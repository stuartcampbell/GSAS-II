

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASIIstrIO &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for GSASIIstrIO</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2014-05-22 13:07:10 -0500 (Thu, 22 May 2014) $</span>
<span class="c"># $Author: vondreele $</span>
<span class="c"># $Revision: 1360 $</span>
<span class="c"># $URL: https://subversion.xor.aps.anl.gov/pyGSAS/trunk/GSASIIstrIO.py $</span>
<span class="c"># $Id: GSASIIstrIO.py 1360 2014-05-22 18:07:10Z vondreele $</span>
<span class="c">########### SVN repository information ###################</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*GSASIIstrIO: structure I/O routines*</span>
<span class="sd">-------------------------------------</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">ospath</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">nl</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="kn">as</span> <span class="nn">so</span>
<span class="kn">import</span> <span class="nn">GSASIIpath</span>
<span class="n">GSASIIpath</span><span class="o">.</span><span class="n">SetVersionNumber</span><span class="p">(</span><span class="s">&quot;$Revision: 1360 $&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">GSASIIElem</span> <span class="kn">as</span> <span class="nn">G2el</span>
<span class="kn">import</span> <span class="nn">GSASIIgrid</span> <span class="kn">as</span> <span class="nn">G2gd</span>
<span class="kn">import</span> <span class="nn">GSASIIlattice</span> <span class="kn">as</span> <span class="nn">G2lat</span>
<span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">G2spc</span>
<span class="kn">import</span> <span class="nn">GSASIIobj</span> <span class="kn">as</span> <span class="nn">G2obj</span>
<span class="kn">import</span> <span class="nn">GSASIImapvars</span> <span class="kn">as</span> <span class="nn">G2mv</span>
<span class="kn">import</span> <span class="nn">GSASIImath</span> <span class="kn">as</span> <span class="nn">G2mth</span>

<span class="n">sind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">cosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">tand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">asind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">acosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">atan2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
<span class="n">ateln2</span> <span class="o">=</span> <span class="mf">8.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span>

<div class="viewcode-block" id="GetControls"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetControls">[docs]</a><span class="k">def</span> <span class="nf">GetControls</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns dictionary of control items found in GSASII gpx file</span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :return: dictionary of control items</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">Controls</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">G2obj</span><span class="o">.</span><span class="n">DefaultControls</span><span class="p">)</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Controls&#39;</span><span class="p">:</span>
            <span class="n">Controls</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Controls</span>
    </div>
<div class="viewcode-block" id="GetConstraints"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetConstraints">[docs]</a><span class="k">def</span> <span class="nf">GetConstraints</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read the constraints from the GPX file and interpret them</span>

<span class="sd">    called in :func:`CheckConstraints`, :func:`GSASIIstrMain.Refine`</span>
<span class="sd">    and :func:`GSASIIstrMain.SeqRefine`. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Constraints&#39;</span><span class="p">:</span>
            <span class="n">constList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">constList</span> <span class="o">+=</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
            <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">constDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">ignored</span> <span class="o">=</span> <span class="n">ProcessConstraints</span><span class="p">(</span><span class="n">constList</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ignored</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">ignored</span><span class="p">,</span><span class="s">&#39;Constraints were rejected. Was a constrained phase, histogram or atom deleted?&#39;</span>
            <span class="k">return</span> <span class="n">constDict</span><span class="p">,</span><span class="n">fixedList</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s">&quot;No constraints in GPX file&quot;</span>
    </div>
<div class="viewcode-block" id="ProcessConstraints"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.ProcessConstraints">[docs]</a><span class="k">def</span> <span class="nf">ProcessConstraints</span><span class="p">(</span><span class="n">constList</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Interpret the constraints in the constList input into a dictionary, etc.</span>
<span class="sd">    All :class:`GSASIIobj.G2VarObj` objects are mapped to the appropriate</span>
<span class="sd">    phase/hist/atoms based on the object internals (random Ids). If this can&#39;t be</span>
<span class="sd">    done (if a phase has been deleted, etc.), the variable is ignored.</span>
<span class="sd">    If the constraint cannot be used due to too many dropped variables,</span>
<span class="sd">    it is counted as ignored.</span>
<span class="sd">    </span>
<span class="sd">    :param list constList: a list of lists where each item in the outer list</span>
<span class="sd">      specifies a constraint of some form, as described in the :mod:`GSASIIobj`</span>
<span class="sd">      :ref:`Constraint definition &lt;Constraint_definitions_table&gt;`.</span>

<span class="sd">    :returns:  a tuple of (constDict,fixedList,ignored) where:</span>
<span class="sd">      </span>
<span class="sd">      * constDict (list of dicts) contains the constraint relationships</span>
<span class="sd">      * fixedList (list) contains the fixed values for each type</span>
<span class="sd">        of constraint.</span>
<span class="sd">      * ignored (int) counts the number of invalid constraint items</span>
<span class="sd">        (should always be zero!)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">constDict</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">fixedList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ignored</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">constList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;h&#39;</span><span class="p">:</span>
            <span class="c"># process a hold</span>
            <span class="n">fixedList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
            <span class="n">var</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;?&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                <span class="n">constDict</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="n">var</span><span class="p">:</span><span class="mf">0.0</span><span class="p">})</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ignored</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span>
            <span class="c"># process a new variable</span>
            <span class="n">fixedList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">varyFlag</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">varname</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;?&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="n">D</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># add extra dict terms for input variable name and vary flag</span>
                <span class="k">if</span> <span class="n">varname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>                    
                    <span class="k">if</span> <span class="n">varname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;::&#39;</span><span class="p">):</span>
                        <span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">varname</span> <span class="o">=</span> <span class="n">varname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">,</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
                    <span class="n">D</span><span class="p">[</span><span class="s">&#39;_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;::&#39;</span> <span class="o">+</span> <span class="n">varname</span>
                <span class="n">D</span><span class="p">[</span><span class="s">&#39;_vary&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">varyFlag</span> <span class="o">==</span> <span class="bp">True</span> <span class="c"># force to bool</span>
                <span class="n">constDict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ignored</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="c">#constFlag[-1] = [&#39;Vary&#39;]</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;c&#39;</span><span class="p">:</span> 
            <span class="c"># process a contraint relationship</span>
            <span class="n">D</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;?&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span>
                    <span class="n">D</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">D</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">fixedList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]))</span>
                <span class="n">constDict</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ignored</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">item</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;e&#39;</span><span class="p">:</span>
            <span class="c"># process an equivalence</span>
            <span class="n">firstmult</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">eqlist</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">item</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="s">&#39;?&#39;</span> <span class="ow">in</span> <span class="n">var</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="n">firstmult</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">firstmult</span> <span class="o">=</span> <span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">firstvar</span> <span class="o">=</span> <span class="n">var</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eqlist</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">var</span><span class="p">,</span><span class="n">firstmult</span><span class="o">/</span><span class="n">term</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">eqlist</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">G2mv</span><span class="o">.</span><span class="n">StoreEquivalence</span><span class="p">(</span><span class="n">firstvar</span><span class="p">,</span><span class="n">eqlist</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ignored</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ignored</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">constDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">ignored</span>
</div>
<div class="viewcode-block" id="CheckConstraints"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.CheckConstraints">[docs]</a><span class="k">def</span> <span class="nf">CheckConstraints</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Load constraints and related info and return any error or warning messages&#39;&#39;&#39;</span>
    <span class="c"># init constraints</span>
    <span class="n">G2mv</span><span class="o">.</span><span class="n">InitVars</span><span class="p">()</span>    
    <span class="c"># get variables</span>
    <span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span> <span class="o">=</span> <span class="n">GetUsedHistogramsAndPhases</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Phases</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;Error: No Phases!&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">Histograms</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">&#39;Error: no diffraction data&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span>
    <span class="n">rigidbodyDict</span> <span class="o">=</span> <span class="n">GetRigidBodies</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="n">rbIds</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;RBIds&#39;</span><span class="p">,{</span><span class="s">&#39;Vector&#39;</span><span class="p">:[],</span><span class="s">&#39;Residue&#39;</span><span class="p">:[]})</span>
    <span class="n">rbVary</span><span class="p">,</span><span class="n">rbDict</span> <span class="o">=</span> <span class="n">GetRigidBodyModels</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">Natoms</span><span class="p">,</span><span class="n">atomIndx</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">,</span><span class="n">pawleyLookup</span><span class="p">,</span><span class="n">FFtables</span><span class="p">,</span><span class="n">BLtables</span> <span class="o">=</span> <span class="n">GetPhaseData</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">RestraintDict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rbIds</span><span class="o">=</span><span class="n">rbIds</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">hapVary</span><span class="p">,</span><span class="n">hapDict</span><span class="p">,</span><span class="n">controlDict</span> <span class="o">=</span> <span class="n">GetHistogramPhaseData</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">histVary</span><span class="p">,</span><span class="n">histDict</span><span class="p">,</span><span class="n">controlDict</span> <span class="o">=</span> <span class="n">GetHistogramData</span><span class="p">(</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">varyList</span> <span class="o">=</span> <span class="n">rbVary</span><span class="o">+</span><span class="n">phaseVary</span><span class="o">+</span><span class="n">hapVary</span><span class="o">+</span><span class="n">histVary</span>
    <span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span> <span class="o">=</span> <span class="n">GetConstraints</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G2mv</span><span class="o">.</span><span class="n">CheckConstraints</span><span class="p">(</span><span class="n">varyList</span><span class="p">,</span><span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="GetRestraints"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetRestraints">[docs]</a><span class="k">def</span> <span class="nf">GetRestraints</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read the restraints from the GPX file.</span>
<span class="sd">    Throws an exception if not found in the .GPX file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Restraints&#39;</span><span class="p">:</span>
            <span class="n">restraintDict</span> <span class="o">=</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">restraintDict</span>
    </div>
<div class="viewcode-block" id="GetRigidBodies"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetRigidBodies">[docs]</a><span class="k">def</span> <span class="nf">GetRigidBodies</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Read the rigid body models from the GPX file</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Rigid bodies&#39;</span><span class="p">:</span>
            <span class="n">rigidbodyDict</span> <span class="o">=</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">rigidbodyDict</span>
        </div>
<div class="viewcode-block" id="GetFprime"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetFprime">[docs]</a><span class="k">def</span> <span class="nf">GetFprime</span><span class="p">(</span><span class="n">controlDict</span><span class="p">,</span><span class="n">Histograms</span><span class="p">):</span>
    <span class="s">&#39;Needs a doc string&#39;</span>
    <span class="n">FFtables</span> <span class="o">=</span> <span class="n">controlDict</span><span class="p">[</span><span class="s">&#39;FFtables&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">FFtables</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">histoList</span> <span class="o">=</span> <span class="n">Histograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">histogram</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">]:</span>
            <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="n">hfx</span> <span class="o">=</span> <span class="s">&#39;:</span><span class="si">%d</span><span class="s">:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span>
            <span class="n">keV</span> <span class="o">=</span> <span class="n">controlDict</span><span class="p">[</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;keV&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">El</span> <span class="ow">in</span> <span class="n">FFtables</span><span class="p">:</span>
                <span class="n">Orbs</span> <span class="o">=</span> <span class="n">G2el</span><span class="o">.</span><span class="n">GetXsectionCoeff</span><span class="p">(</span><span class="n">El</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;-&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">FP</span><span class="p">,</span><span class="n">FPP</span><span class="p">,</span><span class="n">Mu</span> <span class="o">=</span> <span class="n">G2el</span><span class="o">.</span><span class="n">FPcalc</span><span class="p">(</span><span class="n">Orbs</span><span class="p">,</span> <span class="n">keV</span><span class="p">)</span>
                <span class="n">FFtables</span><span class="p">[</span><span class="n">El</span><span class="p">][</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;FP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FP</span>
                <span class="n">FFtables</span><span class="p">[</span><span class="n">El</span><span class="p">][</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;FPP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">FPP</span>                
            </div>
<div class="viewcode-block" id="GetPhaseNames"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetPhaseNames">[docs]</a><span class="k">def</span> <span class="nf">GetPhaseNames</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns a list of phase names found under &#39;Phases&#39; in GSASII gpx file</span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :return: list of phase names</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">PhaseNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;Phases&#39;</span> <span class="o">==</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">datus</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="n">PhaseNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">PhaseNames</span>
</div>
<div class="viewcode-block" id="GetAllPhaseData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetAllPhaseData">[docs]</a><span class="k">def</span> <span class="nf">GetAllPhaseData</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">PhaseName</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns the entire dictionary for PhaseName from GSASII gpx file</span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param str PhaseName: phase name</span>
<span class="sd">    :return: phase dictionary</span>
<span class="sd">    &#39;&#39;&#39;</span>        
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">General</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">Atoms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;Phases&#39;</span> <span class="o">==</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">datus</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">PhaseName</span><span class="p">:</span>
                    <span class="k">break</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">datus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="GetHistograms"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetHistograms">[docs]</a><span class="k">def</span> <span class="nf">GetHistograms</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">hNames</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a dictionary of histograms found in GSASII gpx file</span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param str hNames: list of histogram names</span>
<span class="sd">    :return: dictionary of histograms (types = PWDR &amp; HKLF)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">Histograms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hist</span> <span class="o">=</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">hNames</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
                <span class="n">PWDRdata</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">PWDRdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>        <span class="c">#weight factor</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>          <span class="c">#masked powder data arrays/clear previous masks</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Limits &amp; excluded regions (if any)</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Background</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Instrument parameters</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Sample parameters</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">PWDRdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Reflection lists might be missing</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    
                <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span> <span class="o">=</span> <span class="n">PWDRdata</span>
            <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
                <span class="n">HKLFdata</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">HKLFdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>        <span class="c">#weight factor</span>
<span class="c">#patch</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="nb">list</span><span class="p">):</span>
                    <span class="n">RefData</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;RefList&#39;</span><span class="p">:[],</span><span class="s">&#39;FF&#39;</span><span class="p">:{}}</span>
                    <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">RefData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">ref</span><span class="p">[</span><span class="mi">13</span><span class="p">],])</span>
                    <span class="n">RefData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">RefData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">])</span>
                    <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefData</span>
<span class="c">#end patch</span>
                <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;FF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">HKLFdata</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datum</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">HKLFdata</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>       <span class="c">#Instrument parameters</span>
                <span class="n">HKLFdata</span><span class="p">[</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">HKLFdata</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span> <span class="o">=</span> <span class="n">HKLFdata</span>           
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Histograms</span>
    </div>
<div class="viewcode-block" id="GetHistogramNames"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetHistogramNames">[docs]</a><span class="k">def</span> <span class="nf">GetHistogramNames</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">hType</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a list of histogram names found in GSASII gpx file</span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param str hType: list of histogram types</span>
<span class="sd">    :return: list of histogram names (types = PWDR &amp; HKLF)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fl</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">HistogramNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hType</span><span class="p">:</span>
            <span class="n">HistogramNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">fl</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HistogramNames</span>
    </div>
<div class="viewcode-block" id="GetUsedHistogramsAndPhases"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetUsedHistogramsAndPhases">[docs]</a><span class="k">def</span> <span class="nf">GetUsedHistogramsAndPhases</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Returns all histograms that are found in any phase</span>
<span class="sd">    and any phase that uses a histogram. This also</span>
<span class="sd">    assigns numbers to used phases and histograms by the</span>
<span class="sd">    order they appear in the file. </span>

<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :returns: (Histograms,Phases)</span>

<span class="sd">     * Histograms = dictionary of histograms as {name:data,...}</span>
<span class="sd">     * Phases = dictionary of phases that use histograms</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">phaseNames</span> <span class="o">=</span> <span class="n">GetPhaseNames</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="n">histoList</span> <span class="o">=</span> <span class="n">GetHistogramNames</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,[</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">])</span>
    <span class="n">allHistograms</span> <span class="o">=</span> <span class="n">GetHistograms</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">histoList</span><span class="p">)</span>
    <span class="n">phaseData</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">phaseNames</span><span class="p">:</span> 
        <span class="n">phaseData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span>  <span class="n">GetAllPhaseData</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="n">Histograms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">Phases</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phaseData</span><span class="p">:</span>
        <span class="n">Phase</span> <span class="o">=</span> <span class="n">phaseData</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
                <span class="n">pId</span> <span class="o">=</span> <span class="n">phaseNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;pId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pId</span>
                <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phase</span>
            <span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="s">&#39;Use&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">]:</span>      <span class="c">#patch</span>
                    <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;Use&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>         
                <span class="k">if</span> <span class="n">hist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Histograms</span> <span class="ow">and</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;Use&#39;</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span> <span class="o">=</span> <span class="n">allHistograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span>
                        <span class="n">hId</span> <span class="o">=</span> <span class="n">histoList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
                        <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;hId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hId</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="c"># would happen if a referenced histogram were</span>
                        <span class="c"># renamed or deleted</span>
                        <span class="k">print</span><span class="p">(</span><span class="s">&#39;For phase &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">+</span>
                              <span class="s">&#39;&quot; unresolved reference to histogram &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
    <span class="n">G2obj</span><span class="o">.</span><span class="n">IndexAllIds</span><span class="p">(</span><span class="n">Histograms</span><span class="o">=</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span><span class="o">=</span><span class="n">Phases</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span>
    </div>
<div class="viewcode-block" id="getBackupName"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.getBackupName">[docs]</a><span class="k">def</span> <span class="nf">getBackupName</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">makeBack</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Get the name for the backup .gpx file name</span>
<span class="sd">    </span>
<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param bool makeBack: if True the name of a new file is returned, if</span>
<span class="sd">      False the name of the last file that exists is returned</span>
<span class="sd">    :returns: the name of a backup file</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">GPXpath</span><span class="p">,</span><span class="n">GPXname</span> <span class="o">=</span> <span class="n">ospath</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">GPXpath</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span> <span class="n">GPXpath</span> <span class="o">=</span> <span class="s">&#39;.&#39;</span>
    <span class="n">Name</span> <span class="o">=</span> <span class="n">ospath</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">GPXname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">GPXpath</span><span class="p">)</span>
    <span class="n">last</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">Name</span> <span class="ow">and</span> <span class="s">&#39;bak&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">makeBack</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;bak&#39;</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">last</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">last</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;bak&#39;</span><span class="p">)))</span>
    <span class="n">GPXback</span> <span class="o">=</span> <span class="n">ospath</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">GPXpath</span><span class="p">,</span><span class="n">ospath</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">GPXname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.bak&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">last</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;.gpx&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GPXback</span>    
        </div>
<div class="viewcode-block" id="GPXBackup"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GPXBackup">[docs]</a><span class="k">def</span> <span class="nf">GPXBackup</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">makeBack</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    makes a backup of the current .gpx file (?)</span>
<span class="sd">    </span>
<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param bool makeBack: if True (default), the backup is written to</span>
<span class="sd">      a new file; if False, the last backup is overwritten</span>
<span class="sd">    :returns: the name of the backup file that was written</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">distutils.file_util</span> <span class="kn">as</span> <span class="nn">dfu</span>
    <span class="n">GPXback</span> <span class="o">=</span> <span class="n">getBackupName</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">makeBack</span><span class="p">)</span>
    <span class="n">dfu</span><span class="o">.</span><span class="n">copy_file</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">GPXback</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">GPXback</span>
</div>
<div class="viewcode-block" id="SetUsedHistogramsAndPhases"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetUsedHistogramsAndPhases">[docs]</a><span class="k">def</span> <span class="nf">SetUsedHistogramsAndPhases</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span><span class="p">,</span><span class="n">RigidBodies</span><span class="p">,</span><span class="n">CovData</span><span class="p">,</span><span class="n">makeBack</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Updates gpxfile from all histograms that are found in any phase</span>
<span class="sd">    and any phase that used a histogram. Also updates rigid body definitions.</span>


<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    :param dict Histograms: dictionary of histograms as {name:data,...}</span>
<span class="sd">    :param dict Phases: dictionary of phases that use histograms</span>
<span class="sd">    :param dict RigidBodies: dictionary of rigid bodies</span>
<span class="sd">    :param dict CovData: dictionary of refined variables, varyList, &amp; covariance matrix</span>
<span class="sd">    :param bool makeBack: True if new backup of .gpx file is to be made; else use the last one made</span>

<span class="sd">    &#39;&#39;&#39;</span>
                        
    <span class="n">GPXback</span> <span class="o">=</span> <span class="n">GPXBackup</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">makeBack</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Read from file:&#39;</span><span class="p">,</span><span class="n">GPXback</span>
    <span class="k">print</span> <span class="s">&#39;Save to file  :&#39;</span><span class="p">,</span><span class="n">GPXfile</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXback</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c">#        print &#39;read: &#39;,datum[0]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Phases&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">iphase</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">iphase</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
                    <span class="n">phaseName</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">iphase</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data</span><span class="p">[</span><span class="n">iphase</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Phases</span><span class="p">[</span><span class="n">phaseName</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Covariance&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CovData</span>
        <span class="k">elif</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Rigid bodies&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RigidBodies</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
<span class="c">#            print &#39;found &#39;,datum[0]</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">datus</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
<span class="c">#                print &#39;    read: &#39;,datus[0]</span>
                <span class="k">if</span> <span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">,</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">,</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]:</span>
                    <span class="n">datus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
                                
        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;GPX file save successful&#39;</span>
    </div>
<div class="viewcode-block" id="SetSeqResult"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetSeqResult">[docs]</a><span class="k">def</span> <span class="nf">SetSeqResult</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">SeqResult</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Needs doc string</span>
<span class="sd">    </span>
<span class="sd">    :param str GPXfile: full .gpx file name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">GPXback</span> <span class="o">=</span> <span class="n">GPXBackup</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;Read from file:&#39;</span><span class="p">,</span><span class="n">GPXback</span>
    <span class="k">print</span> <span class="s">&#39;Save to file  :&#39;</span><span class="p">,</span><span class="n">GPXfile</span>
    <span class="n">infile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXback</span><span class="p">,</span><span class="s">&#39;rb&#39;</span><span class="p">)</span>
    <span class="n">outfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">GPXfile</span><span class="p">,</span><span class="s">&#39;wb&#39;</span><span class="p">)</span>
    <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">datum</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Sequential results&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">SeqResult</span>
        <span class="c"># reset the Copy Next flag, since it should not be needed twice in a row</span>
        <span class="k">if</span> <span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;Controls&#39;</span><span class="p">:</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;Copy2Next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">datum</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">histogram</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">datus</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">,</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">,</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]:</span>
                    <span class="n">datus</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="n">datus</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
                                
        <span class="n">cPickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">outfile</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">infile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">outfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;GPX file save successful&#39;</span>
                        </div>
<div class="viewcode-block" id="ShowBanner"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.ShowBanner">[docs]</a><span class="k">def</span> <span class="nf">ShowBanner</span><span class="p">(</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;Print authorship, copyright and citation notice&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">80</span><span class="o">*</span><span class="s">&#39;*&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;   General Structure Analysis System-II Crystal Structure Refinement&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;              by Robert B. Von Dreele &amp; Brian H. Toby&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;                Argonne National Laboratory(C), 2010&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; This product includes software developed by the UChicago Argonne, LLC,&#39;</span> 
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;            as Operator of Argonne National Laboratory.&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;                          Please cite:&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;   B.H. Toby &amp; R.B. Von Dreele, J. Appl. Cryst. 46, 544-549 (2013)&#39;</span>

    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">80</span><span class="o">*</span><span class="s">&#39;*&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
</div>
<div class="viewcode-block" id="ShowControls"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.ShowControls">[docs]</a><span class="k">def</span> <span class="nf">ShowControls</span><span class="p">(</span><span class="n">Controls</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">SeqRef</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="s">&#39;Print controls information&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Least squares controls:&#39;</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Refinement type: &#39;</span><span class="p">,</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;Hessian&#39;</span> <span class="ow">in</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">]:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Maximum number of cycles:&#39;</span><span class="p">,</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Minimum delta-M/M for convergence: &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;min dM/M&#39;</span><span class="p">])</span>
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Initial shift factor: &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;shift factor&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">SeqRef</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Sequential refinement controls:&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Copy of histogram results to next: &#39;</span><span class="p">,</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;Copy2Next&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Process histograms in reverse order: &#39;</span><span class="p">,</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;Reverse Seq&#39;</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="GetPawleyConstr"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetPawleyConstr">[docs]</a><span class="k">def</span> <span class="nf">GetPawleyConstr</span><span class="p">(</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">PawleyRef</span><span class="p">,</span><span class="n">pawleyVary</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
<span class="c">#    if SGLaue in [&#39;-1&#39;,&#39;2/m&#39;,&#39;mmm&#39;]:</span>
<span class="c">#        return                      #no Pawley symmetry required constraints</span>
    <span class="n">eqvDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">varyI</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pawleyVary</span><span class="p">):</span>
        <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">refI</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">varyI</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ih</span><span class="p">,</span><span class="n">ik</span><span class="p">,</span><span class="n">il</span> <span class="o">=</span> <span class="n">PawleyRef</span><span class="p">[</span><span class="n">refI</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">dspI</span> <span class="o">=</span> <span class="n">PawleyRef</span><span class="p">[</span><span class="n">refI</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">varyJ</span> <span class="ow">in</span> <span class="n">pawleyVary</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">refJ</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">varyJ</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">jh</span><span class="p">,</span><span class="n">jk</span><span class="p">,</span><span class="n">jl</span> <span class="o">=</span> <span class="n">PawleyRef</span><span class="p">[</span><span class="n">refJ</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">dspJ</span> <span class="o">=</span> <span class="n">PawleyRef</span><span class="p">[</span><span class="n">refJ</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
                <span class="n">isum</span> <span class="o">=</span> <span class="n">ih</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ik</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">jsum</span> <span class="o">=</span> <span class="n">jh</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jk</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">il</span><span class="p">)</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jl</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isum</span> <span class="o">==</span> <span class="n">jsum</span><span class="p">:</span>
                    <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varyJ</span><span class="p">)</span> 
            <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
                <span class="n">isum</span> <span class="o">=</span> <span class="n">ih</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ik</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">il</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">jsum</span> <span class="o">=</span> <span class="n">jh</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jk</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jl</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">isum2</span> <span class="o">=</span> <span class="n">ih</span><span class="o">*</span><span class="n">ik</span><span class="o">+</span><span class="n">ih</span><span class="o">*</span><span class="n">il</span><span class="o">+</span><span class="n">ik</span><span class="o">*</span><span class="n">il</span>
                <span class="n">jsum2</span> <span class="o">=</span> <span class="n">jh</span><span class="o">*</span><span class="n">jk</span><span class="o">+</span><span class="n">jh</span><span class="o">*</span><span class="n">jl</span><span class="o">+</span><span class="n">jk</span><span class="o">*</span><span class="n">jl</span>
                <span class="k">if</span> <span class="n">isum</span> <span class="o">==</span> <span class="n">jsum</span> <span class="ow">and</span> <span class="n">isum2</span> <span class="o">==</span> <span class="n">jsum2</span><span class="p">:</span>
                    <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varyJ</span><span class="p">)</span> 
            <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">,</span><span class="s">&#39;6/m&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">]:</span>
                <span class="n">isum</span> <span class="o">=</span> <span class="n">ih</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ik</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ih</span><span class="o">*</span><span class="n">ik</span>
                <span class="n">jsum</span> <span class="o">=</span> <span class="n">jh</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jk</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jh</span><span class="o">*</span><span class="n">jk</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">il</span><span class="p">)</span> <span class="o">==</span> <span class="nb">abs</span><span class="p">(</span><span class="n">jl</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isum</span> <span class="o">==</span> <span class="n">jsum</span><span class="p">:</span>
                    <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varyJ</span><span class="p">)</span> 
            <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
                <span class="n">isum</span> <span class="o">=</span> <span class="n">ih</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">ik</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">il</span><span class="o">**</span><span class="mi">2</span>
                <span class="n">jsum</span> <span class="o">=</span> <span class="n">jh</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jk</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">jl</span><span class="o">**</span><span class="mi">2</span>
                <span class="k">if</span> <span class="n">isum</span> <span class="o">==</span> <span class="n">jsum</span><span class="p">:</span>
                    <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varyJ</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dspI</span><span class="o">-</span><span class="n">dspJ</span><span class="p">)</span><span class="o">/</span><span class="n">dspI</span> <span class="o">&lt;</span> <span class="mf">1.e-4</span><span class="p">:</span>
                <span class="n">eqvDict</span><span class="p">[</span><span class="n">varyI</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">varyJ</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">pawleyVary</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">eqvDict</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">pawleyVary</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item2</span> <span class="ow">in</span> <span class="n">eqvDict</span><span class="p">[</span><span class="n">item</span><span class="p">]:</span>
                    <span class="n">eqvDict</span><span class="p">[</span><span class="n">item2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">StoreEquivalence</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">eqvDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    </div>
<div class="viewcode-block" id="cellVary"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.cellVary">[docs]</a><span class="k">def</span> <span class="nf">cellVary</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span> 
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;-1&#39;</span><span class="p">,]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;2/m&#39;</span><span class="p">,]:</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;6/m&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span> <span class="s">&#39;31m&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span> <span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">]</span>                       
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3m&#39;</span><span class="p">,</span><span class="s">&#39;m3&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,]</span>
        
<span class="c">################################################################################</span>
<span class="c">##### Rigid Body Models and not General.get(&#39;doPawley&#39;)</span>
<span class="c">################################################################################</span>
        </div>
<div class="viewcode-block" id="GetRigidBodyModels"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetRigidBodyModels">[docs]</a><span class="k">def</span> <span class="nf">GetRigidBodyModels</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">PrintResRBModel</span><span class="p">(</span><span class="n">RBModel</span><span class="p">):</span>
        <span class="n">atNames</span> <span class="o">=</span> <span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;atNames&#39;</span><span class="p">]</span>
        <span class="n">rbRef</span> <span class="o">=</span> <span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbRef&#39;</span><span class="p">]</span>
        <span class="n">rbSeq</span> <span class="o">=</span> <span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbSeq&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Residue RB name: &#39;</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;RBname&#39;</span><span class="p">],</span><span class="s">&#39; no.atoms: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbTypes&#39;</span><span class="p">]),</span> \
            <span class="s">&#39;No. times used: &#39;</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;useCount&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;    At name       x          y          z&#39;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">xyz</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">atNames</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbXYZ&#39;</span><span class="p">]):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  </span><span class="si">%8s</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Orientation defined by:&#39;</span><span class="p">,</span><span class="n">atNames</span><span class="p">[</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="s">&#39; -&gt; &#39;</span><span class="p">,</span><span class="n">atNames</span><span class="p">[</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> \
            <span class="s">&#39; &amp; &#39;</span><span class="p">,</span><span class="n">atNames</span><span class="p">[</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="s">&#39; -&gt; &#39;</span><span class="p">,</span><span class="n">atNames</span><span class="p">[</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">rbSeq</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">rbseq</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rbSeq</span><span class="p">):</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Torsion sequence &#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39; Bond: &#39;</span><span class="o">+</span><span class="n">atNames</span><span class="p">[</span><span class="n">rbseq</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="s">&#39; - &#39;</span><span class="p">,</span> \
                    <span class="n">atNames</span><span class="p">[</span><span class="n">rbseq</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="s">&#39; riding: &#39;</span><span class="p">,[</span><span class="n">atNames</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rbseq</span><span class="p">[</span><span class="mi">3</span><span class="p">]]</span>
        
    <span class="k">def</span> <span class="nf">PrintVecRBModel</span><span class="p">(</span><span class="n">RBModel</span><span class="p">):</span>
        <span class="n">rbRef</span> <span class="o">=</span> <span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbRef&#39;</span><span class="p">]</span>
        <span class="n">atTypes</span> <span class="o">=</span> <span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbTypes&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Vector RB name: &#39;</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;RBname&#39;</span><span class="p">],</span><span class="s">&#39; no.atoms: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbTypes&#39;</span><span class="p">]),</span> \
            <span class="s">&#39;No. times used: &#39;</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;useCount&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;VectMag&#39;</span><span class="p">])):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Vector no.: &#39;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s">&#39; Magnitude: &#39;</span><span class="p">,</span> \
                <span class="s">&#39;</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;VectMag&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span><span class="s">&#39; Refine? &#39;</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;VectRef&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  No. Type     vx         vy         vz&#39;</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,[</span><span class="n">name</span><span class="p">,</span><span class="n">xyz</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atTypes</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbVect&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])):</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  </span><span class="si">%d</span><span class="s">   </span><span class="si">%2s</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  No. Type      x          y          z&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,[</span><span class="n">name</span><span class="p">,</span><span class="n">xyz</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atTypes</span><span class="p">,</span><span class="n">RBModel</span><span class="p">[</span><span class="s">&#39;rbXYZ&#39;</span><span class="p">])):</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  </span><span class="si">%d</span><span class="s">   </span><span class="si">%2s</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">xyz</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Orientation defined by: atom &#39;</span><span class="p">,</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39; -&gt; atom &#39;</span><span class="p">,</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> \
            <span class="s">&#39; &amp; atom &#39;</span><span class="p">,</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39; -&gt; atom &#39;</span><span class="p">,</span><span class="n">rbRef</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">rbVary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rbDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rbIds</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;RBIds&#39;</span><span class="p">,{</span><span class="s">&#39;Vector&#39;</span><span class="p">:[],</span><span class="s">&#39;Residue&#39;</span><span class="p">:[]})</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">irb</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]):</span>
            <span class="k">if</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;useCount&#39;</span><span class="p">]:</span>
                <span class="n">RBmags</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;VectMag&#39;</span><span class="p">]</span>
                <span class="n">RBrefs</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;VectRef&#39;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,[</span><span class="n">mag</span><span class="p">,</span><span class="n">ref</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">RBmags</span><span class="p">,</span><span class="n">RBrefs</span><span class="p">)):</span>
                    <span class="n">pid</span> <span class="o">=</span> <span class="s">&#39;::RBV;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">irb</span><span class="p">)</span>
                    <span class="n">rbDict</span><span class="p">[</span><span class="n">pid</span><span class="p">]</span> <span class="o">=</span> <span class="n">mag</span>
                    <span class="k">if</span> <span class="n">ref</span><span class="p">:</span>
                        <span class="n">rbVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Vector rigid body model:&#39;</span>
                    <span class="n">PrintVecRBModel</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;useCount&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Residue rigid body model:&#39;</span>
                    <span class="n">PrintResRBModel</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">rbVary</span><span class="p">,</span><span class="n">rbDict</span>
    </div>
<div class="viewcode-block" id="SetRigidBodyModels"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetRigidBodyModels">[docs]</a><span class="k">def</span> <span class="nf">SetRigidBodyModels</span><span class="p">(</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">,</span><span class="n">rigidbodyDict</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">PrintRBVectandSig</span><span class="p">(</span><span class="n">VectRB</span><span class="p">,</span><span class="n">VectSig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Rigid body vector magnitudes for &#39;</span><span class="o">+</span><span class="n">VectRB</span><span class="p">[</span><span class="s">&#39;RBname&#39;</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,[</span><span class="n">val</span><span class="p">,</span><span class="n">sig</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">VectRB</span><span class="p">[</span><span class="s">&#39;VectMag&#39;</span><span class="p">],</span><span class="n">VectSig</span><span class="p">)):</span>
            <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Vect &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sig</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>        
        
    <span class="n">RBIds</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;RBIds&#39;</span><span class="p">,{</span><span class="s">&#39;Vector&#39;</span><span class="p">:[],</span><span class="s">&#39;Residue&#39;</span><span class="p">:[]})</span>  <span class="c">#these are lists of rbIds</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">RBIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]:</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">irb</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RBIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]):</span>
        <span class="k">if</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;useCount&#39;</span><span class="p">]:</span>
            <span class="n">VectSig</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">RBmags</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="s">&#39;VectMag&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">mag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RBmags</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;::RBV;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">irb</span><span class="p">)</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">VectSig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="n">PrintRBVectandSig</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">],</span><span class="n">VectSig</span><span class="p">)</span>    
        
<span class="c">################################################################################</span>
<span class="c">##### Phase data</span>
<span class="c">################################################################################        </span>
                    </div>
<div class="viewcode-block" id="GetPhaseData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetPhaseData">[docs]</a><span class="k">def</span> <span class="nf">GetPhaseData</span><span class="p">(</span><span class="n">PhaseData</span><span class="p">,</span><span class="n">RestraintDict</span><span class="o">=</span><span class="p">{},</span><span class="n">rbIds</span><span class="o">=</span><span class="p">{},</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
            
    <span class="k">def</span> <span class="nf">PrintFFtable</span><span class="p">(</span><span class="n">FFtable</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> X-ray scattering factors:&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;   Symbol     fa                                      fb                                      fc&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">99</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
        <span class="k">for</span> <span class="n">Ename</span> <span class="ow">in</span> <span class="n">FFtable</span><span class="p">:</span>
            <span class="n">ffdata</span> <span class="o">=</span> <span class="n">FFtable</span><span class="p">[</span><span class="n">Ename</span><span class="p">]</span>
            <span class="n">fa</span> <span class="o">=</span> <span class="n">ffdata</span><span class="p">[</span><span class="s">&#39;fa&#39;</span><span class="p">]</span>
            <span class="n">fb</span> <span class="o">=</span> <span class="n">ffdata</span><span class="p">[</span><span class="s">&#39;fb&#39;</span><span class="p">]</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; </span><span class="si">%8s</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s"> </span><span class="si">%9.5f</span><span class="s">&#39;</span> <span class="o">%</span>  \
                <span class="p">(</span><span class="n">Ename</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="n">fa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fa</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fa</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">fb</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fb</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">fb</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">fb</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ffdata</span><span class="p">[</span><span class="s">&#39;fc&#39;</span><span class="p">])</span>
                
    <span class="k">def</span> <span class="nf">PrintBLtable</span><span class="p">(</span><span class="n">BLtable</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Neutron scattering factors:&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;   Symbol   isotope       mass       b       resonant terms&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">99</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
        <span class="k">for</span> <span class="n">Ename</span> <span class="ow">in</span> <span class="n">BLtable</span><span class="p">:</span>
            <span class="n">bldata</span> <span class="o">=</span> <span class="n">BLtable</span><span class="p">[</span><span class="n">Ename</span><span class="p">]</span>
            <span class="n">isotope</span> <span class="o">=</span> <span class="n">bldata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">mass</span> <span class="o">=</span> <span class="n">bldata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;Mass&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;SL&#39;</span> <span class="ow">in</span> <span class="n">bldata</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">blen</span> <span class="o">=</span> <span class="n">bldata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;SL&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">bres</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">blen</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">bres</span> <span class="o">=</span> <span class="n">bldata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;BW-LS&#39;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; </span><span class="si">%8s%11s</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ename</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span><span class="n">isotope</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span><span class="n">mass</span><span class="p">,</span><span class="n">blen</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">bres</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.5g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
            
    <span class="k">def</span> <span class="nf">PrintRBObjects</span><span class="p">(</span><span class="n">resRBData</span><span class="p">,</span><span class="n">vecRBData</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">PrintRBThermals</span><span class="p">():</span>
            <span class="n">tlstr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;11&#39;</span><span class="p">,</span><span class="s">&#39;22&#39;</span><span class="p">,</span><span class="s">&#39;33&#39;</span><span class="p">,</span><span class="s">&#39;12&#39;</span><span class="p">,</span><span class="s">&#39;13&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">]</span>
            <span class="n">sstr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;12&#39;</span><span class="p">,</span><span class="s">&#39;13&#39;</span><span class="p">,</span><span class="s">&#39;21&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">,</span><span class="s">&#39;31&#39;</span><span class="p">,</span><span class="s">&#39;32&#39;</span><span class="p">,</span><span class="s">&#39;AA&#39;</span><span class="p">,</span><span class="s">&#39;BB&#39;</span><span class="p">]</span>
            <span class="n">TLS</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">TLSvar</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;TLS data&#39;</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;T&#39;</span><span class="o">+</span><span class="n">tlstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; </span><span class="si">%8.4f</span><span class="s"> </span><span class="si">%s</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">TLS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">TLSvar</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>
                <span class="k">if</span> <span class="s">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span> 
                    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">):</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;L&#39;</span><span class="o">+</span><span class="n">tlstr</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; </span><span class="si">%8.2f</span><span class="s"> </span><span class="si">%s</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">TLS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">TLSvar</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>
                <span class="k">if</span> <span class="s">&#39;S&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">20</span><span class="p">):</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;S&#39;</span><span class="o">+</span><span class="n">sstr</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">12</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">TLS</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">TLSvar</span><span class="p">[</span><span class="n">i</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>
            <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Uiso data&#39;</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;Uiso&#39;</span><span class="o">+</span><span class="s">&#39; </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">TLS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">TLSvar</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>           
            
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">resRBData</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">RB</span> <span class="ow">in</span> <span class="n">resRBData</span><span class="p">:</span>
                <span class="n">Oxyz</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Qrijk</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Angle</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">acosd</span><span class="p">(</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">RBObject &#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;RBname&#39;</span><span class="p">],</span><span class="s">&#39; at &#39;</span><span class="p">,</span>      \
                    <span class="s">&#39;</span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Orientation angle,vector:&#39;</span><span class="p">,</span>      \
                    <span class="s">&#39;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Angle</span><span class="p">,</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="s">&#39; Refine? &#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">Torsions</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Torsions&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Torsions</span><span class="p">):</span>
                    <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;Torsions: &#39;</span>
                    <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">Torsions</span><span class="p">:</span>
                        <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.4f</span><span class="s"> Refine? </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>
                <span class="n">PrintRBThermals</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vecRBData</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">RB</span> <span class="ow">in</span> <span class="n">vecRBData</span><span class="p">:</span>
                <span class="n">Oxyz</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Qrijk</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Angle</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">acosd</span><span class="p">(</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">RBObject &#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;RBname&#39;</span><span class="p">],</span><span class="s">&#39; at &#39;</span><span class="p">,</span>      \
                    <span class="s">&#39;</span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Oxyz</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>           
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;Orientation angle,vector:&#39;</span><span class="p">,</span>      \
                    <span class="s">&#39;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s"> </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Angle</span><span class="p">,</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">Qrijk</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="s">&#39; Refine? &#39;</span><span class="p">,</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">PrintRBThermals</span><span class="p">()</span>
                
    <span class="k">def</span> <span class="nf">PrintAtoms</span><span class="p">(</span><span class="n">General</span><span class="p">,</span><span class="n">Atoms</span><span class="p">):</span>
        <span class="n">cx</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="n">cia</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomPtrs&#39;</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Atoms:&#39;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;   name    type  refine?   x         y         z    &#39;</span><span class="o">+</span> \
            <span class="s">&#39;  frac site sym  mult I/A   Uiso     U11     U22     U33     U12     U13     U23&#39;</span>
        <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;magnetic&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;   Mx     My     Mz&#39;</span>
        <span class="k">elif</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;macromolecular&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; res no residue chain&#39;</span><span class="o">+</span><span class="n">line</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nuclear&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Atoms</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> \
                    <span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%5d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%5s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">48</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">])</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">elif</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;macromolecular&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>            
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Atoms</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> \
                    <span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%5d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%5s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">48</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">j</span><span class="p">])</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        
    <span class="k">def</span> <span class="nf">PrintTexture</span><span class="p">(</span><span class="n">textureData</span><span class="p">):</span>
        <span class="n">topstr</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> Spherical harmonics texture: Order:&#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">]:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">topstr</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">topstr</span>
            <span class="k">return</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">,</span><span class="s">&#39;chi&#39;</span><span class="p">,</span><span class="s">&#39;phi&#39;</span><span class="p">]</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; SH &#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Texture coefficients:&#39;</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">SHcoeff</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">SHcoeff</span><span class="p">:</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">SHcoeff</span><span class="p">[</span><span class="n">item</span><span class="p">])</span> 
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        
    <span class="k">def</span> <span class="nf">MakeRBParms</span><span class="p">(</span><span class="n">rbKey</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">):</span>
        <span class="n">rbid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rbids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;RBId&#39;</span><span class="p">]))</span>
        <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;P&#39;</span>
        <span class="n">pstr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;x&#39;</span><span class="p">,</span><span class="s">&#39;y&#39;</span><span class="p">,</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">ostr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;i&#39;</span><span class="p">,</span><span class="s">&#39;j&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="n">pstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
            <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orig&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
        <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;O&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="n">ostr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
            <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;AV&#39;</span> <span class="ow">and</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
            <span class="k">elif</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;Orient&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span><span class="p">:</span>
                <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
            
    <span class="k">def</span> <span class="nf">MakeRBThermals</span><span class="p">(</span><span class="n">rbKey</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">):</span>
        <span class="n">rbid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rbids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;RBId&#39;</span><span class="p">]))</span>
        <span class="n">tlstr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;11&#39;</span><span class="p">,</span><span class="s">&#39;22&#39;</span><span class="p">,</span><span class="s">&#39;33&#39;</span><span class="p">,</span><span class="s">&#39;12&#39;</span><span class="p">,</span><span class="s">&#39;13&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">]</span>
        <span class="n">sstr</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;12&#39;</span><span class="p">,</span><span class="s">&#39;13&#39;</span><span class="p">,</span><span class="s">&#39;21&#39;</span><span class="p">,</span><span class="s">&#39;23&#39;</span><span class="p">,</span><span class="s">&#39;31&#39;</span><span class="p">,</span><span class="s">&#39;32&#39;</span><span class="p">,</span><span class="s">&#39;AA&#39;</span><span class="p">,</span><span class="s">&#39;BB&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;T&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="n">tlstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
        <span class="k">if</span> <span class="s">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;L&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="n">tlstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">6</span><span class="p">]:</span>
                    <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
        <span class="k">if</span> <span class="s">&#39;S&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;S&#39;</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="n">sstr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">12</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="o">+</span><span class="mi">12</span><span class="p">]:</span>
                    <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
        <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;U:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
            <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">RB</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
                
    <span class="k">def</span> <span class="nf">MakeRBTorsions</span><span class="p">(</span><span class="n">rbKey</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">):</span>
        <span class="n">rbid</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rbids</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;RBId&#39;</span><span class="p">]))</span>
        <span class="n">pfxRB</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RB&#39;</span><span class="o">+</span><span class="n">rbKey</span><span class="o">+</span><span class="s">&#39;Tr;&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">torsion</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RB</span><span class="p">[</span><span class="s">&#39;Torsions&#39;</span><span class="p">]):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfxRB</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">iRB</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbid</span>
            <span class="n">phaseDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">torsion</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">phaseVary</span> <span class="o">+=</span> <span class="p">[</span><span class="n">name</span><span class="p">,]</span>
                    
    <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
        <span class="k">print</span>  <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phases:&#39;</span>
    <span class="n">phaseVary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">phaseDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">phaseConstr</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">pawleyLookup</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">FFtables</span> <span class="o">=</span> <span class="p">{}</span>                   <span class="c">#scattering factors - xrays</span>
    <span class="n">BLtables</span> <span class="o">=</span> <span class="p">{}</span>                   <span class="c"># neutrons</span>
    <span class="n">Natoms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">AtMults</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">AtIA</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">shModels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;cylindrical&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;shear - 2/m&#39;</span><span class="p">,</span><span class="s">&#39;rolling - mmm&#39;</span><span class="p">]</span>
    <span class="n">SamSym</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">shModels</span><span class="p">,[</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;-1&#39;</span><span class="p">,</span><span class="s">&#39;2/m&#39;</span><span class="p">,</span><span class="s">&#39;mmm&#39;</span><span class="p">]))</span>
    <span class="n">atomIndx</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">PhaseData</span><span class="p">:</span>
        <span class="n">General</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
        <span class="n">pId</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span>
        <span class="n">FFtable</span> <span class="o">=</span> <span class="n">G2el</span><span class="o">.</span><span class="n">GetFFtable</span><span class="p">(</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">])</span>
        <span class="n">BLtable</span> <span class="o">=</span> <span class="n">G2el</span><span class="o">.</span><span class="n">GetBLtable</span><span class="p">(</span><span class="n">General</span><span class="p">)</span>
        <span class="n">FFtables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">FFtable</span><span class="p">)</span>
        <span class="n">BLtables</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">BLtable</span><span class="p">)</span>
        <span class="n">Atoms</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;Atoms&#39;</span><span class="p">]</span>
        <span class="n">AtLookup</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">FillAtomLookUp</span><span class="p">(</span><span class="n">Atoms</span><span class="p">)</span>
        <span class="n">PawleyRef</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Pawley ref&#39;</span><span class="p">,[])</span>
        <span class="n">SGData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
        <span class="n">SGtext</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">SGPrint</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Cell&#39;</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">phaseDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">:</span><span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Vol&#39;</span><span class="p">:</span><span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)})</span>
        <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">phaseVary</span> <span class="o">+=</span> <span class="n">cellVary</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
        <span class="n">resRBData</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;RBModels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Residue&#39;</span><span class="p">,[])</span>
        <span class="k">if</span> <span class="n">resRBData</span><span class="p">:</span>
            <span class="n">rbids</span> <span class="o">=</span> <span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">]</span>    <span class="c">#NB: used in the MakeRB routines</span>
            <span class="k">for</span> <span class="n">iRB</span><span class="p">,</span><span class="n">RB</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">resRBData</span><span class="p">):</span>
                <span class="n">MakeRBParms</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">)</span>
                <span class="n">MakeRBThermals</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">)</span>
                <span class="n">MakeRBTorsions</span><span class="p">(</span><span class="s">&#39;R&#39;</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">)</span>
        
        <span class="n">vecRBData</span> <span class="o">=</span> <span class="n">PhaseData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;RBModels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Vector&#39;</span><span class="p">,[])</span>
        <span class="k">if</span> <span class="n">vecRBData</span><span class="p">:</span>
            <span class="n">rbids</span> <span class="o">=</span> <span class="n">rbIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]</span>    <span class="c">#NB: used in the MakeRB routines</span>
            <span class="k">for</span> <span class="n">iRB</span><span class="p">,</span><span class="n">RB</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">vecRBData</span><span class="p">):</span>
                <span class="n">MakeRBParms</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">)</span>
                <span class="n">MakeRBThermals</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">)</span>
                    
        <span class="n">Natoms</span><span class="p">[</span><span class="n">pfx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">Atoms</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">General</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;doPawley&#39;</span><span class="p">):</span>
            <span class="n">cx</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">cs</span><span class="p">,</span><span class="n">cia</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomPtrs&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;nuclear&#39;</span><span class="p">,</span><span class="s">&#39;macromolecular&#39;</span><span class="p">]:</span>
                <span class="n">Natoms</span><span class="p">[</span><span class="n">pfx</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Atoms</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Atoms</span><span class="p">):</span>
                    <span class="n">atomIndx</span><span class="p">[</span><span class="n">at</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>      <span class="c">#lookup table for restraints</span>
                    <span class="n">phaseDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Atype:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Afrac:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">3</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Amul:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Ax:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Ay:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Az:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cx</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span>
                        <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAx:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="mf">0.</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAy:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="mf">0.</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAz:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="mf">0.</span><span class="p">,</span>         <span class="c">#refined shifts for x,y,z</span>
                        <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AI/A:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">],})</span>
                    <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                        <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AUiso:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">phaseDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU11:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU22:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">3</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU33:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">4</span><span class="p">],</span>
                            <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU12:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">5</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU13:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">6</span><span class="p">],</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU23:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">):</span><span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="o">+</span><span class="mi">7</span><span class="p">]})</span>
                    <span class="k">if</span> <span class="s">&#39;F&#39;</span> <span class="ow">in</span> <span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Afrac:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                    <span class="k">if</span> <span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">xId</span><span class="p">,</span><span class="n">xCoef</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">GetCSxinel</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="p">])</span>
                        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAx:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAy:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;dAz:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                        <span class="n">equivs</span> <span class="o">=</span> <span class="p">[[],[],[]]</span>
                        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">xId</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                               
                                <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                <span class="n">equivs</span><span class="p">[</span><span class="n">xId</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">xCoef</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
                        <span class="k">for</span> <span class="n">equiv</span> <span class="ow">in</span> <span class="n">equivs</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equiv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="n">name</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">for</span> <span class="n">eqv</span> <span class="ow">in</span> <span class="n">equiv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                    <span class="n">G2mv</span><span class="o">.</span><span class="n">StoreEquivalence</span><span class="p">(</span><span class="n">name</span><span class="p">,(</span><span class="n">eqv</span><span class="p">,))</span>
                    <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">at</span><span class="p">[</span><span class="n">ct</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="n">cia</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                            <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AUiso:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">uId</span><span class="p">,</span><span class="n">uCoef</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">GetCSuinel</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">cs</span><span class="p">])[:</span><span class="mi">2</span><span class="p">]</span>
                            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU11:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU22:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU33:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                                <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU12:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU13:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU23:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                            <span class="n">equivs</span> <span class="o">=</span> <span class="p">[[],[],[],[],[],[]]</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                                <span class="k">if</span> <span class="n">uId</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                               
                                    <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                    <span class="n">equivs</span><span class="p">[</span><span class="n">uId</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">names</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">uCoef</span><span class="p">[</span><span class="n">j</span><span class="p">]])</span>
                            <span class="k">for</span> <span class="n">equiv</span> <span class="ow">in</span> <span class="n">equivs</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">equiv</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                                    <span class="n">name</span> <span class="o">=</span> <span class="n">equiv</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">for</span> <span class="n">eqv</span> <span class="ow">in</span> <span class="n">equiv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                                        <span class="n">G2mv</span><span class="o">.</span><span class="n">StoreEquivalence</span><span class="p">(</span><span class="n">name</span><span class="p">,(</span><span class="n">eqv</span><span class="p">,))</span>
<span class="c">#            elif General[&#39;Type&#39;] == &#39;magnetic&#39;:</span>
<span class="c">#            elif General[&#39;Type&#39;] == &#39;macromolecular&#39;:</span>
            <span class="n">textureData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SH Texture&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">]:</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SHorder&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">]</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SHmodel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SamSym</span><span class="p">[</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Model&#39;</span><span class="p">]]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">,</span><span class="s">&#39;chi&#39;</span><span class="p">,</span><span class="s">&#39;phi&#39;</span><span class="p">]:</span>
                    <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SH &#39;</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SH &#39;</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">phaseVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phase name: &#39;</span><span class="p">,</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
                <span class="n">PrintFFtable</span><span class="p">(</span><span class="n">FFtable</span><span class="p">)</span>
                <span class="n">PrintBLtable</span><span class="p">(</span><span class="n">BLtable</span><span class="p">)</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">SGtext</span><span class="p">:</span> <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
                <span class="n">PrintRBObjects</span><span class="p">(</span><span class="n">resRBData</span><span class="p">,</span><span class="n">vecRBData</span><span class="p">)</span>
                <span class="n">PrintAtoms</span><span class="p">(</span><span class="n">General</span><span class="p">,</span><span class="n">Atoms</span><span class="p">)</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Unit cell: a =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="s">&#39; b =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="s">&#39; c =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> \
                    <span class="s">&#39; alpha =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span><span class="s">&#39; beta =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span><span class="s">&#39; gamma =&#39;</span><span class="p">,</span> \
                    <span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span><span class="s">&#39; volume =&#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">PrintTexture</span><span class="p">(</span><span class="n">textureData</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">RestraintDict</span><span class="p">:</span>
                    <span class="n">PrintRestraints</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">SGData</span><span class="p">,</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomPtrs&#39;</span><span class="p">],</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span>
                        <span class="n">textureData</span><span class="p">,</span><span class="n">RestraintDict</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="n">pFile</span><span class="p">)</span>
                    
        <span class="k">elif</span> <span class="n">PawleyRef</span><span class="p">:</span>
            <span class="n">pawleyVary</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">refl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">PawleyRef</span><span class="p">):</span>
                <span class="n">phaseDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;PWLref:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span> <span class="n">refl</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
                <span class="n">pawleyLookup</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">refl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">refl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">refl</span><span class="p">[</span><span class="mi">2</span><span class="p">])]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="k">if</span> <span class="n">refl</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
                    <span class="n">pawleyVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;PWLref:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">GetPawleyConstr</span><span class="p">(</span><span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">],</span><span class="n">PawleyRef</span><span class="p">,</span><span class="n">pawleyVary</span><span class="p">)</span>      <span class="c">#does G2mv.StoreEquivalence</span>
            <span class="n">phaseVary</span> <span class="o">+=</span> <span class="n">pawleyVary</span>
                
    <span class="k">return</span> <span class="n">Natoms</span><span class="p">,</span><span class="n">atomIndx</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">,</span><span class="n">pawleyLookup</span><span class="p">,</span><span class="n">FFtables</span><span class="p">,</span><span class="n">BLtables</span>
    </div>
<div class="viewcode-block" id="cellFill"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.cellFill">[docs]</a><span class="k">def</span> <span class="nf">cellFill</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">):</span> 
    <span class="sd">&#39;&#39;&#39;Returns the filled-out reciprocal cell (A) terms and their uncertainties</span>
<span class="sd">    from the parameter and sig dictionaries.</span>

<span class="sd">    :param str pfx: parameter prefix (&quot;n::&quot;, where n is a phase number)</span>
<span class="sd">    :param dict SGdata: a symmetry object</span>
<span class="sd">    :param dict parmDict: a dictionary of parameters</span>
<span class="sd">    :param dict sigDict:  a dictionary of uncertainties on parameters</span>

<span class="sd">    :returns: A,sigA where each is a list of six terms with the A terms </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;-1&#39;</span><span class="p">,]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;2/m&#39;</span><span class="p">,]:</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                <span class="mi">0</span><span class="p">,</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;6/m&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span> <span class="s">&#39;31m&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span> <span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3m&#39;</span><span class="p">,</span><span class="s">&#39;m3&#39;</span><span class="p">]:</span>
        <span class="n">A</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;-1&#39;</span><span class="p">,]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;2/m&#39;</span><span class="p">,]:</span>
            <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
                <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                    <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
                <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">,</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">],</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;6/m&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span> <span class="s">&#39;31m&#39;</span><span class="p">,</span> <span class="s">&#39;3&#39;</span><span class="p">]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span> <span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3m&#39;</span><span class="p">,</span><span class="s">&#39;m3&#39;</span><span class="p">]:</span>
            <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="n">sigA</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">A</span><span class="p">,</span><span class="n">sigA</span>
        </div>
<div class="viewcode-block" id="PrintRestraints"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.PrintRestraints">[docs]</a><span class="k">def</span> <span class="nf">PrintRestraints</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">AtPtrs</span><span class="p">,</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">textureData</span><span class="p">,</span><span class="n">phaseRest</span><span class="p">,</span><span class="n">pFile</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">phaseRest</span><span class="p">:</span>
        <span class="n">Amat</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2AB</span><span class="p">(</span><span class="n">cell</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cx</span><span class="p">,</span><span class="n">ct</span><span class="p">,</span><span class="n">cs</span> <span class="o">=</span> <span class="n">AtPtrs</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[[</span><span class="s">&#39;Bond&#39;</span><span class="p">,</span><span class="s">&#39;Bonds&#39;</span><span class="p">],[</span><span class="s">&#39;Angle&#39;</span><span class="p">,</span><span class="s">&#39;Angles&#39;</span><span class="p">],[</span><span class="s">&#39;Plane&#39;</span><span class="p">,</span><span class="s">&#39;Planes&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;Chiral&#39;</span><span class="p">,</span><span class="s">&#39;Volumes&#39;</span><span class="p">],[</span><span class="s">&#39;Torsion&#39;</span><span class="p">,</span><span class="s">&#39;Torsions&#39;</span><span class="p">],[</span><span class="s">&#39;Rama&#39;</span><span class="p">,</span><span class="s">&#39;Ramas&#39;</span><span class="p">],</span>
            <span class="p">[</span><span class="s">&#39;ChemComp&#39;</span><span class="p">,</span><span class="s">&#39;Sites&#39;</span><span class="p">],[</span><span class="s">&#39;Texture&#39;</span><span class="p">,</span><span class="s">&#39;HKLs&#39;</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">rest</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">itemRest</span> <span class="o">=</span> <span class="n">phaseRest</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]</span> <span class="ow">and</span> <span class="n">itemRest</span><span class="p">[</span><span class="s">&#39;Use&#39;</span><span class="p">]:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">  </span><span class="si">%s</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> Use: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; restraint weight factor&#39;</span><span class="p">,</span><span class="n">itemRest</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">],</span><span class="nb">str</span><span class="p">(</span><span class="n">itemRest</span><span class="p">[</span><span class="s">&#39;Use&#39;</span><span class="p">]))</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Bond&#39;</span><span class="p">,</span><span class="s">&#39;Angle&#39;</span><span class="p">,</span><span class="s">&#39;Plane&#39;</span><span class="p">,</span><span class="s">&#39;Chiral&#39;</span><span class="p">]:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;     calc       obs      sig   delt/sig  atoms(symOp): &#39;</span>
                    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span><span class="n">ops</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span> <span class="ow">in</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">AtNames</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">ct</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">AtName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">Aname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">AtNames</span><span class="p">):</span>
                                <span class="n">AtName</span> <span class="o">+=</span> <span class="n">Aname</span>
                                <span class="k">if</span> <span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;1&#39;</span><span class="p">:</span>
                                    <span class="n">AtName</span> <span class="o">+=</span> <span class="s">&#39;-&#39;</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">AtName</span> <span class="o">+=</span> <span class="s">&#39;+(&#39;</span><span class="o">+</span><span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;)-&#39;</span>
                            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                            <span class="n">XYZ</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getSyXYZ</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">ops</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Bond&#39;</span><span class="p">:</span>
                                <span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestDist</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Angle&#39;</span><span class="p">:</span>
                                <span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestAngle</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Plane&#39;</span><span class="p">:</span>
                                <span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestPlane</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Chiral&#39;</span><span class="p">:</span>
                                <span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestChiral</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; </span><span class="si">%9.3f</span><span class="s"> </span><span class="si">%9.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s">   </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">calc</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span><span class="p">,(</span><span class="n">obs</span><span class="o">-</span><span class="n">calc</span><span class="p">)</span><span class="o">/</span><span class="n">esd</span><span class="p">,</span><span class="n">AtName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Torsion&#39;</span><span class="p">,</span><span class="s">&#39;Rama&#39;</span><span class="p">]:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;  atoms(symOp)  calc  obs  sig  delt/sig  torsions: &#39;</span>
                    <span class="n">coeffDict</span> <span class="o">=</span> <span class="n">itemRest</span><span class="p">[</span><span class="s">&#39;Coeff&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span><span class="n">ops</span><span class="p">,</span><span class="n">cofName</span><span class="p">,</span><span class="n">esd</span> <span class="ow">in</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]:</span>
                        <span class="n">AtNames</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">ct</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                        <span class="n">AtName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">Aname</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">AtNames</span><span class="p">):</span>
                            <span class="n">AtName</span> <span class="o">+=</span> <span class="n">Aname</span><span class="o">+</span><span class="s">&#39;+(&#39;</span><span class="o">+</span><span class="n">ops</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;)-&#39;</span>
                        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
                        <span class="n">XYZ</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getSyXYZ</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">ops</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Torsion&#39;</span><span class="p">:</span>
                            <span class="n">tor</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestTorsion</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="n">restr</span><span class="p">,</span><span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">calcTorsionEnergy</span><span class="p">(</span><span class="n">tor</span><span class="p">,</span><span class="n">coeffDict</span><span class="p">[</span><span class="n">cofName</span><span class="p">])</span>
                            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">calc</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span><span class="p">,(</span><span class="n">obs</span><span class="o">-</span><span class="n">calc</span><span class="p">)</span><span class="o">/</span><span class="n">esd</span><span class="p">,</span><span class="n">tor</span><span class="p">,</span><span class="n">AtName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">phi</span><span class="p">,</span><span class="n">psi</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestRama</span><span class="p">(</span><span class="n">XYZ</span><span class="p">,</span><span class="n">Amat</span><span class="p">)</span>
                            <span class="n">restr</span><span class="p">,</span><span class="n">calc</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">calcRamaEnergy</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">coeffDict</span><span class="p">[</span><span class="n">cofName</span><span class="p">])</span>                               
                            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">calc</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span><span class="p">,(</span><span class="n">obs</span><span class="o">-</span><span class="n">calc</span><span class="p">)</span><span class="o">/</span><span class="n">esd</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">AtName</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;ChemComp&#39;</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;     atoms   mul*frac  factor     prod&#39;</span>
                    <span class="k">for</span> <span class="n">indx</span><span class="p">,</span><span class="n">factors</span><span class="p">,</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span> <span class="ow">in</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">atoms</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">ct</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                            <span class="n">mul</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">cs</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                            <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2mth</span><span class="o">.</span><span class="n">GetAtomItemsById</span><span class="p">(</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span><span class="n">indx</span><span class="p">,</span><span class="n">cs</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
                            <span class="n">mulfrac</span> <span class="o">=</span> <span class="n">mul</span><span class="o">*</span><span class="n">frac</span>
                            <span class="n">calcs</span> <span class="o">=</span> <span class="n">mul</span><span class="o">*</span><span class="n">frac</span><span class="o">*</span><span class="n">factors</span>
                            <span class="k">for</span> <span class="n">iatm</span><span class="p">,[</span><span class="n">atom</span><span class="p">,</span><span class="n">mf</span><span class="p">,</span><span class="n">fr</span><span class="p">,</span><span class="n">clc</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">atoms</span><span class="p">,</span><span class="n">mulfrac</span><span class="p">,</span><span class="n">factors</span><span class="p">,</span><span class="n">calcs</span><span class="p">)):</span>
                                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; </span><span class="si">%10s</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">atom</span><span class="p">,</span><span class="n">mf</span><span class="p">,</span><span class="n">fr</span><span class="p">,</span><span class="n">clc</span><span class="p">)</span>
                            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Sum:                   calc: </span><span class="si">%8.3f</span><span class="s"> obs: </span><span class="si">%8.3f</span><span class="s"> esd: </span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">calcs</span><span class="p">),</span><span class="n">obs</span><span class="p">,</span><span class="n">esd</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]</span>
                <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Texture&#39;</span> <span class="ow">and</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">]:</span>
                    <span class="n">Start</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="n">SHCoef</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">shModels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;cylindrical&#39;</span><span class="p">,</span><span class="s">&#39;none&#39;</span><span class="p">,</span><span class="s">&#39;shear - 2/m&#39;</span><span class="p">,</span><span class="s">&#39;rolling - mmm&#39;</span><span class="p">]</span>
                    <span class="n">SamSym</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">shModels</span><span class="p">,[</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;-1&#39;</span><span class="p">,</span><span class="s">&#39;2/m&#39;</span><span class="p">,</span><span class="s">&#39;mmm&#39;</span><span class="p">]))</span>
                    <span class="k">print</span> <span class="s">&#39;    HKL  grid  neg esd  sum neg  num neg use unit?  unit esd  &#39;</span>
                    <span class="k">for</span> <span class="n">hkl</span><span class="p">,</span><span class="n">grid</span><span class="p">,</span><span class="n">esd1</span><span class="p">,</span><span class="n">ifesd2</span><span class="p">,</span><span class="n">esd2</span> <span class="ow">in</span> <span class="n">itemRest</span><span class="p">[</span><span class="n">rest</span><span class="p">]:</span>
                        <span class="n">PH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hkl</span><span class="p">)</span>
                        <span class="n">phi</span><span class="p">,</span><span class="n">beta</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">CrsAng</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">hkl</span><span class="p">),</span><span class="n">cell</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
                        <span class="n">ODFln</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">Flnh</span><span class="p">(</span><span class="n">Start</span><span class="p">,</span><span class="n">SHCoef</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
                        <span class="n">R</span><span class="p">,</span><span class="n">P</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getRestPolefig</span><span class="p">(</span><span class="n">ODFln</span><span class="p">,</span><span class="n">SamSym</span><span class="p">[</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Model&#39;</span><span class="p">]],</span><span class="n">grid</span><span class="p">)</span>
                        <span class="n">Z</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_greater</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
                        <span class="n">num</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
                        <span class="nb">sum</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">if</span> <span class="n">num</span><span class="p">:</span>
                            <span class="nb">sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
                        <span class="k">print</span> <span class="s">&#39;   </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">  </span><span class="si">%d</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8d</span><span class="s">   </span><span class="si">%s</span><span class="s">    </span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hkl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">hkl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">hkl</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">grid</span><span class="p">,</span><span class="n">esd1</span><span class="p">,</span><span class="nb">sum</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">ifesd2</span><span class="p">),</span><span class="n">esd2</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="getCellEsd"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.getCellEsd">[docs]</a><span class="k">def</span> <span class="nf">getCellEsd</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">covData</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">dpr</span> <span class="o">=</span> <span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">rVsq</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rVsq</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>       <span class="c">#get recip. &amp; real metric tensors</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">Gmat2cell</span><span class="p">(</span><span class="n">g</span><span class="p">))</span>   <span class="c">#real cell</span>
    <span class="n">cellst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">Gmat2cell</span><span class="p">(</span><span class="n">G</span><span class="p">))</span> <span class="c">#recip. cell</span>
    <span class="n">scos</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">cellst</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">ssin</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">cellst</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">scot</span> <span class="o">=</span> <span class="n">scos</span><span class="o">/</span><span class="n">ssin</span>
    <span class="n">rcos</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">rsin</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])</span>
    <span class="n">rcot</span> <span class="o">=</span> <span class="n">rcos</span><span class="o">/</span><span class="n">rsin</span>
    <span class="n">RMnames</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A0&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A1&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A2&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A3&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A4&#39;</span><span class="p">,</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A5&#39;</span><span class="p">]</span>
    <span class="n">varyList</span> <span class="o">=</span> <span class="n">covData</span><span class="p">[</span><span class="s">&#39;varyList&#39;</span><span class="p">]</span>
    <span class="n">covMatrix</span> <span class="o">=</span> <span class="n">covData</span><span class="p">[</span><span class="s">&#39;covMatrix&#39;</span><span class="p">]</span>
    <span class="n">vcov</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">getVCov</span><span class="p">(</span><span class="n">RMnames</span><span class="p">,</span><span class="n">varyList</span><span class="p">,</span><span class="n">covMatrix</span><span class="p">)</span>
    <span class="n">Ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">/=</span> <span class="mf">2.</span>
    <span class="n">drVdA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">Ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">Ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">Ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">5</span><span class="p">]])</span>
    <span class="n">srcvlsq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">drVdA</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">vcov</span><span class="p">,</span><span class="n">drVdA</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">Vol</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rVsq</span><span class="p">)</span>
    <span class="n">sigVol</span> <span class="o">=</span> <span class="n">Vol</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">srcvlsq</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">R123</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">dsasdg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">dadg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>         <span class="c">#0  1   2</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>           <span class="c">#1  2   0</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>           <span class="c">#2  0   1</span>
        <span class="n">i3</span> <span class="o">=</span> <span class="mi">5</span><span class="o">-</span><span class="n">i2</span>               <span class="c">#3  5   4</span>
        <span class="n">i4</span> <span class="o">=</span> <span class="mi">5</span><span class="o">-</span><span class="n">i1</span>               <span class="c">#4  3   5</span>
        <span class="n">i5</span> <span class="o">=</span> <span class="mi">5</span><span class="o">-</span><span class="n">i0</span>               <span class="c">#5  4   3</span>
        <span class="n">dsasdg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">scot</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">scos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span>
        <span class="n">dsasdg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">scot</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">scos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span>
        <span class="n">dsasdg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">i5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">scot</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">])</span>
        <span class="n">denmsq</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">R123</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">denom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">denmsq</span><span class="p">)</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i5</span><span class="p">]</span><span class="o">/</span><span class="n">denom</span><span class="o">-</span><span class="n">rcos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denmsq</span><span class="o">*</span><span class="p">(</span><span class="n">R123</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">rcos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denmsq</span><span class="o">*</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">rcos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denmsq</span><span class="o">*</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i3</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">/</span><span class="n">denom</span><span class="o">+</span><span class="n">rcos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denmsq</span><span class="o">*</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i4</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">/</span><span class="n">denom</span><span class="o">+</span><span class="n">rcos</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denmsq</span><span class="o">*</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i1</span><span class="p">]</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">]</span><span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i3</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">Ax</span><span class="p">[</span><span class="n">i4</span><span class="p">])</span>
        <span class="n">dadg</span><span class="p">[</span><span class="n">i5</span><span class="p">][</span><span class="n">i5</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">denom</span>
    <span class="k">for</span> <span class="n">i0</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">i1</span> <span class="o">=</span> <span class="p">(</span><span class="n">i0</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>
        <span class="n">i2</span> <span class="o">=</span> <span class="p">(</span><span class="n">i1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span>
        <span class="n">i3</span> <span class="o">=</span> <span class="mi">5</span><span class="o">-</span><span class="n">i2</span>
        <span class="k">for</span> <span class="n">ij</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
            <span class="n">dadg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">rcot</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">*</span><span class="n">dadg</span><span class="p">[</span><span class="n">i3</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span><span class="o">/</span><span class="n">rsin</span><span class="p">[</span><span class="n">i2</span><span class="p">]</span><span class="o">-</span><span class="n">dsasdg</span><span class="p">[</span><span class="n">i1</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span><span class="o">/</span><span class="n">ssin</span><span class="p">[</span><span class="n">i1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ij</span> <span class="o">==</span> <span class="n">i0</span><span class="p">:</span>
                <span class="n">dadg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="n">dadg</span><span class="p">[</span><span class="n">i0</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cell</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span><span class="o">/</span><span class="n">Ax</span><span class="p">[</span><span class="n">i0</span><span class="p">]</span>
            <span class="n">dadg</span><span class="p">[</span><span class="n">i3</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">dadg</span><span class="p">[</span><span class="n">i3</span><span class="p">][</span><span class="n">ij</span><span class="p">]</span><span class="o">*</span><span class="n">rsin</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="n">i0</span><span class="p">]</span><span class="o">*</span><span class="n">dpr</span>
    <span class="n">sigMat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">dadg</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">vcov</span><span class="p">,</span><span class="n">dadg</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">sigMat</span><span class="p">)</span>
    <span class="n">CS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">var</span><span class="o">&gt;</span><span class="mf">0.</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">var</span><span class="p">),</span><span class="mf">0.</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">CS</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">CS</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">CS</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">CS</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">CS</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">CS</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">sigVol</span><span class="p">]</span>  <span class="c">#exchange sig(alp) &amp; sig(gam) to get in right order</span>
    </div>
<div class="viewcode-block" id="SetPhaseData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetPhaseData">[docs]</a><span class="k">def</span> <span class="nf">SetPhaseData</span><span class="p">(</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">,</span><span class="n">Phases</span><span class="p">,</span><span class="n">RBIds</span><span class="p">,</span><span class="n">covData</span><span class="p">,</span><span class="n">RestraintDict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">PrintAtomsAndSig</span><span class="p">(</span><span class="n">General</span><span class="p">,</span><span class="n">Atoms</span><span class="p">,</span><span class="n">atomsSig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Atoms:&#39;</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;   name      x         y         z      frac   Uiso     U11     U22     U33     U12     U13     U23&#39;</span>
        <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;magnetic&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;   Mx     My     Mz&#39;</span>
        <span class="k">elif</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;macromolecular&#39;</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; res no  residue  chain &#39;</span><span class="o">+</span><span class="n">line</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nuclear&#39;</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%7s</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">5</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%10.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">6</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">10</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span>
                <span class="mi">11</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">12</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">13</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">14</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">15</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">,</span><span class="mi">16</span><span class="p">:</span><span class="s">&#39;</span><span class="si">%8.5f</span><span class="s">&#39;</span><span class="p">}</span>
            <span class="n">noFXsig</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:[</span><span class="mi">10</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%10s</span><span class="s">&#39;</span><span class="p">],</span><span class="mi">4</span><span class="p">:[</span><span class="mi">10</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%10s</span><span class="s">&#39;</span><span class="p">],</span><span class="mi">5</span><span class="p">:[</span><span class="mi">10</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%10s</span><span class="s">&#39;</span><span class="p">],</span><span class="mi">6</span><span class="p">:[</span><span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%8s</span><span class="s">&#39;</span><span class="p">]}</span>
            <span class="k">for</span> <span class="n">atyp</span> <span class="ow">in</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">]:</span>       <span class="c">#zero composition</span>
                <span class="n">General</span><span class="p">[</span><span class="s">&#39;NoAtoms&#39;</span><span class="p">][</span><span class="n">atyp</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Atoms</span><span class="p">):</span>
                <span class="n">General</span><span class="p">[</span><span class="s">&#39;NoAtoms&#39;</span><span class="p">][</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">at</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>     <span class="c">#new composition</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">fmt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39; values:&#39;</span>
                <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
                <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
                    <span class="n">sigind</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                    <span class="n">valstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>                    
                    <span class="k">if</span> <span class="n">sigind</span> <span class="ow">in</span> <span class="n">atomsSig</span><span class="p">:</span>
                        <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">atomsSig</span><span class="p">[</span><span class="n">sigind</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">noFXsig</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">noFXsig</span><span class="p">[</span><span class="n">ind</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                    <span class="n">valstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
                    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:10&#39;</span> <span class="ow">in</span> <span class="n">atomsSig</span><span class="p">:</span>
                        <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">atomsSig</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:10&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">valstr</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]:</span>
                        <span class="n">sigind</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)</span>
                        <span class="n">valstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="n">ind</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">sigind</span> <span class="ow">in</span> <span class="n">atomsSig</span><span class="p">:</span>                        
                            <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">%</span><span class="p">(</span><span class="n">atomsSig</span><span class="p">[</span><span class="n">sigind</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">name</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
                
    <span class="k">def</span> <span class="nf">PrintRBObjPOAndSig</span><span class="p">(</span><span class="n">rbfx</span><span class="p">,</span><span class="n">rbsx</span><span class="p">):</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">px</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Px:&#39;</span><span class="p">,</span><span class="s">&#39;Py:&#39;</span><span class="p">,</span><span class="s">&#39;Pz:&#39;</span><span class="p">]):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="n">px</span><span class="o">+</span><span class="n">rbsx</span>
            <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Pos &#39;</span><span class="o">+</span><span class="n">px</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">po</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Oa:&#39;</span><span class="p">,</span><span class="s">&#39;Oi:&#39;</span><span class="p">,</span><span class="s">&#39;Oj:&#39;</span><span class="p">,</span><span class="s">&#39;Ok:&#39;</span><span class="p">]):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="n">po</span><span class="o">+</span><span class="n">rbsx</span>
            <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Ori &#39;</span><span class="o">+</span><span class="n">po</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintRBObjTLSAndSig</span><span class="p">(</span><span class="n">rbfx</span><span class="p">,</span><span class="n">rbsx</span><span class="p">,</span><span class="n">TLS</span><span class="p">):</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="k">if</span> <span class="s">&#39;N&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TLS</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Thermal motion:&#39;</span>
        <span class="k">if</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">TLS</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;T11:&#39;</span><span class="p">,</span><span class="s">&#39;T22:&#39;</span><span class="p">,</span><span class="s">&#39;T33:&#39;</span><span class="p">,</span><span class="s">&#39;T12:&#39;</span><span class="p">,</span><span class="s">&#39;T13:&#39;</span><span class="p">,</span><span class="s">&#39;T23:&#39;</span><span class="p">]):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="n">pt</span><span class="o">+</span><span class="n">rbsx</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">pt</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        <span class="k">if</span> <span class="s">&#39;L&#39;</span> <span class="ow">in</span> <span class="n">TLS</span><span class="p">:</span>
            <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
            <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;L11:&#39;</span><span class="p">,</span><span class="s">&#39;L22:&#39;</span><span class="p">,</span><span class="s">&#39;L33:&#39;</span><span class="p">,</span><span class="s">&#39;L12:&#39;</span><span class="p">,</span><span class="s">&#39;L13:&#39;</span><span class="p">,</span><span class="s">&#39;L23:&#39;</span><span class="p">]):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="n">pt</span><span class="o">+</span><span class="n">rbsx</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">pt</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        <span class="k">if</span> <span class="s">&#39;S&#39;</span> <span class="ow">in</span> <span class="n">TLS</span><span class="p">:</span>
            <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
            <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">pt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;S12:&#39;</span><span class="p">,</span><span class="s">&#39;S13:&#39;</span><span class="p">,</span><span class="s">&#39;S21:&#39;</span><span class="p">,</span><span class="s">&#39;S23:&#39;</span><span class="p">,</span><span class="s">&#39;S31:&#39;</span><span class="p">,</span><span class="s">&#39;S32:&#39;</span><span class="p">,</span><span class="s">&#39;SAA:&#39;</span><span class="p">,</span><span class="s">&#39;SBB:&#39;</span><span class="p">]):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="n">pt</span><span class="o">+</span><span class="n">rbsx</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">pt</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        <span class="k">if</span> <span class="s">&#39;U&#39;</span> <span class="ow">in</span> <span class="n">TLS</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">rbfx</span><span class="o">+</span><span class="s">&#39;U:&#39;</span><span class="o">+</span><span class="n">rbsx</span>
            <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Uiso&#39;</span><span class="p">)</span>
            <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span><span class="o">+</span><span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintRBObjTorAndSig</span><span class="p">(</span><span class="n">rbsx</span><span class="p">):</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="n">nTors</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">RBObj</span><span class="p">[</span><span class="s">&#39;Torsions&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">nTors</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Torsions:&#39;</span>
            <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nTors</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;RBRTr;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="n">rbsx</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Tor&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
                <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
                
    <span class="k">def</span> <span class="nf">PrintSHtextureAndSig</span><span class="p">(</span><span class="n">textureData</span><span class="p">,</span><span class="n">SHtextureSig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Spherical harmonics texture: Order:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">])</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">,</span><span class="s">&#39;chi&#39;</span><span class="p">,</span><span class="s">&#39;phi&#39;</span><span class="p">]</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span> <span class="ow">in</span> <span class="n">SHtextureSig</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">SHtextureSig</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Texture coefficients:&#39;</span>
        <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39;  values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
        <span class="n">SHcoeff</span> <span class="o">=</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">SHcoeff</span><span class="p">:</span>
            <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">SHcoeff</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">SHtextureSig</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">SHtextureSig</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
            
    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phases:&#39;</span>
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Result for phase: &#39;</span><span class="p">,</span><span class="n">phase</span>
        <span class="n">Phase</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
        <span class="n">General</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
        <span class="n">SGData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
        <span class="n">Atoms</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Atoms&#39;</span><span class="p">]</span>
        <span class="n">AtLookup</span> <span class="o">=</span> <span class="n">G2mth</span><span class="o">.</span><span class="n">FillAtomLookUp</span><span class="p">(</span><span class="n">Atoms</span><span class="p">)</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Cell&#39;</span><span class="p">]</span>
        <span class="n">pId</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span>
        <span class="k">if</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">A</span><span class="p">,</span><span class="n">sigA</span> <span class="o">=</span> <span class="n">cellFill</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">)</span>
            <span class="n">cellSig</span> <span class="o">=</span> <span class="n">getCellEsd</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">covData</span><span class="p">)</span>  <span class="c">#includes sigVol</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Reciprocal metric tensor: &#39;</span>
            <span class="n">ptfmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%15.9f</span><span class="s">&quot;</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;A11&#39;</span><span class="p">,</span><span class="s">&#39;A22&#39;</span><span class="p">,</span><span class="s">&#39;A33&#39;</span><span class="p">,</span><span class="s">&#39;A12&#39;</span><span class="p">,</span><span class="s">&#39;A13&#39;</span><span class="p">,</span><span class="s">&#39;A23&#39;</span><span class="p">]</span>
            <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39;  values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">siga</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">sigA</span><span class="p">):</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%15s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">siga</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">siga</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">15</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
            <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">cell</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; New unit cell:&#39;</span>
            <span class="n">ptfmt</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;</span><span class="si">%12.6f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.6f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.6f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.4f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.4f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.4f</span><span class="s">&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%12.3f</span><span class="s">&quot;</span><span class="p">]</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;alpha&#39;</span><span class="p">,</span><span class="s">&#39;beta&#39;</span><span class="p">,</span><span class="s">&#39;gamma&#39;</span><span class="p">,</span><span class="s">&#39;Volume&#39;</span><span class="p">]</span>
            <span class="n">namstr</span> <span class="o">=</span> <span class="s">&#39;  names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39;  values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39;  esds  :&#39;</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">fmt</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">siga</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">ptfmt</span><span class="p">,</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span><span class="n">cellSig</span><span class="p">):</span>
                <span class="n">namstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">%</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">siga</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">fmt</span><span class="o">%</span><span class="p">(</span><span class="n">siga</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">namstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
            
        <span class="n">General</span><span class="p">[</span><span class="s">&#39;Mass&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="k">if</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;doPawley&#39;</span><span class="p">):</span>
            <span class="n">pawleyRef</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Pawley ref&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">refl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">pawleyRef</span><span class="p">):</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;PWLref:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">refl</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">refl</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">refl</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">VRBIds</span> <span class="o">=</span> <span class="n">RBIds</span><span class="p">[</span><span class="s">&#39;Vector&#39;</span><span class="p">]</span>
            <span class="n">RRBIds</span> <span class="o">=</span> <span class="n">RBIds</span><span class="p">[</span><span class="s">&#39;Residue&#39;</span><span class="p">]</span>
            <span class="n">RBModels</span> <span class="o">=</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;RBModels&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">irb</span><span class="p">,</span><span class="n">RBObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RBModels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Vector&#39;</span><span class="p">,[])):</span>
                <span class="n">jrb</span> <span class="o">=</span> <span class="n">VRBIds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">RBObj</span><span class="p">[</span><span class="s">&#39;RBId&#39;</span><span class="p">])</span>
                <span class="n">rbsx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">irb</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jrb</span><span class="p">)</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Vector rigid body parameters:&#39;</span>
                <span class="n">PrintRBObjPOAndSig</span><span class="p">(</span><span class="s">&#39;RBV&#39;</span><span class="p">,</span><span class="n">rbsx</span><span class="p">)</span>
                <span class="n">PrintRBObjTLSAndSig</span><span class="p">(</span><span class="s">&#39;RBV&#39;</span><span class="p">,</span><span class="n">rbsx</span><span class="p">,</span><span class="n">RBObj</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">irb</span><span class="p">,</span><span class="n">RBObj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">RBModels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Residue&#39;</span><span class="p">,[])):</span>
                <span class="n">jrb</span> <span class="o">=</span> <span class="n">RRBIds</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">RBObj</span><span class="p">[</span><span class="s">&#39;RBId&#39;</span><span class="p">])</span>
                <span class="n">rbsx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">irb</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">jrb</span><span class="p">)</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Residue rigid body parameters:&#39;</span>
                <span class="n">PrintRBObjPOAndSig</span><span class="p">(</span><span class="s">&#39;RBR&#39;</span><span class="p">,</span><span class="n">rbsx</span><span class="p">)</span>
                <span class="n">PrintRBObjTLSAndSig</span><span class="p">(</span><span class="s">&#39;RBR&#39;</span><span class="p">,</span><span class="n">rbsx</span><span class="p">,</span><span class="n">RBObj</span><span class="p">[</span><span class="s">&#39;ThermalMotion&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">PrintRBObjTorAndSig</span><span class="p">(</span><span class="n">rbsx</span><span class="p">)</span>
            <span class="n">atomsSig</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;nuclear&#39;</span><span class="p">:</span>        <span class="c">#this needs macromolecular variant!</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Atoms</span><span class="p">):</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Ax:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">4</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Ay:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">5</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Az:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">6</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Afrac:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                        <span class="mi">10</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AUiso:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">11</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU11:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">12</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU22:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">13</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU33:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                        <span class="mi">14</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU12:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">15</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU13:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="mi">16</span><span class="p">:</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;AU23:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)}</span>
                    <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
                        <span class="n">at</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;A&#39;</span><span class="p">,</span><span class="s">&#39;dA&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">name</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                            <span class="n">atomsSig</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">at</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span>
                        <span class="n">at</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">10</span><span class="p">]]</span>
                        <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                            <span class="n">atomsSig</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:10&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="mi">10</span><span class="p">]]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ind</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">14</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">16</span><span class="p">]:</span>
                            <span class="n">at</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                            <span class="k">if</span> <span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                                <span class="n">atomsSig</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ind</span><span class="p">)]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">names</span><span class="p">[</span><span class="n">ind</span><span class="p">]]</span>
                    <span class="n">ind</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">at</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">General</span><span class="p">[</span><span class="s">&#39;Mass&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomMass&#39;</span><span class="p">][</span><span class="n">ind</span><span class="p">]</span><span class="o">*</span><span class="n">at</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">*</span><span class="n">at</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
            <span class="n">PrintAtomsAndSig</span><span class="p">(</span><span class="n">General</span><span class="p">,</span><span class="n">Atoms</span><span class="p">,</span><span class="n">atomsSig</span><span class="p">)</span>
        
        <span class="n">textureData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SH Texture&#39;</span><span class="p">]</span>    
        <span class="k">if</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Order&#39;</span><span class="p">]:</span>
            <span class="n">SHtextureSig</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;omega&#39;</span><span class="p">,</span><span class="s">&#39;chi&#39;</span><span class="p">,</span><span class="s">&#39;phi&#39;</span><span class="p">]:</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SH &#39;</span><span class="o">+</span><span class="n">name</span>
                <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">aname</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">aname</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">SHtextureSig</span><span class="p">[</span><span class="s">&#39;Sample &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">aname</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">name</span>
                <span class="n">textureData</span><span class="p">[</span><span class="s">&#39;SH Coeff&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">aname</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">aname</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">SHtextureSig</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">aname</span><span class="p">]</span>
            <span class="n">PrintSHtextureAndSig</span><span class="p">(</span><span class="n">textureData</span><span class="p">,</span><span class="n">SHtextureSig</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">RestraintDict</span><span class="p">:</span>
            <span class="n">PrintRestraints</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">SGData</span><span class="p">,</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;AtomPtrs&#39;</span><span class="p">],</span><span class="n">Atoms</span><span class="p">,</span><span class="n">AtLookup</span><span class="p">,</span>
                <span class="n">textureData</span><span class="p">,</span><span class="n">RestraintDict</span><span class="p">[</span><span class="n">phase</span><span class="p">],</span><span class="n">pFile</span><span class="p">)</span>
                    
<span class="c">################################################################################</span>
<span class="c">##### Histogram &amp; Phase data</span>
<span class="c">################################################################################        </span>
                    </div>
<div class="viewcode-block" id="GetHistogramPhaseData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetHistogramPhaseData">[docs]</a><span class="k">def</span> <span class="nf">GetHistogramPhaseData</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">resetRefList</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Loads the HAP histogram/phase information into dicts</span>

<span class="sd">    :param dict Phases: phase information</span>
<span class="sd">    :param dict Histograms: Histogram information</span>
<span class="sd">    :param bool Print: prints information as it is read</span>
<span class="sd">    :param file pFile: file object to print to (the default, None causes printing to the console)</span>
<span class="sd">    :param bool resetRefList: Should the contents of the Reflection List be initialized</span>
<span class="sd">      on loading. The default, True, initializes the Reflection List as it is loaded.</span>

<span class="sd">    :returns: (hapVary,hapDict,controlDict)</span>
<span class="sd">      * hapVary: list of refined variables</span>
<span class="sd">      * hapDict: dict with refined variables and their values</span>
<span class="sd">      * controlDict: dict with computation controls (?)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">PrintSize</span><span class="p">(</span><span class="n">hapData</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> Size model    : </span><span class="si">%9s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; equatorial:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; axial:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\t</span><span class="s"> LG mixing coeff.: </span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Size model    : </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span> \
                <span class="s">&#39;</span><span class="se">\n\t</span><span class="s"> LG mixing coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">Snames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;S11&#39;</span><span class="p">,</span><span class="s">&#39;S22&#39;</span><span class="p">,</span><span class="s">&#39;S33&#39;</span><span class="p">,</span><span class="s">&#39;S12&#39;</span><span class="p">,</span><span class="s">&#39;S13&#39;</span><span class="p">,</span><span class="s">&#39;S23&#39;</span><span class="p">]</span>
            <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
            <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Snames</span><span class="p">):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>
        
    <span class="k">def</span> <span class="nf">PrintMuStrain</span><span class="p">(</span><span class="n">hapData</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> Mustrain model: </span><span class="si">%9s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; equatorial:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; axial:&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%12.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span><span class="s">&#39;</span><span class="se">\n\t</span><span class="s"> LG mixing coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Mustrain model: </span><span class="si">%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span> \
                <span class="s">&#39;</span><span class="se">\n\t</span><span class="s"> LG mixing coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">Snames</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
            <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
            <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Snames</span><span class="p">):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>

    <span class="k">def</span> <span class="nf">PrintHStrain</span><span class="p">(</span><span class="n">hapData</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Hydrostatic/elastic strain: &#39;</span>
        <span class="n">Hsnames</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Hsnames</span><span class="p">):</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>

    <span class="k">def</span> <span class="nf">PrintSHPO</span><span class="p">(</span><span class="n">hapData</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Spherical harmonics preferred orientation: Order:&#39;</span> <span class="o">+</span> \
            <span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; Refine? &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">item</span><span class="p">])</span> 
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
    
    <span class="k">def</span> <span class="nf">PrintBabinet</span><span class="p">(</span><span class="n">hapData</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Babinet form factor modification: &#39;</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;BabA&#39;</span><span class="p">,</span><span class="s">&#39;BabU&#39;</span><span class="p">]:</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>
        
    
    <span class="n">hapDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">hapVary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">controlDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">poType</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">poAxes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spAxes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">spType</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
        <span class="n">HistoPhase</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
        <span class="n">SGData</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Cell&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">pId</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
        <span class="n">histoList</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>                        
                <span class="c">#skip if histogram not included e.g. in a sequential refinement</span>
                <span class="k">continue</span>
            <span class="n">hapData</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                <span class="n">limits</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Limits&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">inst</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">Zero</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="s">&#39;Zero&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="s">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">wave</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="s">&#39;Lam&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                        <span class="n">wave</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="s">&#39;Lam1&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">dmin</span> <span class="o">=</span> <span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="p">))</span>
                <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Extinction&#39;</span><span class="p">]:</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;HStrain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;HStrain&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;poType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;MD&#39;</span><span class="p">:</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MDAxis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>                           <span class="c">#&#39;SH&#39; spherical harmonics</span>
                    <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SHord&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
                    <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SHncof&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                            <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Mustrain&#39;</span><span class="p">,</span><span class="s">&#39;Size&#39;</span><span class="p">]:</span>
                    <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;Type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;mx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;mx&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>
                        <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;i&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;i&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;Axis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                            <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;a&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;a&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>       <span class="c">#generalized for mustrain or ellipsoidal for size</span>
                        <span class="n">Nterms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&#39;Mustrain&#39;</span><span class="p">:</span>
                            <span class="n">names</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
                            <span class="n">pwrs</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                                <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                                <span class="n">pwrs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">h</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">k</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">l</span><span class="p">)])</span>
                            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MuPwrs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwrs</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nterms</span><span class="p">):</span>
                            <span class="n">sfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="n">sfx</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                                <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="n">sfx</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">bab</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;BabA&#39;</span><span class="p">,</span><span class="s">&#39;BabU&#39;</span><span class="p">]:</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">bab</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">bab</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">bab</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">bab</span><span class="p">)</span>
                                
                <span class="k">if</span> <span class="n">Print</span><span class="p">:</span> 
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phase: &#39;</span><span class="p">,</span><span class="n">phase</span><span class="p">,</span><span class="s">&#39; in histogram: &#39;</span><span class="p">,</span><span class="n">histogram</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Phase fraction  : </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Extinction coeff: </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;MD&#39;</span><span class="p">:</span>
                        <span class="n">Ax</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; March-Dollase PO: </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span> \
                            <span class="s">&#39; Axis: </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Ax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Ax</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span> <span class="c">#&#39;SH&#39; for spherical harmonics</span>
                        <span class="n">PrintSHPO</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">])</span>
                    <span class="n">PrintSize</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Size&#39;</span><span class="p">])</span>
                    <span class="n">PrintMuStrain</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Mustrain&#39;</span><span class="p">],</span><span class="n">SGData</span><span class="p">)</span>
                    <span class="n">PrintHStrain</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;HStrain&#39;</span><span class="p">],</span><span class="n">SGData</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="s">&#39;BabA&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">PrintBabinet</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">])</span>
                <span class="n">HKLd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">GenHLaue</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">resetRefList</span><span class="p">:</span>
                    <span class="n">refList</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">Uniq</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">Phi</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">HKLd</span><span class="p">:</span>
                        <span class="n">ext</span><span class="p">,</span><span class="n">mul</span><span class="p">,</span><span class="n">uniq</span><span class="p">,</span><span class="n">phi</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">GenHKLf</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">],</span><span class="n">SGData</span><span class="p">)</span>
                        <span class="n">mul</span> <span class="o">*=</span> <span class="mi">2</span>      <span class="c"># for powder overlap of Friedel pairs</span>
                        <span class="k">if</span> <span class="n">ext</span><span class="p">:</span>
                            <span class="k">continue</span>
                        <span class="k">if</span> <span class="s">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                            <span class="n">pos</span> <span class="o">=</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">asind</span><span class="p">(</span><span class="n">wave</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">d</span><span class="p">))</span><span class="o">+</span><span class="n">Zero</span>
                            <span class="k">if</span> <span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">refList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">mul</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">])</span>
                                <span class="n">Uniq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">uniq</span><span class="p">)</span>
                                <span class="n">Phi</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="ne">ValueError</span> 
                    <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">][</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;RefList&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">refList</span><span class="p">),</span><span class="s">&#39;FF&#39;</span><span class="p">:{}}</span>
            <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                <span class="n">inst</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
                <span class="n">hfx</span> <span class="o">=</span> <span class="s">&#39;:</span><span class="si">%d</span><span class="s">:&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">inst</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">inst</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">and</span> <span class="n">item</span> <span class="o">!=</span> <span class="s">&#39;Type&#39;</span><span class="p">:</span> <span class="k">continue</span> <span class="c"># skip over non-refined items (such as InstName)</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">hfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span><span class="p">)</span>
                                
                <span class="n">extApprox</span><span class="p">,</span><span class="n">extType</span><span class="p">,</span><span class="n">extParms</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">]</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;EType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extType</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;EApprox&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extApprox</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Tbar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extParms</span><span class="p">[</span><span class="s">&#39;Tbar&#39;</span><span class="p">]</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Cos2TM&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">extParms</span><span class="p">[</span><span class="s">&#39;Cos2TM&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="s">&#39;Primary&#39;</span> <span class="ow">in</span> <span class="n">extType</span><span class="p">:</span>
                    <span class="n">Ekey</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Ep&#39;</span><span class="p">,]</span>
                <span class="k">elif</span> <span class="s">&#39;I &amp; II&#39;</span> <span class="ow">in</span> <span class="n">extType</span><span class="p">:</span>
                    <span class="n">Ekey</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Eg&#39;</span><span class="p">,</span><span class="s">&#39;Es&#39;</span><span class="p">]</span>
                <span class="k">elif</span> <span class="s">&#39;Secondary Type II&#39;</span> <span class="o">==</span> <span class="n">extType</span><span class="p">:</span>
                    <span class="n">Ekey</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Es&#39;</span><span class="p">,]</span>
                <span class="k">elif</span> <span class="s">&#39;Secondary Type I&#39;</span> <span class="o">==</span> <span class="n">extType</span><span class="p">:</span>
                    <span class="n">Ekey</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Eg&#39;</span><span class="p">,]</span>
                <span class="k">else</span><span class="p">:</span>   <span class="c">#&#39;None&#39;</span>
                    <span class="n">Ekey</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">eKey</span> <span class="ow">in</span> <span class="n">Ekey</span><span class="p">:</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">eKey</span><span class="p">]</span> <span class="o">=</span> <span class="n">extParms</span><span class="p">[</span><span class="n">eKey</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">extParms</span><span class="p">[</span><span class="n">eKey</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">eKey</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">bab</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;BabA&#39;</span><span class="p">,</span><span class="s">&#39;BabU&#39;</span><span class="p">]:</span>
                    <span class="n">hapDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">bab</span><span class="p">]</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">bab</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">bab</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                        <span class="n">hapVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">bab</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Print</span><span class="p">:</span> 
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phase: &#39;</span><span class="p">,</span><span class="n">phase</span><span class="p">,</span><span class="s">&#39; in histogram: &#39;</span><span class="p">,</span><span class="n">histogram</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Scale factor     : </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">extType</span> <span class="o">!=</span> <span class="s">&#39;None&#39;</span><span class="p">:</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Extinction  Type: </span><span class="si">%15s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">extType</span><span class="p">),</span><span class="s">&#39; approx: </span><span class="si">%10s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">extApprox</span><span class="p">),</span><span class="s">&#39; tbar: </span><span class="si">%6.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">extParms</span><span class="p">[</span><span class="s">&#39;Tbar&#39;</span><span class="p">])</span>
                        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39; Parameters       :&#39;</span>
                        <span class="k">for</span> <span class="n">eKey</span> <span class="ow">in</span> <span class="n">Ekey</span><span class="p">:</span>
                            <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%4s</span><span class="s"> : </span><span class="si">%10.3e</span><span class="s"> Refine? &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">eKey</span><span class="p">,</span><span class="n">extParms</span><span class="p">[</span><span class="n">eKey</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">extParms</span><span class="p">[</span><span class="n">eKey</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="s">&#39;BabA&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="n">PrintBabinet</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">])</span>
                <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>       
                
    <span class="k">return</span> <span class="n">hapVary</span><span class="p">,</span><span class="n">hapDict</span><span class="p">,</span><span class="n">controlDict</span>
    </div>
<div class="viewcode-block" id="SetHistogramPhaseData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetHistogramPhaseData">[docs]</a><span class="k">def</span> <span class="nf">SetHistogramPhaseData</span><span class="p">(</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">,</span><span class="n">Phases</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">PrintSizeAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">,</span><span class="n">sizeSig</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> Size model:     </span><span class="si">%9s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; equatorial:</span><span class="si">%12.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; axial:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; LG mix coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; LG mix coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sizeSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">Snames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;S11&#39;</span><span class="p">,</span><span class="s">&#39;S22&#39;</span><span class="p">,</span><span class="s">&#39;S33&#39;</span><span class="p">,</span><span class="s">&#39;S12&#39;</span><span class="p">,</span><span class="s">&#39;S13&#39;</span><span class="p">,</span><span class="s">&#39;S23&#39;</span><span class="p">]</span>
            <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; name  :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Snames</span><span class="p">):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sizeSig</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sizeSig</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintMuStrainAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">,</span><span class="n">mustrainSig</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s"> Mustrain model: </span><span class="si">%9s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; equatorial:</span><span class="si">%12.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; axial:</span><span class="si">%12.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                     <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; LG mix coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; LG mix coeff.:</span><span class="si">%12.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;, sig:</span><span class="si">%8.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">mustrainSig</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">Snames</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
            <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; name  :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Snames</span><span class="p">):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">mustrainSig</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mustrainSig</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
            
    <span class="k">def</span> <span class="nf">PrintHStrainAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">,</span><span class="n">strainSig</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
        <span class="n">Hsnames</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; name  :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Hsnames</span><span class="p">):</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">strainSig</span><span class="p">:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">strainSig</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Hydrostatic/elastic strain: &#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintSHPOAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">,</span><span class="n">POsig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Spherical harmonics preferred orientation: Order:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="n">item</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">POsig</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">POsig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span> 
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintExtAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">,</span><span class="n">ScalExtSig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Single crystal extinction: Type: &#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39; Approx: &#39;</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">ScalExtSig</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;       </span><span class="si">%s</span><span class="s">: &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.2e</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">ScalExtSig</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39; sig: </span><span class="si">%12.2e</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">ScalExtSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">])</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">text</span>        
        
    <span class="k">def</span> <span class="nf">PrintBabinetAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">,</span><span class="n">BabSig</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Babinet form factor modification: &#39;</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">:</span>
            <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">BabSig</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">BabSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span> 
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
    
    <span class="n">PhFrExtPOSig</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">SizeMuStrSig</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">ScalExtSig</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">BabSig</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">wtFrSum</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
        <span class="n">HistoPhase</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
        <span class="n">General</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
        <span class="n">SGData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
        <span class="n">pId</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
        <span class="n">histoList</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>                        
                <span class="c">#skip if histogram not included e.g. in a sequential refinement</span>
                <span class="k">continue</span>
            <span class="n">hapData</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
            <span class="k">if</span> <span class="n">hId</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wtFrSum</span><span class="p">:</span>
                <span class="n">wtFrSum</span><span class="p">[</span><span class="n">hId</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Extinction&#39;</span><span class="p">]:</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">PhFrExtPOSig</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">:</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">],})</span>
                <span class="n">wtFrSum</span><span class="p">[</span><span class="n">hId</span><span class="p">]</span> <span class="o">+=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;Mass&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;MD&#39;</span><span class="p">:</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">PhFrExtPOSig</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">:</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">],})</span>
                <span class="k">else</span><span class="p">:</span>                           <span class="c">#&#39;SH&#39; spherical harmonics</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">5</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                            <span class="n">PhFrExtPOSig</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">:</span><span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">],})</span>
                <span class="n">SizeMuStrSig</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Mustrain&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Mustrain&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]))]],</span>
                    <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Size&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Size&#39;</span><span class="p">][</span><span class="mi">4</span><span class="p">]))]],</span>
                    <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;HStrain&#39;</span><span class="p">:{}})</span>                  
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Mustrain&#39;</span><span class="p">,</span><span class="s">&#39;Size&#39;</span><span class="p">]:</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;mx&#39;</span><span class="p">]</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;mx&#39;</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;mx&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,</span><span class="s">&#39;uniaxial&#39;</span><span class="p">]:</span>                    
                        <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;i&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&#39;Size&#39;</span><span class="p">:</span>
                            <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                        <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;i&#39;</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span> 
                            <span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;i&#39;</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;uniaxial&#39;</span><span class="p">:</span>
                            <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;a&#39;</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="s">&#39;Size&#39;</span><span class="p">:</span>
                                <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mf">10.</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>                        
                            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;a&#39;</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                                <span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;;a&#39;</span><span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>       <span class="c">#generalized for mustrain or ellipsoidal for size</span>
                        <span class="n">Nterms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">4</span><span class="p">])</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nterms</span><span class="p">):</span>
                            <span class="n">sfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                            <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">4</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="n">sfx</span><span class="p">]</span>
                            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="n">sfx</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                                <span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="o">+</span><span class="n">sfx</span><span class="p">]</span>
                <span class="n">names</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;HStrain&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;HStrain&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;BabA&#39;</span><span class="p">,</span><span class="s">&#39;BabU&#39;</span><span class="p">]:</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">BabSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>                
                
            <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,]:</span>
                    <span class="k">if</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">):</span>
                        <span class="n">hapData</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                            <span class="n">ScalExtSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Ep&#39;</span><span class="p">,</span><span class="s">&#39;Eg&#39;</span><span class="p">,</span><span class="s">&#39;Es&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">):</span>
                        <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">][</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                            <span class="n">ScalExtSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;BabA&#39;</span><span class="p">,</span><span class="s">&#39;BabU&#39;</span><span class="p">]:</span>
                    <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">][</span><span class="n">name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">BabSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">name</span><span class="p">]</span>                

    <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
            <span class="n">HistoPhase</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
            <span class="n">General</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
            <span class="n">SGData</span> <span class="o">=</span> <span class="n">General</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
            <span class="n">pId</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">][</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
            <span class="n">histoList</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>                        
                    <span class="c">#skip if histogram not included e.g. in a sequential refinement</span>
                    <span class="k">continue</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Phase: &#39;</span><span class="p">,</span><span class="n">phase</span><span class="p">,</span><span class="s">&#39; in histogram: &#39;</span><span class="p">,</span><span class="n">histogram</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">130</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
                <span class="n">hapData</span> <span class="o">=</span> <span class="n">HistoPhase</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
                <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
                <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">phase</span>
                <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Final refinement RF, RF^2 = </span><span class="si">%.2f%%</span><span class="s">, </span><span class="si">%.2f%%</span><span class="s"> on </span><span class="si">%d</span><span class="s"> reflections&#39;</span>   \
                        <span class="o">%</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf^2&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Nref&#39;</span><span class="p">])</span>
                
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span> <span class="ow">in</span> <span class="n">PhFrExtPOSig</span><span class="p">:</span>
                        <span class="n">wtFr</span> <span class="o">=</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">General</span><span class="p">[</span><span class="s">&#39;Mass&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">wtFrSum</span><span class="p">[</span><span class="n">hId</span><span class="p">]</span>
                        <span class="n">sigwtFr</span> <span class="o">=</span> <span class="n">PhFrExtPOSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">wtFr</span><span class="o">/</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Phase fraction  : </span><span class="si">%10.5f</span><span class="s">, sig </span><span class="si">%10.5f</span><span class="s"> Weight fraction  : </span><span class="si">%8.5f</span><span class="s">, sig </span><span class="si">%10.5f</span><span class="s">&#39;</span> \
                            <span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PhFrExtPOSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span><span class="p">],</span><span class="n">wtFr</span><span class="p">,</span><span class="n">sigwtFr</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Extinction&#39;</span> <span class="ow">in</span> <span class="n">PhFrExtPOSig</span><span class="p">:</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Extinction coeff: </span><span class="si">%10.4f</span><span class="s">, sig </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">PhFrExtPOSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Extinction&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;MD&#39;</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span> <span class="ow">in</span> <span class="n">PhFrExtPOSig</span><span class="p">:</span>
                            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; March-Dollase PO: </span><span class="si">%10.4f</span><span class="s">, sig </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">PhFrExtPOSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;MD&#39;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">PrintSHPOAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">],</span><span class="n">PhFrExtPOSig</span><span class="p">)</span>
                    <span class="n">PrintSizeAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Size&#39;</span><span class="p">],</span><span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Size&#39;</span><span class="p">])</span>
                    <span class="n">PrintMuStrainAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Mustrain&#39;</span><span class="p">],</span><span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Mustrain&#39;</span><span class="p">],</span><span class="n">SGData</span><span class="p">)</span>
                    <span class="n">PrintHStrainAndSig</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;HStrain&#39;</span><span class="p">],</span><span class="n">SizeMuStrSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;HStrain&#39;</span><span class="p">],</span><span class="n">SGData</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">BabSig</span><span class="p">):</span>
                        <span class="n">PrintBabinetAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">],</span><span class="n">BabSig</span><span class="p">)</span>
                    
                <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Final refinement RF, RF^2 = </span><span class="si">%.2f%%</span><span class="s">, </span><span class="si">%.2f%%</span><span class="s"> on </span><span class="si">%d</span><span class="s"> reflections&#39;</span>   \
                        <span class="o">%</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf^2&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Nref&#39;</span><span class="p">])</span>
                    <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; HKLF histogram weight factor = &#39;</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span> <span class="ow">in</span> <span class="n">ScalExtSig</span><span class="p">:</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Scale factor : </span><span class="si">%10.4f</span><span class="s">, sig </span><span class="si">%10.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">ScalExtSig</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Scale&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;None&#39;</span><span class="p">:</span>
                        <span class="n">PrintExtAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Extinction&#39;</span><span class="p">],</span><span class="n">ScalExtSig</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">BabSig</span><span class="p">):</span>
                        <span class="n">PrintBabinetAndSig</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">hapData</span><span class="p">[</span><span class="s">&#39;Babinet&#39;</span><span class="p">],</span><span class="n">BabSig</span><span class="p">)</span>

<span class="c">################################################################################</span>
<span class="c">##### Histogram data</span>
<span class="c">################################################################################        </span>
                    </div>
<div class="viewcode-block" id="GetHistogramData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.GetHistogramData">[docs]</a><span class="k">def</span> <span class="nf">GetHistogramData</span><span class="p">(</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">GetBackgroundParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Background</span><span class="p">):</span>
        <span class="n">Back</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DebyePeaks</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">bakType</span><span class="p">,</span><span class="n">bakFlag</span> <span class="o">=</span> <span class="n">Back</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">backVals</span> <span class="o">=</span> <span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
        <span class="n">backNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:Back:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">backVals</span><span class="p">))]</span>
        <span class="n">backDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">backNames</span><span class="p">,</span><span class="n">backVals</span><span class="p">))</span>
        <span class="n">backVary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">bakFlag</span><span class="p">:</span>
            <span class="n">backVary</span> <span class="o">=</span> <span class="n">backNames</span>
        <span class="n">backDict</span><span class="p">[</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:nDebye&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]</span>
        <span class="n">backDict</span><span class="p">[</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:nPeaks&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]</span>
        <span class="n">debyeDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">debyeList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]):</span>
            <span class="n">debyeNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:DebyeA:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:DebyeR:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:DebyeU:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
            <span class="n">debyeDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">debyeNames</span><span class="p">,</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][::</span><span class="mi">2</span><span class="p">])))</span>
            <span class="n">debyeList</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">debyeNames</span><span class="p">,</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">debyeVary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">debyeList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">debyeVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">backDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">debyeDict</span><span class="p">)</span>
        <span class="n">backVary</span> <span class="o">+=</span> <span class="n">debyeVary</span>
        <span class="n">peakDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">peakList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]):</span>
            <span class="n">peakNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:BkPkpos;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span> \
                <span class="s">&#39;:BkPkint;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:BkPksig;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:BkPkgam;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
            <span class="n">peakDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">peakNames</span><span class="p">,</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;peaksList&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][::</span><span class="mi">2</span><span class="p">])))</span>
            <span class="n">peakList</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">peakNames</span><span class="p">,</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;peaksList&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">peakVary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">peakList</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">peakVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">backDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">peakDict</span><span class="p">)</span>
        <span class="n">backVary</span> <span class="o">+=</span> <span class="n">peakVary</span>
        <span class="k">return</span> <span class="n">bakType</span><span class="p">,</span><span class="n">backDict</span><span class="p">,</span><span class="n">backVary</span>            
        
    <span class="k">def</span> <span class="nf">GetInstParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Inst</span><span class="p">):</span>     
        <span class="n">dataType</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">instDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">insVary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
        <span class="n">insKeys</span> <span class="o">=</span> <span class="n">Inst</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">insKeys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">insKeys</span><span class="p">:</span>
            <span class="n">insName</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span>
            <span class="n">instDict</span><span class="p">[</span><span class="n">insName</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">Inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
                <span class="n">insVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">insName</span><span class="p">)</span>
<span class="c">#        instDict[pfx+&#39;X&#39;] = max(instDict[pfx+&#39;X&#39;],0.001)</span>
<span class="c">#        instDict[pfx+&#39;Y&#39;] = max(instDict[pfx+&#39;Y&#39;],0.001)</span>
        <span class="n">instDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SH/L&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">instDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;SH/L&#39;</span><span class="p">],</span><span class="mf">0.0005</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">dataType</span><span class="p">,</span><span class="n">instDict</span><span class="p">,</span><span class="n">insVary</span>
        
    <span class="k">def</span> <span class="nf">GetSampleParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Sample</span><span class="p">):</span>
        <span class="n">sampVary</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">hfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>        
        <span class="n">sampDict</span> <span class="o">=</span> <span class="p">{</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;Gonio. radius&#39;</span><span class="p">:</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Gonio. radius&#39;</span><span class="p">],</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;Omega&#39;</span><span class="p">:</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Omega&#39;</span><span class="p">],</span>
            <span class="n">hfx</span><span class="o">+</span><span class="s">&#39;Chi&#39;</span><span class="p">:</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Chi&#39;</span><span class="p">],</span><span class="n">hfx</span><span class="o">+</span><span class="s">&#39;Phi&#39;</span><span class="p">:</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Phi&#39;</span><span class="p">]}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;Temperature&#39;</span><span class="p">,</span><span class="s">&#39;Pressure&#39;</span><span class="p">,</span><span class="s">&#39;FreePrm1&#39;</span><span class="p">,</span><span class="s">&#39;FreePrm2&#39;</span><span class="p">,</span><span class="s">&#39;FreePrm3&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">:</span>
                <span class="n">sampDict</span><span class="p">[</span><span class="n">hfx</span><span class="o">+</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">Type</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="s">&#39;Bragg&#39;</span> <span class="ow">in</span> <span class="n">Type</span><span class="p">:</span>             <span class="c">#Bragg-Brentano</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Shift&#39;</span><span class="p">,</span><span class="s">&#39;Transparency&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughA&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughB&#39;</span><span class="p">]:</span>
                <span class="n">sampDict</span><span class="p">[</span><span class="n">hfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">sampVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hfx</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;Debye&#39;</span> <span class="ow">in</span> <span class="n">Type</span><span class="p">:</span>        <span class="c">#Debye-Scherrer</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Absorption&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceX&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceY&#39;</span><span class="p">]:</span>
                <span class="n">sampDict</span><span class="p">[</span><span class="n">hfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">sampVary</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hfx</span><span class="o">+</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Type</span><span class="p">,</span><span class="n">sampDict</span><span class="p">,</span><span class="n">sampVary</span>
        
    <span class="k">def</span> <span class="nf">PrintBackground</span><span class="p">(</span><span class="n">Background</span><span class="p">):</span>
        <span class="n">Back</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DebyePeaks</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Background function: &#39;</span><span class="p">,</span><span class="n">Back</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39; Refine?&#39;</span><span class="p">,</span><span class="nb">bool</span><span class="p">(</span><span class="n">Back</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; Coefficients: &#39;</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">back</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">back</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span><span class="o">%</span><span class="mi">10</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="mi">15</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Debye diffuse scattering coefficients&#39;</span>
            <span class="n">parms</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;DebyeA&#39;</span><span class="p">,</span><span class="s">&#39;DebyeR&#39;</span><span class="p">,</span><span class="s">&#39;DebyeU&#39;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; names :  &#39;</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8s</span><span class="s"> refine?&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">]):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; term&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%5s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span><span class="nb">bool</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>                    
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Single peak coefficients&#39;</span>
            <span class="n">parms</span> <span class="o">=</span>    <span class="p">[</span><span class="s">&#39;BkPkpos&#39;</span><span class="p">,</span><span class="s">&#39;BkPkint&#39;</span><span class="p">,</span><span class="s">&#39;BkPksig&#39;</span><span class="p">,</span><span class="s">&#39;BkPkgam&#39;</span><span class="p">]</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; names :  &#39;</span>
            <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">parms</span><span class="p">:</span>
                <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%8s</span><span class="s"> refine?&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">parm</span><span class="p">)</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;peaksList&#39;</span><span class="p">]):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39; peak&#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%2d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">j</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%5s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">],</span><span class="nb">bool</span><span class="p">(</span><span class="n">term</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>                    
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">line</span>
        
    <span class="k">def</span> <span class="nf">PrintInstParms</span><span class="p">(</span><span class="n">Inst</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Instrument Parameters:&#39;</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; name  :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
        <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
        <span class="n">insKeys</span> <span class="o">=</span> <span class="n">Inst</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">insKeys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">insKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="s">&#39;Type&#39;</span><span class="p">:</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Lam1&#39;</span><span class="p">,</span><span class="s">&#39;Lam2&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">]:</span>
                    <span class="n">varstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">Inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">2</span><span class="p">])))</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>
        
    <span class="k">def</span> <span class="nf">PrintSampleParms</span><span class="p">(</span><span class="n">Sample</span><span class="p">):</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Sample Parameters:&#39;</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Goniometer omega = </span><span class="si">%.2f</span><span class="s">, chi = </span><span class="si">%.2f</span><span class="s">, phi = </span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span> \
            <span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Omega&#39;</span><span class="p">],</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Chi&#39;</span><span class="p">],</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Phi&#39;</span><span class="p">])</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; name  :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
        <span class="n">varstr</span> <span class="o">=</span> <span class="s">&#39; refine:&#39;</span>
        <span class="k">if</span> <span class="s">&#39;Bragg&#39;</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Shift&#39;</span><span class="p">,</span><span class="s">&#39;Transparency&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughA&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughB&#39;</span><span class="p">]:</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">])))</span>
            
        <span class="k">elif</span> <span class="s">&#39;Debye&#39;</span> <span class="ow">in</span> <span class="n">Type</span><span class="p">:</span>        <span class="c">#Debye-Scherrer</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Absorption&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceX&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceY&#39;</span><span class="p">]:</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">varstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">])))</span>

        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">varstr</span>
        
    <span class="n">histDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">histVary</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">controlDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">histoList</span> <span class="o">=</span> <span class="n">Histograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
            <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Limits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Limits&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Exclude&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Limits&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">excl</span> <span class="ow">in</span> <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Exclude&#39;</span><span class="p">]:</span>
                <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_inside</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">excl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">excl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Exclude&#39;</span><span class="p">]:</span>
                <span class="n">ma</span><span class="o">.</span><span class="n">mask_rows</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">])</span>
            <span class="n">Background</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">]</span>
            <span class="n">Type</span><span class="p">,</span><span class="n">bakDict</span><span class="p">,</span><span class="n">bakVary</span> <span class="o">=</span> <span class="n">GetBackgroundParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Background</span><span class="p">)</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;bakType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type</span>
            <span class="n">histDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">bakDict</span><span class="p">)</span>
            <span class="n">histVary</span> <span class="o">+=</span> <span class="n">bakVary</span>
            
            <span class="n">Inst</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">Type</span><span class="p">,</span><span class="n">instDict</span><span class="p">,</span><span class="n">insVary</span> <span class="o">=</span> <span class="n">GetInstParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Inst</span><span class="p">)</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;histType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type</span>
            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Lam1&#39;</span> <span class="ow">in</span> <span class="n">instDict</span><span class="p">:</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;keV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">12.397639</span><span class="o">/</span><span class="n">instDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Lam1&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;keV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">12.397639</span><span class="o">/</span><span class="n">instDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Lam&#39;</span><span class="p">]</span>            
            <span class="n">histDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">instDict</span><span class="p">)</span>
            <span class="n">histVary</span> <span class="o">+=</span> <span class="n">insVary</span>
            
            <span class="n">Sample</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">]</span>
            <span class="n">Type</span><span class="p">,</span><span class="n">sampDict</span><span class="p">,</span><span class="n">sampVary</span> <span class="o">=</span> <span class="n">GetSampleParms</span><span class="p">(</span><span class="n">hId</span><span class="p">,</span><span class="n">Sample</span><span class="p">)</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;instType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Type</span>
            <span class="n">histDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">sampDict</span><span class="p">)</span>
            <span class="n">histVary</span> <span class="o">+=</span> <span class="n">sampVary</span>
            
    
            <span class="k">if</span> <span class="n">Print</span><span class="p">:</span> 
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Histogram: &#39;</span><span class="p">,</span><span class="n">histogram</span><span class="p">,</span><span class="s">&#39; histogram Id: &#39;</span><span class="p">,</span><span class="n">hId</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
                <span class="n">Units</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;C&#39;</span><span class="p">:</span><span class="s">&#39; deg&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">:</span><span class="s">&#39; msec&#39;</span><span class="p">}</span>
                <span class="n">units</span> <span class="o">=</span> <span class="n">Units</span><span class="p">[</span><span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;histType&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">Limits</span> <span class="o">=</span> <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Limits&#39;</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Instrument type: &#39;</span><span class="p">,</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Histogram limits: </span><span class="si">%8.2f%s</span><span class="s"> to </span><span class="si">%8.2f%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Limits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">units</span><span class="p">,</span><span class="n">Limits</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">units</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Exclude&#39;</span><span class="p">]):</span>
                    <span class="n">excls</span> <span class="o">=</span> <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Exclude&#39;</span><span class="p">]</span>
                    <span class="k">for</span> <span class="n">excl</span> <span class="ow">in</span> <span class="n">excls</span><span class="p">:</span>
                        <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Excluded region:  </span><span class="si">%8.2f%s</span><span class="s"> to </span><span class="si">%8.2f%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">excl</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">units</span><span class="p">,</span><span class="n">excl</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">units</span><span class="p">)</span>    
                <span class="n">PrintSampleParms</span><span class="p">(</span><span class="n">Sample</span><span class="p">)</span>
                <span class="n">PrintInstParms</span><span class="p">(</span><span class="n">Inst</span><span class="p">)</span>
                <span class="n">PrintBackground</span><span class="p">(</span><span class="n">Background</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
            <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span>
            <span class="n">Inst</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;histType&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">histDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Lam&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inst</span><span class="p">[</span><span class="s">&#39;Lam&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">controlDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;keV&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">12.397639</span><span class="o">/</span><span class="n">histDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Lam&#39;</span><span class="p">]</span>                    
    <span class="k">return</span> <span class="n">histVary</span><span class="p">,</span><span class="n">histDict</span><span class="p">,</span><span class="n">controlDict</span>
    </div>
<div class="viewcode-block" id="SetHistogramData"><a class="viewcode-back" href="../GSASIIstruc.html#GSASIIstrIO.SetHistogramData">[docs]</a><span class="k">def</span> <span class="nf">SetHistogramData</span><span class="p">(</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">pFile</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">SetBackgroundParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Background</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">):</span>
        <span class="n">Back</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DebyePeaks</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lenBack</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">backSig</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenBack</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenBack</span><span class="p">):</span>
            <span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="o">+</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Back:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Back:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="n">backSig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Back:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;DebyeA:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;DebyeR:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;DebyeU:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">backSig</span><span class="p">[</span><span class="n">lenBack</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>            
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]):</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;BkPkpos;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;BkPkint;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="n">pfx</span><span class="o">+</span><span class="s">&#39;BkPksig;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;BkPkgam;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">names</span><span class="p">):</span>
                    <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;peaksList&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="o">*</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                        <span class="n">backSig</span><span class="p">[</span><span class="n">lenBack</span><span class="o">+</span><span class="mi">3</span><span class="o">*</span><span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]</span><span class="o">+</span><span class="mi">4</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">backSig</span>
        
    <span class="k">def</span> <span class="nf">SetInstParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Inst</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">):</span>
        <span class="n">instSig</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">insKeys</span> <span class="o">=</span> <span class="n">Inst</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">insKeys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">insKeys</span><span class="p">:</span>
            <span class="n">insName</span> <span class="o">=</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span>
            <span class="n">Inst</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">insName</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">insName</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="n">instSig</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">insName</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">instSig</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">instSig</span>
        
    <span class="k">def</span> <span class="nf">SetSampleParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Sample</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">):</span>
        <span class="k">if</span> <span class="s">&#39;Bragg&#39;</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]:</span>             <span class="c">#Bragg-Brentano</span>
            <span class="n">sampSig</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Shift&#39;</span><span class="p">,</span><span class="s">&#39;Transparency&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughA&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughB&#39;</span><span class="p">]):</span>
                <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sampSig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
        <span class="k">elif</span> <span class="s">&#39;Debye&#39;</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]:</span>        <span class="c">#Debye-Scherrer</span>
            <span class="n">sampSig</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Absorption&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceX&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceY&#39;</span><span class="p">]):</span>
                <span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pfx</span><span class="o">+</span><span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                    <span class="n">sampSig</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sampSig</span>
        
    <span class="k">def</span> <span class="nf">PrintBackgroundSig</span><span class="p">(</span><span class="n">Background</span><span class="p">,</span><span class="n">backSig</span><span class="p">):</span>
        <span class="n">Back</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">DebyePeaks</span> <span class="o">=</span> <span class="n">Background</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">lenBack</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>
        <span class="n">valstr</span> <span class="o">=</span> <span class="s">&#39; value : &#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   : &#39;</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">back</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Back</span><span class="p">[</span><span class="mi">3</span><span class="p">:]):</span>
            <span class="n">valstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.4g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">back</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Back</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%10.4g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">backSig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">10</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Background function: &#39;</span><span class="p">,</span><span class="n">Back</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">valstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span> 
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nDebye&#39;</span><span class="p">]:</span>
            <span class="n">ifAny</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ptfmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%12.3f</span><span class="s">&quot;</span>
            <span class="n">names</span> <span class="o">=</span>  <span class="s">&#39; names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; esds  :&#39;</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;Debye&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">ifAny</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">names</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">ptstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ifAny</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Debye diffuse scattering coefficients&#39;</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">names</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        <span class="k">if</span> <span class="n">DebyePeaks</span><span class="p">[</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]:</span>
            <span class="n">ifAny</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">ptfmt</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%14.3f</span><span class="s">&quot;</span>
            <span class="n">names</span> <span class="o">=</span>  <span class="s">&#39; names :&#39;</span>
            <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
            <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; esds  :&#39;</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sigDict</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">&#39;BkPk&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">ifAny</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">names</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="n">ptstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="n">ptfmt</span><span class="o">%</span><span class="p">(</span><span class="n">sigDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">ifAny</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Single peak coefficients&#39;</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">names</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintInstParmsSig</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">instSig</span><span class="p">):</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; value :&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">insKeys</span> <span class="o">=</span> <span class="n">instSig</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">insKeys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">insKeys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;Lam1&#39;</span><span class="p">,</span><span class="s">&#39;Lam2&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">]:</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Inst</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">instSig</span><span class="p">[</span><span class="n">name</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%12.6f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">instSig</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">12</span><span class="o">*</span><span class="s">&#39; &#39;</span>
        <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Instrument Parameters:&#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="k">def</span> <span class="nf">PrintSampleParmsSig</span><span class="p">(</span><span class="n">Sample</span><span class="p">,</span><span class="n">sampleSig</span><span class="p">):</span>
        <span class="n">ptlbls</span> <span class="o">=</span> <span class="s">&#39; names :&#39;</span>
        <span class="n">ptstr</span> <span class="o">=</span>  <span class="s">&#39; values:&#39;</span>
        <span class="n">sigstr</span> <span class="o">=</span> <span class="s">&#39; sig   :&#39;</span>
        <span class="n">refine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="s">&#39;Bragg&#39;</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Shift&#39;</span><span class="p">,</span><span class="s">&#39;Transparency&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughA&#39;</span><span class="p">,</span><span class="s">&#39;SurfRoughB&#39;</span><span class="p">]):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sampleSig</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sampleSig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">14</span><span class="o">*</span><span class="s">&#39; &#39;</span>
            
        <span class="k">elif</span> <span class="s">&#39;Debye&#39;</span> <span class="ow">in</span> <span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]:</span>        <span class="c">#Debye-Scherrer</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Scale&#39;</span><span class="p">,</span><span class="s">&#39;Absorption&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceX&#39;</span><span class="p">,</span><span class="s">&#39;DisplaceY&#39;</span><span class="p">]):</span>
                <span class="n">ptlbls</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ptstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Sample</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">sampleSig</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                    <span class="n">refine</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="si">%14.4f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">sampleSig</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sigstr</span> <span class="o">+=</span> <span class="mi">14</span><span class="o">*</span><span class="s">&#39; &#39;</span>

        <span class="k">if</span> <span class="n">refine</span><span class="p">:</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Sample Parameters:&#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptlbls</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">ptstr</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="n">sigstr</span>
        
    <span class="n">histoList</span> <span class="o">=</span> <span class="n">Histograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">histoList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">histogram</span> <span class="ow">in</span> <span class="n">histoList</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">histogram</span><span class="p">:</span>
            <span class="n">Histogram</span> <span class="o">=</span> <span class="n">Histograms</span><span class="p">[</span><span class="n">histogram</span><span class="p">]</span>
            <span class="n">hId</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;hId&#39;</span><span class="p">]</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="s">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;:&#39;</span>
            <span class="n">Background</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">]</span>
            <span class="n">backSig</span> <span class="o">=</span> <span class="n">SetBackgroundParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Background</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">)</span>
            
            <span class="n">Inst</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">instSig</span> <span class="o">=</span> <span class="n">SetInstParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Inst</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">)</span>
        
            <span class="n">Sample</span> <span class="o">=</span> <span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">]</span>
            <span class="n">sampSig</span> <span class="o">=</span> <span class="n">SetSampleParms</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">Sample</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">sigDict</span><span class="p">)</span>

            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Histogram: &#39;</span><span class="p">,</span><span class="n">histogram</span><span class="p">,</span><span class="s">&#39; histogram Id: &#39;</span><span class="p">,</span><span class="n">hId</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="mi">135</span><span class="o">*</span><span class="s">&#39;-&#39;</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; PWDR histogram weight factor = &#39;</span><span class="o">+</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Final refinement wR = </span><span class="si">%.2f%%</span><span class="s"> on </span><span class="si">%d</span><span class="s"> observations in this histogram&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;wR&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;Nobs&#39;</span><span class="p">])</span>
            <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Other residuals: R = </span><span class="si">%.2f%%</span><span class="s">, Rb = </span><span class="si">%.2f%%</span><span class="s">, wRb = </span><span class="si">%.2f%%</span><span class="s"> wRmin = </span><span class="si">%.2f%%</span><span class="s">&#39;</span><span class="o">%</span> \
                <span class="p">(</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;R&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;Rb&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;wRb&#39;</span><span class="p">],</span><span class="n">Histogram</span><span class="p">[</span><span class="s">&#39;Residuals&#39;</span><span class="p">][</span><span class="s">&#39;wRmin&#39;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">Print</span><span class="p">:</span>
                <span class="k">print</span> <span class="o">&gt;&gt;</span><span class="n">pFile</span><span class="p">,</span><span class="s">&#39; Instrument type: &#39;</span><span class="p">,</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">]</span>
                <span class="n">PrintSampleParmsSig</span><span class="p">(</span><span class="n">Sample</span><span class="p">,</span><span class="n">sampSig</span><span class="p">)</span>
                <span class="n">PrintInstParmsSig</span><span class="p">(</span><span class="n">Inst</span><span class="p">,</span><span class="n">instSig</span><span class="p">)</span>
                <span class="n">PrintBackgroundSig</span><span class="p">(</span><span class="n">Background</span><span class="p">,</span><span class="n">backSig</span><span class="p">)</span>
                </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>