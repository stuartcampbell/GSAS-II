

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASIIindex &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for GSASIIindex</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#GSASII cell indexing program: variation on that of A. Coehlo</span>
<span class="c">#   includes cell refinement from peak positions (not zero as yet)</span>
<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2013-06-02 23:07:35 -0500 (Sun, 02 Jun 2013) $</span>
<span class="c"># $Author: toby $</span>
<span class="c"># $Revision: 939 $</span>
<span class="c"># $URL: https://subversion.xray.aps.anl.gov/pyGSAS/trunk/GSASIIindex.py $</span>
<span class="c"># $Id: GSASIIindex.py 939 2013-06-03 04:07:35Z toby $</span>
<span class="c">########### SVN repository information ###################</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*GSASIIindex: Cell Indexing Module*</span>
<span class="sd">===================================</span>

<span class="sd">Cell indexing program: variation on that of A. Coehlo</span>
<span class="sd">includes cell refinement from peak positions (not zero as yet)</span>

<span class="sd">This needs a bit of refactoring to remove the little bit of GUI</span>
<span class="sd">code referencing wx</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">nl</span>
<span class="kn">import</span> <span class="nn">GSASIIpath</span>
<span class="n">GSASIIpath</span><span class="o">.</span><span class="n">SetVersionNumber</span><span class="p">(</span><span class="s">&quot;$Revision: 939 $&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">GSASIIlattice</span> <span class="kn">as</span> <span class="nn">G2lat</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="kn">as</span> <span class="nn">so</span>

<span class="c"># trig functions in degrees</span>
<span class="n">sind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">asind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">tand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">atand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">atan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">atan2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">cosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">acosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">rdsq2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>
<span class="c">#numpy versions</span>
<span class="n">npsind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">npasind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">npcosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">nptand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">npatand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">npatan2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    
<div class="viewcode-block" id="scaleAbyV"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.scaleAbyV">[docs]</a><span class="k">def</span> <span class="nf">scaleAbyV</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">V</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">v</span><span class="o">/</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale</span>
    </div>
<div class="viewcode-block" id="ranaxis"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.ranaxis">[docs]</a><span class="k">def</span> <span class="nf">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">random</span> <span class="kn">as</span> <span class="nn">rand</span>
    <span class="k">return</span> <span class="n">rand</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span><span class="o">+</span><span class="n">dmin</span>
    </div>
<div class="viewcode-block" id="ran2axis"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.ran2axis">[docs]</a><span class="k">def</span> <span class="nf">ran2axis</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">random</span> <span class="kn">as</span> <span class="nn">rand</span>
    <span class="n">T</span> <span class="o">=</span> <span class="mf">1.5</span><span class="o">+</span><span class="mf">0.49</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span>
<span class="c">#    B = 0.99-0.49*k/N</span>
<span class="c">#    B = 0.99-0.049*k/N</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mf">0.99</span><span class="o">-</span><span class="mf">0.149</span><span class="o">*</span><span class="n">k</span><span class="o">/</span><span class="n">N</span>
    <span class="n">R</span> <span class="o">=</span> <span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="n">B</span><span class="p">)</span><span class="o">*</span><span class="n">rand</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">+</span><span class="n">B</span>
    <span class="k">return</span> <span class="n">R</span>
    
<span class="c">#def ranNaxis(k,N):</span>
<span class="c">#    import random as rand</span>
<span class="c">#    T = 1.0+1.0*k/N</span>
<span class="c">#    B = 1.0-1.0*k/N</span>
<span class="c">#    R = (T-B)*rand.random()+B</span>
<span class="c">#    return R</span>
    </div>
<div class="viewcode-block" id="ranAbyV"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.ranAbyV">[docs]</a><span class="k">def</span> <span class="nf">ranAbyV</span><span class="p">(</span><span class="n">Bravais</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">,</span><span class="n">V</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">bad</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">while</span> <span class="n">bad</span><span class="p">:</span>
        <span class="n">bad</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">rancell</span><span class="p">(</span><span class="n">Bravais</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">Gmat2A</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rVsq</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scaleAbyV</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">V</span><span class="p">)</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">bad</span> <span class="o">|=</span> <span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">dmin</span>
    <span class="k">return</span> <span class="n">A</span>
    </div>
<div class="viewcode-block" id="ranAbyR"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.ranAbyR">[docs]</a><span class="k">def</span> <span class="nf">ranAbyR</span><span class="p">(</span><span class="n">Bravais</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">ranFunc</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">ranFunc</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>          <span class="c">#cubic - not used</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>          <span class="c">#hexagonal/trigonal</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>        
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>          <span class="c">#tetragonal</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>        
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>     <span class="c">#orthorhombic</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>        
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>        <span class="c">#monoclinic</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>        
    <span class="k">else</span><span class="p">:</span>                           <span class="c">#triclinic</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
        <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*=</span> <span class="n">R</span>
    <span class="k">return</span> <span class="n">A</span>
    </div>
<div class="viewcode-block" id="rancell"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.rancell">[docs]</a><span class="k">def</span> <span class="nf">rancell</span><span class="p">(</span><span class="n">Bravais</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>          <span class="c">#cubic</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">c</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">gam</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>          <span class="c">#hexagonal/trigonal</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">bet</span> <span class="o">=</span>  <span class="mi">90</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="mi">120</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>          <span class="c">#tetragonal</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">b</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">gam</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>       <span class="c">#orthorhombic - F,I,C,P - a&lt;b&lt;c convention</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">),</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">),</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)]</span>
        <span class="n">abc</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">gam</span> <span class="o">=</span> <span class="mi">90</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>        <span class="c">#monoclinic - C,P - a&lt;c convention</span>
        <span class="n">ac</span> <span class="o">=</span> <span class="p">[</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">),</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)]</span>
        <span class="n">ac</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">ac</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">ac</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">gam</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">bet</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="mf">90.</span><span class="p">,</span><span class="mf">130.</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>                           <span class="c">#triclinic - a&lt;b&lt;c convention</span>
        <span class="n">abc</span> <span class="o">=</span> <span class="p">[</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">),</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">),</span><span class="n">ranaxis</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">dmax</span><span class="p">)]</span>
        <span class="n">abc</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">abc</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="n">c</span>
        <span class="n">alp</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">acosd</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="n">acosd</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="n">c</span>
        <span class="n">bet</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">acosd</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="n">acosd</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>
        <span class="n">r</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="n">b</span>
        <span class="n">gam</span> <span class="o">=</span> <span class="n">ranaxis</span><span class="p">(</span><span class="n">acosd</span><span class="p">(</span><span class="n">r</span><span class="p">),</span><span class="n">acosd</span><span class="p">(</span><span class="o">-</span><span class="n">r</span><span class="p">))</span>  
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="calc_M20"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.calc_M20">[docs]</a><span class="k">def</span> <span class="nf">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">X20</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">Nobs20</span><span class="p">,</span><span class="n">peak</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
            <span class="n">Qobs</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">Qcalc</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">peak</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
            <span class="n">diff</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Qobs</span><span class="o">-</span><span class="n">Qcalc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">X20</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">Nobs20</span> <span class="o">==</span> <span class="mi">19</span><span class="p">:</span> 
            <span class="n">d20</span> <span class="o">=</span> <span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="k">break</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d20</span> <span class="o">=</span> <span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">Nobs20</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">N20</span><span class="p">,</span><span class="n">hkl</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">HKL</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">d20</span><span class="p">:</span>
            <span class="k">break</span>                
    <span class="n">eta</span> <span class="o">=</span> <span class="n">diff</span><span class="o">/</span><span class="n">Nobs20</span>
    <span class="n">Q20</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">d20</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">diff</span><span class="p">:</span>
        <span class="n">M20</span> <span class="o">=</span> <span class="n">Q20</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">diff</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">M20</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">M20</span> <span class="o">/=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">X20</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">M20</span><span class="p">,</span><span class="n">X20</span>
    </div>
<div class="viewcode-block" id="sortM20"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.sortM20">[docs]</a><span class="k">def</span> <span class="nf">sortM20</span><span class="p">(</span><span class="n">cells</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="c">#cells is M20,X20,Bravais,a,b,c,alp,bet,gam</span>
    <span class="c">#sort highest M20 1st</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">M</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cells</span><span class="p">):</span>
        <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">i</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">cells</span><span class="p">))</span>
    <span class="n">T</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">T</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span>
                </div>
<span class="k">def</span> <span class="nf">sortVolume</span><span class="p">(</span><span class="n">cells</span><span class="p">):</span>
    <span class="c">#cells is M20,X20,Bravais,a,b,c,alp,bet,gam,volume</span>
    <span class="c">#sort smallest volume 1st</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">M</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cells</span><span class="p">):</span>
        <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">M</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span><span class="n">i</span><span class="p">))</span>
    <span class="n">D</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">cells</span><span class="p">))</span>
    <span class="n">T</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">X</span>
                
<div class="viewcode-block" id="IndexPeaks"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.IndexPeaks">[docs]</a><span class="k">def</span> <span class="nf">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">bisect</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">False</span>
    <span class="n">hklds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">+</span><span class="p">[</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,]</span>
    <span class="n">hklds</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>                                        <span class="c"># ascending sort - upper bound at end</span>
    <span class="n">hklmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ipk</span><span class="p">,</span><span class="n">peak</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">bisect</span><span class="o">.</span><span class="n">bisect_right</span><span class="p">(</span><span class="n">hklds</span><span class="p">,</span><span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">])</span>          <span class="c"># find peak position in hkl list</span>
            <span class="n">dm</span> <span class="o">=</span> <span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">hklds</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>                         <span class="c"># peak to neighbor hkls in list</span>
            <span class="n">dp</span> <span class="o">=</span> <span class="n">hklds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">N</span><span class="o">-</span><span class="n">i</span>                                       <span class="c"># reverse the order</span>
            <span class="k">if</span> <span class="n">dp</span> <span class="o">&gt;</span> <span class="n">dm</span><span class="p">:</span> <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>                            <span class="c"># closer to upper than lower</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">pos</span><span class="p">,</span><span class="n">N</span>
                <span class="k">break</span>
            <span class="n">hkl</span> <span class="o">=</span> <span class="n">HKL</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>                                 <span class="c"># put in hkl</span>
            <span class="k">if</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>                                 <span class="c"># peak already assigned - test if this one better</span>
                <span class="n">opeak</span> <span class="o">=</span> <span class="n">peaks</span><span class="p">[</span><span class="n">hkl</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
                <span class="n">dold</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">opeak</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">-</span><span class="n">hkl</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
                <span class="n">dnew</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dm</span><span class="p">,</span><span class="n">dp</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dold</span> <span class="o">&gt;</span> <span class="n">dnew</span><span class="p">:</span>                             <span class="c"># new better - zero out old</span>
                    <span class="n">opeak</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">opeak</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">else</span><span class="p">:</span>                                       <span class="c"># old better - do nothing</span>
                    <span class="k">continue</span>                
            <span class="n">hkl</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">ipk</span>
            <span class="n">peak</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">hkl</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">peak</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="n">hkl</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>                                <span class="c"># fill in d-calc</span>
    <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="n">peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">peak</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">hklmax</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span> <span class="n">hklmax</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">4</span><span class="p">])</span>
                <span class="n">peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">hklmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">hklmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">hklmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
        </div>
<div class="viewcode-block" id="Values2A"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.Values2A">[docs]</a><span class="k">def</span> <span class="nf">Values2A</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">values</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="A2values"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.A2values">[docs]</a><span class="k">def</span> <span class="nf">A2values</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">A</span>
</div>
<div class="viewcode-block" id="FitHKL"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.FitHKL">[docs]</a><span class="k">def</span> <span class="nf">FitHKL</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Pwr</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
                
    <span class="k">def</span> <span class="nf">errFit</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">Pwr</span><span class="p">):</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Values2A</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">values</span><span class="p">)</span>
        <span class="n">Qo</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Qc</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Qo</span><span class="o">-</span><span class="n">Qc</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="n">Pwr</span>
    
    <span class="n">Peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">A2values</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errFit</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">ftol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">Pwr</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Values2A</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errFit</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">Pwr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="n">A</span><span class="p">,</span><span class="n">result</span>
           </div>
<div class="viewcode-block" id="FitHKLZ"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.FitHKLZ">[docs]</a><span class="k">def</span> <span class="nf">FitHKLZ</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Zref</span><span class="p">,</span><span class="n">Pwr</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="k">def</span> <span class="nf">errFit</span><span class="p">(</span><span class="n">values</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">H</span><span class="p">,</span><span class="n">tth</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">Zref</span><span class="p">,</span><span class="n">Pwr</span><span class="p">):</span>
        <span class="n">Zero</span> <span class="o">=</span> <span class="n">Z</span>
        <span class="k">if</span> <span class="n">Zref</span><span class="p">:</span>    
            <span class="n">Zero</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">Values2A</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">values</span><span class="p">[:</span><span class="mi">6</span><span class="p">])</span>
        <span class="n">Qo</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">d</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Qc</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsqZ</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Zero</span><span class="p">,</span><span class="n">tth</span><span class="p">,</span><span class="n">wave</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">Qo</span><span class="o">-</span><span class="n">Qc</span><span class="p">)</span><span class="o">*</span><span class="n">d</span><span class="o">**</span><span class="n">Pwr</span>
    
    <span class="n">Peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">values</span> <span class="o">=</span> <span class="n">A2values</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Zref</span><span class="p">:</span>
        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Z</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">errFit</span><span class="p">,</span><span class="n">values</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">ftol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span>
        <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wave</span><span class="p">,</span><span class="n">Zref</span><span class="p">,</span><span class="n">Pwr</span><span class="p">))</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">Values2A</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="mi">6</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">Zref</span><span class="p">:</span>
        <span class="n">Z</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="bp">True</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">errFit</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">],</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wave</span><span class="p">,</span><span class="n">Zref</span><span class="p">,</span><span class="n">Pwr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span><span class="n">A</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">result</span>
               </div>
<div class="viewcode-block" id="rotOrthoA"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.rotOrthoA">[docs]</a><span class="k">def</span> <span class="nf">rotOrthoA</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="swapMonoA"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.swapMonoA">[docs]</a><span class="k">def</span> <span class="nf">swapMonoA</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="oddPeak"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.oddPeak">[docs]</a><span class="k">def</span> <span class="nf">oddPeak</span><span class="p">(</span><span class="n">indx</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">noOdd</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">peak</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">H</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">noOdd</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">noOdd</span>
    </div>
<div class="viewcode-block" id="halfCell"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.halfCell">[docs]</a><span class="k">def</span> <span class="nf">halfCell</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">2</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span><span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*=</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">oddPeak</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">peaks</span><span class="p">):</span>
            <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*=</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">A</span>
    </div>
<div class="viewcode-block" id="getDmin"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.getDmin">[docs]</a><span class="k">def</span> <span class="nf">getDmin</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">return</span> <span class="n">peaks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="getDmax"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.getDmax">[docs]</a><span class="k">def</span> <span class="nf">getDmax</span><span class="p">(</span><span class="n">peaks</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="k">return</span> <span class="n">peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">7</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="refinePeaksZ"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.refinePeaksZ">[docs]</a><span class="k">def</span> <span class="nf">refinePeaksZ</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Zero</span><span class="p">,</span><span class="n">ZeroRef</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">getDmin</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">OK</span><span class="p">,</span><span class="n">smin</span><span class="p">,</span><span class="n">Aref</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="n">FitHKLZ</span><span class="p">(</span><span class="n">wave</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Zero</span><span class="p">,</span><span class="n">ZeroRef</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">Peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">Peaks</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsqZ</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">Aref</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">Peaks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">wave</span><span class="p">))</span>
    <span class="n">peaks</span> <span class="o">=</span> <span class="n">Peaks</span><span class="o">.</span><span class="n">T</span>    
    <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Aref</span><span class="p">)</span>
    <span class="n">M20</span><span class="p">,</span><span class="n">X20</span> <span class="o">=</span> <span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">),</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">Aref</span><span class="p">,</span><span class="n">Z</span>
    </div>
<div class="viewcode-block" id="refinePeaks"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.refinePeaks">[docs]</a><span class="k">def</span> <span class="nf">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">getDmin</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">smin</span> <span class="o">=</span> <span class="mf">1.0e10</span>
    <span class="n">pwr</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">maxTries</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">OK</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">):</span>
        <span class="n">Pwr</span> <span class="o">=</span> <span class="n">pwr</span> <span class="o">-</span> <span class="p">(</span><span class="n">tries</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">osmin</span> <span class="o">=</span> <span class="n">smin</span>
        <span class="n">oldA</span> <span class="o">=</span> <span class="n">A</span><span class="p">[:]</span>
        <span class="n">Vold</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">oldA</span><span class="p">)</span>
        <span class="n">OK</span><span class="p">,</span><span class="n">smin</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="n">FitHKL</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Pwr</span><span class="p">)</span>
        <span class="n">Vnew</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Vnew</span> <span class="o">&gt;</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">Vold</span> <span class="ow">or</span> <span class="n">Vnew</span> <span class="o">&lt;</span> <span class="mf">2.</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">ranAbyR</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">oldA</span><span class="p">,</span><span class="n">tries</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">maxTries</span><span class="p">,</span><span class="n">ran2axis</span><span class="p">)</span>
            <span class="n">OK</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">continue</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FloatingPointError</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">oldA</span>
            <span class="n">OK</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">break</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">break</span>                         <span class="c">#absurd cell obtained!</span>
        <span class="n">rat</span> <span class="o">=</span> <span class="p">(</span><span class="n">osmin</span><span class="o">-</span><span class="n">smin</span><span class="p">)</span><span class="o">/</span><span class="n">smin</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rat</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-5</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">OK</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">if</span> <span class="n">tries</span> <span class="o">&gt;</span> <span class="n">maxTries</span><span class="p">:</span> <span class="k">break</span>
    <span class="k">if</span> <span class="n">OK</span><span class="p">:</span>
        <span class="n">OK</span><span class="p">,</span><span class="n">smin</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="n">FitHKL</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">Peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Peaks</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
            <span class="n">peaks</span> <span class="o">=</span> <span class="n">Peaks</span><span class="o">.</span><span class="n">T</span>
        <span class="k">except</span> <span class="ne">FloatingPointError</span><span class="p">:</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">oldA</span>
        
    <span class="n">M20</span><span class="p">,</span><span class="n">X20</span> <span class="o">=</span> <span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">),</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span>
        </div>
<div class="viewcode-block" id="findBestCell"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.findBestCell">[docs]</a><span class="k">def</span> <span class="nf">findBestCell</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">ncMax</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Ntries</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">V1</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
<span class="c"># dlg &amp; ncMax are used for wx progress bar </span>
<span class="c"># A != 0 find the best A near input A,</span>
<span class="c"># A = 0 for random cell, volume normalized to V1;</span>
<span class="c"># returns number of generated hkls, M20, X20 &amp; A for best found</span>
    <span class="n">mHKL</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">getDmin</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">-</span><span class="mf">0.05</span>
    <span class="n">amin</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="n">amax</span> <span class="o">=</span> <span class="mf">5.</span><span class="o">*</span><span class="n">getDmax</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">Asave</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">GoOn</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="k">if</span> <span class="n">A</span><span class="p">:</span>
        <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">[:])</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mHKL</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]:</span>
            <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
            <span class="n">Asave</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">),</span><span class="n">A</span><span class="p">[:]])</span>
    <span class="n">tries</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">tries</span> <span class="o">&lt;</span> <span class="n">Ntries</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">A</span><span class="p">:</span>
            <span class="n">Abeg</span> <span class="o">=</span> <span class="n">ranAbyR</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">tries</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Ntries</span><span class="p">,</span><span class="n">ran2axis</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">13</span><span class="p">]:</span>         <span class="c">#monoclinic &amp; triclinic</span>
                <span class="n">Abeg</span> <span class="o">=</span> <span class="n">ranAbyR</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">tries</span><span class="o">/</span><span class="mi">10</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Ntries</span><span class="p">,</span><span class="n">ran2axis</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Abeg</span> <span class="o">=</span> <span class="n">ranAbyV</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">amin</span><span class="p">,</span><span class="n">amax</span><span class="p">,</span><span class="n">V1</span><span class="p">)</span>
        <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Abeg</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">mHKL</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]:</span>
            <span class="n">Lhkl</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">Aref</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Abeg</span><span class="p">)</span>
            <span class="n">Asave</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">),</span><span class="n">Aref</span><span class="p">[:]])</span>
            <span class="k">if</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>                          <span class="c">#C-centered orthorhombic</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
                    <span class="n">Abeg</span> <span class="o">=</span> <span class="n">rotOrthoA</span><span class="p">(</span><span class="n">Abeg</span><span class="p">[:])</span>
                    <span class="n">Lhkl</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">Aref</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Abeg</span><span class="p">)</span>
                    <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Aref</span><span class="p">)</span>
                    <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
                    <span class="n">Asave</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">),</span><span class="n">Aref</span><span class="p">[:]])</span>
            <span class="k">elif</span> <span class="n">ibrav</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span>                      <span class="c">#C-centered monoclinic</span>
                <span class="n">Abeg</span> <span class="o">=</span> <span class="n">swapMonoA</span><span class="p">(</span><span class="n">Abeg</span><span class="p">[:])</span>
                <span class="n">Lhkl</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">Aref</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Abeg</span><span class="p">)</span>
                <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">Aref</span><span class="p">)</span>
                <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
                <span class="n">Asave</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">),</span><span class="n">Aref</span><span class="p">[:]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">Nc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">HKL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Nc</span> <span class="o">&gt;=</span> <span class="n">ncMax</span><span class="p">:</span>
            <span class="n">GoOn</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">elif</span> <span class="n">dlg</span><span class="p">:</span>
            <span class="n">GoOn</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">Nc</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                <span class="k">break</span>
        <span class="n">tries</span> <span class="o">+=</span> <span class="mi">1</span>    
    <span class="n">X</span> <span class="o">=</span> <span class="n">sortM20</span><span class="p">(</span><span class="n">Asave</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">Lhkl</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">GoOn</span><span class="p">,</span><span class="n">Lhkl</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GoOn</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span>
        </div>
<div class="viewcode-block" id="monoCellReduce"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.monoCellReduce">[docs]</a><span class="k">def</span> <span class="nf">monoCellReduce</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">]:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">anew</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">g</span><span class="p">),</span><span class="n">v</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">anew</span> <span class="o">&lt;</span> <span class="n">a</span><span class="p">:</span>
            <span class="n">cang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">g</span><span class="p">),</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">anew</span><span class="o">*</span><span class="n">c</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cang</span><span class="p">))</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">([</span><span class="n">anew</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cnew</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">g</span><span class="p">),</span><span class="n">v</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">cnew</span> <span class="o">&lt;</span> <span class="n">c</span><span class="p">:</span>
            <span class="n">cang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">g</span><span class="p">),</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">cnew</span><span class="p">)</span>
            <span class="n">beta</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">cang</span><span class="p">))</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">([</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">cnew</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">A</span>
</div>
<div class="viewcode-block" id="DoIndexPeaks"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.DoIndexPeaks">[docs]</a><span class="k">def</span> <span class="nf">DoIndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="n">controls</span><span class="p">,</span><span class="n">bravais</span><span class="p">):</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    
    <span class="n">delt</span> <span class="o">=</span> <span class="mf">0.005</span>                                     <span class="c">#lowest d-spacing cushion - can be fixed?</span>
    <span class="n">amin</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="n">amax</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">*</span><span class="n">getDmax</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">getDmin</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span><span class="o">-</span><span class="n">delt</span>
    <span class="n">bravaisNames</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Cubic-F&#39;</span><span class="p">,</span><span class="s">&#39;Cubic-I&#39;</span><span class="p">,</span><span class="s">&#39;Cubic-P&#39;</span><span class="p">,</span><span class="s">&#39;Trigonal-R&#39;</span><span class="p">,</span><span class="s">&#39;Trigonal/Hexagonal-P&#39;</span><span class="p">,</span>
        <span class="s">&#39;Tetragonal-I&#39;</span><span class="p">,</span><span class="s">&#39;Tetragonal-P&#39;</span><span class="p">,</span><span class="s">&#39;Orthorhombic-F&#39;</span><span class="p">,</span><span class="s">&#39;Orthorhombic-I&#39;</span><span class="p">,</span><span class="s">&#39;Orthorhombic-C&#39;</span><span class="p">,</span>
        <span class="s">&#39;Orthorhombic-P&#39;</span><span class="p">,</span><span class="s">&#39;Monoclinic-C&#39;</span><span class="p">,</span><span class="s">&#39;Monoclinic-P&#39;</span><span class="p">,</span><span class="s">&#39;Triclinic&#39;</span><span class="p">]</span>
    <span class="n">tries</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;1st&#39;</span><span class="p">,</span><span class="s">&#39;2nd&#39;</span><span class="p">,</span><span class="s">&#39;3rd&#39;</span><span class="p">,</span><span class="s">&#39;4th&#39;</span><span class="p">,</span><span class="s">&#39;5th&#39;</span><span class="p">,</span><span class="s">&#39;6th&#39;</span><span class="p">,</span><span class="s">&#39;7th&#39;</span><span class="p">,</span><span class="s">&#39;8th&#39;</span><span class="p">,</span><span class="s">&#39;9th&#39;</span><span class="p">,</span><span class="s">&#39;10th&#39;</span><span class="p">]</span>
    <span class="n">N1s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>   <span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span>  <span class="mi">50</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span> <span class="mi">200</span><span class="p">]</span>
    <span class="n">N2s</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>   <span class="mi">4</span><span class="p">]</span>
    <span class="n">Nm</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>   <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>     <span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span>   <span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>   <span class="mi">4</span><span class="p">]</span>
    <span class="n">Nobs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">zero</span><span class="p">,</span><span class="n">ncno</span> <span class="o">=</span> <span class="n">controls</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">ncMax</span> <span class="o">=</span> <span class="n">Nobs</span><span class="o">*</span><span class="n">ncno</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;lattice parameter range = &#39;</span><span class="p">,</span><span class="n">amin</span><span class="p">,</span><span class="n">amax</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%8.5f</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%.4f</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;Wavelength =&#39;</span><span class="p">,</span><span class="n">wave</span><span class="p">,</span><span class="s">&#39;Zero =&#39;</span><span class="p">,</span><span class="n">zero</span><span class="p">,</span><span class="s">&#39;Nc/No max =&#39;</span><span class="p">,</span><span class="n">ncno</span><span class="p">,</span><span class="s">&#39; Max Nc =&#39;</span><span class="p">,</span><span class="n">ncno</span><span class="o">*</span><span class="n">Nobs</span><span class="p">)</span>
    <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">):</span>
        <span class="n">begin</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">bravais</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]:</span>
            <span class="k">print</span> <span class="s">&#39;cell search for &#39;</span><span class="p">,</span><span class="n">bravaisNames</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]</span>
            <span class="k">print</span> <span class="s">&#39;      M20  X20  Nc       a          b          c        alpha       beta      gamma     volume      V-test&#39;</span>
            <span class="n">V1</span> <span class="o">=</span> <span class="n">controls</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">bestM20</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">topM20</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">cycle</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">cycle</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ProgressDialog</span><span class="p">(</span><span class="s">&quot;Generated reflections&quot;</span><span class="p">,</span><span class="n">tries</span><span class="p">[</span><span class="n">cycle</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; cell search for &quot;</span><span class="o">+</span><span class="n">bravaisNames</span><span class="p">[</span><span class="n">ibrav</span><span class="p">],</span><span class="n">ncMax</span><span class="p">,</span> 
                    <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PD_ELAPSED_TIME</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_AUTO_HIDE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_REMAINING_TIME</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_CAN_ABORT</span><span class="p">)</span>
                <span class="n">screenSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
                <span class="n">Size</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">305</span><span class="p">,</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">GoOn</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">while</span> <span class="n">GoOn</span><span class="p">:</span>                                                 <span class="c">#Loop over increment of volume</span>
                        <span class="n">N2</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="k">while</span> <span class="n">N2</span> <span class="o">&lt;</span> <span class="n">N2s</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]:</span>                                  <span class="c">#Table 2 step (iii)               </span>
                            <span class="k">if</span> <span class="n">ibrav</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">N2</span><span class="p">:</span>
                                    <span class="n">A</span> <span class="o">=</span> <span class="p">[]</span>
                                    <span class="n">GoOn</span><span class="p">,</span><span class="n">Nc</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">findBestCell</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">ncMax</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Nm</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]</span><span class="o">*</span><span class="n">N1s</span><span class="p">[</span><span class="n">ibrav</span><span class="p">],</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">V1</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">A</span><span class="p">:</span>
                                    <span class="n">GoOn</span><span class="p">,</span><span class="n">Nc</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">findBestCell</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">ncMax</span><span class="p">,</span><span class="n">A</span><span class="p">[:],</span><span class="n">N1s</span><span class="p">[</span><span class="n">ibrav</span><span class="p">],</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">GoOn</span><span class="p">,</span><span class="n">Nc</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">findBestCell</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">ncMax</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Nm</span><span class="p">[</span><span class="n">ibrav</span><span class="p">]</span><span class="o">*</span><span class="n">N1s</span><span class="p">[</span><span class="n">ibrav</span><span class="p">],</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">V1</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">Nc</span> <span class="o">&gt;=</span> <span class="n">ncMax</span><span class="p">:</span>
                                <span class="n">GoOn</span> <span class="o">=</span> <span class="bp">False</span>
                                <span class="k">break</span>
                            <span class="k">elif</span> <span class="mi">3</span><span class="o">*</span><span class="n">Nc</span> <span class="o">&lt;</span> <span class="n">Nobs</span><span class="p">:</span>
                                <span class="n">N2</span> <span class="o">=</span> <span class="mi">10</span>
                                <span class="k">break</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                                    <span class="k">break</span>
                                <span class="k">if</span> <span class="n">M20</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                                    <span class="n">bestM20</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bestM20</span><span class="p">,</span><span class="n">M20</span><span class="p">)</span>
                                    <span class="n">A</span> <span class="o">=</span> <span class="n">halfCell</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">[:],</span><span class="n">peaks</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">12</span><span class="p">]:</span>
                                        <span class="n">A</span> <span class="o">=</span> <span class="n">monoCellReduce</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">[:])</span>
                                    <span class="n">HKL</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                                    <span class="n">IndexPeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
                                    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
                                    <span class="n">V</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
                                    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.2f</span><span class="s"> </span><span class="si">%10.2f</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">Nc</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">V1</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="n">M20</span> <span class="o">&gt;=</span> <span class="mf">2.0</span><span class="p">:</span>
                                        <span class="n">cells</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">])</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                                <span class="k">break</span>
                            <span class="n">N2</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="k">if</span> <span class="n">ibrav</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">:</span>
                            <span class="n">V1</span> <span class="o">*=</span> <span class="mf">1.1</span>
                        <span class="k">elif</span> <span class="n">ibrav</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">14</span><span class="p">):</span>
                            <span class="n">V1</span> <span class="o">*=</span> <span class="mf">1.05</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">bestM20</span> <span class="o">&gt;</span> <span class="n">topM20</span><span class="p">:</span>
                                <span class="n">topM20</span> <span class="o">=</span> <span class="n">bestM20</span>
                                <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
                                    <span class="n">V1</span> <span class="o">=</span> <span class="n">cells</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">9</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">V1</span> <span class="o">=</span> <span class="mi">25</span>
                                <span class="n">ncMax</span> <span class="o">+=</span> <span class="n">Nobs</span>
                                <span class="n">cycle</span> <span class="o">+=</span> <span class="mi">1</span>
                                <span class="k">print</span> <span class="s">&#39;Restart search, new Max Nc = &#39;</span><span class="p">,</span><span class="n">ncMax</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">cycle</span> <span class="o">=</span> <span class="mi">10</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&#39;</span><span class="si">%s%s%s%s</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;finished cell search for &#39;</span><span class="p">,</span><span class="n">bravaisNames</span><span class="p">[</span><span class="n">ibrav</span><span class="p">],</span> \
                <span class="s">&#39;, elapsed time = &#39;</span><span class="p">,</span><span class="n">G2lat</span><span class="o">.</span><span class="n">sec2HMS</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">begin</span><span class="p">))</span>
            
    <span class="k">if</span> <span class="n">cells</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span><span class="p">,</span><span class="n">dmin</span><span class="p">,</span><span class="n">cells</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span><span class="p">,</span><span class="mi">0</span><span class="p">,[]</span>
        
        </div>
<span class="n">NeedTestData</span> <span class="o">=</span> <span class="bp">True</span>
<div class="viewcode-block" id="TestData"><a class="viewcode-back" href="../GSASIIindex.html#GSASIIindex.TestData">[docs]</a><span class="k">def</span> <span class="nf">TestData</span><span class="p">():</span>
    <span class="s">&#39;needs a doc string&#39;</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
    <span class="k">global</span> <span class="n">NeedTestData</span>
    <span class="n">NeedTestData</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">global</span> <span class="n">TestData</span>
    <span class="n">TestData</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="p">[</span><span class="mf">7.</span><span class="p">,</span><span class="mf">8.70</span><span class="p">,</span><span class="mf">10.86</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">102.95</span><span class="p">,</span><span class="mf">90.</span><span class="p">],</span> <span class="p">[</span><span class="mf">7.76006</span><span class="p">,</span><span class="mf">8.706215</span><span class="p">,</span><span class="mf">10.865679</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">102.947</span><span class="p">,</span><span class="mf">90.</span><span class="p">],</span><span class="mi">3</span><span class="p">,</span>
        <span class="p">[[</span><span class="mf">2.176562137832974</span><span class="p">,</span> <span class="mf">761.60902227696033</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">10.591300714328161</span><span class="p">,</span> <span class="mf">10.589436</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.0477561489789498</span><span class="p">,</span> <span class="mf">4087.2956049071572</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">7.564238997554908</span><span class="p">,</span> <span class="mf">7.562777</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.3254921120068524</span><span class="p">,</span> <span class="mf">1707.0253890991009</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">6.932650301411212</span><span class="p">,</span> <span class="mf">6.932718</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.428121546163426</span><span class="p">,</span> <span class="mf">2777.5082170150563</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">6.725163158013632</span><span class="p">,</span> <span class="mf">6.725106</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.0379791325512118</span><span class="p">,</span> <span class="mf">1598.4321673135987</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">5.709789097440156</span><span class="p">,</span> <span class="mf">5.70946</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.2511182350743937</span><span class="p">,</span> <span class="mf">473.10955149057577</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">5.423637972781876</span><span class="p">,</span> <span class="mf">5.42333</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.354684330373451</span><span class="p">,</span> <span class="mf">569.88528280256071</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.2947091882172534</span><span class="p">,</span> <span class="mf">5.294718</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">4.723324574319177</span><span class="p">,</span> <span class="mf">342.73882372499997</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">4.881681587039431</span><span class="p">,</span> <span class="mf">4.881592</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.9014773581253994</span><span class="p">,</span> <span class="mf">5886.3516356615492</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.704350709093183</span><span class="p">,</span> <span class="mf">4.70413</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.0970774474587275</span><span class="p">,</span> <span class="mf">3459.7541692903033</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">4.523933797797693</span><span class="p">,</span> <span class="mf">4.523829</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.2971997607389518</span><span class="p">,</span> <span class="mf">1290.0229964239879</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.353139557169142</span><span class="p">,</span> <span class="mf">4.353108</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.4161306205553847</span><span class="p">,</span> <span class="mf">1472.5726977257755</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">4.257619398422479</span><span class="p">,</span> <span class="mf">4.257944</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.7277364698554161</span><span class="p">,</span> <span class="mf">1577.8791668322888</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">4.026169751907777</span><span class="p">,</span> <span class="mf">4.026193</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.8500213058834163</span><span class="p">,</span> <span class="mf">420.74210142657131</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.9420803081518443</span><span class="p">,</span> <span class="mf">3.942219</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">6.0986764166731708</span><span class="p">,</span> <span class="mf">163.02160537058708</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.7814965150452537</span><span class="p">,</span> <span class="mf">3.781389</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.1126665157702753</span><span class="p">,</span> <span class="mf">943.25461245706833</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.772849962062199</span><span class="p">,</span> <span class="mf">3.772764</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.2559260555056957</span><span class="p">,</span> <span class="mf">250.55355015505376</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.6865353266375283</span><span class="p">,</span> <span class="mf">3.686602</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.4226243128279892</span><span class="p">,</span> <span class="mf">5388.5560141098349</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.5909481979190283</span><span class="p">,</span> <span class="mf">3.591214</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.5346132446561134</span><span class="p">,</span> <span class="mf">1951.6070344509026</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.5294722429440584</span><span class="p">,</span> <span class="mf">3.529812</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.5586952135236443</span><span class="p">,</span> <span class="mf">259.65938178131034</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.516526936765838</span><span class="p">,</span> <span class="mf">3.516784</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.6509216222783722</span><span class="p">,</span> <span class="mf">93.265376597376573</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.4678179073694952</span><span class="p">,</span> <span class="mf">3.468369</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.7152737044107722</span><span class="p">,</span> <span class="mf">289.39386813803162</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">3.4346235125812807</span><span class="p">,</span> <span class="mf">3.434648</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.8594130457361899</span><span class="p">,</span> <span class="mf">603.54959764648322</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.362534044860622</span><span class="p">,</span> <span class="mf">3.362553</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.0511627728884454</span><span class="p">,</span> <span class="mf">126.43246447656593</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.2712038721790675</span><span class="p">,</span> <span class="mf">3.271181</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.077700845503319</span><span class="p">,</span> <span class="mf">125.49742760019636</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.2589538988480626</span><span class="p">,</span> <span class="mf">3.259037</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.099393757363675</span><span class="p">,</span> <span class="mf">416.55444885434633</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.2490085228959193</span><span class="p">,</span> <span class="mf">3.248951</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.1623933278642742</span><span class="p">,</span> <span class="mf">369.27397110921817</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mf">3.2204673608202383</span><span class="p">,</span> <span class="mf">3.220487</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.4121734953058924</span><span class="p">,</span> <span class="mf">482.84120827021826</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">3.1120858221599876</span><span class="p">,</span> <span class="mf">3.112308</span><span class="p">]]</span>
        <span class="p">]</span>
    <span class="k">global</span> <span class="n">TestData2</span>
    <span class="n">TestData2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.15336547830008007</span><span class="p">,</span> <span class="mf">0.017345499139401827</span><span class="p">,</span> <span class="mf">0.008122368657493792</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.02893538955687591</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span>
        <span class="p">[[</span><span class="mf">2.176562137832974</span><span class="p">,</span> <span class="mf">761.6090222769603</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">10.591300714328161</span><span class="p">,</span> <span class="mf">11.095801</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.0477561489789498</span><span class="p">,</span> <span class="mf">4087.295604907157</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">7.564238997554908</span><span class="p">,</span> <span class="mf">7.592881</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.3254921120068524</span><span class="p">,</span> <span class="mf">1707.025389099101</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">6.932650301411212</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">3.428121546163426</span><span class="p">,</span> <span class="mf">2777.5082170150563</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">6.725163158013632</span><span class="p">,</span> <span class="mf">6.266192</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.037979132551212</span><span class="p">,</span> <span class="mf">1598.4321673135987</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">5.709789097440156</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.251118235074394</span><span class="p">,</span> <span class="mf">473.10955149057577</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.423637972781876</span><span class="p">,</span> <span class="mf">5.5479</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.354684330373451</span><span class="p">,</span> <span class="mf">569.8852828025607</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">5.2947091882172534</span><span class="p">,</span> <span class="mf">5.199754</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.723324574319177</span><span class="p">,</span> <span class="mf">342.738823725</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.881681587039431</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">4.901477358125399</span><span class="p">,</span> <span class="mf">5886.351635661549</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.704350709093183</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.0970774474587275</span><span class="p">,</span> <span class="mf">3459.7541692903033</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">4.523933797797693</span><span class="p">,</span> <span class="mf">4.479534</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.297199760738952</span><span class="p">,</span> <span class="mf">1290.022996423988</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.353139557169142</span><span class="p">,</span> <span class="mf">4.345087</span><span class="p">],</span>
        <span class="p">[</span><span class="mf">5.416130620555385</span><span class="p">,</span> <span class="mf">1472.5726977257755</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.257619398422479</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.727736469855416</span><span class="p">,</span> <span class="mf">1577.8791668322888</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">4.026169751907777</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">5.850021305883416</span><span class="p">,</span> <span class="mf">420.7421014265713</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.9420803081518443</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.098676416673171</span><span class="p">,</span> <span class="mf">163.02160537058708</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.7814965150452537</span><span class="p">,</span> <span class="mf">3.796441</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.112666515770275</span><span class="p">,</span> <span class="mf">943.2546124570683</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.772849962062199</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.255926055505696</span><span class="p">,</span> <span class="mf">250.55355015505376</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.6865353266375283</span><span class="p">,</span> <span class="mf">3.6986</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.422624312827989</span><span class="p">,</span> <span class="mf">5388.556014109835</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">3.5909481979190283</span><span class="p">,</span> <span class="mf">3.592005</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.534613244656113</span><span class="p">,</span> <span class="mf">191.6070344509026</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mf">3.5294722429440584</span><span class="p">,</span> <span class="mf">3.546166</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.558695213523644</span><span class="p">,</span> <span class="mf">259.65938178131034</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.516526936765838</span><span class="p">,</span> <span class="mf">3.495428</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.650921622278372</span><span class="p">,</span> <span class="mf">93.26537659737657</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.4678179073694952</span><span class="p">,</span> <span class="mf">3.466503</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.715273704410772</span><span class="p">,</span> <span class="mf">289.3938681380316</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.4346235125812807</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">6.85941304573619</span><span class="p">,</span> <span class="mf">603.5495976464832</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.362534044860622</span><span class="p">,</span> <span class="mf">3.32509</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.051162772888445</span><span class="p">,</span> <span class="mf">126.43246447656593</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.2712038721790675</span><span class="p">,</span> <span class="mf">3.352121</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.077700845503319</span><span class="p">,</span> <span class="mf">125.49742760019636</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.2589538988480626</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.099393757363675</span><span class="p">,</span> <span class="mf">416.55444885434633</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.2490085228959193</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.162393327864274</span><span class="p">,</span> <span class="mf">369.27397110921817</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">3.2204673608202383</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mf">7.412173495305892</span><span class="p">,</span> <span class="mf">482.84120827021826</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">3.112085822159976</span><span class="p">,</span> <span class="mf">3.133096</span><span class="p">]]</span>
        <span class="p">]</span>
<span class="c">#</span></div>
<span class="k">def</span> <span class="nf">test0</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test FitHKL&#39;</span>
    <span class="n">ibrav</span><span class="p">,</span><span class="n">cell</span><span class="p">,</span><span class="n">bestcell</span><span class="p">,</span><span class="n">Pwr</span><span class="p">,</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">TestData</span>
    <span class="k">print</span> <span class="s">&#39;best cell:&#39;</span><span class="p">,</span><span class="n">bestcell</span>
    <span class="k">print</span> <span class="s">&#39;old cell:&#39;</span><span class="p">,</span><span class="n">cell</span>
    <span class="n">Peaks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span>
    <span class="n">HKL</span> <span class="o">=</span> <span class="n">Peaks</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span>
    <span class="k">print</span> <span class="n">calc_M20</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">HKL</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">OK</span><span class="p">,</span><span class="n">smin</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="n">FitHKL</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Pwr</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;new cell:&#39;</span><span class="p">,</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>    
    <span class="k">print</span> <span class="s">&#39;x:&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&#39;cov_x:&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&#39;infodict:&#39;</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
        <span class="k">print</span> <span class="n">item</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&#39;msg:&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="k">print</span> <span class="s">&#39;ier:&#39;</span><span class="p">,</span><span class="n">result</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="n">N</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">print</span> <span class="s">&#39;refinePeaks:&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;compare bestcell:&#39;</span><span class="p">,</span><span class="n">bestcell</span>
<span class="c">#</span>
<span class="k">def</span> <span class="nf">test1</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test FitHKL&#39;</span>
    <span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Pwr</span><span class="p">,</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">TestData2</span>
    <span class="k">print</span> <span class="s">&#39;bad cell:&#39;</span><span class="p">,</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;FitHKL&#39;</span>
    <span class="n">OK</span><span class="p">,</span><span class="n">smin</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">result</span> <span class="o">=</span> <span class="n">FitHKL</span><span class="p">(</span><span class="n">ibrav</span><span class="p">,</span><span class="n">peaks</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Pwr</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">refinePeaks</span><span class="p">(</span><span class="n">peaks</span><span class="p">,</span><span class="n">ibrav</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="n">N</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span> <span class="o">=</span> <span class="n">result</span>
    <span class="k">print</span> <span class="s">&#39;refinePeaks:&#39;</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">M20</span><span class="p">,</span><span class="n">X20</span><span class="p">,</span><span class="n">A</span>
<span class="c">#    Peaks = np.array(peaks)</span>
<span class="c">#    HKL = Peaks[4:7]</span>
<span class="c">#    print calc_M20(peaks,HKL)</span>
<span class="c">#    OK,smin,A,result = FitHKL(ibrav,peaks,A,Pwr)</span>
<span class="c">#    print &#39;new cell:&#39;,G2lat.A2cell(A)    </span>
<span class="c">#    print &#39;x:&#39;,result[0]</span>
<span class="c">#    print &#39;cov_x:&#39;,result[1]</span>
<span class="c">#    print &#39;infodict:&#39;</span>
<span class="c">#    for item in result[2]:</span>
<span class="c">#        print item,result[2][item]</span>
<span class="c">#    print &#39;msg:&#39;,result[3]</span>
<span class="c">#    print &#39;ier:&#39;,result[4]</span>
    
<span class="c">#</span>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test0</span><span class="p">()</span>
    <span class="n">test1</span><span class="p">()</span>
<span class="c">#    test2()</span>
<span class="c">#    test3()</span>
<span class="c">#    test4()</span>
<span class="c">#    test5()</span>
<span class="c">#    test6()</span>
<span class="c">#    test7()</span>
<span class="c">#    test8()</span>
    <span class="k">print</span> <span class="s">&quot;OK&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>