

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASII &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for GSASII</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#GSASII</span>
<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2014-05-29 11:19:07 -0500 (Thu, 29 May 2014) $</span>
<span class="c"># $Author: vondreele $</span>
<span class="c"># $Revision: 1368 $</span>
<span class="c"># $URL: https://subversion.xor.aps.anl.gov/pyGSAS/trunk/GSASII.py $</span>
<span class="c"># $Id: GSASII.py 1368 2014-05-29 16:19:07Z vondreele $</span>
<span class="c">########### SVN repository information ###################</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*GSAS-II Main Module*</span>
<span class="sd">=====================</span>

<span class="sd">Main routines for the GSAS-II program</span>
<span class="sd">&#39;&#39;&#39;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">random</span> <span class="kn">as</span> <span class="nn">ran</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">imp</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy</span> <span class="kn">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">OpenGL</span> <span class="kn">as</span> <span class="nn">ogl</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*******************************************************&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;PyOpenGL is missing from your python installation&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;     - we will try to install it&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*******************************************************&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">install_with_easyinstall</span><span class="p">(</span><span class="n">package</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="k">print</span> <span class="s">&quot;trying a system-wide PyOpenGl install&quot;</span>
            <span class="n">easy_install</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s">&#39;-f&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">package</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span> 
            <span class="k">print</span> <span class="s">&quot;trying a user level PyOpenGl install&quot;</span>
            <span class="n">easy_install</span><span class="o">.</span><span class="n">main</span><span class="p">([</span><span class="s">&#39;-f&#39;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">__file__</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;--user&#39;</span><span class="p">,</span><span class="n">package</span><span class="p">])</span>
            <span class="k">return</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&quot;Install of &#39;+package+&#39; failed. Please report this information:&quot;</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="k">print</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    <span class="kn">from</span> <span class="nn">setuptools.command</span> <span class="kn">import</span> <span class="n">easy_install</span>
    <span class="n">install_with_easyinstall</span><span class="p">(</span><span class="s">&#39;PyOpenGl&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*******************************************************&#39;</span><span class="p">)</span>         
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;OpenGL has been installed. Please restart GSAS-II&#39;</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">&#39;*******************************************************&#39;</span><span class="p">)</span>         
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
    
<span class="c"># load the GSAS routines</span>
<span class="kn">import</span> <span class="nn">GSASIIpath</span>
<span class="n">GSASIIpath</span><span class="o">.</span><span class="n">SetVersionNumber</span><span class="p">(</span><span class="s">&quot;$Revision: 1368 $&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">GSASIIIO</span> <span class="kn">as</span> <span class="nn">G2IO</span>
<span class="kn">import</span> <span class="nn">GSASIIgrid</span> <span class="kn">as</span> <span class="nn">G2gd</span>
<span class="kn">import</span> <span class="nn">GSASIIplot</span> <span class="kn">as</span> <span class="nn">G2plt</span>
<span class="kn">import</span> <span class="nn">GSASIIpwd</span> <span class="kn">as</span> <span class="nn">G2pwd</span>
<span class="kn">import</span> <span class="nn">GSASIIpwdGUI</span> <span class="kn">as</span> <span class="nn">G2pdG</span>
<span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">G2spc</span>
<span class="kn">import</span> <span class="nn">GSASIIstrMain</span> <span class="kn">as</span> <span class="nn">G2stMn</span>
<span class="kn">import</span> <span class="nn">GSASIIstrIO</span> <span class="kn">as</span> <span class="nn">G2stIO</span>
<span class="kn">import</span> <span class="nn">GSASIImapvars</span> <span class="kn">as</span> <span class="nn">G2mv</span>
<span class="kn">import</span> <span class="nn">GSASIIobj</span> <span class="kn">as</span> <span class="nn">G2obj</span>
<span class="kn">import</span> <span class="nn">GSASIIlattice</span> <span class="kn">as</span> <span class="nn">G2lat</span>

<span class="c">#wx inspector - use as needed</span>
<span class="n">wxInspector</span> <span class="o">=</span> <span class="bp">False</span>

<span class="c"># print versions</span>
<span class="k">print</span> <span class="s">&quot;Python module versions loaded:&quot;</span>
<span class="k">print</span> <span class="s">&quot;python:     &quot;</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
<span class="k">print</span> <span class="s">&quot;wxpython:   &quot;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">__version__</span>
<span class="k">print</span> <span class="s">&quot;matplotlib: &quot;</span><span class="p">,</span><span class="n">mpl</span><span class="o">.</span><span class="n">__version__</span>
<span class="k">print</span> <span class="s">&quot;numpy:      &quot;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">__version__</span>
<span class="k">print</span> <span class="s">&quot;scipy:      &quot;</span><span class="p">,</span><span class="n">sp</span><span class="o">.</span><span class="n">__version__</span>
<span class="k">print</span> <span class="s">&quot;OpenGL:     &quot;</span><span class="p">,</span><span class="n">ogl</span><span class="o">.</span><span class="n">__version__</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">mkl</span>
    <span class="k">print</span> <span class="s">&quot;Max threads &quot;</span><span class="p">,</span><span class="n">mkl</span><span class="o">.</span><span class="n">get_max_threads</span><span class="p">()</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>
<span class="c">#    print &quot;MKL module not present&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s">&#39;0.2.0&#39;</span>
<span class="n">G2gd</span><span class="o">.</span><span class="n">__version__</span> <span class="o">=</span> <span class="n">__version__</span>
<span class="k">print</span> <span class="s">&quot;This is GSAS-II version:     &quot;</span><span class="p">,</span><span class="n">__version__</span><span class="p">,</span><span class="s">&#39; revision &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">GSASIIpath</span><span class="o">.</span><span class="n">GetVersionNumber</span><span class="p">())</span>

<span class="c"># useful degree trig functions</span>
<span class="n">sind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">cosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">tand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">math</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">asind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">acosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
<span class="n">atan2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">atan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>

<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">GSASII</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

<div class="viewcode-block" id="GSASII"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII">[docs]</a><span class="k">class</span> <span class="nc">GSASII</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Define the main GSAS-II frame and its associated menu items</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">_Add_FileMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Open a GSAS-II project file (*.gpx)&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Open project...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileOpen</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Save project under current name&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Save project&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSave</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Save current project to new file&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save project as...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSaveas</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Create empty new project, saving current is optional&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;New project&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileClose</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Exit from GSAS-II&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Exit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileExit</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">_Add_DataMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Read image data...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImageRead</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Read Powder Pattern Peaks...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnReadPowderPeaks</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Sum powder data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnPwdrSum</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Sum image data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImageSum</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Add phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnAddPhase</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnDeletePhase</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Rename data&#39;</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnRenameData</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnDataDelete</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
                
    <span class="k">def</span> <span class="nf">_Add_CalculateMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Make new PDFs from selected powder patterns&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Make new PDFs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MakePDF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c">#        item.Enable(False)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnMakePDFs</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;View least squares parameters&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;View LS parms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShowLSParms</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Refine&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Refine</span><span class="p">):</span> <span class="c"># extend state for new menus to match main (on mac)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Refine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnRefine</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Sequential refine&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span><span class="p">):</span> <span class="c"># extend state for new menus to match main (on mac)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">IsEnabled</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="c"># save menu obj for use in self.EnableSeqRefineMenu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSeqRefine</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
    <span class="k">def</span> <span class="nf">_init_Imports</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;import all the G2phase*.py &amp; G2sfact*.py &amp; G2pwd*.py files that </span>
<span class="sd">        are found in the path</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ImportPhaseReaderlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Import_routines</span><span class="p">(</span><span class="s">&#39;phase&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportPhaseReaderlist</span><span class="p">,</span><span class="s">&#39;Phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportSfactReaderlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Import_routines</span><span class="p">(</span><span class="s">&#39;sfact&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportSfactReaderlist</span><span class="p">,</span><span class="s">&#39;Struct_Factor&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportPowderReaderlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Import_routines</span><span class="p">(</span><span class="s">&#39;pwd&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportPowderReaderlist</span><span class="p">,</span><span class="s">&#39;Powder_Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportSmallAngleReaderlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Import_routines</span><span class="p">(</span><span class="s">&#39;sad&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportSmallAngleReaderlist</span><span class="p">,</span><span class="s">&#39;SmallAngle_Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">_init_Import_routines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prefix</span><span class="p">,</span><span class="n">readerlist</span><span class="p">,</span><span class="n">errprefix</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;import all the import readers matching the prefix</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c">#path2GSAS2 = os.path.dirname(os.path.realpath(__file__)) # location of this file</span>
        <span class="c">#pathlist = sys.path[:]</span>
        <span class="c">#if path2GSAS2 not in pathlist: pathlist.append(path2GSAS2)</span>
        <span class="c">#path2GSAS2 = os.path.join(</span>
        <span class="c">#    os.path.dirname(os.path.realpath(__file__)), # location of this file</span>
        <span class="c">#    &#39;imports&#39;)</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">[:]</span>
        <span class="c">#if path2GSAS2 not in pathlist: pathlist.append(path2GSAS2)</span>

        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="n">path</span><span class="p">,</span>
                <span class="s">&quot;G2&quot;</span><span class="o">+</span><span class="n">prefix</span><span class="o">+</span><span class="s">&quot;*.py&quot;</span><span class="p">)):</span>
                <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>    
                <span class="c">#print &#39;debug: found&#39;,filename</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">filelist</span><span class="p">)))</span> <span class="c"># remove duplicates</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span><span class="n">rootname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pkg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rootname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">fp</span><span class="p">,</span> <span class="n">fppath</span><span class="p">,</span><span class="n">desc</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">pkg</span><span class="p">,[</span><span class="n">path</span><span class="p">,])</span>
                <span class="n">pkg</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">fppath</span><span class="p">,</span><span class="n">desc</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">clss</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span> <span class="c"># find classes defined in package</span>
                    <span class="k">if</span> <span class="n">clss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="c"># check if we have the required methods</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="s">&#39;Reader&#39;</span><span class="p">,</span><span class="s">&#39;ExtensionValidator&#39;</span><span class="p">,</span><span class="s">&#39;ContentsValidator&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">):</span> <span class="k">break</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">)):</span> <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">reader</span> <span class="o">=</span> <span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span> <span class="c"># create an import instance</span>
                            <span class="n">readerlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">reader</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Import_&#39;</span><span class="o">+</span><span class="n">errprefix</span><span class="o">+</span><span class="s">&#39;: Attribute Error &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Import_&#39;</span><span class="o">+</span><span class="n">errprefix</span><span class="o">+</span><span class="s">&#39;: Error importing file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">fp</span><span class="p">:</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="GSASII.EnableSeqRefineMenu"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.EnableSeqRefineMenu">[docs]</a>    <span class="k">def</span> <span class="nf">EnableSeqRefineMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Enable or disable the sequential refinement menu items based on the</span>
<span class="sd">        contents of the Controls &#39;Seq Data&#39; item (if present)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;Controls&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">controls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Seq Data&#39;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GSASII.OnImportGeneric"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImportGeneric">[docs]</a>    <span class="k">def</span> <span class="nf">OnImportGeneric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">reader</span><span class="p">,</span><span class="n">readerlist</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">usedRanIdList</span><span class="o">=</span><span class="p">[]):</span>
        <span class="sd">&#39;&#39;&#39;Used to import Phases, powder dataset or single</span>
<span class="sd">        crystal datasets (structure factor tables) using reader objects</span>
<span class="sd">        subclassed from :class:`GSASIIIO.ImportPhase`, :class:`GSASIIIO.ImportStructFactor`</span>
<span class="sd">        or :class:`GSASIIIO.ImportPowderData`. If a reader is specified, only</span>
<span class="sd">        that will be attempted, but if no reader is specified, every one</span>
<span class="sd">        that is potentially compatible (by file extension) will</span>
<span class="sd">        be tried on the selected file(s). </span>

<span class="sd">        :param readerobject reader: This will be a reference to</span>
<span class="sd">          a particular object to be used to read a file or None,</span>
<span class="sd">          if every appropriate reader should be used.</span>

<span class="sd">        :param list readerlist: a list of reader objects appropriate for</span>
<span class="sd">          the current read attempt. At present, this will be either</span>
<span class="sd">          self.ImportPhaseReaderlist, self.ImportSfactReaderlist or</span>
<span class="sd">          self.ImportPowderReaderlist (defined in _init_Imports from</span>
<span class="sd">          the files found in the path), but in theory this list could</span>
<span class="sd">          be tailored. Used only when reader is None.</span>

<span class="sd">        :param str label: string to place on the open file dialog:</span>
<span class="sd">          Open `label` input file</span>

<span class="sd">        :param bool multiple: True if multiple files can be selected</span>
<span class="sd">          in the file dialog. False is default. At present True is used</span>
<span class="sd">          only for reading of powder data.</span>

<span class="sd">        :param list usedRanIdList: an optional list of random Ids that </span>
<span class="sd">          have been used and should not be reused</span>

<span class="sd">        :returns: a list of reader objects (rd_list) that were able</span>
<span class="sd">          to read the specified file(s). This list may be empty. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">singlereader</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="n">reader</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">singlereader</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">multiple</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="c">#print &quot;use all formats&quot;</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="s">&quot;any file (*.*)|*.*&quot;</span>
            <span class="n">choices</span> <span class="o">+=</span> <span class="s">&quot;|zip archive (.zip)|*.zip&quot;</span>
            <span class="n">extdict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="c"># compile a list of allowed extensions</span>
            <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">readerlist</span><span class="p">:</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">formatName</span>
                <span class="k">for</span> <span class="n">extn</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">extensionlist</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">extdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">extn</span><span class="p">):</span> <span class="n">extdict</span><span class="p">[</span><span class="n">extn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">extdict</span><span class="p">[</span><span class="n">extn</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">fmt</span><span class="p">,]</span>
            <span class="k">for</span> <span class="n">extn</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">extdict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">cmp</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="nb">cmp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">y</span><span class="o">.</span><span class="n">lower</span><span class="p">())):</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">extdict</span><span class="p">[</span><span class="n">extn</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">fmt</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="n">fmt</span> <span class="o">+=</span> <span class="s">&#39;, &#39;</span>
                    <span class="n">fmt</span> <span class="o">+=</span> <span class="n">f</span>
                <span class="n">choices</span> <span class="o">+=</span> <span class="s">&quot;|&quot;</span> <span class="o">+</span> <span class="n">fmt</span> <span class="o">+</span> <span class="s">&quot; file (*&quot;</span> <span class="o">+</span> <span class="n">extn</span> <span class="o">+</span> <span class="s">&quot;)|*&quot;</span> <span class="o">+</span> <span class="n">extn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">readerlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">reader</span><span class="p">,]</span>
            <span class="c"># compile a list of allowed extensions</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">formatName</span> <span class="o">+</span> <span class="s">&quot; file (&quot;</span>
            <span class="n">w</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
            <span class="k">for</span> <span class="n">extn</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">extensionlist</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">w</span> <span class="o">!=</span> <span class="s">&quot;&quot;</span><span class="p">:</span> <span class="n">w</span> <span class="o">+=</span> <span class="s">&quot;;&quot;</span>
                <span class="n">w</span> <span class="o">+=</span> <span class="s">&quot;*&quot;</span> <span class="o">+</span> <span class="n">extn</span>
            <span class="n">choices</span> <span class="o">+=</span> <span class="n">w</span> <span class="o">+</span> <span class="s">&quot;)|&quot;</span> <span class="o">+</span> <span class="n">w</span>
            <span class="n">choices</span> <span class="o">+=</span> <span class="s">&quot;|zip archive (.zip)|*.zip&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">reader</span><span class="o">.</span><span class="n">strictExtension</span><span class="p">:</span>
                <span class="n">choices</span> <span class="o">+=</span> <span class="s">&quot;|any file (*.*)|*.*&quot;</span>
        <span class="c"># get the file(s)</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">MULTIPLE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="s">&quot;Choose &quot;</span><span class="o">+</span><span class="n">label</span><span class="o">+</span><span class="s">&quot; input file&quot;</span><span class="p">,</span>
            <span class="n">defaultFile</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="n">wildcard</span><span class="o">=</span><span class="n">choices</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Tutorials</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">SetDirectory</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">GSASIIpath</span><span class="o">.</span><span class="n">path2GSAS2</span><span class="p">,</span><span class="s">&#39;Exercises&#39;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Tutorials</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
                    <span class="n">filelist</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPaths</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">filename</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                    <span class="n">filelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">filename</span><span class="p">,]</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">())</span>           <span class="c"># to get Mac/Linux to change directory!</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># cancel was pressed</span>
                <span class="k">return</span> <span class="p">[]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">rd_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">filelist1</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="c"># is this a zip file?</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;.zip&#39;</span><span class="p">:</span>
                <span class="n">extractedfiles</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">ExtractFileFromZip</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">multipleselect</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extractedfiles</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span> <span class="c"># error or Cancel </span>
                <span class="k">if</span> <span class="n">extractedfiles</span> <span class="o">!=</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span> <span class="o">=</span> <span class="n">filename</span> <span class="c"># save zip name</span>
                    <span class="n">filelist1</span> <span class="o">+=</span> <span class="n">extractedfiles</span>
                    <span class="k">continue</span>
            <span class="n">filelist1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="n">filelist1</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="c"># is this a zip file?</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;.zip&#39;</span><span class="p">:</span>
                <span class="n">extractedfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">ExtractFileFromZip</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">extractedfile</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span> <span class="c"># error or Cancel </span>
                <span class="k">if</span> <span class="n">extractedfile</span> <span class="o">!=</span> <span class="n">filename</span><span class="p">:</span>
                    <span class="n">filename</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span> <span class="o">=</span> <span class="n">extractedfile</span><span class="p">,</span><span class="n">filename</span> <span class="c"># now use the file that was created</span>
            <span class="c"># set what formats are compatible with this file</span>
            <span class="n">primaryReaders</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">secondaryReaders</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">readerlist</span><span class="p">:</span>
                <span class="n">flag</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">ExtensionValidator</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">flag</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
                    <span class="n">secondaryReaders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">flag</span><span class="p">:</span>
                    <span class="n">primaryReaders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">secondaryReaders</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">primaryReaders</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;No Format&#39;</span><span class="p">,</span><span class="s">&#39;No matching format for file &#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">return</span> <span class="p">[]</span>

            <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">&#39;Ur&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filelist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c"># confirm we have the right file</span>
                    <span class="n">rdmsg</span> <span class="o">=</span> <span class="s">&#39;File &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; begins:</span><span class="se">\n\n</span><span class="s">&#39;</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                        <span class="n">rdmsg</span> <span class="o">+=</span> <span class="n">fp</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                    <span class="n">rdmsg</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Do you want to read this file?&#39;</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">128</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">rdmsg</span><span class="p">]):</span> <span class="c"># show only if ASCII</span>
                        <span class="n">rdmsg</span> <span class="o">=</span> <span class="s">&#39;File &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span>
                            <span class="n">filename</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; is a binary file. Do you want to read this file?&#39;</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_NO</span>
                    <span class="c"># it would be better to use something that</span>
                    <span class="c"># would resize better, but this will do for now</span>
                    <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
                        <span class="bp">self</span><span class="p">,</span> <span class="n">rdmsg</span><span class="p">,</span>
                        <span class="s">&#39;Is this the file you want?&#39;</span><span class="p">,</span> 
                        <span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">ICON_QUESTION</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="n">dlg</span><span class="o">.</span><span class="n">SetSize</span><span class="p">((</span><span class="mi">700</span><span class="p">,</span><span class="mi">300</span><span class="p">))</span> <span class="c"># does not resize on Mac</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                    <span class="k">finally</span><span class="p">:</span>
                        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_NO</span><span class="p">:</span> <span class="k">return</span> <span class="p">[]</span>
                            
                <span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span> <span class="o">=</span> <span class="n">filename</span> <span class="c"># this is probably not what I want to do -- it saves only the</span>
                <span class="c"># last name in a series. See rd.readfilename for a better name.</span>
                
                <span class="c"># try the file first with Readers that specify the</span>
                <span class="c"># file&#39;s extension and later with ones that merely allow it</span>
                <span class="n">errorReport</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">primaryReaders</span><span class="o">+</span><span class="n">secondaryReaders</span><span class="p">:</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">ReInitialize</span><span class="p">()</span> <span class="c"># purge anything from a previous read</span>
                    <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># rewind</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c"># clear out any old errors</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">rd</span><span class="o">.</span><span class="n">ContentsValidator</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span> <span class="c"># rejected on cursory check</span>
                        <span class="n">errorReport</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  &quot;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">formatName</span> <span class="o">+</span> <span class="s">&#39; validator error&#39;</span>
                        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span> 
                            <span class="n">errorReport</span> <span class="o">+=</span> <span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">errors</span>
                        <span class="k">continue</span> 
                    <span class="n">repeat</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">rdbuffer</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># create temporary storage for file reader</span>
                    <span class="n">block</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">repeat</span><span class="p">:</span> <span class="c"># loop if the reader asks for another pass on the file</span>
                        <span class="n">block</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">repeat</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">fp</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c"># rewind</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">objname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                        <span class="n">flag</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">flag</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span>
                                             <span class="nb">buffer</span><span class="o">=</span><span class="n">rdbuffer</span><span class="p">,</span>
                                             <span class="n">blocknum</span><span class="o">=</span><span class="n">block</span><span class="p">,</span>
                                             <span class="n">usedRanIdList</span><span class="o">=</span><span class="n">usedRanIdList</span><span class="p">,</span>
                                             <span class="p">)</span>
                        <span class="k">except</span> <span class="n">rd</span><span class="o">.</span><span class="n">ImportException</span> <span class="k">as</span> <span class="n">detail</span><span class="p">:</span>
                            <span class="n">rd</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  Read exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">detail</span><span class="p">:</span>
                            <span class="n">rd</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  Unhandled read exception: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">detail</span><span class="p">)</span>
                            <span class="n">rd</span><span class="o">.</span><span class="n">errors</span> <span class="o">+=</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">  Traceback info:</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
                        <span class="k">if</span> <span class="n">flag</span><span class="p">:</span> <span class="c"># this read succeeded</span>
                            <span class="n">rd</span><span class="o">.</span><span class="n">readfilename</span> <span class="o">=</span> <span class="n">filename</span>
                            <span class="n">rd_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">rd</span><span class="p">))</span> <span class="c"># save the result before it is written over</span>
                            <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">repeat</span><span class="p">:</span>
                                <span class="n">repeat</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="k">continue</span>
                        <span class="n">errorReport</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">formatName</span> <span class="o">+</span> <span class="s">&#39; read error&#39;</span>
                        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
                            <span class="n">errorReport</span> <span class="o">+=</span> <span class="s">&#39;: &#39;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">errors</span>
                    <span class="k">if</span> <span class="n">rd_list</span><span class="p">:</span> <span class="c"># read succeeded, was there a warning or any errors? </span>
                        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">warnings</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Read Warning&#39;</span><span class="p">,</span><span class="s">&#39;The &#39;</span><span class="o">+</span> <span class="n">rd</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span>
                                             <span class="s">&#39; reader reported a warning message:</span><span class="se">\n\n</span><span class="s">&#39;</span><span class="o">+</span>
                                             <span class="n">rd</span><span class="o">.</span><span class="n">warnings</span><span class="p">)</span>
                        <span class="k">break</span> <span class="c"># success in reading, try no further</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">singlereader</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Read Error&#39;</span><span class="p">,</span><span class="s">&#39;The &#39;</span><span class="o">+</span> <span class="n">rd</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span>
                                         <span class="s">&#39; reader was not able to read file &#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="n">msg</span><span class="o">+</span>
                                         <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Error message(s):</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errorReport</span>
                                         <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Read Error&#39;</span><span class="p">,</span><span class="s">&#39;No reader was able to read file &#39;</span><span class="o">+</span><span class="n">filename</span><span class="o">+</span><span class="n">msg</span><span class="o">+</span>
                                         <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Error messages:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errorReport</span>
                                         <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">traceback</span>
                <span class="k">print</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Open Error&#39;</span><span class="p">,</span><span class="s">&#39;Unexpected error trying to open or read file &#39;</span><span class="o">+</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fp</span><span class="p">:</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">rd_list</span>
</div>
    <span class="k">def</span> <span class="nf">_Add_ImportMenu_Phase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;configure the Import Phase menus accord to the readers found in _init_Imports</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Phase&#39;</span><span class="p">,</span>
            <span class="n">submenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import phase data&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportPhaseReaderlist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;from &#39;</span><span class="o">+</span><span class="n">reader</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span><span class="s">&#39; file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportPhase</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                              <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import phase data, use file to try to determine format&#39;</span><span class="p">,</span>
                              <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
                              <span class="n">text</span><span class="o">=</span><span class="s">&#39;guess format from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportPhase</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>

<div class="viewcode-block" id="GSASII.OnImportPhase"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImportPhase">[docs]</a>    <span class="k">def</span> <span class="nf">OnImportPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to an Import/Phase/... menu item</span>
<span class="sd">        to read phase information.</span>
<span class="sd">        dict self.ImportMenuId is used to look up the specific</span>
<span class="sd">        reader item associated with the menu item, which will be</span>
<span class="sd">        None for the last menu item, which is the &quot;guess&quot; option</span>
<span class="sd">        where all appropriate formats will be tried.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># look up which format was requested</span>
        <span class="n">reqrdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        
        <span class="c"># make a list of phase names, ranId&#39;s and the histograms used in those phases</span>
        <span class="n">phaseRIdList</span><span class="p">,</span><span class="n">usedHistograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseInfofromTree</span><span class="p">()</span>
        <span class="n">phaseNameList</span> <span class="o">=</span> <span class="n">usedHistograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c"># phase names in use</span>
        <span class="n">usedHKLFhists</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># used single-crystal histograms</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">usedHistograms</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">usedHistograms</span><span class="p">[</span><span class="n">p</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">h</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HKLF &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">h</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">usedHKLFhists</span><span class="p">:</span>
                    <span class="n">usedHKLFhists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">rdlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportGeneric</span><span class="p">(</span><span class="n">reqrdr</span><span class="p">,</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">ImportPhaseReaderlist</span><span class="p">,</span>
                                  <span class="s">&#39;phase&#39;</span><span class="p">,</span><span class="n">usedRanIdList</span><span class="o">=</span><span class="n">phaseRIdList</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="c"># for now rdlist is only expected to have one element</span>
        <span class="c"># but below will allow multiple phases to be imported</span>
        <span class="c"># if ever the import routines ever implement multiple phase reads. </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">newPhaseList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">rdlist</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span> <span class="c"># allow editing of phase name</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Enter the name for the new phase&#39;</span><span class="p">,</span>
                <span class="s">&#39;Edit phase name&#39;</span><span class="p">,</span> <span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">],</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="c"># make new phase names unique</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">],</span><span class="n">phaseNameList</span><span class="p">)</span>
            <span class="n">PhaseName</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Name&#39;</span><span class="p">]</span>
            <span class="n">newPhaseList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PhaseName</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Read phase &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">PhaseName</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; from file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">):</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
            <span class="n">psub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">PhaseName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">psub</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">Phase</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span> <span class="c"># make sure phases are seen</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">psub</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">psub</span><span class="p">)</span> <span class="c"># show the page to complete the initialization (yuk!)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Yield</span><span class="p">()</span> <span class="c"># make sure call of GSASII.OnPatternTreeSelChanged happens before we go on</span>

            <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">Constraints</span><span class="p">:</span>
                <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Constraints&#39;</span><span class="p">)</span> <span class="c"># was created in CheckNotebook if needed</span>
                <span class="n">Constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>                
                <span class="c"># TODO: make sure that NEWVAR names are unique here?</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">Constraints</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="c">#for j in i: print j,&#39; --&gt; &#39;,i[j]</span>
                        <span class="k">if</span> <span class="s">&#39;_Explain&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Constraints</span><span class="p">:</span> <span class="n">Constraints</span><span class="p">[</span><span class="s">&#39;_Explain&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                        <span class="n">Constraints</span><span class="p">[</span><span class="s">&#39;_Explain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                        <span class="k">continue</span>
                    <span class="n">Constraints</span><span class="p">[</span><span class="s">&#39;Phase&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newPhaseList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># somehow, no new phases</span>
        <span class="c"># get a list of existing histograms</span>
        <span class="n">PWDRlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">HKLFlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PWDR &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PWDRlist</span><span class="p">:</span>
                    <span class="n">PWDRlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HKLF &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HKLFlist</span><span class="p">:</span>
                    <span class="n">HKLFlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="n">TextList</span> <span class="o">=</span> <span class="n">PWDRlist</span> <span class="o">+</span> <span class="n">HKLFlist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">TextList</span><span class="p">):</span> <span class="k">return</span> <span class="c"># no data loaded yet</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&#39;Select histogram(s) to add to new phase(s):&#39;</span>
        <span class="k">for</span> <span class="n">phaseName</span> <span class="ow">in</span> <span class="n">newPhaseList</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">phaseName</span><span class="p">)</span>

        <span class="n">notOK</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">notOK</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ItemSelector</span><span class="p">(</span><span class="n">TextList</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;Add histogram(s)&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span> <span class="k">return</span>
            <span class="c"># check that selected single crystal histograms are not already in use!</span>
            <span class="n">used</span> <span class="o">=</span> <span class="p">[</span><span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span> <span class="k">if</span> <span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">usedHKLFhists</span><span class="p">]</span>
            <span class="c">#for i in result:</span>
            <span class="c">#    if TextList[i] in usedHKLFhists: used.append(TextList[i])</span>
            <span class="k">if</span> <span class="n">used</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;The following single crystal histogram(s) are already in use&#39;</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">used</span><span class="p">:</span>
                    <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Are you sure you want to add them to this phase? &#39;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;Associating a single crystal dataset to &gt;1 histogram is usually an error, &#39;</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;so No is suggested here.&#39;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Likely error&#39;</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">wtype</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">YES_NO</span><span class="p">)</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_YES</span><span class="p">:</span> <span class="n">notOK</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">notOK</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c"># connect new phases to histograms</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;ERROR -- why are there no phases here?&#39;</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">BeginBusyCursor</span><span class="p">()</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span> <span class="c"># loop over (new) phases</span>
            <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">phaseName</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">newPhaseList</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">generalData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
            <span class="n">SGData</span> <span class="o">=</span> <span class="n">generalData</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
            <span class="n">UseList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
            <span class="n">NShkl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="n">NDij</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">histoName</span> <span class="o">=</span> <span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">histoName</span> <span class="ow">in</span> <span class="n">HKLFlist</span><span class="p">:</span>
                    <span class="n">UseList</span><span class="p">[</span><span class="n">histoName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&#39;Histogram&#39;</span><span class="p">:</span><span class="n">histoName</span><span class="p">,</span><span class="s">&#39;Show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">True</span><span class="p">],</span>
                        <span class="s">&#39;Babinet&#39;</span><span class="p">:{</span><span class="s">&#39;BabA&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;BabU&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">]},</span>
                        <span class="s">&#39;Extinction&#39;</span><span class="p">:[</span><span class="s">&#39;Lorentzian&#39;</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Tbar&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s">&#39;Cos2TM&#39;</span><span class="p">:</span><span class="mf">0.955</span><span class="p">,</span>
                                                            <span class="s">&#39;Eg&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span>
                                                            <span class="s">&#39;Es&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span>
                                                            <span class="s">&#39;Ep&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">]},]</span>
                        <span class="p">}</span>
                    <span class="c">#redo UpdateHKLFdata(histoName) here:</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">histoName</span><span class="p">)</span>
                    <span class="n">refDict</span><span class="p">,</span><span class="n">reflData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2Gmat</span><span class="p">(</span><span class="n">generalData</span><span class="p">[</span><span class="s">&#39;Cell&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
                    <span class="k">for</span> <span class="n">iref</span><span class="p">,</span><span class="n">ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reflData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]):</span>
                        <span class="n">H</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                        <span class="n">ref</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsq2</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">G</span><span class="p">))</span>
                        <span class="n">iabsnt</span><span class="p">,</span><span class="n">ref</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">Uniq</span><span class="p">,</span><span class="n">phi</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">GenHKLf</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">histoName</span> <span class="ow">in</span> <span class="n">PWDRlist</span><span class="p">:</span>
                    <span class="n">UseList</span><span class="p">[</span><span class="n">histoName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s">&#39;Histogram&#39;</span><span class="p">:</span><span class="n">histoName</span><span class="p">,</span><span class="s">&#39;Show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                        <span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">:[</span><span class="s">&#39;MD&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,{}],</span>
                        <span class="s">&#39;Size&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                        <span class="s">&#39;Mustrain&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                                    <span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,],</span><span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                        <span class="s">&#39;HStrain&#39;</span><span class="p">:[</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,],</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>                          
                        <span class="s">&#39;Extinction&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Babinet&#39;</span><span class="p">:{</span><span class="s">&#39;BabA&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;BabU&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">]}}</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">histoName</span><span class="p">)</span>
                    <span class="n">refList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>
                        <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">))</span>
                    <span class="n">refList</span><span class="p">[</span><span class="n">generalData</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Unexpected histogram &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">histoName</span><span class="p">))</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EndBusyCursor</span><span class="p">()</span>
        <span class="k">return</span> <span class="c"># success</span>
        </div>
    <span class="k">def</span> <span class="nf">_Add_ImportMenu_Sfact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;configure the Import Structure Factor menus accord to the readers found in _init_Imports</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Structure Factor&#39;</span><span class="p">,</span>
            <span class="n">submenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import Structure Factor data&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportSfactReaderlist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>                
                <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;from &#39;</span><span class="o">+</span><span class="n">reader</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span><span class="s">&#39; file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportSfact</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import Structure Factor, use file to try to determine format&#39;</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;guess format from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportSfact</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>

<div class="viewcode-block" id="GSASII.OnImportSfact"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImportSfact">[docs]</a>    <span class="k">def</span> <span class="nf">OnImportSfact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to an Import/Structure Factor/... menu item</span>
<span class="sd">        to read single crystal datasets. </span>
<span class="sd">        dict self.ImportMenuId is used to look up the specific</span>
<span class="sd">        reader item associated with the menu item, which will be</span>
<span class="sd">        None for the last menu item, which is the &quot;guess&quot; option</span>
<span class="sd">        where all appropriate formats will be tried.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># get a list of existing histograms</span>
        <span class="n">HKLFlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;HKLF &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">HKLFlist</span><span class="p">:</span>
                    <span class="n">HKLFlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="c"># look up which format was requested</span>
        <span class="n">reqrdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">rdlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportGeneric</span><span class="p">(</span><span class="n">reqrdr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportSfactReaderlist</span><span class="p">,</span>
            <span class="s">&#39;Structure Factor&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">newHistList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">rdlist</span><span class="p">:</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">objname</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdlist</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span> 
                <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span> <span class="c"># allow editing of Structure Factor name</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Enter the name for the new Structure Factor&#39;</span><span class="p">,</span>
                    <span class="s">&#39;Edit Structure Factor name&#39;</span><span class="p">,</span> <span class="n">HistName</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">HistName</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="s">&#39;HKLF &#39;</span><span class="o">+</span><span class="n">HistName</span>
            <span class="c"># make new histogram names unique</span>
            <span class="n">valuesdict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s">&#39;Dummy&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;ranId&#39;</span><span class="p">:</span><span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">Banks</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">Bank</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">Banks</span><span class="p">:</span>
                    <span class="n">HistName</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">HistName</span><span class="p">,</span><span class="n">HKLFlist</span><span class="p">)</span>
                    <span class="k">print</span> <span class="s">&#39;Read structure factor table &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; from file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span><span class="p">)</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">HistName</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Bank</span><span class="p">[</span><span class="s">&#39;RefDict&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;FF&#39;</span><span class="p">):</span>
                        <span class="n">Bank</span><span class="p">[</span><span class="s">&#39;RefDict&#39;</span><span class="p">][</span><span class="s">&#39;FF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Bank</span><span class="p">[</span><span class="s">&#39;RefDict&#39;</span><span class="p">][</span><span class="s">&#39;RefList&#39;</span><span class="p">]))]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,</span><span class="n">Bank</span><span class="p">[</span><span class="s">&#39;RefDict&#39;</span><span class="p">]])</span>
                    <span class="n">Sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Sub</span><span class="p">,</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">Parameters</span><span class="p">))</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reflection List&#39;</span><span class="p">),[])</span>  <span class="c">#dummy entry for GUI use</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">HistName</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">HistName</span><span class="p">,</span><span class="n">HKLFlist</span><span class="p">)</span>
                <span class="k">print</span> <span class="s">&#39;Read structure factor table &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; from file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rd</span><span class="o">.</span><span class="n">RefDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;FF&#39;</span><span class="p">):</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">RefDict</span><span class="p">[</span><span class="s">&#39;FF&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[{}</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">RefDict</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]))]</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">HistName</span><span class="p">)</span>
                <span class="k">print</span> <span class="n">rd</span><span class="o">.</span><span class="n">RefDict</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">RefDict</span><span class="p">])</span>
                <span class="n">Sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Sub</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">Parameters</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reflection List&#39;</span><span class="p">),[])</span>  <span class="c">#dummy entry for GUI use</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Sngl</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">newHistList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">newHistList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># somehow, no new histograms</span>
        <span class="c"># make a list of phase names</span>
        <span class="n">phaseRIdList</span><span class="p">,</span><span class="n">usedHistograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseInfofromTree</span><span class="p">()</span>
        <span class="n">phaseNameList</span> <span class="o">=</span> <span class="n">usedHistograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c"># phase names in use</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phaseNameList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># no phases yet, nothing to do</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&#39;Select phase(s) to add the new</span><span class="se">\n</span><span class="s">single crystal dataset(s) to:&#39;</span>
        <span class="k">for</span> <span class="n">Name</span> <span class="ow">in</span> <span class="n">newHistList</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ItemSelector</span><span class="p">(</span><span class="n">phaseNameList</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;Add to phase(s)&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span> <span class="k">return</span>
        <span class="c"># connect new phases to histograms</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;ERROR -- why are there no phases here?&#39;</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">BeginBusyCursor</span><span class="p">()</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="n">iph</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span> <span class="c"># loop over (new) phases</span>
            <span class="n">iph</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">generalData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
            <span class="n">SGData</span> <span class="o">=</span> <span class="n">generalData</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
            <span class="n">UseList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
            <span class="n">NShkl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="n">NDij</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">histoName</span> <span class="ow">in</span> <span class="n">newHistList</span><span class="p">:</span>
                <span class="n">UseList</span><span class="p">[</span><span class="n">histoName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;Histogram&#39;</span><span class="p">:</span><span class="n">histoName</span><span class="p">,</span><span class="s">&#39;Show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">True</span><span class="p">],</span>
                    <span class="s">&#39;Babinet&#39;</span><span class="p">:{</span><span class="s">&#39;BabA&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;BabU&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">]},</span>
                    <span class="s">&#39;Extinction&#39;</span><span class="p">:[</span><span class="s">&#39;Lorentzian&#39;</span><span class="p">,</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s">&#39;Tbar&#39;</span><span class="p">:</span><span class="mf">0.1</span><span class="p">,</span><span class="s">&#39;Cos2TM&#39;</span><span class="p">:</span><span class="mf">0.955</span><span class="p">,</span>
                                                        <span class="s">&#39;Eg&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span>
                                                        <span class="s">&#39;Es&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span>
                                                        <span class="s">&#39;Ep&#39;</span><span class="p">:[</span><span class="mf">1.e-10</span><span class="p">,</span><span class="bp">False</span><span class="p">]},]</span>
                    <span class="p">}</span>
                <span class="c">#redo UpdateHKLFdata(histoName) here:</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">histoName</span><span class="p">)</span>
                <span class="n">refDict</span><span class="p">,</span><span class="n">reflData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2Gmat</span><span class="p">(</span><span class="n">generalData</span><span class="p">[</span><span class="s">&#39;Cell&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">iref</span><span class="p">,</span><span class="n">ref</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reflData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ref</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
                    <span class="n">ref</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">G2lat</span><span class="o">.</span><span class="n">calc_rDsq2</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">G</span><span class="p">))</span>
                    <span class="n">iabsnt</span><span class="p">,</span><span class="n">ref</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">Uniq</span><span class="p">,</span><span class="n">phi</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">GenHKLf</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">SGData</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EndBusyCursor</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="c"># success</span>
</div>
    <span class="k">def</span> <span class="nf">_Add_ImportMenu_powder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;configure the Powder Data menus accord to the readers found in _init_Imports</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Powder Data&#39;</span><span class="p">,</span>
            <span class="n">submenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import Powder data&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportPowderReaderlist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;from &#39;</span><span class="o">+</span><span class="n">reader</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span><span class="s">&#39; file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportPowder</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import powder data, use file to try to determine format&#39;</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;guess format from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportPowder</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Create a powder data set entry that will be simulated&#39;</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Simulate a dataset&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnDummyPowder</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
           
<div class="viewcode-block" id="GSASII.ReadPowderInstprm"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.ReadPowderInstprm">[docs]</a>    <span class="k">def</span> <span class="nf">ReadPowderInstprm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">instfile</span><span class="p">):</span>       <span class="c">#fix the write routine for [inst1,inst2] style</span>
        <span class="sd">&#39;&#39;&#39;Read a GSAS-II (new) instrument parameter file</span>

<span class="sd">        :param str instfile: name of instrument parameter file</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">instfile</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s">&#39;.instprm&#39;</span><span class="p">:</span> <span class="c"># invalid file</span>
            <span class="k">return</span> <span class="bp">None</span>            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">instfile</span><span class="p">):</span> <span class="c"># no such file</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">File</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">S</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#GSAS-II&#39;</span><span class="p">):</span> <span class="c"># not a valid file</span>
            <span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">None</span>
        <span class="n">newItems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">newVals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">S</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">S</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;#&#39;</span><span class="p">:</span>
                <span class="n">S</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">continue</span>
            <span class="p">[</span><span class="n">item</span><span class="p">,</span><span class="n">val</span><span class="p">]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">newItems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">newVals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">newVals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>                        
            <span class="n">S</span> <span class="o">=</span> <span class="n">File</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>                
        <span class="n">File</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c"># add a second MT dict here. TOF parms? (BHT)</span>
        <span class="k">return</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">makeInstDict</span><span class="p">(</span><span class="n">newItems</span><span class="p">,</span><span class="n">newVals</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">newVals</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]),{}</span>
        </div>
<div class="viewcode-block" id="GSASII.ReadPowderIparm"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.ReadPowderIparm">[docs]</a>    <span class="k">def</span> <span class="nf">ReadPowderIparm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">instfile</span><span class="p">,</span><span class="n">bank</span><span class="p">,</span><span class="n">databanks</span><span class="p">,</span><span class="n">rd</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Read a GSAS (old) instrument parameter file</span>

<span class="sd">        :param str instfile: name of instrument parameter file</span>

<span class="sd">        :param int bank: the bank number read in the raw data file</span>

<span class="sd">        :param int databanks: the number of banks in the raw data file.</span>
<span class="sd">          If the number of banks in the data and instrument parameter files</span>
<span class="sd">          agree, then the sets of banks are assumed to match up and bank</span>
<span class="sd">          is used to select the instrument parameter file. If not, the user</span>
<span class="sd">          is asked to make a selection.</span>

<span class="sd">        :param obj rd: the raw data (histogram) data object. This</span>
<span class="sd">          sets rd.instbank.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">instfile</span><span class="p">):</span> <span class="c"># no such file</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">fp</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="s">&#39;Ur&#39;</span><span class="p">)</span>
            <span class="n">Iparm</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span>
                <span class="n">Iparm</span><span class="p">[</span><span class="n">S</span><span class="p">[:</span><span class="mi">12</span><span class="p">]]</span> <span class="o">=</span> <span class="n">S</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error reading file:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">instfile</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">fp</span><span class="p">:</span>        
            <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">ibanks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Iparm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;INS   BANK  &#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="n">hType</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS   HTYPE &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ibanks</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c"># there is only one bank here, return it</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">instbank</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">Iparm</span>
        <span class="k">if</span> <span class="s">&#39;PNT&#39;</span> <span class="ow">in</span> <span class="n">hType</span><span class="p">:</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">instbank</span> <span class="o">=</span> <span class="n">bank</span>
        <span class="k">elif</span> <span class="n">ibanks</span> <span class="o">!=</span> <span class="n">databanks</span><span class="p">:</span>
            <span class="c"># number of banks in data and prm file not not agree, need a</span>
            <span class="c"># choice from a human here</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="o">+</span><span class="n">ibanks</span><span class="p">):</span>
                <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Bank &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">bank</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">BlockSelector</span><span class="p">(</span>
                <span class="n">choices</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select an instrument parameter bank for &#39;</span><span class="o">+</span>
                <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; BANK &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">bank</span><span class="p">)</span><span class="o">+</span>
                <span class="s">&#39;</span><span class="se">\n</span><span class="s">Or use Cancel to select from the default parameter sets&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&#39;Block Selector&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bank</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="p">{}</span>
        <span class="c"># pull out requested bank # bank from the data, and change the bank to 1</span>
        <span class="n">IparmS</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">Iparm</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&quot;  &quot;</span><span class="p">:</span>
                <span class="n">IparmS</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">int</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="o">==</span> <span class="n">bank</span><span class="p">:</span>
                <span class="n">IparmS</span><span class="p">[</span><span class="n">key</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="s">&#39; 1&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">[</span><span class="mi">6</span><span class="p">:]]</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">instbank</span> <span class="o">=</span> <span class="n">bank</span>
        <span class="k">return</span> <span class="n">IparmS</span>
                        </div>
<div class="viewcode-block" id="GSASII.GetPowderIparm"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetPowderIparm">[docs]</a>    <span class="k">def</span> <span class="nf">GetPowderIparm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rd</span><span class="p">,</span> <span class="n">prevIparm</span><span class="p">,</span> <span class="n">lastIparmfile</span><span class="p">,</span> <span class="n">lastdatafile</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Open and read an instrument parameter file for a data file</span>
<span class="sd">        Returns the list of parameters used in the data tree</span>

<span class="sd">        :param obj rd: the raw data (histogram) data object.</span>

<span class="sd">        :param str prevIparm: not used</span>

<span class="sd">        :param str lastIparmfile: Name of last instrument parameter</span>
<span class="sd">          file that was read, or a empty string. </span>

<span class="sd">        :param str lastdatafile: Name of last data file that was read.</span>

<span class="sd">        :returns: a list of two dicts, the first containing instrument parameters</span>
<span class="sd">          and the second used for future TOF datasets (timemaps?)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">SetPowderInstParms</span><span class="p">(</span><span class="n">Iparm</span><span class="p">,</span> <span class="n">rd</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;extracts values from instrument parameters in rd.instdict</span>
<span class="sd">            or in array Iparm.</span>
<span class="sd">            Create and return the contents of the instrument parameter tree entry.</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">DataType</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS   HTYPE &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()[:</span><span class="mi">3</span><span class="p">]</span>  <span class="c"># take 1st 3 chars</span>
            <span class="c"># override inst values with values read from data file</span>
            <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">instdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">):</span>
                <span class="n">DataType</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">instdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;type&#39;</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">DataType</span><span class="p">,]</span>
            <span class="n">instname</span> <span class="o">=</span> <span class="n">Iparm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;INS  1INAME &#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instname</span><span class="p">:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;InstrName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">instname</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="s">&#39;C&#39;</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
                <span class="n">wave1</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">wave2</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">instdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wave&#39;</span><span class="p">):</span>
                    <span class="n">wl</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">instdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;wave&#39;</span><span class="p">)</span>
                    <span class="n">wave1</span> <span class="o">=</span> <span class="n">wl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">wl</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">wave2</span> <span class="o">=</span> <span class="n">wl</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1 ICONS&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">wave1</span><span class="p">:</span>
                    <span class="n">wave1</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[:</span><span class="mi">10</span><span class="p">])</span>
                    <span class="n">wave2</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">10</span><span class="p">:</span><span class="mi">20</span><span class="p">])</span>
                <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">wave1</span><span class="p">,</span><span class="n">wave2</span><span class="p">,</span>
                     <span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="mi">30</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">55</span><span class="p">:</span><span class="mi">65</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">50</span><span class="p">]))</span> <span class="c">#get lam1, lam2, zero, pola &amp; ratio</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;Lam&#39;</span><span class="p">,</span><span class="s">&#39;Zero&#39;</span><span class="p">,</span><span class="s">&#39;Polariz.&#39;</span><span class="p">,</span><span class="s">&#39;U&#39;</span><span class="p">,</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;W&#39;</span><span class="p">,</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">,</span><span class="s">&#39;SH/L&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">]</span> 
                    <span class="n">v</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">v</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>
                    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;Lam1&#39;</span><span class="p">,</span><span class="s">&#39;Lam2&#39;</span><span class="p">,</span><span class="s">&#39;Zero&#39;</span><span class="p">,</span><span class="s">&#39;I(L2)/I(L1)&#39;</span><span class="p">,</span><span class="s">&#39;Polariz.&#39;</span><span class="p">,</span><span class="s">&#39;U&#39;</span><span class="p">,</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="s">&#39;W&#39;</span><span class="p">,</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">,</span><span class="s">&#39;SH/L&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">]</span>
                    <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;INS  1PRCF  &#39;</span> <span class="ow">in</span> <span class="n">Iparm</span><span class="p">:</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF  &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>                                                  
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>                  <span class="c">#get GU, GV &amp; GW - always here</span>
                    <span class="n">azm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Iparm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;INS  1DETAZM&#39;</span><span class="p">,</span><span class="s">&#39;0.0&#39;</span><span class="p">))</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF 2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">azm</span><span class="p">)])</span>  <span class="c">#get LX, LY, S+H/L &amp; azimuth</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.002</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>                                      <span class="c">#OK defaults if fxn #3 not 1st in iprm file                    </span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">v1</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF1 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>                                                  
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>                  <span class="c">#get GU, GV &amp; GW - always here</span>
                    <span class="n">azm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Iparm</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;INS  1DETAZM&#39;</span><span class="p">,</span><span class="s">&#39;0.0&#39;</span><span class="p">))</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">+</span><span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">azm</span><span class="p">)])</span>  <span class="c">#get LX, LY, S+H/L &amp; azimuth</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.002</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>                                      <span class="c">#OK defaults if fxn #3 not 1st in iprm file</span>
                <span class="n">codes</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">G2IO</span><span class="o">.</span><span class="n">makeInstDict</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">codes</span><span class="p">),{}]</span>
            <span class="k">elif</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">DataType</span><span class="p">:</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;2-theta&#39;</span><span class="p">,</span><span class="s">&#39;difC&#39;</span><span class="p">,</span><span class="s">&#39;difA&#39;</span><span class="p">,</span><span class="s">&#39;Zero&#39;</span><span class="p">,</span><span class="s">&#39;alpha&#39;</span><span class="p">,</span><span class="s">&#39;beta-0&#39;</span><span class="p">,</span><span class="s">&#39;beta-1&#39;</span><span class="p">,</span>
                    <span class="s">&#39;beta-q&#39;</span><span class="p">,</span><span class="s">&#39;sig-0&#39;</span><span class="p">,</span><span class="s">&#39;sig-1&#39;</span><span class="p">,</span><span class="s">&#39;sig-q&#39;</span><span class="p">,</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">,</span><span class="s">&#39;Azimuth&#39;</span><span class="p">]</span>
                <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">azm</span> <span class="o">=</span> <span class="mf">0.</span>
                <span class="k">if</span> <span class="s">&#39;INS  1DETAZM&#39;</span> <span class="ow">in</span> <span class="n">Iparm</span><span class="p">:</span>
                    <span class="n">azm</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1DETAZM&#39;</span><span class="p">])</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1BNKPAR&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),])</span>               <span class="c">#2-theta for bank</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1 ICONS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>    <span class="c">#difC, difA, Zero</span>
                <span class="k">if</span> <span class="s">&#39;INS  1PRCF  &#39;</span> <span class="ow">in</span> <span class="n">Iparm</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF  &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">pfType</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF 2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF 2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>                       
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF1 &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">pfType</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF11&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">])])</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>
                    <span class="k">elif</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]:</span>
                        <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])])</span>
                        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">pfType</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1PRCF12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">data</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">sfloat</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="n">azm</span><span class="p">])</span>                       
                <span class="n">Inst1</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">makeInstDict</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">codes</span><span class="p">)</span>
                <span class="n">Inst2</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">if</span> <span class="n">pfType</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Ipab</span> <span class="o">=</span> <span class="s">&#39;INS  1PAB&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="o">-</span><span class="n">pfType</span><span class="p">)</span>
                    <span class="n">Npab</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Iparm</span><span class="p">[</span><span class="n">Ipab</span><span class="o">+</span><span class="s">&#39;  &#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
                    <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Npab</span><span class="p">):</span>
                        <span class="n">k</span> <span class="o">=</span> <span class="n">Ipab</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
                        <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
                    <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">])</span>
                    <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Pdabc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">Inst1</span><span class="p">[</span><span class="s">&#39;difC&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c">#turn 3rd col into TOF</span>
                <span class="k">if</span> <span class="s">&#39;INS  1I ITYP&#39;</span> <span class="ow">in</span> <span class="n">Iparm</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1I ITYP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                    <span class="n">Ityp</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">Tminmax</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">1000.</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="mf">1000.</span><span class="p">]</span>
                    <span class="n">Itypes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Exponential&#39;</span><span class="p">,</span><span class="s">&#39;Maxwell/Exponential&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Maxwell/Chebyschev&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">Ityp</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Itype&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Itypes</span><span class="p">[</span><span class="n">Ityp</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Tminmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tminmax</span>
                        <span class="n">Icoeff</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">Iesd</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">Icovar</span> <span class="o">=</span> <span class="p">[]</span>                   
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1ICOFF&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">Icoeff</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1IECOF&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
                            <span class="n">Iesd</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="k">for</span> <span class="n">S</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
                        <span class="n">NT</span> <span class="o">=</span> <span class="mi">10</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
                            <span class="n">s</span> <span class="o">=</span> <span class="n">Iparm</span><span class="p">[</span><span class="s">&#39;INS  1IECOR&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                                <span class="n">NT</span> <span class="o">=</span> <span class="mi">8</span>
                            <span class="n">Icovar</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">j</span><span class="p">:</span><span class="mi">6</span><span class="o">*</span><span class="n">j</span><span class="o">+</span><span class="mi">6</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">NT</span><span class="p">)]</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Icoeff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Icoeff</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Iesd&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Iesd</span>
                        <span class="n">Inst2</span><span class="p">[</span><span class="s">&#39;Icovar&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Icovar</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">Inst1</span><span class="p">,</span><span class="n">Inst2</span><span class="p">]</span>

        <span class="c"># stuff we might need from the reader</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bank</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">numbanks</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">numbanks</span>
        <span class="c"># is there an instrument parameter file defined for the current data set?</span>
        <span class="c"># or if this is a read on a set of set of files, use the last one again</span>
        <span class="c">#if rd.instparm or (lastdatafile == filename and lastIparmfile):</span>
        <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">instparm</span> <span class="ow">or</span> <span class="n">lastIparmfile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">instparm</span><span class="p">:</span>
                <span class="n">instfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">rd</span><span class="o">.</span><span class="n">instparm</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># for multiple reads of one data file, reuse the inst parm file</span>
                <span class="n">instfile</span> <span class="o">=</span> <span class="n">lastIparmfile</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">instfile</span><span class="p">):</span>
                <span class="c">#print &#39;debug: try read&#39;,instfile</span>
                <span class="n">instParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderInstprm</span><span class="p">(</span><span class="n">instfile</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">instParmList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="s">&#39;GSAS-II file &#39;</span><span class="o">+</span><span class="n">instfile</span>
                    <span class="k">return</span> <span class="n">instParmList</span>
                <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderIparm</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="n">bank</span><span class="p">,</span><span class="n">numbanks</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Iparm</span><span class="p">:</span>
                    <span class="c">#print &#39;debug: success&#39;</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="n">instfile</span> <span class="o">+</span> <span class="s">&#39; bank &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instbank</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">SetPowderInstParms</span><span class="p">(</span><span class="n">Iparm</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Open Error&#39;</span><span class="p">,</span><span class="s">&#39;Error opening instrument parameter file &#39;</span>
                    <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">instfile</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; requested by file &#39;</span><span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
        <span class="c"># is there an instrument parameter file matching the current file</span>
        <span class="c"># with extension .inst or .prm? If so read it</span>
        <span class="n">basename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="s">&#39;.instprm&#39;</span><span class="p">,</span><span class="s">&#39;.prm&#39;</span><span class="p">,</span><span class="s">&#39;.inst&#39;</span><span class="p">,</span><span class="s">&#39;.ins&#39;</span><span class="p">:</span>
            <span class="n">instfile</span> <span class="o">=</span> <span class="n">basename</span> <span class="o">+</span> <span class="n">ext</span>
            <span class="n">instParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderInstprm</span><span class="p">(</span><span class="n">instfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instParmList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="s">&#39;GSAS-II file &#39;</span><span class="o">+</span><span class="n">instfile</span>
                <span class="k">return</span> <span class="n">instParmList</span>
            <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderIparm</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="n">bank</span><span class="p">,</span><span class="n">numbanks</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Iparm</span><span class="p">:</span>
                <span class="c">#print &#39;debug: success&#39;</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="n">instfile</span> <span class="o">+</span> <span class="s">&#39; bank &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instbank</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">SetPowderInstParms</span><span class="p">(</span><span class="n">Iparm</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c">#print &#39;debug: open/read failed&#39;,instfile</span>
                <span class="k">pass</span> <span class="c"># fail silently</span>

        <span class="c"># did we read the data file from a zip? If so, look there for a</span>
        <span class="c"># instrument parameter file</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="s">&#39;.instprm&#39;</span><span class="p">,</span><span class="s">&#39;.prm&#39;</span><span class="p">,</span><span class="s">&#39;.inst&#39;</span><span class="p">,</span><span class="s">&#39;.ins&#39;</span><span class="p">:</span>
                <span class="n">instfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">ExtractFileFromZip</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span><span class="p">,</span>
                    <span class="n">selection</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">basename</span> <span class="o">+</span> <span class="n">ext</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">instfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">instfile</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;debug:&#39;</span><span class="p">,</span><span class="n">instfile</span><span class="p">,</span><span class="s">&#39;created from &#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span>
                    <span class="n">instParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderInstprm</span><span class="p">(</span><span class="n">instfile</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">instParmList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="s">&#39;GSAS-II file &#39;</span><span class="o">+</span><span class="n">instfile</span>
                        <span class="k">return</span> <span class="n">instParmList</span>
                    <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderIparm</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="n">bank</span><span class="p">,</span><span class="n">numbanks</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Iparm</span><span class="p">:</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                        <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="n">instfile</span> <span class="o">+</span> <span class="s">&#39; bank &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instbank</span><span class="p">)</span>
                        <span class="k">return</span> <span class="n">SetPowderInstParms</span><span class="p">(</span><span class="n">Iparm</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c">#print &#39;debug: open/read for&#39;,instfile,&#39;from&#39;,self.zipfile,&#39;failed&#39;</span>
                        <span class="k">pass</span> <span class="c"># fail silently</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="c"># loop until we get a file that works or we get a cancel</span>
            <span class="n">instfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s">&#39;Choose inst. param file for &quot;&#39;</span>
                <span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">idstring</span>
                <span class="o">+</span><span class="s">&#39;&quot; (or Cancel for default)&#39;</span><span class="p">,</span>
                <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                <span class="s">&#39;GSAS iparm file (*.prm,*.inst,*.ins)|*.prm;*.inst;*.ins|&#39;</span>
                <span class="s">&#39;GSAS-II iparm file (*.instprm)|*.instprm|&#39;</span>
                <span class="s">&#39;All files (*.*)|*.*&#39;</span><span class="p">,</span> 
                <span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lastIparmfile</span><span class="p">):</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">SetFilename</span><span class="p">(</span><span class="n">lastIparmfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">instfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">instfile</span><span class="p">:</span> <span class="k">break</span>
            <span class="n">instParmList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderInstprm</span><span class="p">(</span><span class="n">instfile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instParmList</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="s">&#39;GSAS-II file &#39;</span><span class="o">+</span><span class="n">instfile</span>
                <span class="k">return</span> <span class="n">instParmList</span>
            <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReadPowderIparm</span><span class="p">(</span><span class="n">instfile</span><span class="p">,</span><span class="n">bank</span><span class="p">,</span><span class="n">numbanks</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">Iparm</span><span class="p">:</span>
                <span class="c">#print &#39;debug: success with&#39;,instfile</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="n">instfile</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="n">instfile</span> <span class="o">+</span> <span class="s">&#39; bank &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instbank</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">SetPowderInstParms</span><span class="p">(</span><span class="n">Iparm</span><span class="p">,</span><span class="n">rd</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Read Error&#39;</span><span class="p">,</span>
                                 <span class="s">&#39;Error opening/reading file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">instfile</span><span class="p">))</span>
        
        <span class="c"># still no success: offer user choice of defaults</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span> <span class="c"># loop until we get a choice</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">head</span> <span class="o">=</span> <span class="s">&#39;Select from default instrument parameters for &#39;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">idstring</span>

            <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">rd</span><span class="o">.</span><span class="n">defaultIparm_lbl</span><span class="p">:</span>
                <span class="n">choices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Defaults for &#39;</span><span class="o">+</span><span class="n">l</span><span class="p">)</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">BlockSelector</span><span class="p">(</span>
                <span class="n">choices</span><span class="p">,</span>
                <span class="n">ParentFrame</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">head</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&#39;Select default inst parms&#39;</span><span class="p">,</span>
                <span class="n">useCancel</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span> <span class="o">=</span> <span class="s">&#39;default: &#39;</span><span class="o">+</span><span class="n">rd</span><span class="o">.</span><span class="n">defaultIparm_lbl</span><span class="p">[</span><span class="n">res</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">SetPowderInstParms</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">defaultIparms</span><span class="p">[</span><span class="n">res</span><span class="p">],</span><span class="n">rd</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GSASII.OnImportPowder"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImportPowder">[docs]</a>    <span class="k">def</span> <span class="nf">OnImportPowder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to an Import/Powder Data/... menu item</span>
<span class="sd">        to read a powder diffraction data set. </span>
<span class="sd">        dict self.ImportMenuId is used to look up the specific</span>
<span class="sd">        reader item associated with the menu item, which will be</span>
<span class="sd">        None for the last menu item, which is the &quot;guess&quot; option</span>
<span class="sd">        where all appropriate formats will be tried.</span>

<span class="sd">        Also reads an instrument parameter file for each dataset.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># get a list of existing histograms</span>
        <span class="n">PWDRlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PWDR &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PWDRlist</span><span class="p">:</span>
                    <span class="n">PWDRlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="c"># look up which format was requested</span>
        <span class="n">reqrdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>  
        <span class="n">rdlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportGeneric</span><span class="p">(</span>
            <span class="n">reqrdr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportPowderReaderlist</span><span class="p">,</span><span class="s">&#39;Powder Data&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">lastIparmfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">lastdatafile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">newHistList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">rdlist</span><span class="p">:</span>
            <span class="c"># get instrument parameters for each dataset</span>
            <span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowderIparm</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">Iparm</span><span class="p">,</span> <span class="n">lastIparmfile</span><span class="p">,</span> <span class="n">lastdatafile</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">rd</span><span class="o">.</span><span class="n">repeat_instparm</span><span class="p">:</span> 
                <span class="n">lastIparmfile</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">instfile</span>
            <span class="n">lastdatafile</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">idstring</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="s">&#39;PWDR &#39;</span><span class="o">+</span><span class="n">HistName</span>
            <span class="c"># make new histogram names unique</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">HistName</span><span class="p">,</span><span class="n">PWDRlist</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Read powder data &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span><span class="o">+</span> \
                <span class="s">&#39; from file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">readfilename</span><span class="p">)</span> <span class="o">+</span> \
                <span class="s">&#39; with parameters from &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span><span class="p">)</span>
            <span class="c"># data are read, now store them in the tree</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">HistName</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">Iparm1</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">rd</span><span class="o">.</span><span class="n">clockWd</span> <span class="ow">and</span> <span class="n">rd</span><span class="o">.</span><span class="n">GSAS</span><span class="p">:</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="mf">100.</span>        <span class="c">#put back the CW centideg correction</span>
                <span class="n">cw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">cw</span><span class="o">/</span><span class="mf">2.</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">cw</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cw</span><span class="o">**</span><span class="mi">2</span>  <span class="c">#1/var=w at this point</span>
                <span class="k">if</span> <span class="s">&#39;Itype&#39;</span> <span class="ow">in</span> <span class="n">Iparm2</span><span class="p">:</span>
                    <span class="n">Ibeg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Iparm2</span><span class="p">[</span><span class="s">&#39;Tminmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">Ifin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Iparm2</span><span class="p">[</span><span class="s">&#39;Tminmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">Ibeg</span><span class="p">:</span><span class="n">Ifin</span><span class="p">]</span>
                    <span class="n">YI</span><span class="p">,</span><span class="n">WYI</span> <span class="o">=</span> <span class="n">G2pwd</span><span class="o">.</span><span class="n">calcIncident</span><span class="p">(</span><span class="n">Iparm2</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">Ibeg</span><span class="p">:</span><span class="n">Ifin</span><span class="p">]</span><span class="o">/</span><span class="n">YI</span>
                    <span class="n">var</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">Ibeg</span><span class="p">:</span><span class="n">Ifin</span><span class="p">]</span>
                    <span class="n">var</span> <span class="o">+=</span> <span class="n">WYI</span><span class="o">*</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">var</span> <span class="o">/=</span> <span class="n">YI</span><span class="o">**</span><span class="mi">2</span>
                    <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">var</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                                        
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                                        
                <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>                                        
            <span class="n">Tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">valuesdict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s">&#39;Dummy&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;ranId&#39;</span><span class="p">:</span><span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valuesdict</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="c"># this should be removed someday</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Limits&#39;</span><span class="p">),</span>
                <span class="p">[(</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">),[</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Limits&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Background&#39;</span><span class="p">),</span>
                <span class="p">[[</span><span class="s">&#39;chebyschev&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                 <span class="p">{</span><span class="s">&#39;nDebye&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">:[],</span><span class="s">&#39;nPeaks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;peaksList&#39;</span><span class="p">:[]}])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">),</span>
                <span class="p">[</span><span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">),</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Peak List&#39;</span><span class="p">)</span>
                <span class="p">,[])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Index Peak List&#39;</span><span class="p">),</span>
                <span class="p">[])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Unit Cells List&#39;</span><span class="p">),</span>
                <span class="p">[])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">),</span>
                <span class="p">{})</span>
            <span class="n">newHistList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newHistList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># somehow, no new histograms</span>
        <span class="c"># make a list of phase names</span>
        <span class="n">phaseRIdList</span><span class="p">,</span><span class="n">usedHistograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseInfofromTree</span><span class="p">()</span>
        <span class="n">phaseNameList</span> <span class="o">=</span> <span class="n">usedHistograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c"># phase names in use</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phaseNameList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># no phases yet, nothing to do</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&#39;Select phase(s) to add the new</span><span class="se">\n</span><span class="s">powder dataset(s) to:&#39;</span>
        <span class="k">for</span> <span class="n">Name</span> <span class="ow">in</span> <span class="n">newHistList</span><span class="p">:</span>
            <span class="n">header</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ItemSelector</span><span class="p">(</span><span class="n">phaseNameList</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;Add to phase(s)&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span> <span class="k">return</span>
        <span class="c"># connect new phases to histograms</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;ERROR -- why are there no phases here?&#39;</span><span class="p">)</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="n">iph</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span> <span class="c"># loop over (new) phases</span>
            <span class="n">iph</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">generalData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
            <span class="n">SGData</span> <span class="o">=</span> <span class="n">generalData</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
            <span class="n">UseList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
            <span class="n">NShkl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="n">NDij</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">histoName</span> <span class="ow">in</span> <span class="n">newHistList</span><span class="p">:</span>
                <span class="n">UseList</span><span class="p">[</span><span class="n">histoName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s">&#39;Histogram&#39;</span><span class="p">:</span><span class="n">histoName</span><span class="p">,</span><span class="s">&#39;Show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                    <span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">:[</span><span class="s">&#39;MD&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,{}],</span>
                    <span class="s">&#39;Size&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                            <span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                    <span class="s">&#39;Mustrain&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                                <span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,],</span><span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                    <span class="s">&#39;HStrain&#39;</span><span class="p">:[</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,],</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>                          
                    <span class="s">&#39;Extinction&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Babinet&#39;</span><span class="p">:{</span><span class="s">&#39;BabA&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;BabU&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">]}}</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">histoName</span><span class="p">)</span>
                <span class="n">refList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>
                    <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">))</span>
                <span class="n">refList</span><span class="p">[</span><span class="n">generalData</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="c"># success</span>
</div>
<div class="viewcode-block" id="GSASII.OnDummyPowder"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnDummyPowder">[docs]</a>    <span class="k">def</span> <span class="nf">OnDummyPowder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to Import/Powder Data/Simulate menu item</span>
<span class="sd">        to create a Dummy powder diffraction data set. </span>

<span class="sd">        Reads an instrument parameter file and then gets input from the user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># get a list of existing histograms</span>
        <span class="n">PWDRlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;PWDR &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PWDRlist</span><span class="p">:</span>
                    <span class="n">PWDRlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="c"># Initialize a base class reader</span>
        <span class="n">rd</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">ImportPowderData</span><span class="p">(</span>
            <span class="n">extensionlist</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(),</span>
            <span class="n">strictExtension</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">formatName</span> <span class="o">=</span> <span class="s">&#39;Simulate dataset&#39;</span><span class="p">,</span>
            <span class="n">longFormatName</span> <span class="o">=</span> <span class="s">&#39;Compute a simulated pattern&#39;</span><span class="p">)</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="c"># no filename</span>
        <span class="c"># #self.powderentry[1] = pos # bank offset (N/A here)</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">powderentry</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="c"># only one bank</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;This is a dummy dataset for powder pattern simulation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">lastIparmfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">lastdatafile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zipfile</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="c"># get instrument parameters for it</span>
        <span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPowderIparm</span><span class="p">(</span><span class="n">rd</span><span class="p">,</span> <span class="n">Iparm</span><span class="p">,</span> <span class="n">lastIparmfile</span><span class="p">,</span> <span class="n">lastdatafile</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;T&#39;</span> <span class="ow">in</span> <span class="n">Iparm1</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;TOF simulation not supported yet&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># need to get name, 2theta start, end, step</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">idstring</span> <span class="o">=</span> <span class="s">&#39; CW&#39;</span>
            <span class="k">if</span> <span class="s">&#39;X&#39;</span> <span class="ow">in</span> <span class="n">Iparm1</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">idstring</span> <span class="o">=</span> <span class="s">&#39;CW x-ray simulation&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">idstring</span> <span class="o">=</span> <span class="s">&#39;CW neutron simulation&#39;</span>
            <span class="c"># base initial range on wavelength</span>
            <span class="n">wave</span> <span class="o">=</span> <span class="n">Iparm1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Lam&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">wave</span><span class="p">:</span>
                <span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wave</span> <span class="o">=</span> <span class="n">Iparm1</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Lam1&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">wave</span><span class="p">:</span>
                    <span class="n">wave</span> <span class="o">=</span> <span class="n">wave</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">N</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">):</span> <span class="c"># insist on a dataset with a few points</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;dataset name&#39;</span><span class="p">,</span> <span class="s">&#39;start angle&#39;</span><span class="p">,</span> <span class="s">&#39;end angle&#39;</span><span class="p">,</span> <span class="s">&#39;step size&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">wave</span> <span class="ow">or</span> <span class="n">wave</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">inp</span> <span class="o">=</span> <span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">idstring</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span><span class="mf">40.</span><span class="p">,</span><span class="mf">0.005</span><span class="p">]</span> <span class="c"># see names for what&#39;s what</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">inp</span> <span class="o">=</span> <span class="p">[</span><span class="n">rd</span><span class="o">.</span><span class="n">idstring</span><span class="p">,</span> <span class="mf">10.</span><span class="p">,</span><span class="mf">80.</span><span class="p">,</span><span class="mf">0.01</span><span class="p">]</span> <span class="c"># see names for what&#39;s what</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ScrolledMultiEditor</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,[</span><span class="n">inp</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">),</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)),</span><span class="n">names</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&#39;Enter simulation name and range&#39;</span><span class="p">,</span>
                <span class="n">minvals</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">),</span>
                <span class="n">maxvals</span><span class="o">=</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">sizevals</span><span class="o">=</span><span class="p">((</span><span class="mi">225</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),)</span>
                <span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">inp</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
                    <span class="n">end</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>                
                    <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="n">step</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># x-axis values</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># powder pattern intensities</span>
            <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># 1/sig(intensity)^2 values (weights)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># calc. intensities (zero)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># calc. background (zero)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="c"># obs-calc profiles</span>
            <span class="p">]</span>
        <span class="n">Tmin</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Tmax</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c"># data are read, now store them in the tree</span>
        <span class="n">HistName</span> <span class="o">=</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">HistName</span> <span class="o">=</span> <span class="s">&#39;PWDR &#39;</span><span class="o">+</span><span class="n">HistName</span>
        <span class="n">HistName</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">HistName</span><span class="p">,</span><span class="n">PWDRlist</span><span class="p">)</span>  <span class="c"># make new histogram names unique</span>
        <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">HistName</span><span class="p">)</span>
        <span class="n">valuesdict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="s">&#39;Dummy&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,</span>
            <span class="s">&#39;ranId&#39;</span><span class="p">:</span><span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">powderdata</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Limits&#39;</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">),[</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Limits&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Background&#39;</span><span class="p">),</span>
            <span class="p">[[</span><span class="s">&#39;chebyschev&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
             <span class="p">{</span><span class="s">&#39;nDebye&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">:[],</span><span class="s">&#39;nPeaks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;peaksList&#39;</span><span class="p">:[]}])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">),</span>
            <span class="p">[</span><span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">),</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Peak List&#39;</span><span class="p">)</span>
            <span class="p">,[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Index Peak List&#39;</span><span class="p">),</span>
            <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Unit Cells List&#39;</span><span class="p">),</span>
            <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">),</span>
            <span class="p">{})</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;Added simulation powder data &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span><span class="o">+</span> 
              <span class="s">&#39; with parameters from &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">instmsg</span><span class="p">))</span>

        <span class="c"># make a list of phase names</span>
        <span class="n">phaseRIdList</span><span class="p">,</span><span class="n">usedHistograms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseInfofromTree</span><span class="p">()</span>
        <span class="n">phaseNameList</span> <span class="o">=</span> <span class="n">usedHistograms</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="c"># phase names in use</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">phaseNameList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># no phases yet, nothing to do</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s">&#39;Select phase(s) to add the new</span><span class="se">\n</span><span class="s">powder simulation (dummy) dataset to:&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ItemSelector</span><span class="p">(</span><span class="n">phaseNameList</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;Add to phase(s)&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span> <span class="k">return</span>
        <span class="c"># connect new phases to histograms</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">sub</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;ERROR -- why are there no phases here?&#39;</span><span class="p">)</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
        <span class="n">iph</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span> <span class="c"># loop over (new) phases</span>
            <span class="n">iph</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iph</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">generalData</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">]</span>
            <span class="n">SGData</span> <span class="o">=</span> <span class="n">generalData</span><span class="p">[</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
            <span class="n">UseList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
            <span class="n">NShkl</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">MustrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="n">NDij</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">HStrainNames</span><span class="p">(</span><span class="n">SGData</span><span class="p">))</span>
            <span class="n">UseList</span><span class="p">[</span><span class="n">HistName</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;Histogram&#39;</span><span class="p">:</span><span class="n">HistName</span><span class="p">,</span><span class="s">&#39;Show&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Pref.Ori.&#39;</span><span class="p">:[</span><span class="s">&#39;MD&#39;</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">False</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,{}],</span>
                <span class="s">&#39;Size&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                <span class="s">&#39;Mustrain&#39;</span><span class="p">:[</span><span class="s">&#39;isotropic&#39;</span><span class="p">,[</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1000.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],[</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>
                            <span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,],</span><span class="n">NShkl</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>
                <span class="s">&#39;HStrain&#39;</span><span class="p">:[</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,],</span><span class="n">NDij</span><span class="o">*</span><span class="p">[</span><span class="bp">False</span><span class="p">,]],</span>                          
                <span class="s">&#39;Extinction&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Babinet&#39;</span><span class="p">:{</span><span class="s">&#39;BabA&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;BabU&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">]}}</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">HistName</span><span class="p">)</span>
            <span class="n">refList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>
                <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">))</span>
            <span class="n">refList</span><span class="p">[</span><span class="n">generalData</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="c"># success</span>
</div>
    <span class="k">def</span> <span class="nf">_Add_ImportMenu_smallangle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;configure the Small Angle Data menus accord to the readers found in _init_Imports</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Small Angle Data&#39;</span><span class="p">,</span>
            <span class="n">submenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import small angle data&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportSmallAngleReaderlist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;from &#39;</span><span class="o">+</span><span class="n">reader</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span><span class="s">&#39; file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportSmallAngle</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="c"># item = submenu.Append(wx.ID_ANY,</span>
        <span class="c">#     help=&#39;Import small angle data, use file to try to determine format&#39;,</span>
        <span class="c">#     kind=wx.ITEM_NORMAL,text=&#39;guess format from file&#39;)</span>
        <span class="c"># self.Bind(wx.EVT_MENU, self.OnImportSmallAngle, id=item.GetId())</span>

<div class="viewcode-block" id="GSASII.OnImportSmallAngle"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImportSmallAngle">[docs]</a>    <span class="k">def</span> <span class="nf">OnImportSmallAngle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to an Import/Small Angle Data/... menu item</span>
<span class="sd">        to read a small angle diffraction data set. </span>
<span class="sd">        dict self.ImportMenuId is used to look up the specific</span>
<span class="sd">        reader item associated with the menu item, which will be</span>
<span class="sd">        None for the last menu item, which is the &quot;guess&quot; option</span>
<span class="sd">        where all appropriate formats will be tried.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">def</span> <span class="nf">GetSASDIparm</span><span class="p">(</span><span class="n">reader</span><span class="p">):</span>
            <span class="n">parm</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">instdict</span>
            <span class="n">Iparm</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Type&#39;</span><span class="p">:[</span><span class="n">parm</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span><span class="n">parm</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;Lam&#39;</span><span class="p">:[</span><span class="n">parm</span><span class="p">[</span><span class="s">&#39;wave&#39;</span><span class="p">],</span>
                <span class="n">parm</span><span class="p">[</span><span class="s">&#39;wave&#39;</span><span class="p">],</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;Azimuth&#39;</span><span class="p">:[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mi">0</span><span class="p">]}</span>           
            <span class="k">return</span> <span class="n">Iparm</span><span class="p">,{}</span>
            
        <span class="c"># get a list of existing histograms</span>
        <span class="n">SASDlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;SASD &#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">SASDlist</span><span class="p">:</span>
                    <span class="n">SASDlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="c"># look up which format was requested</span>
        <span class="n">reqrdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ImportMenuId</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>  
        <span class="n">rdlist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImportGeneric</span><span class="p">(</span>
            <span class="n">reqrdr</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ImportSmallAngleReaderlist</span><span class="p">,</span><span class="s">&#39;Small Angle Data&#39;</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rdlist</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">Iparm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">lastdatafile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">newHistList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">rdlist</span><span class="p">:</span>
            <span class="n">lastdatafile</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">smallangleentry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="n">rd</span><span class="o">.</span><span class="n">idstring</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="s">&#39;SASD &#39;</span><span class="o">+</span><span class="n">HistName</span>
            <span class="c"># make new histogram names unique</span>
            <span class="n">HistName</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">MakeUniqueLabel</span><span class="p">(</span><span class="n">HistName</span><span class="p">,</span><span class="n">SASDlist</span><span class="p">)</span>
            <span class="k">print</span> <span class="s">&#39;Read small angle data &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span><span class="o">+</span> \
                <span class="s">&#39; from file &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lastimport</span><span class="p">)</span>
            <span class="c"># data are read, now store them in the tree</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">HistName</span><span class="p">)</span>
            <span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span> <span class="o">=</span> <span class="n">GetSASDIparm</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>
<span class="c">#            if &#39;T&#39; in Iparm1[&#39;Type&#39;][0]:</span>
<span class="c">#                if not rd.clockWd and rd.GSAS:</span>
<span class="c">#                    rd.powderdata[0] *= 100.        #put back the CW centideg correction</span>
<span class="c">#                cw = np.diff(rd.powderdata[0])</span>
<span class="c">#                rd.powderdata[0] = rd.powderdata[0][:-1]+cw/2.</span>
<span class="c">#                rd.powderdata[1] = rd.powderdata[1][:-1]/cw</span>
<span class="c">#                rd.powderdata[2] = rd.powderdata[2][:-1]*cw**2  #1/var=w at this point</span>
<span class="c">#                if &#39;Itype&#39; in Iparm2:</span>
<span class="c">#                    Ibeg = np.searchsorted(rd.powderdata[0],Iparm2[&#39;Tminmax&#39;][0])</span>
<span class="c">#                    Ifin = np.searchsorted(rd.powderdata[0],Iparm2[&#39;Tminmax&#39;][1])</span>
<span class="c">#                    rd.powderdata[0] = rd.powderdata[0][Ibeg:Ifin]</span>
<span class="c">#                    YI,WYI = G2pwd.calcIncident(Iparm2,rd.powderdata[0])</span>
<span class="c">#                    rd.powderdata[1] = rd.powderdata[1][Ibeg:Ifin]/YI</span>
<span class="c">#                    var = 1./rd.powderdata[2][Ibeg:Ifin]</span>
<span class="c">#                    var += WYI*rd.powderdata[1]**2</span>
<span class="c">#                    var /= YI**2</span>
<span class="c">#                    rd.powderdata[2] = 1./var</span>
<span class="c">#                rd.powderdata[3] = np.zeros_like(rd.powderdata[0])                                        </span>
<span class="c">#                rd.powderdata[4] = np.zeros_like(rd.powderdata[0])                                        </span>
<span class="c">#                rd.powderdata[5] = np.zeros_like(rd.powderdata[0])                                        </span>
            <span class="n">Tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">smallangledata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">rd</span><span class="o">.</span><span class="n">smallangledata</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">valuesdict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="s">&#39;Dummy&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                <span class="s">&#39;ranId&#39;</span><span class="p">:</span><span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">valuesdict</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="c"># this should be removed someday</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,</span><span class="n">rd</span><span class="o">.</span><span class="n">smallangledata</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">comments</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Limits&#39;</span><span class="p">),</span>
                <span class="p">[(</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">),[</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Limits&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">),</span>
                <span class="p">[</span><span class="n">Iparm1</span><span class="p">,</span><span class="n">Iparm2</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Substances&#39;</span><span class="p">),</span><span class="n">G2pdG</span><span class="o">.</span><span class="n">SetDefaultSubstances</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">),</span>
                <span class="n">rd</span><span class="o">.</span><span class="n">Sample</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">),</span><span class="n">G2pdG</span><span class="o">.</span><span class="n">SetDefaultSASDModel</span><span class="p">())</span>
            <span class="n">newHistList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HistName</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newHistList</span><span class="p">:</span> <span class="k">return</span> <span class="c"># somehow, no new histograms</span>
        <span class="k">return</span> <span class="c"># success</span>
</div>
    <span class="k">def</span> <span class="nf">_init_Exports</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Find exporter routines and add them into menus</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># set up the top-level menus</span>
        <span class="n">projectmenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Entire project as&#39;</span><span class="p">,</span>
            <span class="n">projectmenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export entire project&#39;</span><span class="p">)</span>

        <span class="n">phasemenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Phase as&#39;</span><span class="p">,</span>
            <span class="n">phasemenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export phase or sometimes phases&#39;</span><span class="p">)</span>

        <span class="n">powdermenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Powder data as&#39;</span><span class="p">,</span>
            <span class="n">powdermenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export powder diffraction histogram(s)&#39;</span><span class="p">)</span>

        <span class="n">singlemenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Single crystal data as&#39;</span><span class="p">,</span>
            <span class="n">singlemenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export single crystal histogram(s)&#39;</span><span class="p">)</span>

        <span class="n">imagemenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Image data as&#39;</span><span class="p">,</span>
            <span class="n">imagemenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export powder image(s) data&#39;</span><span class="p">)</span>

        <span class="n">mapmenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Maps as&#39;</span><span class="p">,</span>
            <span class="n">mapmenu</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&#39;Export density map(s)&#39;</span><span class="p">)</span>

        <span class="c"># pdfmenu = wx.Menu()</span>
        <span class="c"># item = menu.AppendMenu(</span>
        <span class="c">#     wx.ID_ANY, &#39;PDFs as&#39;,</span>
        <span class="c">#     pdfmenu, help=&#39;Export pair distribution function(s)&#39;)</span>

        <span class="c"># find all the exporter files</span>
        <span class="n">pathlist</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
        <span class="n">filelist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">pathlist</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">iglob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="s">&quot;G2export*.py&quot;</span><span class="p">)):</span>
                <span class="n">filelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>    
        <span class="n">filelist</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">filelist</span><span class="p">)))</span> <span class="c"># remove duplicates</span>
        <span class="n">exporterlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c"># go through the routines and import them, saving objects that</span>
        <span class="c"># have export routines (method Exporter)</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filelist</span><span class="p">:</span>
            <span class="n">path</span><span class="p">,</span><span class="n">rootname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="n">pkg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">rootname</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">fp</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">fp</span><span class="p">,</span> <span class="n">fppath</span><span class="p">,</span><span class="n">desc</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">pkg</span><span class="p">,[</span><span class="n">path</span><span class="p">,])</span>
                <span class="n">pkg</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">pkg</span><span class="p">,</span><span class="n">fp</span><span class="p">,</span><span class="n">fppath</span><span class="p">,</span><span class="n">desc</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">clss</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">pkg</span><span class="p">):</span> <span class="c"># find classes defined in package</span>
                    <span class="k">if</span> <span class="n">clss</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span> <span class="k">continue</span>
                    <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">isclass</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="c"># check if we have the required methods</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="s">&#39;Exporter&#39;</span><span class="p">,</span><span class="s">&#39;loadParmDict&#39;</span><span class="p">:</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">):</span> <span class="k">break</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="nb">callable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">m</span><span class="p">)):</span> <span class="k">break</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">exporter</span> <span class="o">=</span> <span class="n">clss</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span> <span class="c"># create an export instance</span>
                            <span class="n">exporterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exporter</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Import_&#39;</span><span class="o">+</span><span class="n">errprefix</span><span class="o">+</span><span class="s">&#39;: Attribute Error&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Import_&#39;</span><span class="o">+</span><span class="n">errprefix</span><span class="o">+</span><span class="s">&#39;: Error importing file&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
                <span class="k">pass</span>
            <span class="k">if</span> <span class="n">fp</span><span class="p">:</span> <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="c"># Add submenu item(s) for each Exporter by its self-declared type (can be more than one)</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">exporterlist</span><span class="p">:</span>
            <span class="c">#print &#39;exporter&#39;,obj</span>
            <span class="k">for</span> <span class="n">typ</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">exporttype</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;project&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">projectmenu</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;phase&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">phasemenu</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;powder&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">powdermenu</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;single&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">singlemenu</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;image&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">imagemenu</span>
                <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&quot;map&quot;</span><span class="p">:</span>
                    <span class="n">submenu</span> <span class="o">=</span> <span class="n">mapmenu</span>
                <span class="c"># elif typ == &quot;pdf&quot;:</span>
                <span class="c">#     submenu = pdfmenu</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s">&quot;Error, unknown type in &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="p">))</span>
                    <span class="k">break</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>
                    <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
                    <span class="n">text</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">formatName</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">Exporter</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ExportLookup</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">typ</span> <span class="c"># lookup table for submenu item</span>
                
        <span class="c">#code to debug an Exporter. hard-coded the routine below, to allow a reload before use</span>
        <span class="c"># def DebugExport(event):</span>
        <span class="c">#      print &#39;start reload&#39;</span>
        <span class="c">#      reload(G2IO)</span>
        <span class="c">#      import G2export_pwdr as dev</span>
        <span class="c">#      reload(dev)</span>
        <span class="c">#      dev.ExportPowderFXYE(self).Exporter(event)</span>
        <span class="c"># item = menu.Append(</span>
        <span class="c">#     wx.ID_ANY,kind=wx.ITEM_NORMAL,</span>
        <span class="c">#     help=&quot;debug exporter&quot;,text=&quot;test Export FXYE&quot;)</span>
        <span class="c"># self.Bind(wx.EVT_MENU, DebugExport, id=item.GetId())</span>
        <span class="c"># # #self.ExportLookup[item.GetId()] = &#39;image&#39;</span>
        <span class="c"># self.ExportLookup[item.GetId()] = &#39;powder&#39;</span>

    <span class="k">def</span> <span class="nf">_Add_ExportMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="c"># item = parent.Append(</span>
        <span class="c">#     help=&#39;Select PWDR item to enable&#39;,id=wx.ID_ANY,</span>
        <span class="c">#     kind=wx.ITEM_NORMAL,</span>
        <span class="c">#     text=&#39;Export Powder Patterns...&#39;)</span>
        <span class="c"># self.ExportPattern.append(item)</span>
        <span class="c"># item.Enable(False)</span>
        <span class="c"># self.Bind(wx.EVT_MENU, self.OnExportPatterns, id=item.GetId())</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Export All Peak Lists...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportPeakList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnExportPeakList</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Export HKLs...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportHKL</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnExportHKL</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>

        <span class="n">item</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select PDF item to enable&#39;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Export PDF...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportPDF</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnExportPDF</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>

<div class="viewcode-block" id="GSASII.FillMainMenu"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.FillMainMenu">[docs]</a>    <span class="k">def</span> <span class="nf">FillMainMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menubar</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Define contents of the main GSAS-II menu for the (main) data tree window</span>
<span class="sd">        in the mac, used also for the data item windows as well.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">File</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">File</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&amp;File&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_FileMenuItems</span><span class="p">(</span><span class="n">File</span><span class="p">)</span>
        <span class="n">Data</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">Data</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_DataMenuItems</span><span class="p">(</span><span class="n">Data</span><span class="p">)</span>
        <span class="n">Calculate</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>        
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">Calculate</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&amp;Calculate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_CalculateMenuItems</span><span class="p">(</span><span class="n">Calculate</span><span class="p">)</span>
        <span class="n">Import</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>        
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">Import</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Import&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_ImportMenu_Phase</span><span class="p">(</span><span class="n">Import</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_ImportMenu_powder</span><span class="p">(</span><span class="n">Import</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_ImportMenu_Sfact</span><span class="p">(</span><span class="n">Import</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_ImportMenu_smallangle</span><span class="p">(</span><span class="n">Import</span><span class="p">)</span>
        <span class="c">#======================================================================</span>
        <span class="c"># Code to help develop/debug an importer, much is hard-coded below</span>
        <span class="c"># but module is reloaded before each use, allowing faster testing</span>
        <span class="c"># def DebugImport(event):</span>
        <span class="c">#     print &#39;start reload&#39;</span>
        <span class="c">#     import G2phase_ISO as dev</span>
        <span class="c">#     reload(dev)</span>
        <span class="c">#     rd = dev.ISODISTORTPhaseReader()</span>
        <span class="c">#     self.ImportMenuId[event.GetId()] = rd</span>
        <span class="c">#     self.OnImportPhase(event)</span>
            <span class="c"># or ----------------------------------------------------------------------</span>
            <span class="c">#self.OnImportGeneric(rd,[],&#39;test of ISODISTORTPhaseReader&#39;)</span>
            <span class="c"># special debug code</span>
            <span class="c"># or ----------------------------------------------------------------------</span>
            <span class="c"># filename = &#39;/Users/toby/projects/branton/subgroup_cif.txt&#39;</span>
            <span class="c"># fp = open(filename,&#39;Ur&#39;)</span>
            <span class="c"># if not rd.ContentsValidator(fp):</span>
            <span class="c">#     print &#39;not validated&#39;</span>
            <span class="c">#     # make a list of used phase ranId&#39;s</span>
            <span class="c"># phaseRIdList = []</span>
            <span class="c"># sub = G2gd.GetPatternTreeItemId(self,self.root,&#39;Phases&#39;)</span>
            <span class="c"># if sub:</span>
            <span class="c">#     item, cookie = self.PatternTree.GetFirstChild(sub)</span>
            <span class="c">#     while item:</span>
            <span class="c">#         phaseName = self.PatternTree.GetItemText(item)</span>
            <span class="c">#         ranId = self.PatternTree.GetItemPyData(item).get(&#39;ranId&#39;)</span>
            <span class="c">#         if ranId: phaseRIdList.append(ranId)</span>
            <span class="c">#         item, cookie = self.PatternTree.GetNextChild(sub, cookie)</span>
            <span class="c"># if rd.Reader(filename,fp,usedRanIdList=phaseRIdList):</span>
            <span class="c">#     print &#39;read OK&#39;</span>
        <span class="c"># item = Import.Append(</span>
        <span class="c">#     wx.ID_ANY,kind=wx.ITEM_NORMAL,</span>
        <span class="c">#     help=&quot;debug importer&quot;,text=&quot;test importer&quot;)</span>
        <span class="c"># self.Bind(wx.EVT_MENU, DebugImport, id=item.GetId())</span>
        <span class="c">#======================================================================</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ExportMenu</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Export&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Exports</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExportMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Add_ExportMenuItems</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExportMenu</span><span class="p">)</span>
        <span class="n">HelpMenu</span><span class="o">=</span><span class="n">G2gd</span><span class="o">.</span><span class="n">MyHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Data tree&#39;</span><span class="p">,</span>
            <span class="n">morehelpitems</span><span class="o">=</span><span class="p">[(</span><span class="s">&#39;&amp;Tutorials&#39;</span><span class="p">,</span><span class="s">&#39;Tutorials&#39;</span><span class="p">)])</span>
        <span class="n">menubar</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">HelpMenu</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&amp;Help&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_init_ctrls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;GSASII&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_FRAME_STYLE</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;GSAS-II data tree&#39;</span><span class="p">)</span>
        <span class="n">clientSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="n">xPos</span> <span class="o">=</span> <span class="n">clientSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">xPos</span><span class="p">,</span><span class="n">clientSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_Imports</span><span class="p">()</span>
        <span class="c">#initialize Menu item objects (these contain lists of menu items that are enabled or disabled)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MakePDF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Refine</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SeqRefine</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># pointer(s) to Sequential Refinement menu objects</span>
        <span class="c">#self.ExportPattern = []</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportPeakList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportHKL</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportPDF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportPhase</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportCIF</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GSASIIMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">FillMainMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASIIMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASIIMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SIZE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CreateStatusBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainPanel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">wxID_PATTERNTREE</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TreeCtrl</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">,</span>
            <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mainPanel</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TR_DEFAULT_STYLE</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TREE_SEL_CHANGED</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnPatternTreeSelChanged</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TREE_ITEM_COLLAPSED</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnPatternTreeItemCollapsed</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TREE_ITEM_EXPANDED</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnPatternTreeItemExpanded</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TREE_DELETE_ITEM</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnPatternTreeItemDelete</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TREE_KEY_DOWN</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnPatternTreeKeyDown</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PATTERNTREE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AddRoot</span><span class="p">(</span><span class="s">&#39;Loaded Data: &#39;</span><span class="p">)</span>
        
        <span class="n">plotFrame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;GSASII Plots&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">),</span> \
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_FRAME_STYLE</span> <span class="o">^</span> <span class="n">wx</span><span class="o">.</span><span class="n">CLOSE_BOX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span> <span class="o">=</span> <span class="n">G2plt</span><span class="o">.</span><span class="n">G2PlotNoteBook</span><span class="p">(</span><span class="n">plotFrame</span><span class="p">)</span>
        <span class="n">plotFrame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExportLookup</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ctrls</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Image</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">GSASIIpath</span><span class="o">.</span><span class="n">path2GSAS2</span><span class="p">,</span><span class="s">&#39;gsas2.ico&#39;</span><span class="p">),</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">BITMAP_TYPE_ICO</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&quot;wxMSW&quot;</span> <span class="ow">in</span> <span class="n">wx</span><span class="o">.</span><span class="n">PlatformInfo</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToBitmap</span><span class="p">()</span>
        <span class="k">elif</span> <span class="s">&quot;wxGTK&quot;</span> <span class="ow">in</span> <span class="n">wx</span><span class="o">.</span><span class="n">PlatformInfo</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="mi">22</span><span class="p">,</span> <span class="mi">22</span><span class="p">)</span><span class="o">.</span><span class="n">ConvertToBitmap</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">ConvertToBitmap</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetIcon</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">IconFromBitmap</span><span class="p">(</span><span class="n">img</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExitMain</span><span class="p">)</span>
        <span class="c"># various defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oldFocus</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">&#39;~&#39;</span><span class="p">)</span>       <span class="c">#start in the users home directory by default; may be meaningless</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exportDir</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># the last directory used for exports, if any.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">undofile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TreeItemDelete</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Offset</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delOffset</span> <span class="o">=</span> <span class="o">.</span><span class="mo">02</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refOffset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">100.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">refDelt</span> <span class="o">=</span> <span class="o">.</span><span class="mo">01</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Weight</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IparmName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># to be removed when SelectPowderData &amp; GetInstrumentFile is</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IfPlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakTable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitsTable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Interpolate</span> <span class="o">=</span> <span class="s">&#39;nearest&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ContourColor</span> <span class="o">=</span> <span class="s">&#39;Paired&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VcovColor</span> <span class="o">=</span> <span class="s">&#39;RdYlGn&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RamaColor</span> <span class="o">=</span> <span class="s">&#39;Blues&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Projection</span> <span class="o">=</span> <span class="s">&#39;equal area&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logPlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">qPlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sqPlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SqrtPlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorBars</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Contour</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Legend</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SinglePlot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubBack</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqReverse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotView</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oldImagefile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageZ</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Integrate</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imageDefault</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Sngl</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ifGetRing</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskKey</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>           <span class="c">#trigger for making image masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrainKey</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>         <span class="c">#ditto for new strain d-zeros</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Tutorials</span> <span class="o">=</span> <span class="bp">False</span>      <span class="c">#used for changing default directory</span>
        <span class="n">arg</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.gpx&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Refine</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">EnableSeqRefineMenu</span><span class="p">()</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Error opening file&#39;</span><span class="p">,</span><span class="n">arg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="GSASII.OnSize"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnSize">[docs]</a>    <span class="k">def</span> <span class="nf">OnSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when the main window is resized. Not sure why&#39;</span>
        <span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetClientSizeTuple</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mainPanel</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">))</span>
                        </div>
<div class="viewcode-block" id="GSASII.OnPatternTreeSelChanged"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeSelChanged">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeSelChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when a data tree item is selected&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TreeItemDelete</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TreeItemDelete</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pltNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pltNum</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>                         <span class="c">#to avoid the startup with no plot!</span>
                <span class="n">pltPage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">pltNum</span><span class="p">)</span>
                <span class="n">pltPlot</span> <span class="o">=</span> <span class="n">pltPage</span><span class="o">.</span><span class="n">figure</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetItem</span><span class="p">()</span>
            <span class="n">G2gd</span><span class="o">.</span><span class="n">MovePatternTreeToGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oldFocus</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">oldFocus</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.OnPatternTreeItemCollapsed"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeItemCollapsed">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeItemCollapsed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when a tree item is collapsed&#39;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.OnPatternTreeItemExpanded"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeItemExpanded">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeItemExpanded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when a tree item is expanded&#39;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.OnPatternTreeItemDelete"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeItemDelete">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeItemDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when a tree item is deleted -- not sure what this does&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TreeItemDelete</span> <span class="o">=</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="GSASII.OnPatternTreeItemActivated"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeItemActivated">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeItemActivated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when a tree item is activated&#39;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.OnPatternTreeKeyDown"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPatternTreeKeyDown">[docs]</a>    <span class="k">def</span> <span class="nf">OnPatternTreeKeyDown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Not sure what this does&#39;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span> <span class="k">return</span> <span class="c"># is this the toplevel in tree?</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_UP</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oldFocus</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">FindFocus</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetPrevSibling</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DOWN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">oldFocus</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Window</span><span class="o">.</span><span class="n">FindFocus</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextSibling</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                </div>
<div class="viewcode-block" id="GSASII.OnReadPowderPeaks"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnReadPowderPeaks">[docs]</a>    <span class="k">def</span> <span class="nf">OnReadPowderPeaks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Bound to menu Data/Read Powder Peaks -- still needed?&#39;</span>
        <span class="n">Cuka</span> <span class="o">=</span> <span class="mf">1.54052</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose file with peak list&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="s">&#39;peak files (*.txt)|*.txt|All files (*.*)|*.*&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">powderfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="n">comments</span><span class="p">,</span><span class="n">peaks</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">GetPowderPeaks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">powderfile</span><span class="p">)</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;PKS &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">powderfile</span><span class="p">))</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;PKS&#39;</span><span class="p">,</span><span class="n">Cuka</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
                <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">,</span><span class="s">&#39;Lam&#39;</span><span class="p">,</span><span class="s">&#39;Zero&#39;</span><span class="p">]</span> 
                <span class="n">codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">inst</span> <span class="o">=</span> <span class="p">[</span><span class="n">G2IO</span><span class="o">.</span><span class="n">makeInstDict</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">codes</span><span class="p">),{}]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">),</span><span class="n">inst</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span><span class="n">comments</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Index Peak List&#39;</span><span class="p">),</span><span class="n">peaks</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Unit Cells List&#39;</span><span class="p">),[])</span>             
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">())</span>           <span class="c"># to get Mac/Linux to change directory!</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                        </div>
<div class="viewcode-block" id="GSASII.OnImageRead"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImageRead">[docs]</a>    <span class="k">def</span> <span class="nf">OnImageRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called to read in an image in any known format&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose image files&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
            <span class="s">&#39;Any supported image file (*.edf;*.tif;*.tiff;*.mar*;*.avg;*.sum;*.img;*.G2img;*.png)|&#39;</span>
            <span class="s">&#39;*.edf;*.tif;*.tiff;*.mar*;*.avg;*.sum;*.img;*.G2img;*.png;*.zip|&#39;</span>
            <span class="s">&#39;European detector file (*.edf)|*.edf|&#39;</span>
            <span class="s">&#39;Any detector tif (*.tif;*.tiff)|*.tif;*.tiff|&#39;</span>
            <span class="s">&#39;MAR file (*.mar*)|*.mar*|&#39;</span>
            <span class="s">&#39;GE Image (*.avg;*.sum)|*.avg;*.sum|&#39;</span>
            <span class="s">&#39;ADSC Image (*.img)|*.img|&#39;</span>
            <span class="s">&#39;GSAS-II Image (*.G2img)|*.G2img|&#39;</span>
            <span class="s">&#39;Portable Network Graphics image (*.png)|*.png|&#39;</span>
            <span class="s">&#39;Zip archive (*.zip)|*.zip|&#39;</span>
            <span class="s">&#39;All files (*.*)|*.*&#39;</span><span class="p">,</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">MULTIPLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">imagefiles</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPaths</span><span class="p">()</span>
                <span class="n">imagefiles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">imagefile</span> <span class="ow">in</span> <span class="n">imagefiles</span><span class="p">:</span>
                    <span class="c"># if a zip file, open and extract</span>
                    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">imagefile</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;.zip&#39;</span><span class="p">:</span>
                        <span class="n">extractedfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">ExtractFileFromZip</span><span class="p">(</span><span class="n">imagefile</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">extractedfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">extractedfile</span> <span class="o">!=</span> <span class="n">imagefile</span><span class="p">:</span>
                            <span class="n">imagefile</span> <span class="o">=</span> <span class="n">extractedfile</span>
                    <span class="n">Comments</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="n">Npix</span><span class="p">,</span><span class="n">Image</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imagefile</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Comments</span><span class="p">:</span>
                        <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;IMG &#39;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">imagefile</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span><span class="n">Comments</span><span class="p">)</span>
                        <span class="n">Imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">Image</span><span class="p">)</span>
                        <span class="n">Imin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">Image</span><span class="p">))</span>          <span class="c">#force positive</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageDefault</span><span class="p">:</span>
                            <span class="n">Data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageDefault</span><span class="p">)</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;showLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;rings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;pixLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;edgemin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000000</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibdmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibskip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ellipses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibrant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;GonioAngles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;DetDepth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;DetDepthRef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;PWDR&#39;</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Paired&#39;</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;tilt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;rotation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;showLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;rings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;pixLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibdmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibskip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;edgemin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100000000</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ellipses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;GonioAngles&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;DetDepth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;DetDepthRef&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibrant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;IOtth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">5.0</span><span class="p">]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;LRazimuth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">135</span><span class="p">,</span><span class="mi">225</span><span class="p">]</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;azmthOff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;outChannels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2500</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;outAzimuths&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;centerAzm&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;fullIntegrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;setRings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;background image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>                            
                            <span class="n">Data</span><span class="p">[</span><span class="s">&#39;dark image&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">]</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;setDefault&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">),[</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Image Controls&#39;</span><span class="p">),</span><span class="n">Data</span><span class="p">)</span>
                        <span class="n">Masks</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Points&#39;</span><span class="p">:[],</span><span class="s">&#39;Rings&#39;</span><span class="p">:[],</span><span class="s">&#39;Arcs&#39;</span><span class="p">:[],</span><span class="s">&#39;Polygons&#39;</span><span class="p">:[],</span><span class="s">&#39;Frames&#39;</span><span class="p">:[],</span><span class="s">&#39;Thresholds&#39;</span><span class="p">:[(</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">),[</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">]]}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Masks&#39;</span><span class="p">),</span><span class="n">Masks</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Stress/Strain&#39;</span><span class="p">),</span>
                            <span class="p">{</span><span class="s">&#39;Type&#39;</span><span class="p">:</span><span class="s">&#39;True&#39;</span><span class="p">,</span><span class="s">&#39;d-zero&#39;</span><span class="p">:[],</span><span class="s">&#39;Sample phi&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s">&#39;Sample z&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">,</span><span class="s">&#39;strain&#39;</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">Npix</span><span class="p">,</span><span class="n">imagefile</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">Id</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">Id</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">())</span>           <span class="c"># to get Mac/Linux to change directory!                </span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Image Controls&#39;</span><span class="p">))</span>             <span class="c">#show last one</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>           <span class="c"># to get Mac/Linux to change directory!</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.CheckNotebook"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.CheckNotebook">[docs]</a>    <span class="k">def</span> <span class="nf">CheckNotebook</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Make sure the data tree has the minimally expected controls.</span>
<span class="sd">        (BHT) correct?</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Notebook&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Notebook&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,[</span><span class="s">&#39;&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Controls&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Controls&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span><span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">G2obj</span><span class="o">.</span><span class="n">DefaultControls</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Covariance&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Covariance&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Constraints&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Constraints&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,{</span><span class="s">&#39;Hist&#39;</span><span class="p">:[],</span><span class="s">&#39;HAP&#39;</span><span class="p">:[],</span><span class="s">&#39;Phase&#39;</span><span class="p">:[]})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Restraints&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Restraints&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,{})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,{</span><span class="s">&#39;Vector&#39;</span><span class="p">:{</span><span class="s">&#39;AtInfo&#39;</span><span class="p">:{}},</span>
                <span class="s">&#39;Residue&#39;</span><span class="p">:{</span><span class="s">&#39;AtInfo&#39;</span><span class="p">:{}},</span><span class="s">&#39;RBIds&#39;</span><span class="p">:{</span><span class="s">&#39;Vector&#39;</span><span class="p">:[],</span><span class="s">&#39;Residue&#39;</span><span class="p">:[]}})</span>
                </div>
<div class="viewcode-block" id="GSASII.CopyDialog"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.CopyDialog">[docs]</a>    <span class="k">class</span> <span class="nc">CopyDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates a dialog for copying control settings between</span>
<span class="sd">        data tree items&#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> 
                <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
            <span class="n">topLabl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">topLabl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">/</span><span class="mi">40</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">dataGridSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">cols</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span><span class="n">hgap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">vgap</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="n">ckbox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">ckbox</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnCopyChange</span><span class="p">)</span>                    
                <span class="n">dataGridSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ckbox</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dataGridSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
            <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
            <span class="n">cancelBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
            <span class="n">cancelBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCancel</span><span class="p">)</span>
            <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cancelBtn</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">OnCopyChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindWindowById</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>        
            
        <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>              
            
        <span class="k">def</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>              
            
        <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        </div>
<div class="viewcode-block" id="GSASII.SumDialog"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.SumDialog">[docs]</a>    <span class="k">class</span> <span class="nc">SumDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
        <span class="s">&#39;Allows user to supply scale factor(s) when summing data&#39;</span>
        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">dataType</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> 
                <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
            <span class="n">topLabl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">topLabl</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dataGridSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">cols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">hgap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">vgap</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
                <span class="n">name</span><span class="o">.</span><span class="n">SetEditable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="n">scale</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
                <span class="n">scale</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnScaleChange</span><span class="p">)</span>
                <span class="n">scale</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnScaleChange</span><span class="p">)</span>
                <span class="n">dataGridSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">dataGridSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dataType</span><span class="p">:</span>
                <span class="n">dataGridSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Sum result name: &#39;</span><span class="o">+</span><span class="n">dataType</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span> \
                    <span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnNameChange</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnNameChange</span><span class="p">)</span>
                <span class="n">dataGridSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dataGridSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
            <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
            <span class="n">cancelBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
            <span class="n">cancelBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCancel</span><span class="p">)</span>
            <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cancelBtn</span><span class="p">)</span>
            <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">OnScaleChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">FindWindowById</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">FindWindowById</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">id</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">and</span> <span class="s">&#39;-&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">print</span> <span class="s">&#39;bad input - numbers only&#39;</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">FindWindowById</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;0.000&#39;</span><span class="p">)</span>
            
        <span class="k">def</span> <span class="nf">OnNameChange</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> 
            
        <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>              
            
        <span class="k">def</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>              
            
        <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                        </div>
<div class="viewcode-block" id="GSASII.OnPwdrSum"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnPwdrSum">[docs]</a>    <span class="k">def</span> <span class="nf">OnPwdrSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Sum together powder data(?)&#39;</span>
        <span class="n">TextList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DataList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">SumList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Inst</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">SumItemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Comments</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Sum equals: </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">Names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">DataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>    <span class="c"># (x,y,w,yc,yb,yd)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Inst</span><span class="p">:</span>
                        <span class="n">Inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;Instrument Parameters&#39;</span><span class="p">))</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TextList</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Not enough data to sum&#39;</span><span class="p">,</span><span class="s">&#39;There must be more than one &quot;PWDR&quot; pattern&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;default_sum_name&#39;</span><span class="p">)</span>                
            <span class="n">dlg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SumDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Sum data&#39;</span><span class="p">,</span><span class="s">&#39;Enter scale for each pattern in summation&#39;</span><span class="p">,</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="n">TextList</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">lenX</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">Xminmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">Xsum</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">Ysum</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">Vsum</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">scale</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">item</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">DataList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
                            <span class="n">Comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="s">&#39; * &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">))</span>
                            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">yc</span><span class="p">,</span><span class="n">yb</span><span class="p">,</span><span class="n">yd</span> <span class="o">=</span> <span class="n">data</span>   <span class="c">#numpy arrays!</span>
                            <span class="n">v</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">w</span>
                            <span class="k">if</span> <span class="n">lenX</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">lenX</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Data length error&#39;</span><span class="p">,</span><span class="s">&#39;Data to be summed must have same number of points&#39;</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Expected:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">lenX</span><span class="p">)</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Found:   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">for &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
                                    <span class="k">return</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">lenX</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">Xminmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="k">if</span> <span class="n">Xminmax</span> <span class="o">!=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Data range error&#39;</span><span class="p">,</span><span class="s">&#39;Data to be summed must span same range&#39;</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Expected:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Xminmax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Xminmax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Found:   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">for &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
                                    <span class="k">return</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">yi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                                         <span class="n">Ysum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="n">scale</span><span class="o">*</span><span class="n">yi</span>
                                         <span class="n">Vsum</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">Xminmax</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
                                <span class="n">YCsum</span> <span class="o">=</span> <span class="n">YBsum</span> <span class="o">=</span> <span class="n">YDsum</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lenX</span><span class="p">)]</span>
                                <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">yi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
                                    <span class="n">Xsum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
                                    <span class="n">Ysum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="n">yi</span><span class="p">)</span>
                                    <span class="n">Vsum</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">scale</span><span class="o">*</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
                    <span class="n">Wsum</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Vsum</span><span class="p">)</span>
                    <span class="n">outname</span> <span class="o">=</span> <span class="s">&#39;PWDR &#39;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">outname</span> <span class="ow">in</span> <span class="n">Names</span><span class="p">:</span>
                        <span class="n">dlg2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Overwrite data?&#39;</span><span class="p">,</span><span class="s">&#39;Duplicate data name&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dlg2</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                                <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                        <span class="k">finally</span><span class="p">:</span>
                            <span class="n">dlg2</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">outname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Id</span><span class="p">:</span>
                        <span class="n">Sample</span> <span class="o">=</span> <span class="n">G2pdG</span><span class="o">.</span><span class="n">SetDefaultSample</span><span class="p">()</span>
                        <span class="n">valuesdict</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                            <span class="s">&#39;Dummy&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span>
                            <span class="s">&#39;ranId&#39;</span><span class="p">:</span><span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">),</span>
                            <span class="p">}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">valuesdict</span><span class="p">,[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Xsum</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ysum</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Wsum</span><span class="p">),</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">YCsum</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">YBsum</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">YDsum</span><span class="p">)]])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span><span class="n">Comments</span><span class="p">)</span>                    
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Limits&#39;</span><span class="p">),[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">Xminmax</span><span class="p">),</span><span class="n">Xminmax</span><span class="p">])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Background&#39;</span><span class="p">),[[</span><span class="s">&#39;chebyschev&#39;</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
                            <span class="p">{</span><span class="s">&#39;nDebye&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;debyeTerms&#39;</span><span class="p">:[],</span><span class="s">&#39;nPeaks&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;peaksList&#39;</span><span class="p">:[]}])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">),</span><span class="n">Inst</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">),</span><span class="n">Sample</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Peak List&#39;</span><span class="p">),[])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Index Peak List&#39;</span><span class="p">),[])</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Unit Cells List&#39;</span><span class="p">),[])</span>             
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">),{})</span>             
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.OnImageSum"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnImageSum">[docs]</a>    <span class="k">def</span> <span class="nf">OnImageSum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Sum together image data(?)&#39;</span>
        <span class="n">TextList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DataList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">SumList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Inst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">SumItemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Comments</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Sum equals: </span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">Names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;IMG&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">name</span><span class="p">])</span>
                    <span class="n">DataList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>        <span class="c">#Size,Image</span>
                    <span class="n">Data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="s">&#39;Image Controls&#39;</span><span class="p">))</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TextList</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Not enough data to sum&#39;</span><span class="p">,</span><span class="s">&#39;There must be more than one &quot;IMG&quot; pattern&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;default_sum_name&#39;</span><span class="p">)</span>                
            <span class="n">dlg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SumDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Sum data&#39;</span><span class="p">,</span><span class="s">&#39;Enter scale for each image in summation&#39;</span><span class="p">,</span><span class="s">&#39;IMG&#39;</span><span class="p">,</span><span class="n">TextList</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">imSize</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
                    <span class="n">First</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">Found</span> <span class="o">=</span> <span class="bp">False</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">result</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">scale</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">item</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="n">DataList</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">scale</span><span class="p">:</span>
                            <span class="n">Found</span> <span class="o">=</span> <span class="bp">True</span>                                
                            <span class="n">Comments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scale</span><span class="p">,</span><span class="s">&#39; * &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">))</span>
                            <span class="n">Npix</span><span class="p">,</span><span class="n">imagefile</span> <span class="o">=</span> <span class="n">data</span>
                            <span class="n">image</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imagefile</span><span class="p">,</span><span class="n">imageOnly</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">First</span><span class="p">:</span>
                                <span class="n">newImage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                                <span class="n">First</span> <span class="o">=</span> <span class="bp">False</span>
                            <span class="k">if</span> <span class="n">imSize</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">imSize</span> <span class="o">!=</span> <span class="n">Npix</span><span class="p">:</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Image size error&#39;</span><span class="p">,</span><span class="s">&#39;Images to be summed must be same size&#39;</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Expected:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">imSize</span><span class="p">)</span><span class="o">+</span> \
                                        <span class="s">&#39;</span><span class="se">\n</span><span class="s">Found:   &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">Npix</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">for &#39;</span><span class="o">+</span><span class="n">name</span><span class="p">)</span>
                                    <span class="k">return</span>
                                <span class="n">newImage</span> <span class="o">=</span> <span class="n">newImage</span><span class="o">+</span><span class="n">scale</span><span class="o">*</span><span class="n">image</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="n">imSize</span> <span class="o">=</span> <span class="n">Npix</span>
                                <span class="n">newImage</span> <span class="o">=</span> <span class="n">newImage</span><span class="o">+</span><span class="n">scale</span><span class="o">*</span><span class="n">image</span>
                            <span class="k">del</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">Found</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Image sum error&#39;</span><span class="p">,</span><span class="s">&#39;No nonzero image multipliers found&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                        
                    <span class="n">newImage</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">(</span><span class="n">newImage</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>                        
                    <span class="n">outname</span> <span class="o">=</span> <span class="s">&#39;IMG &#39;</span><span class="o">+</span><span class="n">result</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">Id</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="n">outname</span> <span class="ow">in</span> <span class="n">Names</span><span class="p">:</span>
                        <span class="n">dlg2</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Overwrite data?&#39;</span><span class="p">,</span><span class="s">&#39;Duplicate data name&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dlg2</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                                <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                        <span class="k">finally</span><span class="p">:</span>
                            <span class="n">dlg2</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">outname</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Id</span><span class="p">:</span>
                        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose sum image filename&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
                            <span class="s">&#39;G2img files (*.G2img)|*.G2img&#39;</span><span class="p">,</span> 
                            <span class="n">wx</span><span class="o">.</span><span class="n">SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                            <span class="n">newimagefile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                            <span class="n">newimagefile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">newimagefile</span><span class="p">)</span>
                            <span class="n">G2IO</span><span class="o">.</span><span class="n">PutG2Image</span><span class="p">(</span><span class="n">newimagefile</span><span class="p">,</span><span class="n">Comments</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="n">Npix</span><span class="p">,</span><span class="n">newImage</span><span class="p">)</span>
                            <span class="n">Imax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">newImage</span><span class="p">)</span>
                            <span class="n">Imin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">newImage</span><span class="p">)</span>
                            <span class="n">newImage</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,[</span><span class="n">imSize</span><span class="p">,</span><span class="n">newimagefile</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">),</span><span class="n">Comments</span><span class="p">)</span>
                        <span class="k">del</span><span class="p">(</span><span class="n">newImage</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">imageDefault</span><span class="p">:</span>
                            <span class="n">Data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imageDefault</span><span class="p">)</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;showLines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;rings&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;cutoff&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;pixLimit&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">20</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;ellipses&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;calibrant&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                        <span class="n">Data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">),[</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">]]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Image Controls&#39;</span><span class="p">),</span><span class="n">Data</span><span class="p">)</span>                                            
                        <span class="n">Masks</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Points&#39;</span><span class="p">:[],</span><span class="s">&#39;Rings&#39;</span><span class="p">:[],</span><span class="s">&#39;Arcs&#39;</span><span class="p">:[],</span><span class="s">&#39;Polygons&#39;</span><span class="p">:[],</span><span class="s">&#39;Frames&#39;</span><span class="p">:[],</span><span class="s">&#39;Thresholds&#39;</span><span class="p">:[(</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">),[</span><span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span><span class="p">]]}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Masks&#39;</span><span class="p">),</span><span class="n">Masks</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Stress/Strain&#39;</span><span class="p">),{})</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">outname</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                      </div>
<div class="viewcode-block" id="GSASII.OnAddPhase"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnAddPhase">[docs]</a>    <span class="k">def</span> <span class="nf">OnAddPhase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Add a new, empty phase to the tree. Called by Data/Add Phase menu&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="n">PhaseName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="s">&#39;Enter a name for this phase&#39;</span><span class="p">,</span><span class="s">&#39;Phase Name Entry&#39;</span><span class="p">,</span><span class="s">&#39;New phase&#39;</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">PhaseName</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">PhaseName</span><span class="p">)</span>
        <span class="n">E</span><span class="p">,</span><span class="n">SGData</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">SpcGroup</span><span class="p">(</span><span class="s">&#39;P 1&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span><span class="n">G2IO</span><span class="o">.</span><span class="n">SetNewPhase</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="n">PhaseName</span><span class="p">,</span><span class="n">SGData</span><span class="o">=</span><span class="n">SGData</span><span class="p">))</span>
        </div>
<div class="viewcode-block" id="GSASII.OnDeletePhase"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnDeletePhase">[docs]</a>    <span class="k">def</span> <span class="nf">OnDeletePhase</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Delete a phase from the tree. Called by Data/Delete Phase menu&#39;</span>
        <span class="c">#Hmm, also need to delete this phase from Reflection Lists for each PWDR histogram</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
        <span class="n">TextList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DelItemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>                
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MultiChoiceDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Which phase to delete?&#39;</span><span class="p">,</span> <span class="s">&#39;Delete phase&#39;</span><span class="p">,</span> <span class="n">TextList</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">CHOICEDLG_STYLE</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="n">DelList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">i</span><span class="p">,</span><span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                        <span class="k">if</span> <span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)]</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span> <span class="n">DelItemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">DelItemList</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                            <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">,</span> <span class="s">&#39;Reflection Lists&#39;</span><span class="p">)</span>
                            <span class="n">refList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                                <span class="k">del</span><span class="p">(</span><span class="n">refList</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">refList</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                </div>
<div class="viewcode-block" id="GSASII.OnRenameData"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnRenameData">[docs]</a>    <span class="k">def</span> <span class="nf">OnRenameData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Renames an existing phase. Called by Data/Rename Phase menu&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickId</span><span class="p">)</span>      
        <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;IMG&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
            <span class="n">dataType</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>                 <span class="c">#includes the &#39; &#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextEntryDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Data name: &#39;</span><span class="o">+</span><span class="n">dataType</span><span class="p">,</span><span class="s">&#39;Change data name&#39;</span><span class="p">,</span>
                <span class="n">defaultValue</span><span class="o">=</span><span class="n">name</span><span class="p">[</span><span class="n">name</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:])</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PickId</span><span class="p">,</span><span class="n">dataType</span><span class="o">+</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.GetFileList"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetFileList">[docs]</a>    <span class="k">def</span> <span class="nf">GetFileList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fileType</span><span class="p">,</span><span class="n">skip</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>        <span class="c">#potentially useful?</span>
        <span class="s">&#39;Appears unused. Note routine of same name in GSASIIpwdGUI&#39;</span>
        <span class="n">fileList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Source</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="nb">id</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">while</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">fileType</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">id</span> <span class="o">==</span> <span class="n">skip</span><span class="p">:</span>
                    <span class="n">Source</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fileList</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">False</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="nb">id</span><span class="p">])</span>
            <span class="nb">id</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">skip</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fileList</span><span class="p">,</span><span class="n">Source</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fileList</span>
            </div>
<div class="viewcode-block" id="GSASII.OnDataDelete"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnDataDelete">[docs]</a>    <span class="k">def</span> <span class="nf">OnDataDelete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Delete one or more histograms from data tree. Called by the</span>
<span class="sd">        Data/DeleteData menu</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">TextList</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;All Data&#39;</span><span class="p">]</span>
        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">DelItemList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ifPWDR</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ifSASD</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ifIMG</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ifHKLF</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">ifPDF</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Notebook&#39;</span><span class="p">,</span><span class="s">&#39;Controls&#39;</span><span class="p">,</span><span class="s">&#39;Covariance&#39;</span><span class="p">,</span><span class="s">&#39;Constraints&#39;</span><span class="p">,</span>
                    <span class="s">&#39;Restraints&#39;</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">,</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">ifPWDR</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="s">&#39;SASD&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">ifSASD</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="s">&#39;IMG&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">ifIMG</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">ifHKLF</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">if</span> <span class="s">&#39;PDF&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">ifPDF</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ifPWDR</span><span class="p">:</span> <span class="n">TextList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;All PWDR&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ifSASD</span><span class="p">:</span> <span class="n">TextList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;All SASD&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ifIMG</span><span class="p">:</span> <span class="n">TextList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;All IMG&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ifHKLF</span><span class="p">:</span> <span class="n">TextList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;All HKLF&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ifPDF</span><span class="p">:</span> <span class="n">TextList</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;All PDF&#39;</span><span class="p">)</span>                
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MultiChoiceDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Which data to delete?&#39;</span><span class="p">,</span> <span class="s">&#39;Delete data&#39;</span><span class="p">,</span> <span class="n">TextList</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">CHOICEDLG_STYLE</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="n">DelList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="s">&#39;All Data&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;All&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s">&#39;All PWDR&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PWDR&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s">&#39;All SASD&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;SASD&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s">&#39;All IMG&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;IMG&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s">&#39;All HKLF&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;HKLF&#39;</span><span class="p">]</span>
                    <span class="k">elif</span> <span class="s">&#39;All PDF&#39;</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span>
                        <span class="n">DelList</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PDF&#39;</span><span class="p">]</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                    <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="ow">in</span> <span class="n">DelList</span><span class="p">:</span> <span class="n">DelItemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">DelItemList</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">,</span><span class="bp">self</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>                        <span class="c">#so plot gets updated</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.OnFileOpen"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnFileOpen">[docs]</a>    <span class="k">def</span> <span class="nf">OnFileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reads in a GSAS-II .gpx project file in response to the</span>
<span class="sd">        File/Open Project menu button</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span>
        <span class="n">Id</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetChildrenCount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="bp">False</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s">&#39;Do you want to overwrite the current project? &#39;</span>
                <span class="s">&#39;Any unsaved changes will be lost. Press OK to continue.&#39;</span><span class="p">,</span>
                <span class="s">&#39;Overwrite?&#39;</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">DeleteChildren</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span> <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose GSAS-II project file&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
                <span class="s">&#39;GSAS-II project file (*.gpx)|*.gpx&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span> <span class="k">return</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;.gpx&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Loaded Data: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Expand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Id</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">,</span><span class="s">&#39;IMG &#39;</span><span class="p">,</span><span class="s">&#39;PDF &#39;</span><span class="p">,</span><span class="s">&#39;SASD&#39;</span><span class="p">,]:</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;Controls&#39;</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">Refine</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">EnableSeqRefineMenu</span><span class="p">()</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EnablePlot</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CheckNotebook</span><span class="p">()</span>
        <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>           <span class="c"># to get Mac/Linux to change directory!</span>
</div>
<div class="viewcode-block" id="GSASII.OnFileClose"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnFileClose">[docs]</a>    <span class="k">def</span> <span class="nf">OnFileClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Clears the data tree in response to the</span>
<span class="sd">        File/New Project menu button. User is given option to save</span>
<span class="sd">        the project.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;GSAS-II data display&#39;</span><span class="p">)</span> 
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Save current project?&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">YES</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">NO</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSaveMenu</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Loaded Data: &#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">DeleteChildren</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.OnFileSave"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnFileSave">[docs]</a>    <span class="k">def</span> <span class="nf">OnFileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Save the current project in response to the</span>
<span class="sd">        File/Save Project menu button</span>
<span class="sd">        &#39;&#39;&#39;</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Loaded Data: &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
            <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSaveas</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GSASII.OnFileSaveas"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnFileSaveas">[docs]</a>    <span class="k">def</span> <span class="nf">OnFileSaveas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Save the current project in response to the</span>
<span class="sd">        File/Save as menu button</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose GSAS-II project file name&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="s">&#39;GSAS-II project file (*.gpx)|*.gpx&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Saving project as&#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s">&quot;GSAS-II data tree: &quot;</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileSave</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">())</span>           <span class="c"># to get Mac/Linux to change directory!</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.ExitMain"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.ExitMain">[docs]</a>    <span class="k">def</span> <span class="nf">ExitMain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called if the main window is closed&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">undofile</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">undofile</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.OnFileExit"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnFileExit">[docs]</a>    <span class="k">def</span> <span class="nf">OnFileExit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called in response to the File/Quit menu button&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        
    <span class="c"># def OnExportPatterns(self,event):</span>
    <span class="c">#     names = [&#39;All&#39;]</span>
    <span class="c">#     exports = []</span>
    <span class="c">#     item, cookie = self.PatternTree.GetFirstChild(self.root)</span>
    <span class="c">#     while item:</span>
    <span class="c">#         name = self.PatternTree.GetItemText(item)</span>
    <span class="c">#         if &#39;PWDR&#39; in name:</span>
    <span class="c">#             names.append(name)</span>
    <span class="c">#         item, cookie = self.PatternTree.GetNextChild(self.root, cookie)</span>
    <span class="c">#     if names:</span>
    <span class="c">#         dlg = wx.MultiChoiceDialog(self,&#39;Select&#39;,&#39;Powder patterns to export&#39;,names)</span>
    <span class="c">#         if dlg.ShowModal() == wx.ID_OK:</span>
    <span class="c">#             sel = dlg.GetSelections()</span>
    <span class="c">#             if sel[0] == 0:</span>
    <span class="c">#                 exports = names[1:]</span>
    <span class="c">#             else:</span>
    <span class="c">#                 for x in sel:</span>
    <span class="c">#                     exports.append(names[x])</span>
    <span class="c">#         dlg.Destroy()</span>
    <span class="c">#     if exports:</span>
    <span class="c">#         dlg = wx.FileDialog(self, &#39;Choose output powder file name&#39;, &#39;.&#39;, &#39;&#39;, </span>
    <span class="c">#             &#39;GSAS fxye file (*.fxye)|*.fxye|xye file (*.xye)|*.xye&#39;,</span>
    <span class="c">#             wx.FD_SAVE|wx.FD_OVERWRITE_PROMPT|wx.CHANGE_DIR)</span>
    <span class="c">#         try:</span>
    <span class="c">#             if dlg.ShowModal() == wx.ID_OK:</span>
    <span class="c">#                 powderfile = dlg.GetPath()</span>
    <span class="c">#                 powderfile = G2IO.FileDlgFixExt(dlg,powderfile)</span>
    <span class="c">#                 if &#39;fxye&#39; in powderfile:</span>
    <span class="c">#                     G2IO.powderFxyeSave(self,exports,powderfile)</span>
    <span class="c">#                 else:       #just xye</span>
    <span class="c">#                     G2IO.powderXyeSave(self,exports,powderfile)</span>
    <span class="c">#         finally:</span>
    <span class="c">#             dlg.Destroy()</span>
        </div>
    <span class="k">def</span> <span class="nf">OnExportPeakList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose output peak list file name&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="s">&#39;(*.*)|*.*&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span><span class="p">)</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>                
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">item2</span><span class="p">,</span> <span class="n">cookie2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="k">while</span> <span class="n">item2</span><span class="p">:</span>
                            <span class="n">name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item2</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name2</span> <span class="o">==</span> <span class="s">&#39;Peak List&#39;</span><span class="p">:</span>
                                <span class="n">peaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item2</span><span class="p">)</span>
                                <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; Peak List&#39;</span><span class="p">))</span>                
                                <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
                                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%12.2f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                                        <span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">peak</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">peak</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">peak</span><span class="p">[</span><span class="mi">6</span><span class="p">]))</span>
                            <span class="n">item2</span><span class="p">,</span> <span class="n">cookie2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">cookie2</span><span class="p">)</span>                            
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>                            
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">OnExportHKL</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose output reflection list file name&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="s">&#39;(*.*)|*.*&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span><span class="p">)</span>
                <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">peaklistfile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>                
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                        <span class="n">item2</span><span class="p">,</span> <span class="n">cookie2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                        <span class="k">while</span> <span class="n">item2</span><span class="p">:</span>
                            <span class="n">name2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item2</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">name2</span> <span class="o">==</span> <span class="s">&#39;Reflection Lists&#39;</span><span class="p">:</span>
                                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item2</span><span class="p">)</span>
                                <span class="n">phases</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                                <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phases</span><span class="p">:</span>
                                    <span class="n">peaks</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
                                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">phase</span><span class="p">,</span><span class="s">&#39; Reflection List&#39;</span><span class="p">))</span>
                                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39; h  k  l  m  d-space 2-theta wid F**2&#39;</span><span class="p">))</span>                
                                    <span class="k">for</span> <span class="n">peak</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
                                        <span class="n">FWHM</span> <span class="o">=</span> <span class="n">G2pwd</span><span class="o">.</span><span class="n">getgamFW</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">peak</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span><span class="o">/</span><span class="mf">50.</span>      <span class="c">#to get delta-2-theta in deg.</span>
                                        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot; </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%3d</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.5f</span><span class="s"> </span><span class="si">%10.3f</span><span class="s"> </span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> \
                                            <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span><span class="nb">int</span><span class="p">(</span><span class="n">peak</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span><span class="n">peak</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">peak</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">FWHM</span><span class="p">,</span><span class="n">peak</span><span class="p">[</span><span class="mi">8</span><span class="p">]))</span>
                            <span class="n">item2</span><span class="p">,</span> <span class="n">cookie2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">cookie2</span><span class="p">)</span>                            
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>                            
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">OnExportPDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="c">#need S(Q) and G(R) to be saved here - probably best from selection?</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;All&#39;</span><span class="p">]</span>
        <span class="n">exports</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="s">&#39;PDF&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MultiChoiceDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Select&#39;</span><span class="p">,</span><span class="s">&#39;PDF patterns to export&#39;</span><span class="p">,</span><span class="n">names</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">sel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">exports</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">sel</span><span class="p">:</span>
                        <span class="n">exports</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">exports</span><span class="p">:</span>
            <span class="n">G2IO</span><span class="o">.</span><span class="n">PDFSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">exports</span><span class="p">)</span>
        
<div class="viewcode-block" id="GSASII.OnMakePDFs"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnMakePDFs">[docs]</a>    <span class="k">def</span> <span class="nf">OnMakePDFs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calculates PDFs</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tth2q</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">,</span><span class="n">w</span><span class="p">:</span><span class="mf">4.0</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">t</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span><span class="o">/</span><span class="n">w</span>
        <span class="n">TextList</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;All PWDR&#39;</span><span class="p">]</span>
        <span class="n">PDFlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="nb">id</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="nb">id</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
                <span class="n">Names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="n">TextList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="nb">id</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">TextList</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Nothing to make PDFs for&#39;</span><span class="p">,</span><span class="s">&#39;There must be at least one &quot;PWDR&quot; pattern&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MultiChoiceDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Make PDF controls&#39;</span><span class="p">,</span><span class="s">&#39;Make PDF controls for:&#39;</span><span class="p">,</span><span class="n">TextList</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">CHOICEDLG_STYLE</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span> <span class="n">PDFlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TextList</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                        <span class="n">PDFlist</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">TextList</span> <span class="k">if</span> <span class="n">item</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;PWDR&#39;</span><span class="p">]</span>                        
                    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">PDFlist</span><span class="p">:</span>
                        <span class="n">PWDRname</span> <span class="o">=</span> <span class="n">item</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
                        <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;PDF &#39;</span><span class="o">+</span><span class="n">PWDRname</span><span class="p">)</span>
                        <span class="n">Data</span> <span class="o">=</span> <span class="p">{</span>
                            <span class="s">&#39;Sample&#39;</span><span class="p">:{</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="n">item</span><span class="p">,</span><span class="s">&#39;Mult&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;Add&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                            <span class="s">&#39;Sample Bkg.&#39;</span><span class="p">:{</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Mult&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;Add&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                            <span class="s">&#39;Container&#39;</span><span class="p">:{</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Mult&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;Add&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span>
                            <span class="s">&#39;Container Bkg.&#39;</span><span class="p">:{</span><span class="s">&#39;Name&#39;</span><span class="p">:</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Mult&#39;</span><span class="p">:</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;Add&#39;</span><span class="p">:</span><span class="mf">0.0</span><span class="p">},</span><span class="s">&#39;ElList&#39;</span><span class="p">:{},</span>
                            <span class="s">&#39;Geometry&#39;</span><span class="p">:</span><span class="s">&#39;Cylinder&#39;</span><span class="p">,</span><span class="s">&#39;Diam&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span><span class="s">&#39;Pack&#39;</span><span class="p">:</span><span class="mf">0.50</span><span class="p">,</span><span class="s">&#39;Form Vol&#39;</span><span class="p">:</span><span class="mf">10.0</span><span class="p">,</span>
                            <span class="s">&#39;DetType&#39;</span><span class="p">:</span><span class="s">&#39;Image plate&#39;</span><span class="p">,</span><span class="s">&#39;ObliqCoeff&#39;</span><span class="p">:</span><span class="mf">0.2</span><span class="p">,</span><span class="s">&#39;Ruland&#39;</span><span class="p">:</span><span class="mf">0.025</span><span class="p">,</span><span class="s">&#39;QScaleLim&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span>
                            <span class="s">&#39;Lorch&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">,}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;PDF Controls&#39;</span><span class="p">),</span><span class="n">Data</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;I(Q)&#39;</span><span class="o">+</span><span class="n">PWDRname</span><span class="p">),[])</span>        
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;S(Q)&#39;</span><span class="o">+</span><span class="n">PWDRname</span><span class="p">),[])</span>        
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;F(Q)&#39;</span><span class="o">+</span><span class="n">PWDRname</span><span class="p">),[])</span>        
                        <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;G(R)&#39;</span><span class="o">+</span><span class="n">PWDRname</span><span class="p">),[])</span>        
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExportPDF</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                </div>
<div class="viewcode-block" id="GSASII.GetPWDRdatafromTree"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetPWDRdatafromTree">[docs]</a>    <span class="k">def</span> <span class="nf">GetPWDRdatafromTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns powder data from GSASII tree</span>

<span class="sd">        :param str PWDRname: a powder histogram name as obtained from</span>
<span class="sd">          :meth:`GSASIIstruct.GetHistogramNames`</span>

<span class="sd">        :returns: PWDRdata = powder data dictionary with</span>
<span class="sd">          Powder data arrays, Limits, Instrument Parameters,</span>
<span class="sd">          Sample Parameters            </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">PWDRdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">PWDRdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">PWDRname</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>            <span class="c">#wtFactor + ?</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">PWDRname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>          <span class="c">#powder data arrays</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Limits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">,</span><span class="s">&#39;Limits&#39;</span><span class="p">))</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Background&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">,</span><span class="s">&#39;Background&#39;</span><span class="p">))</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">,</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">))</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">,</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">))</span>
        <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">PWDRname</span><span class="p">,</span><span class="s">&#39;Reflection Lists&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="s">&#39;ranId&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PWDRdata</span><span class="p">:</span>  <span class="c"># patch, add a random Id</span>
            <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;ranId&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">]:</span>  <span class="c"># I hope this becomes obsolete at some point</span>
            <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">][</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PWDRdata</span><span class="p">[</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">PWDRdata</span>
</div>
<div class="viewcode-block" id="GSASII.GetHKLFdatafromTree"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetHKLFdatafromTree">[docs]</a>    <span class="k">def</span> <span class="nf">GetHKLFdatafromTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">HKLFname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns single crystal data from GSASII tree</span>

<span class="sd">        :param str HKLFname: a single crystal histogram name as obtained</span>
<span class="sd">          from</span>
<span class="sd">          :meth:`GSASIIstruct.GetHistogramNames`</span>

<span class="sd">        :returns: HKLFdata = single crystal data list of reflections</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">HKLFdata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">HKLFdata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">HKLFname</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>            <span class="c">#wtFactor + ?</span>
<span class="c">#        try:</span>
<span class="c">#            HKLFdata.update(self.PatternTree.GetItemPyData(HKLFname)[0])            #wtFactor + ?</span>
<span class="c">#        except ValueError:</span>
<span class="c">#            HKLFdata[&#39;wtFactor&#39;] = 1.0</span>
        <span class="n">HKLFdata</span><span class="p">[</span><span class="s">&#39;Data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">HKLFname</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">HKLFdata</span><span class="p">[</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">HKLFname</span><span class="p">,</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">HKLFdata</span>
        </div>
<div class="viewcode-block" id="GSASII.GetPhaseData"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetPhaseData">[docs]</a>    <span class="k">def</span> <span class="nf">GetPhaseData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a dict with defined phases. </span>
<span class="sd">        Note routine :func:`GSASIIstrIO.GetPhaseData` also exists to</span>
<span class="sd">        get same info from GPX file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">phaseData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no phases found in GetPhaseData&#39;</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">phaseData</span><span class="p">[</span><span class="n">phaseName</span><span class="p">]</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;ranId&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">phaseData</span><span class="p">[</span><span class="n">phaseName</span><span class="p">]:</span>
                    <span class="n">phaseData</span><span class="p">[</span><span class="n">phaseName</span><span class="p">][</span><span class="s">&#39;ranId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ran</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">)</span>          
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phaseData</span>
</div>
<div class="viewcode-block" id="GSASII.GetPhaseInfofromTree"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetPhaseInfofromTree">[docs]</a>    <span class="k">def</span> <span class="nf">GetPhaseInfofromTree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get the phase names and their rId values,</span>
<span class="sd">        also the histograms used in each phase. </span>

<span class="sd">        :returns: (phaseRIdList, usedHistograms) where </span>

<span class="sd">          * phaseRIdList is a list of random Id values for each phase</span>
<span class="sd">          * usedHistograms is a dict where the keys are the phase names</span>
<span class="sd">            and the values for each key are a list of the histogram names</span>
<span class="sd">            used in each phase. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">phaseRIdList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">usedHistograms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">phaseName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">ranId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;ranId&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ranId</span><span class="p">:</span> <span class="n">phaseRIdList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ranId</span><span class="p">)</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">UseList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]</span>
                <span class="n">usedHistograms</span><span class="p">[</span><span class="n">phaseName</span><span class="p">]</span> <span class="o">=</span> <span class="n">UseList</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phaseRIdList</span><span class="p">,</span><span class="n">usedHistograms</span>
</div>
<div class="viewcode-block" id="GSASII.GetPhaseNames"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetPhaseNames">[docs]</a>    <span class="k">def</span> <span class="nf">GetPhaseNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a list of defined phases. </span>
<span class="sd">        Note routine :func:`GSASIIstrIO.GetPhaseNames` also exists to</span>
<span class="sd">        get same info from GPX file.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">phaseNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">):</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Phases&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no phases found in GetPhaseNames&#39;</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">sub</span><span class="p">:</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">phase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="n">phaseNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">sub</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">phaseNames</span>
    </div>
<div class="viewcode-block" id="GSASII.GetHistogramNames"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetHistogramNames">[docs]</a>    <span class="k">def</span> <span class="nf">GetHistogramNames</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">hType</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of histogram names found in the GSASII data tree</span>
<span class="sd">        Note routine :func:`GSASIIstrIO.GetHistogramNames` also exists to</span>
<span class="sd">        get same info from GPX file.</span>
<span class="sd">        </span>
<span class="sd">        :param str hType: list of histogram types</span>
<span class="sd">        :return: list of histogram names</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">HistogramNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetCount</span><span class="p">():</span>
            <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">hType</span><span class="p">:</span>
                    <span class="n">HistogramNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>        
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>                

        <span class="k">return</span> <span class="n">HistogramNames</span>

                    </div>
<div class="viewcode-block" id="GSASII.GetUsedHistogramsAndPhasesfromTree"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.GetUsedHistogramsAndPhasesfromTree">[docs]</a>    <span class="k">def</span> <span class="nf">GetUsedHistogramsAndPhasesfromTree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns all histograms that are found in any phase</span>
<span class="sd">        and any phase that uses a histogram.</span>
<span class="sd">        This also assigns numbers to used phases and histograms by the</span>
<span class="sd">        order they appear in the file. </span>
<span class="sd">        Note routine :func:`GSASIIstrIO.GetUsedHistogramsAndPhasesfromTree` also exists to</span>
<span class="sd">        get same info from GPX file.</span>

<span class="sd">        :returns: (Histograms,Phases)</span>

<span class="sd">            * Histograms = dictionary of histograms as {name:data,...}</span>
<span class="sd">            * Phases = dictionary of phases that use histograms</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Histograms</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Phases</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">phaseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseNames</span><span class="p">()</span>
        <span class="n">phaseData</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPhaseData</span><span class="p">()</span>
        <span class="n">histoList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetHistogramNames</span><span class="p">([</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">phaseData</span><span class="p">:</span>
            <span class="n">Phase</span> <span class="o">=</span> <span class="n">phaseData</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
            <span class="n">pId</span> <span class="o">=</span> <span class="n">phaseNames</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
            <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;pId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pId</span>
            <span class="k">if</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">phase</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
                    <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span> <span class="o">=</span> <span class="n">Phase</span>
                <span class="k">for</span> <span class="n">hist</span> <span class="ow">in</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="s">&#39;Use&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">]:</span>      <span class="c">#patch: add Use flag as True</span>
                        <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;Use&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>         
                    <span class="k">if</span> <span class="n">hist</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Histograms</span> <span class="ow">and</span> <span class="n">Phase</span><span class="p">[</span><span class="s">&#39;Histograms&#39;</span><span class="p">][</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;Use&#39;</span><span class="p">]:</span>
                        <span class="n">item</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">hist</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                            <span class="k">if</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span> 
                                <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPWDRdatafromTree</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                            <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">hist</span><span class="p">[:</span><span class="mi">4</span><span class="p">]:</span>
                                <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetHKLFdatafromTree</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                            <span class="n">hId</span> <span class="o">=</span> <span class="n">histoList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
                            <span class="n">Histograms</span><span class="p">[</span><span class="n">hist</span><span class="p">][</span><span class="s">&#39;hId&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">hId</span>
                        <span class="k">else</span><span class="p">:</span> <span class="c"># would happen if a referenced histogram were renamed or deleted</span>
                            <span class="k">print</span><span class="p">(</span><span class="s">&#39;For phase &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span><span class="o">+</span>
                                  <span class="s">&#39;&quot; unresolved reference to histogram &quot;&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span><span class="p">)</span>
        <span class="c">#G2obj.IndexAllIds(Histograms=Histograms,Phases=Phases)</span>
        <span class="n">G2obj</span><span class="o">.</span><span class="n">IndexAllIds</span><span class="p">(</span><span class="n">Histograms</span><span class="o">=</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span><span class="o">=</span><span class="n">phaseData</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span>
        </div>
<div class="viewcode-block" id="GSASII.MakeLSParmDict"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.MakeLSParmDict">[docs]</a>    <span class="k">def</span> <span class="nf">MakeLSParmDict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Load all parameters used for computation from the tree into a</span>
<span class="sd">        dict of paired values [value, refine flag]. Note that this is</span>
<span class="sd">        different than the parmDict used in the refinement, which only has</span>
<span class="sd">        values.</span>

<span class="sd">        Note that similar things are done in</span>
<span class="sd">        :meth:`GSASIIIO.ExportBaseclass.loadParmDict` (from the tree) and </span>
<span class="sd">        :func:`GSASIIstrMain.Refine` and :func:`GSASIIstrMain.SeqRefine` (from</span>
<span class="sd">        a GPX file).</span>

<span class="sd">        :returns: (parmDict,varyList) where:</span>

<span class="sd">         * parmDict is a dict with values and refinement flags</span>
<span class="sd">           for each parameter and</span>
<span class="sd">         * varyList is a list of variables (refined parameters).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">parmDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetUsedHistogramsAndPhasesfromTree</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
            <span class="k">if</span> <span class="s">&#39;pId&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;View parameter error&#39;</span><span class="p">,</span><span class="s">&#39;You must run least squares at least once&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s">&#39;No pId for phase &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">phase</span><span class="p">)</span>
        <span class="n">rigidbodyDict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>   
            <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">))</span>
        <span class="n">rbVary</span><span class="p">,</span><span class="n">rbDict</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">GetRigidBodyModels</span><span class="p">(</span><span class="n">rigidbodyDict</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">rbIds</span> <span class="o">=</span> <span class="n">rigidbodyDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;RBIds&#39;</span><span class="p">,{</span><span class="s">&#39;Vector&#39;</span><span class="p">:[],</span><span class="s">&#39;Residue&#39;</span><span class="p">:[]})</span>
        <span class="n">Natoms</span><span class="p">,</span><span class="n">atomIndx</span><span class="p">,</span><span class="n">phaseVary</span><span class="p">,</span><span class="n">phaseDict</span><span class="p">,</span><span class="n">pawleyLookup</span><span class="p">,</span><span class="n">FFtable</span><span class="p">,</span><span class="n">BLtable</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">GetPhaseData</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">RestraintDict</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">rbIds</span><span class="o">=</span><span class="n">rbIds</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>        
        <span class="n">hapVary</span><span class="p">,</span><span class="n">hapDict</span><span class="p">,</span><span class="n">controlDict</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">GetHistogramPhaseData</span><span class="p">(</span><span class="n">Phases</span><span class="p">,</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">histVary</span><span class="p">,</span><span class="n">histDict</span><span class="p">,</span><span class="n">controlDict</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">GetHistogramData</span><span class="p">(</span><span class="n">Histograms</span><span class="p">,</span><span class="n">Print</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">varyList</span> <span class="o">=</span> <span class="n">rbVary</span><span class="o">+</span><span class="n">phaseVary</span><span class="o">+</span><span class="n">hapVary</span><span class="o">+</span><span class="n">histVary</span>
        <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">rbDict</span><span class="p">)</span>
        <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">phaseDict</span><span class="p">)</span>
        <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hapDict</span><span class="p">)</span>
        <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">histDict</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">parmDict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Azimuth&#39;</span><span class="p">,</span><span class="s">&#39;Gonio. radius&#39;</span><span class="p">,</span><span class="s">&#39;Lam1&#39;</span><span class="p">,</span><span class="s">&#39;Lam2&#39;</span><span class="p">,</span>
                <span class="s">&#39;Omega&#39;</span><span class="p">,</span><span class="s">&#39;Chi&#39;</span><span class="p">,</span><span class="s">&#39;Phi&#39;</span><span class="p">,</span><span class="s">&#39;nDebye&#39;</span><span class="p">,</span><span class="s">&#39;nPeaks&#39;</span><span class="p">]:</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span><span class="s">&#39;-&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">parm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;Ax&#39;</span><span class="p">,</span><span class="s">&#39;Ay&#39;</span><span class="p">,</span><span class="s">&#39;Az&#39;</span><span class="p">,</span><span class="s">&#39;SHmodel&#39;</span><span class="p">,</span><span class="s">&#39;SHord&#39;</span><span class="p">]:</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span><span class="s">&#39;-&#39;</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">varyList</span><span class="p">:</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span><span class="s">&#39;T&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">parmDict</span><span class="p">[</span><span class="n">parm</span><span class="p">],</span><span class="s">&#39;F&#39;</span><span class="p">]</span>
        <span class="c"># for i in parmDict: print i,&#39;\t&#39;,parmDict[i]</span>
        <span class="c"># fl = open(&#39;parmDict.dat&#39;,&#39;wb&#39;)</span>
        <span class="c"># import cPickle</span>
        <span class="c"># cPickle.dump(parmDict,fl,1)</span>
        <span class="c"># fl.close()</span>
        <span class="k">return</span> <span class="n">parmDict</span><span class="p">,</span><span class="n">varyList</span>
</div>
<div class="viewcode-block" id="GSASII.ShowLSParms"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.ShowLSParms">[docs]</a>    <span class="k">def</span> <span class="nf">ShowLSParms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Displays a window showing all parameters in the refinement.</span>
<span class="sd">        Called from the Calculate/View LS Parms menu.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">parmDict</span><span class="p">,</span><span class="n">varyList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">MakeLSParmDict</span><span class="p">()</span>
        <span class="n">parmValDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">parmDict</span><span class="p">:</span>
            <span class="n">parmValDict</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="n">reqVaryList</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">varyList</span><span class="p">)</span> <span class="c"># save requested variables</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># process constraints</span>
            <span class="n">sub</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Constraints&#39;</span><span class="p">)</span> 
            <span class="n">Constraints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">sub</span><span class="p">)</span>
            <span class="n">constList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">Constraints</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span> <span class="k">continue</span>
                <span class="n">constList</span> <span class="o">+=</span> <span class="n">Constraints</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">InitVars</span><span class="p">()</span>
            <span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">ignored</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">ProcessConstraints</span><span class="p">(</span><span class="n">constList</span><span class="p">)</span>
            <span class="n">groups</span><span class="p">,</span><span class="n">parmlist</span> <span class="o">=</span> <span class="n">G2mv</span><span class="o">.</span><span class="n">GroupConstraints</span><span class="p">(</span><span class="n">constrDict</span><span class="p">)</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">GenerateConstraints</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span><span class="n">parmlist</span><span class="p">,</span><span class="n">varyList</span><span class="p">,</span><span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">parmValDict</span><span class="p">)</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">Map2Dict</span><span class="p">(</span><span class="n">parmValDict</span><span class="p">,</span><span class="n">varyList</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">ShowLSParms</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Least Squares Parameters&#39;</span><span class="p">,</span><span class="n">parmValDict</span><span class="p">,</span><span class="n">varyList</span><span class="p">,</span><span class="n">reqVaryList</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.OnRefine"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnRefine">[docs]</a>    <span class="k">def</span> <span class="nf">OnRefine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Perform a refinement.</span>
<span class="sd">        Called from the Calculate/Refine menu.</span>
<span class="sd">        &#39;&#39;&#39;</span>        
        <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Sequential results&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Id</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="s">&#39;Your last refinement was sequential. Continue with &quot;Refine&quot;, removing previous sequential results?&#39;</span><span class="p">,</span>
                <span class="s">&#39;Remove sequential results?&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">Delete</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSave</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c"># check that constraints are OK here</span>
        <span class="n">errmsg</span><span class="p">,</span> <span class="n">warnmsg</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">CheckConstraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errmsg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error in constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errmsg</span><span class="o">+</span>
                  <span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Constraint Error&#39;</span><span class="p">,</span>
                             <span class="s">&#39;Error in constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errmsg</span><span class="o">+</span>
                             <span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">warnmsg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Conflict between refinment flag settings and constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>
                  <span class="n">warnmsg</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Refinement Flag Error&#39;</span><span class="p">,</span>
                             <span class="s">&#39;Conflict between refinment flag settings and constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>
                             <span class="n">warnmsg</span><span class="o">+</span>
                             <span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c">#works - but it&#39;d be better if it could restore plots</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ProgressDialog</span><span class="p">(</span><span class="s">&#39;Residual&#39;</span><span class="p">,</span><span class="s">&#39;All data Rw =&#39;</span><span class="p">,</span><span class="mf">101.0</span><span class="p">,</span> 
            <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PD_ELAPSED_TIME</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_AUTO_HIDE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_CAN_ABORT</span><span class="p">)</span>
        <span class="n">screenSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="p">),</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># increase size a bit along x</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">305</span><span class="p">,</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
        <span class="n">Rw</span> <span class="o">=</span> <span class="mf">100.00</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">Rw</span> <span class="o">=</span> <span class="n">G2stMn</span><span class="o">.</span><span class="n">Refine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">,</span><span class="n">dlg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">oldId</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>        <span class="c">#retain current selection</span>
        <span class="n">oldName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">oldId</span><span class="p">)</span>
        <span class="n">parentId</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">oldId</span><span class="p">)</span>
        <span class="n">parentName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">parentId</span><span class="p">:</span>
            <span class="n">parentName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">parentId</span><span class="p">)</span>     <span class="c">#find the current data tree name</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Load new result?&#39;</span><span class="p">,</span><span class="s">&#39;Refinement results, Rw =</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Rw</span><span class="p">),</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">DeleteChildren</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">while</span> <span class="n">item</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Id</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">]:</span>
                        <span class="n">Id</span> <span class="o">=</span> <span class="n">item</span>
                    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>                
                <span class="k">if</span> <span class="n">Id</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">parentName</span><span class="p">:</span>
                    <span class="n">parentId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">parentName</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">parentId</span><span class="p">:</span>
                        <span class="n">itemId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parentId</span><span class="p">,</span> <span class="n">oldName</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">itemId</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">oldName</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">itemId</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="GSASII.OnSeqRefine"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.OnSeqRefine">[docs]</a>    <span class="k">def</span> <span class="nf">OnSeqRefine</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Perform a sequential refinement.</span>
<span class="sd">        Called from the Calculate/Sequential refine menu.</span>
<span class="sd">        &#39;&#39;&#39;</span>        
        <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Sequential results&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">Id</span><span class="p">:</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">AppendItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sequential results&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,{})</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">OnFileSave</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="c"># check that constraints are OK here</span>
        <span class="n">errmsg</span><span class="p">,</span> <span class="n">warnmsg</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">CheckConstraints</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">errmsg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Error in constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errmsg</span><span class="o">+</span>
                  <span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Constraint Error&#39;</span><span class="p">,</span>
                             <span class="s">&#39;Error in constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span><span class="n">errmsg</span><span class="o">+</span>
                             <span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">warnmsg</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Conflict between refinment flag settings and constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>
                  <span class="n">warnmsg</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Refinement Flag Error&#39;</span><span class="p">,</span>
                             <span class="s">&#39;Conflict between refinment flag settings and constraints:</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>
                             <span class="n">warnmsg</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Refinement not possible&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ProgressDialog</span><span class="p">(</span><span class="s">&#39;Residual for histogram 0&#39;</span><span class="p">,</span><span class="s">&#39;Powder profile Rwp =&#39;</span><span class="p">,</span><span class="mf">101.0</span><span class="p">,</span> 
            <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PD_ELAPSED_TIME</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_AUTO_HIDE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_CAN_ABORT</span><span class="p">)</span>
        <span class="n">screenSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">1.2</span><span class="p">),</span><span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="c"># increase size a bit along x</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">305</span><span class="p">,</span><span class="n">screenSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">G2stMn</span><span class="o">.</span><span class="n">SeqRefine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">,</span><span class="n">dlg</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>        
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;Load new result?&#39;</span><span class="p">,</span><span class="s">&#39;Refinement results&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">DeleteChildren</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">G2plotNB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
                <span class="n">G2IO</span><span class="o">.</span><span class="n">ProjFileOpen</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                <span class="n">Id</span> <span class="o">=</span> <span class="n">G2gd</span><span class="o">.</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Sequential results&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SelectItem</span><span class="p">(</span><span class="n">Id</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="GSASII.ErrorDialog"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASII.ErrorDialog">[docs]</a>    <span class="k">def</span> <span class="nf">ErrorDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">message</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">wtype</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">):</span>
        <span class="s">&#39;Display an error message&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>  <span class="n">wtype</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span>  <span class="n">wtype</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span> <span class="c"># not working on Mac</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span>
</div></div>
<div class="viewcode-block" id="GSASIImain"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASIImain">[docs]</a><span class="k">class</span> <span class="nc">GSASIImain</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Defines a wxApp for GSAS-II</span>

<span class="sd">    Creates a wx frame (self.main) which contains the display of the</span>
<span class="sd">    data tree.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="GSASIImain.OnInit"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASIImain.OnInit">[docs]</a>    <span class="k">def</span> <span class="nf">OnInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called automatically when the app is created.&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="s">&#39;2.7&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">5</span><span class="p">]:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> 
                <span class="s">&#39;GSAS-II requires Python 2.7.x</span><span class="se">\n</span><span class="s"> Yours is &#39;</span><span class="o">+</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[:</span><span class="mi">5</span><span class="p">],</span>
                <span class="s">&#39;Python version error&#39;</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">GSASII</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetTopWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
        <span class="c"># DEBUG: jump to sequential results</span>
        <span class="c">#Id = G2gd.GetPatternTreeItemId(self.main,self.main.root,&#39;Sequential results&#39;)</span>
        <span class="c">#self.main.PatternTree.SelectItem(Id)</span>
        <span class="c"># end DEBUG</span>
        <span class="k">return</span> <span class="bp">True</span></div>
<div class="viewcode-block" id="GSASIImain.MacOpenFile"><a class="viewcode-back" href="../GSASII.html#GSASII.GSASIImain.MacOpenFile">[docs]</a>    <span class="k">def</span> <span class="nf">MacOpenFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called on Mac every time a file is dropped on the app when it is running,</span>
<span class="sd">        treat this like a File/Open project menu action.</span>
<span class="sd">        Should be ignored on other platforms</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c"># PATCH: Canopy 1.4 script main seems dropped on app; ignore .py files</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filename</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;.py&#39;</span><span class="p">:</span> <span class="k">return</span>
        <span class="c"># end PATCH</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">OnFileOpen</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">filename</span><span class="p">)</span>
</div></div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../GSASII.html#GSASII.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Start up the GSAS-II application&#39;&#39;&#39;</span>
    <span class="c">#application = GSASIImain() # don&#39;t redirect output, someday we</span>
    <span class="c"># may want to do this if we can </span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">GSASIImain</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wxInspector</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">wx.lib.inspection</span> <span class="kn">as</span> <span class="nn">wxeye</span>
        <span class="n">wxeye</span><span class="o">.</span><span class="n">InspectionTool</span><span class="p">()</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="c">#application.main.OnRefine(None)</span>
    <span class="n">application</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
    </div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span> <span class="c"># start the GUI</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>