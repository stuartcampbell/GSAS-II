

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASIIgrid &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for GSASIIgrid</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="c">#GSASIIgrid - data display routines</span>
<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2014-05-10 20:12:27 -0500 (Sat, 10 May 2014) $</span>
<span class="c"># $Author: toby $</span>
<span class="c"># $Revision: 1340 $</span>
<span class="c"># $URL: https://subversion.xor.aps.anl.gov/pyGSAS/trunk/GSASIIgrid.py $</span>
<span class="c"># $Id: GSASIIgrid.py 1340 2014-05-11 01:12:27Z toby $</span>
<span class="c">########### SVN repository information ###################</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*GSASIIgrid: Basic GUI routines*</span>
<span class="sd">--------------------------------</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">wx.grid</span> <span class="kn">as</span> <span class="nn">wg</span>
<span class="kn">import</span> <span class="nn">wx.wizard</span> <span class="kn">as</span> <span class="nn">wz</span>
<span class="kn">import</span> <span class="nn">wx.aui</span>
<span class="kn">import</span> <span class="nn">wx.lib.scrolledpanel</span> <span class="kn">as</span> <span class="nn">wxscroll</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">cPickle</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span> <span class="kn">as</span> <span class="nn">so</span>
<span class="kn">import</span> <span class="nn">wx.html</span>        <span class="c"># could postpone this for quicker startup</span>
<span class="kn">import</span> <span class="nn">webbrowser</span>     <span class="c"># could postpone this for quicker startup</span>
<span class="kn">import</span> <span class="nn">GSASIIpath</span>
<span class="n">GSASIIpath</span><span class="o">.</span><span class="n">SetVersionNumber</span><span class="p">(</span><span class="s">&quot;$Revision: 1340 $&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">GSASIImath</span> <span class="kn">as</span> <span class="nn">G2mth</span>
<span class="kn">import</span> <span class="nn">GSASIIIO</span> <span class="kn">as</span> <span class="nn">G2IO</span>
<span class="kn">import</span> <span class="nn">GSASIIstrIO</span> <span class="kn">as</span> <span class="nn">G2stIO</span>
<span class="kn">import</span> <span class="nn">GSASIIlattice</span> <span class="kn">as</span> <span class="nn">G2lat</span>
<span class="kn">import</span> <span class="nn">GSASIIplot</span> <span class="kn">as</span> <span class="nn">G2plt</span>
<span class="kn">import</span> <span class="nn">GSASIIpwdGUI</span> <span class="kn">as</span> <span class="nn">G2pdG</span>
<span class="kn">import</span> <span class="nn">GSASIIimgGUI</span> <span class="kn">as</span> <span class="nn">G2imG</span>
<span class="kn">import</span> <span class="nn">GSASIIphsGUI</span> <span class="kn">as</span> <span class="nn">G2phG</span>
<span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">G2spc</span>
<span class="kn">import</span> <span class="nn">GSASIImapvars</span> <span class="kn">as</span> <span class="nn">G2mv</span>
<span class="kn">import</span> <span class="nn">GSASIIconstrGUI</span> <span class="kn">as</span> <span class="nn">G2cnstG</span>
<span class="kn">import</span> <span class="nn">GSASIIrestrGUI</span> <span class="kn">as</span> <span class="nn">G2restG</span>
<span class="kn">import</span> <span class="nn">GSASIIpy3</span> <span class="kn">as</span> <span class="nn">G2py3</span>
<span class="kn">import</span> <span class="nn">GSASIIobj</span> <span class="kn">as</span> <span class="nn">G2obj</span>
<span class="kn">import</span> <span class="nn">GSASIIexprGUI</span> <span class="kn">as</span> <span class="nn">G2exG</span>

<span class="c"># trig functions in degrees</span>
<span class="n">sind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">tand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">cosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>

<span class="c"># globals we will use later</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># gets overridden in GSASII.py</span>
<span class="n">path2GSAS2</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">realpath</span><span class="p">(</span><span class="n">__file__</span><span class="p">))</span> <span class="c"># save location of this file</span>
<span class="n">helpLocDict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">htmlPanel</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">htmlFrame</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">helpMode</span> <span class="o">=</span> <span class="s">&#39;browser&#39;</span>
<span class="c">#if sys.platform.lower().startswith(&#39;win&#39;): helpMode = &#39;internal&#39; # need a global control to set this</span>
    
<span class="n">htmlFirstUse</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">WACV</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span>

<span class="p">[</span> <span class="n">wxID_FOURCALC</span><span class="p">,</span> <span class="n">wxID_FOURSEARCH</span><span class="p">,</span> <span class="n">wxID_FOURCLEAR</span><span class="p">,</span> <span class="n">wxID_PEAKSMOVE</span><span class="p">,</span> <span class="n">wxID_PEAKSCLEAR</span><span class="p">,</span> 
    <span class="n">wxID_CHARGEFLIP</span><span class="p">,</span> <span class="n">wxID_PEAKSUNIQUE</span><span class="p">,</span> <span class="n">wxID_PEAKSDELETE</span><span class="p">,</span> <span class="n">wxID_PEAKSDA</span><span class="p">,</span>
    <span class="n">wxID_PEAKSDISTVP</span><span class="p">,</span> <span class="n">wxID_PEAKSVIEWPT</span><span class="p">,</span> <span class="n">wxID_FINDEQVPEAKS</span><span class="p">,</span><span class="n">wxID_SHOWBONDS</span><span class="p">,</span><span class="n">wxID_MULTIMCSA</span><span class="p">,</span>
    <span class="n">wxID_SINGLEMCSA</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_PWDRADD</span><span class="p">,</span> <span class="n">wxID_HKLFADD</span><span class="p">,</span> <span class="n">wxID_PWDANALYSIS</span><span class="p">,</span> <span class="n">wxID_PWDCOPY</span><span class="p">,</span> <span class="n">wxID_DATADELETE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_ATOMSEDITADD</span><span class="p">,</span> <span class="n">wxID_ATOMSEDITINSERT</span><span class="p">,</span> <span class="n">wxID_ATOMSEDITDELETE</span><span class="p">,</span> <span class="n">wxID_ATOMSREFINE</span><span class="p">,</span> 
    <span class="n">wxID_ATOMSMODIFY</span><span class="p">,</span> <span class="n">wxID_ATOMSTRANSFORM</span><span class="p">,</span> <span class="n">wxID_ATOMSVIEWADD</span><span class="p">,</span> <span class="n">wxID_ATOMVIEWINSERT</span><span class="p">,</span>
    <span class="n">wxID_RELOADDRAWATOMS</span><span class="p">,</span><span class="n">wxID_ATOMSDISAGL</span><span class="p">,</span><span class="n">wxID_ATOMMOVE</span><span class="p">,</span>
    <span class="n">wxID_ASSIGNATMS2RB</span><span class="p">,</span><span class="n">wxID_ATOMSPDISAGL</span><span class="p">,</span> <span class="n">wxID_ISODISP</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">14</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_DRAWATOMSTYLE</span><span class="p">,</span> <span class="n">wxID_DRAWATOMLABEL</span><span class="p">,</span> <span class="n">wxID_DRAWATOMCOLOR</span><span class="p">,</span> <span class="n">wxID_DRAWATOMRESETCOLOR</span><span class="p">,</span> 
    <span class="n">wxID_DRAWVIEWPOINT</span><span class="p">,</span> <span class="n">wxID_DRAWTRANSFORM</span><span class="p">,</span> <span class="n">wxID_DRAWDELETE</span><span class="p">,</span> <span class="n">wxID_DRAWFILLCELL</span><span class="p">,</span> 
    <span class="n">wxID_DRAWADDEQUIV</span><span class="p">,</span> <span class="n">wxID_DRAWFILLCOORD</span><span class="p">,</span> <span class="n">wxID_DRAWDISAGLTOR</span><span class="p">,</span>  <span class="n">wxID_DRAWPLANE</span><span class="p">,</span>
    <span class="n">wxID_DRAWDISTVP</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">13</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_DRAWRESTRBOND</span><span class="p">,</span> <span class="n">wxID_DRAWRESTRANGLE</span><span class="p">,</span> <span class="n">wxID_DRAWRESTRPLANE</span><span class="p">,</span> <span class="n">wxID_DRAWRESTRCHIRAL</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_ADDMCSAATOM</span><span class="p">,</span><span class="n">wxID_ADDMCSARB</span><span class="p">,</span><span class="n">wxID_CLEARMCSARB</span><span class="p">,</span><span class="n">wxID_MOVEMCSA</span><span class="p">,</span><span class="n">wxID_MCSACLEARRESULTS</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_CLEARTEXTURE</span><span class="p">,</span><span class="n">wxID_REFINETEXTURE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_PAWLEYLOAD</span><span class="p">,</span> <span class="n">wxID_PAWLEYESTIMATE</span><span class="p">,</span> <span class="n">wxID_PAWLEYUPDATE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_IMCALIBRATE</span><span class="p">,</span><span class="n">wxID_IMRECALIBRATE</span><span class="p">,</span><span class="n">wxID_IMINTEGRATE</span><span class="p">,</span> <span class="n">wxID_IMCLEARCALIB</span><span class="p">,</span>  
    <span class="n">wxID_IMCOPYCONTROLS</span><span class="p">,</span> <span class="n">wxID_INTEGRATEALL</span><span class="p">,</span> <span class="n">wxID_IMSAVECONTROLS</span><span class="p">,</span> <span class="n">wxID_IMLOADCONTROLS</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_MASKCOPY</span><span class="p">,</span> <span class="n">wxID_MASKSAVE</span><span class="p">,</span> <span class="n">wxID_MASKLOAD</span><span class="p">,</span><span class="n">wxID_NEWMASKSPOT</span><span class="p">,</span><span class="n">wxID_NEWMASKARC</span><span class="p">,</span><span class="n">wxID_NEWMASKRING</span><span class="p">,</span>
    <span class="n">wxID_NEWMASKFRAME</span><span class="p">,</span> <span class="n">wxID_NEWMASKPOLY</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_STRSTACOPY</span><span class="p">,</span> <span class="n">wxID_STRSTAFIT</span><span class="p">,</span> <span class="n">wxID_STRSTASAVE</span><span class="p">,</span> <span class="n">wxID_STRSTALOAD</span><span class="p">,</span><span class="n">wxID_APPENDDZERO</span><span class="p">,</span>
    <span class="n">wxID_STRSTAALLFIT</span><span class="p">,</span><span class="n">wxID_UPDATEDZERO</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_BACKCOPY</span><span class="p">,</span><span class="n">wxID_LIMITCOPY</span><span class="p">,</span> <span class="n">wxID_SAMPLECOPY</span><span class="p">,</span> <span class="n">wxID_SAMPLECOPYSOME</span><span class="p">,</span> <span class="n">wxID_BACKFLAGCOPY</span><span class="p">,</span> <span class="n">wxID_SAMPLEFLAGCOPY</span><span class="p">,</span>
    <span class="n">wxID_SAMPLESAVE</span><span class="p">,</span> <span class="n">wxID_SAMPLELOAD</span><span class="p">,</span><span class="n">wxID_ADDEXCLREGION</span><span class="p">,</span><span class="n">wxID_SETSCALE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_INSTPRMRESET</span><span class="p">,</span><span class="n">wxID_CHANGEWAVETYPE</span><span class="p">,</span><span class="n">wxID_INSTCOPY</span><span class="p">,</span> <span class="n">wxID_INSTFLAGCOPY</span><span class="p">,</span> <span class="n">wxID_INSTLOAD</span><span class="p">,</span>
    <span class="n">wxID_INSTSAVE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_UNDO</span><span class="p">,</span><span class="n">wxID_LSQPEAKFIT</span><span class="p">,</span><span class="n">wxID_LSQONECYCLE</span><span class="p">,</span><span class="n">wxID_RESETSIGGAM</span><span class="p">,</span><span class="n">wxID_CLEARPEAKS</span><span class="p">,</span><span class="n">wxID_AUTOSEARCH</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>

<span class="p">[</span>  <span class="n">wxID_INDXRELOAD</span><span class="p">,</span> <span class="n">wxID_INDEXPEAKS</span><span class="p">,</span> <span class="n">wxID_REFINECELL</span><span class="p">,</span> <span class="n">wxID_COPYCELL</span><span class="p">,</span> <span class="n">wxID_MAKENEWPHASE</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_CONSTRAINTADD</span><span class="p">,</span><span class="n">wxID_EQUIVADD</span><span class="p">,</span><span class="n">wxID_HOLDADD</span><span class="p">,</span><span class="n">wxID_FUNCTADD</span><span class="p">,</span>
  <span class="n">wxID_CONSPHASE</span><span class="p">,</span> <span class="n">wxID_CONSHIST</span><span class="p">,</span> <span class="n">wxID_CONSHAP</span><span class="p">,</span> <span class="n">wxID_CONSGLOBAL</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_RESTRAINTADD</span><span class="p">,</span> <span class="n">wxID_RESTSELPHASE</span><span class="p">,</span><span class="n">wxID_RESTDELETE</span><span class="p">,</span> <span class="n">wxID_RESRCHANGEVAL</span><span class="p">,</span> 
    <span class="n">wxID_RESTCHANGEESD</span><span class="p">,</span><span class="n">wxID_AARESTRAINTADD</span><span class="p">,</span><span class="n">wxID_AARESTRAINTPLOT</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_RIGIDBODYADD</span><span class="p">,</span><span class="n">wxID_DRAWDEFINERB</span><span class="p">,</span><span class="n">wxID_RIGIDBODYIMPORT</span><span class="p">,</span><span class="n">wxID_RESIDUETORSSEQ</span><span class="p">,</span>
    <span class="n">wxID_AUTOFINDRESRB</span><span class="p">,</span><span class="n">wxID_GLOBALRESREFINE</span><span class="p">,</span><span class="n">wxID_RBREMOVEALL</span><span class="p">,</span><span class="n">wxID_COPYRBPARMS</span><span class="p">,</span>
    <span class="n">wxID_GLOBALTHERM</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_SAVESEQSEL</span><span class="p">,</span><span class="n">wxID_SAVESEQSELCSV</span><span class="p">,</span><span class="n">wxID_PLOTSEQSEL</span><span class="p">,</span>
  <span class="n">wxADDSEQVAR</span><span class="p">,</span><span class="n">wxDELSEQVAR</span><span class="p">,</span><span class="n">wxEDITSEQVAR</span><span class="p">,</span>
  <span class="n">wxADDPARFIT</span><span class="p">,</span><span class="n">wxDELPARFIT</span><span class="p">,</span><span class="n">wxEDITPARFIT</span><span class="p">,</span><span class="n">wxDOPARFIT</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_MODELCOPY</span><span class="p">,</span><span class="n">wxID_MODELFIT</span><span class="p">,</span><span class="n">wxID_MODELADD</span><span class="p">,</span><span class="n">wxID_ELEMENTADD</span><span class="p">,</span><span class="n">wxID_ELEMENTDELETE</span><span class="p">,</span>
    <span class="n">wxID_ADDSUBSTANCE</span><span class="p">,</span><span class="n">wxID_LOADSUBSTANCE</span><span class="p">,</span><span class="n">wxID_DELETESUBSTANCE</span><span class="p">,</span><span class="n">wxID_COPYSUBSTANCE</span><span class="p">,</span>
    <span class="n">wxID_MODELUNDO</span><span class="p">,</span><span class="n">wxID_MODELFITALL</span><span class="p">,</span><span class="n">wxID_MODELCOPYFLAGS</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">12</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_SELECTPHASE</span><span class="p">,</span><span class="n">wxID_PWDHKLPLOT</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">)]</span>

<span class="p">[</span> <span class="n">wxID_PDFCOPYCONTROLS</span><span class="p">,</span> <span class="n">wxID_PDFSAVECONTROLS</span><span class="p">,</span> <span class="n">wxID_PDFLOADCONTROLS</span><span class="p">,</span> 
    <span class="n">wxID_PDFCOMPUTE</span><span class="p">,</span> <span class="n">wxID_PDFCOMPUTEALL</span><span class="p">,</span> <span class="n">wxID_PDFADDELEMENT</span><span class="p">,</span> <span class="n">wxID_PDFDELELEMENT</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">7</span><span class="p">)]</span>

<span class="n">VERY_LIGHT_GREY</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Colour</span><span class="p">(</span><span class="mi">235</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">235</span><span class="p">)</span>
<span class="c">################################################################################</span>
<span class="c">#### GSAS-II class definitions</span>
<span class="c">################################################################################</span>
        
<div class="viewcode-block" id="ValidatedTxtCtrl"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ValidatedTxtCtrl">[docs]</a><span class="k">class</span> <span class="nc">ValidatedTxtCtrl</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create a TextCtrl widget that uses a validator to prevent the</span>
<span class="sd">    entry of inappropriate characters and changes color to highlight</span>
<span class="sd">    when invalid input is supplied. As valid values are typed,</span>
<span class="sd">    they are placed into the dict or list where the initial value</span>
<span class="sd">    came from. The type of the initial value must be int,</span>
<span class="sd">    float or str or None (see :obj:`key` and :obj:`typeHint`);</span>
<span class="sd">    this type (or the one in :obj:`typeHint`) is preserved.</span>

<span class="sd">    Float values can be entered in the TextCtrl as numbers or also</span>
<span class="sd">    as algebraic expressions using operators + - / \* () and \*\*,</span>
<span class="sd">    in addition pi, sind(), cosd(), tand(), and sqrt() can be used,</span>
<span class="sd">    as well as appreviations s, sin, c, cos, t, tan and sq. </span>

<span class="sd">    :param wx.Panel parent: name of panel or frame that will be</span>
<span class="sd">      the parent to the TextCtrl. Can be None.</span>

<span class="sd">    :param dict/list loc: the dict or list with the initial value to be</span>
<span class="sd">      placed in the TextCtrl. </span>

<span class="sd">    :param int/str key: the dict key or the list index for the value to be</span>
<span class="sd">      edited by the TextCtrl. The ``loc[key]`` element must exist, but may</span>
<span class="sd">      have value None. If None, the type for the element is taken from</span>
<span class="sd">      :obj:`typeHint` and the value for the control is set initially</span>
<span class="sd">      blank (and thus invalid.) This is a way to specify a field without a</span>
<span class="sd">      default value: a user must set a valid value. </span>
<span class="sd">      If the value is not None, it must have a base</span>
<span class="sd">      type of int, float, str or unicode; the TextCrtl will be initialized</span>
<span class="sd">      from this value.</span>
<span class="sd">      </span>
<span class="sd">    :param list nDig: number of digits &amp; places ([nDig,nPlc]) after decimal to use</span>
<span class="sd">      for display of float. Alternately, None can be specified which causes</span>
<span class="sd">      numbers to be displayed with approximately 5 significant figures</span>
<span class="sd">      (Default=None).</span>

<span class="sd">    :param bool notBlank: if True (default) blank values are invalid</span>
<span class="sd">      for str inputs.</span>
<span class="sd">      </span>
<span class="sd">    :param number min: minimum allowed valid value. If None (default) the</span>
<span class="sd">      lower limit is unbounded.</span>

<span class="sd">    :param number max: maximum allowed valid value. If None (default) the</span>
<span class="sd">      upper limit is unbounded</span>

<span class="sd">    :param function OKcontrol: specifies a function or method that will be</span>
<span class="sd">      called when the input is validated. The called function is supplied</span>
<span class="sd">      with one argument which is False if the TextCtrl contains an invalid</span>
<span class="sd">      value and True if the value is valid.</span>
<span class="sd">      Note that this function should check all values</span>
<span class="sd">      in the dialog when True, since other entries might be invalid.</span>
<span class="sd">      The default for this is None, which indicates no function should</span>
<span class="sd">      be called.</span>

<span class="sd">    :param function OnLeave: specifies a function or method that will be</span>
<span class="sd">      called when the focus for the control is lost.</span>
<span class="sd">      The called function is supplied with (at present) three keyword arguments:</span>

<span class="sd">         * invalid: (*bool*) True if the value for the TextCtrl is invalid</span>
<span class="sd">         * value:   (*int/float/str*)  the value contained in the TextCtrl</span>
<span class="sd">         * tc:      (*wx.TextCtrl*)  the TextCtrl name</span>

<span class="sd">      The number of keyword arguments may be increased in the future should needs arise,</span>
<span class="sd">      so it is best to code these functions with a \*\*kwargs argument so they will</span>
<span class="sd">      continue to run without errors</span>

<span class="sd">      The default for OnLeave is None, which indicates no function should</span>
<span class="sd">      be called.</span>

<span class="sd">    :param type typeHint: the value of typeHint is overrides the initial value</span>
<span class="sd">      for the dict/list element ``loc[key]``, if set to </span>
<span class="sd">      int or float, which specifies the type for input to the TextCtrl.</span>
<span class="sd">      Defaults as None, which is ignored.</span>

<span class="sd">    :param bool CIFinput: for str input, indicates that only printable</span>
<span class="sd">      ASCII characters may be entered into the TextCtrl. Forces output</span>
<span class="sd">      to be ASCII rather than Unicode. For float and int input, allows</span>
<span class="sd">      use of a single &#39;?&#39; or &#39;.&#39; character as valid input.</span>

<span class="sd">    :param dict OnLeaveArgs: a dict with keyword args that are passed to</span>
<span class="sd">      the :attr:`OnLeave` function. Defaults to ``{}``</span>

<span class="sd">    :param (other): other optional keyword parameters for the</span>
<span class="sd">      wx.TextCtrl widget such as Size or Style may be specified.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">loc</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">nDig</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">notBlank</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">OKcontrol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">OnLeave</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">typeHint</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">CIFinput</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">OnLeaveArgs</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># save passed values needed outside __init__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nDig</span> <span class="o">=</span> <span class="n">nDig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="o">=</span><span class="n">OKcontrol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnLeave</span> <span class="o">=</span> <span class="n">OnLeave</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnLeaveArgs</span> <span class="o">=</span> <span class="n">OnLeaveArgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span> <span class="o">=</span> <span class="n">CIFinput</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">str</span>
        <span class="c"># initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">False</span>   <span class="c"># indicates if the control has invalid contents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># set to True when the validator recognizes an expression</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="n">typeHint</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">int</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                <span class="n">validator</span><span class="o">=</span><span class="n">NumberValidator</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">result</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                          <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span>
                                          <span class="n">OKcontrol</span><span class="o">=</span><span class="n">OKcontrol</span><span class="p">,</span>
                                          <span class="n">CIFinput</span><span class="o">=</span><span class="n">CIFinput</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c"># no default is invalid for a number</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_IndicateValidity</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="n">typeHint</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="nb">float</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                <span class="n">validator</span><span class="o">=</span><span class="n">NumberValidator</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span><span class="n">result</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
                                          <span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span>
                                          <span class="n">OKcontrol</span><span class="o">=</span><span class="n">OKcontrol</span><span class="p">,</span>
                                          <span class="n">CIFinput</span><span class="o">=</span><span class="n">CIFinput</span><span class="p">),</span>
                <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_IndicateValidity</span><span class="p">()</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="nb">unicode</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">val</span><span class="p">,</span>
                    <span class="n">validator</span><span class="o">=</span><span class="n">ASCIIValidator</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">),</span>
                    <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">notBlank</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onStringKey</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ShowStringValidity</span><span class="p">()</span> <span class="c"># test if valid input</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_GetStringValue</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,(</span><span class="s">&quot;ValidatedTxtCtrl error: value of &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span>
                             <span class="s">&quot; element is None and typeHint not defined as int or float&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,(</span><span class="s">&quot;ValidatedTxtCtrl error: Unknown element (&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">+</span>
                             <span class="s">&quot;) type: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">val</span><span class="p">)))</span>
        <span class="c"># When the mouse is moved away or the widget loses focus,</span>
        <span class="c"># display the last saved value, if an expression</span>
<span class="c">#        self.Bind(wx.EVT_LEAVE_WINDOW, self._onLeaveWindow) #leads to weird behavior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLoseFocus</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onLoseFocus</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># note that this bypasses formatting</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_setValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">val</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">!=</span> <span class="n">val</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s">&#39;?&#39;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span> <span class="ow">and</span> <span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="s">&#39;?&#39;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">):</span>
                    <span class="k">pass</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nDig</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">G2py3</span><span class="o">.</span><span class="n">FormatValue</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">nDig</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">G2py3</span><span class="o">.</span><span class="n">FormatSigFigs</span><span class="p">(</span><span class="n">val</span><span class="p">))</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ShowStringValidity</span><span class="p">()</span> <span class="c"># test if valid input</span>
            <span class="k">return</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_IndicateValidity</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_onStringKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span> <span class="c"># check for validity after processing the keystroke</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ShowStringValidity</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> <span class="c"># was invalid</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ShowStringValidity</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span> <span class="c"># was valid</span>

    <span class="k">def</span> <span class="nf">_IndicateValidity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Set the control colors to show invalid input&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># valid input</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">SystemSettings_GetColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">SYS_COLOUR_WINDOW</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>

<div class="viewcode-block" id="ValidatedTxtCtrl.ShowStringValidity"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ValidatedTxtCtrl.ShowStringValidity">[docs]</a>    <span class="k">def</span> <span class="nf">ShowStringValidity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">previousInvalid</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check if input is valid. Anytime the input is</span>
<span class="sd">        invalid, call self.OKcontrol (if defined) because it is fast.</span>
<span class="sd">        If valid, check for any other invalid entries only when</span>
<span class="sd">        changing from invalid to valid, since that is slower.</span>
<span class="sd">        </span>
<span class="sd">        :param bool previousInvalid: True if the TextCtrl contents were</span>
<span class="sd">          invalid prior to the current change.</span>
<span class="sd">          </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_IndicateValidity</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span> <span class="ow">and</span> <span class="n">previousInvalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="c"># always store the result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">:</span> <span class="c"># for CIF make results ASCII</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</div>
    <span class="k">def</span> <span class="nf">_GetStringValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Get string input and store.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span> <span class="c"># process keystroke</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SaveStringValue</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">_SaveStringValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="c"># always store the result</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">:</span> <span class="c"># for CIF make results ASCII</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span><span class="s">&#39;replace&#39;</span><span class="p">)</span> 
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>

    <span class="k">def</span> <span class="nf">_onLoseFocus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EvaluateExpression</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># show formatted result, as Bob wants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnLeave</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnLeave</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">,</span>
                                      <span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">],</span>
                                      <span class="n">tc</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span>
                                      <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">OnLeaveArgs</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onLeaveWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">EvaluateExpression</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># show formatted result, as Bob wants</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>

<div class="viewcode-block" id="ValidatedTxtCtrl.EvaluateExpression"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ValidatedTxtCtrl.EvaluateExpression">[docs]</a>    <span class="k">def</span> <span class="nf">EvaluateExpression</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Show the computed value when an expression is entered to the TextCtrl</span>
<span class="sd">        Make sure that the number fits by truncating decimal places and switching</span>
<span class="sd">        to scientific notation, as needed. </span>
<span class="sd">        Called on loss of focus.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span> <span class="k">return</span> <span class="c"># don&#39;t substitute for an invalid expression</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span><span class="p">:</span> <span class="k">return</span> <span class="c"># true when an expression is evaluated</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># retrieve the stored result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># expression has been recast as value, reset flag</span>
        </div></div>
<div class="viewcode-block" id="NumberValidator"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator">[docs]</a><span class="k">class</span> <span class="nc">NumberValidator</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A validator to be used with a TextCtrl to prevent</span>
<span class="sd">    entering characters other than digits, signs, and for float</span>
<span class="sd">    input, a period and exponents.</span>
<span class="sd">    </span>
<span class="sd">    The value is checked for validity after every keystroke</span>
<span class="sd">      If an invalid number is entered, the box is highlighted.</span>
<span class="sd">      If the number is valid, it is saved in result[key]</span>

<span class="sd">    :param type typ: the base data type. Must be int or float.</span>

<span class="sd">    :param bool positiveonly: If True, negative integers are not allowed</span>
<span class="sd">      (default False). This prevents the + or - keys from being pressed.</span>
<span class="sd">      Used with typ=int; ignored for typ=float.</span>

<span class="sd">    :param number min: Minimum allowed value. If None (default) the</span>
<span class="sd">      lower limit is unbounded</span>

<span class="sd">    :param number max: Maximum allowed value. If None (default) the</span>
<span class="sd">      upper limit is unbounded</span>
<span class="sd">      </span>
<span class="sd">    :param dict/list result: List or dict where value should be placed when valid</span>

<span class="sd">    :param any key: key to use for result (int for list)</span>

<span class="sd">    :param function OKcontrol: function or class method to control</span>
<span class="sd">      an OK button for a window. </span>
<span class="sd">      Ignored if None (default)</span>

<span class="sd">    :param bool CIFinput: allows use of a single &#39;?&#39; or &#39;.&#39; character</span>
<span class="sd">      as valid input.</span>
<span class="sd">      </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">positiveonly</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">OKcontrol</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">CIFinput</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">&#39;Create the validator&#39;</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># save passed parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">positiveonly</span> <span class="o">=</span> <span class="n">positiveonly</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span> <span class="o">=</span> <span class="n">OKcontrol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span> <span class="o">=</span> <span class="n">CIFinput</span>
        <span class="c"># set allowed keys by data type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnChar</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">positiveonly</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">=</span> <span class="s">&#39;0123456789&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">=</span> <span class="s">&#39;0123456789+-&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="o">==</span> <span class="nb">float</span><span class="p">:</span>
            <span class="c"># allow for above and sind, cosd, sqrt, tand, pi, and abbreviations</span>
            <span class="c"># also addition, subtraction, division, multiplication, exponentiation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">=</span> <span class="s">&#39;0123456789.-+eE/cosindcqrtap()*&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">+=</span> <span class="s">&#39;?.&#39;</span>
<div class="viewcode-block" id="NumberValidator.Clone"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.Clone">[docs]</a>    <span class="k">def</span> <span class="nf">Clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Create a copy of the validator, a strange, but required component&#39;</span>
        <span class="k">return</span> <span class="n">NumberValidator</span><span class="p">(</span><span class="n">typ</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">,</span> 
                               <span class="n">positiveonly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">positiveonly</span><span class="p">,</span>
                               <span class="nb">min</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">,</span>
                               <span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">,</span>
                               <span class="n">OKcontrol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">,</span>
                               <span class="n">CIFinput</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">)</span></div>
<div class="viewcode-block" id="NumberValidator.TransferToWindow"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.TransferToWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferToWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Needed by validator, strange, but required component&#39;</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># Prevent wxDialog from complaining.</span></div>
<div class="viewcode-block" id="NumberValidator.TransferFromWindow"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.TransferFromWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferFromWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Needed by validator, strange, but required component&#39;</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># Prevent wxDialog from complaining.</span></div>
<div class="viewcode-block" id="NumberValidator.TestValid"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.TestValid">[docs]</a>    <span class="k">def</span> <span class="nf">TestValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check if the value is valid by casting the input string</span>
<span class="sd">        into the current type.</span>

<span class="sd">        Set the invalid variable in the TextCtrl object accordingly.</span>

<span class="sd">        If the value is valid, save it in the dict/list where</span>
<span class="sd">        the initial value was stored, if appropriate. </span>

<span class="sd">        :param wx.TextCtrl tc: A reference to the TextCtrl that the validator</span>
<span class="sd">          is associated with.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># assume valid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">CIFinput</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="s">&#39;?&#39;</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">SyntaxError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">typ</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span> <span class="c"># for float values, see if an expression can be evaluated</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">G2py3</span><span class="o">.</span><span class="n">FormulaEval</span><span class="p">(</span><span class="n">tc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tc</span><span class="o">.</span><span class="n">evaluated</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span> 
                <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="k">return</span>
        <span class="c"># if self.max != None and self.typ == int:</span>
        <span class="c">#     if val &gt; self.max:</span>
        <span class="c">#         tc.invalid = True</span>
        <span class="c"># if self.min != None and self.typ == int:</span>
        <span class="c">#     if val &lt; self.min:</span>
        <span class="c">#         tc.invalid = True  # invalid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">max</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">min</span><span class="p">:</span>
                <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">True</span>  <span class="c"># invalid</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
</div>
<div class="viewcode-block" id="NumberValidator.ShowValidity"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.ShowValidity">[docs]</a>    <span class="k">def</span> <span class="nf">ShowValidity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set the control colors to show invalid input</span>

<span class="sd">        :param wx.TextCtrl tc: A reference to the TextCtrl that the validator</span>
<span class="sd">          is associated with.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="s">&quot;yellow&quot;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># valid input</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">SystemSettings_GetColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">SYS_COLOUR_WINDOW</span><span class="p">))</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">SetForegroundColour</span><span class="p">(</span><span class="s">&quot;black&quot;</span><span class="p">)</span>
            <span class="n">tc</span><span class="o">.</span><span class="n">Refresh</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
</div>
<div class="viewcode-block" id="NumberValidator.CheckInput"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.CheckInput">[docs]</a>    <span class="k">def</span> <span class="nf">CheckInput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">previousInvalid</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;called to test every change to the TextCtrl for validity and</span>
<span class="sd">        to change the appearance of the TextCtrl</span>

<span class="sd">        Anytime the input is invalid, call self.OKcontrol</span>
<span class="sd">        (if defined) because it is fast. </span>
<span class="sd">        If valid, check for any other invalid entries only when</span>
<span class="sd">        changing from invalid to valid, since that is slower.</span>

<span class="sd">        :param bool previousInvalid: True if the TextCtrl contents were</span>
<span class="sd">          invalid prior to the current change.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TestValid</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ShowValidity</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
        <span class="c"># if invalid</span>
        <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span> <span class="ow">and</span> <span class="n">previousInvalid</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKcontrol</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="NumberValidator.OnChar"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.NumberValidator.OnChar">[docs]</a>    <span class="k">def</span> <span class="nf">OnChar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called each type a key is pressed</span>
<span class="sd">        ignores keys that are not allowed for int and float types</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_RETURN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span> 
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_SPACE</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DELETE</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span> <span class="c"># control characters get processed</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span> 
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span><span class="p">:</span> <span class="c"># valid char pressed?</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">CheckInput</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span> 
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wx</span><span class="o">.</span><span class="n">Validator_IsSilent</span><span class="p">():</span> <span class="n">wx</span><span class="o">.</span><span class="n">Bell</span><span class="p">()</span>
        <span class="k">return</span>  <span class="c"># Returning without calling event.Skip, which eats the keystroke</span>

<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="ASCIIValidator"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator">[docs]</a><span class="k">class</span> <span class="nc">ASCIIValidator</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A validator to be used with a TextCtrl to prevent</span>
<span class="sd">    entering characters other than ASCII characters.</span>
<span class="sd">    </span>
<span class="sd">    The value is checked for validity after every keystroke</span>
<span class="sd">      If an invalid number is entered, the box is highlighted.</span>
<span class="sd">      If the number is valid, it is saved in result[key]</span>

<span class="sd">    :param dict/list result: List or dict where value should be placed when valid</span>

<span class="sd">    :param any key: key to use for result (int for list)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">result</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">&#39;Create the validator&#39;</span>
        <span class="kn">import</span> <span class="nn">string</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">PyValidator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c"># save passed parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span> <span class="o">=</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_letters</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">punctuation</span> <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">whitespace</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnChar</span><span class="p">)</span>
<div class="viewcode-block" id="ASCIIValidator.Clone"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator.Clone">[docs]</a>    <span class="k">def</span> <span class="nf">Clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Create a copy of the validator, a strange, but required component&#39;</span>
        <span class="k">return</span> <span class="n">ASCIIValidator</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">)</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span>
        <span class="n">tc</span><span class="o">.</span><span class="n">invalid</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># make sure the validity flag is defined in parent</span></div>
<div class="viewcode-block" id="ASCIIValidator.TransferToWindow"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator.TransferToWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferToWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Needed by validator, strange, but required component&#39;</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># Prevent wxDialog from complaining.</span></div>
<div class="viewcode-block" id="ASCIIValidator.TransferFromWindow"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator.TransferFromWindow">[docs]</a>    <span class="k">def</span> <span class="nf">TransferFromWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Needed by validator, strange, but required component&#39;</span>
        <span class="k">return</span> <span class="bp">True</span> <span class="c"># Prevent wxDialog from complaining.</span></div>
<div class="viewcode-block" id="ASCIIValidator.TestValid"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator.TestValid">[docs]</a>    <span class="k">def</span> <span class="nf">TestValid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check if the value is valid by casting the input string</span>
<span class="sd">        into ASCII. </span>

<span class="sd">        Save it in the dict/list where the initial value was stored</span>

<span class="sd">        :param wx.TextCtrl tc: A reference to the TextCtrl that the validator</span>
<span class="sd">          is associated with.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">tc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">,</span><span class="s">&#39;replace&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="ASCIIValidator.OnChar"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ASCIIValidator.OnChar">[docs]</a>    <span class="k">def</span> <span class="nf">OnChar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called each type a key is pressed</span>
<span class="sd">        ignores keys that are not allowed for int and float types</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="n">tc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetWindow</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_RETURN</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TestValid</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_SPACE</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DELETE</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span> <span class="c"># control characters get processed</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TestValid</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">elif</span> <span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validchars</span><span class="p">:</span> <span class="c"># valid char pressed?</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">TestValid</span><span class="p">(</span><span class="n">tc</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">wx</span><span class="o">.</span><span class="n">Validator_IsSilent</span><span class="p">():</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Bell</span><span class="p">()</span>
        <span class="k">return</span>  <span class="c"># Returning without calling event.Skip, which eats the keystroke</span>
<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="EnumSelector"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.EnumSelector">[docs]</a><span class="k">class</span> <span class="nc">EnumSelector</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A customized :class:`wxpython.ComboBox` that selects items from a list</span>
<span class="sd">    of choices, but sets a dict (list) entry to the corresponding</span>
<span class="sd">    entry from the input list of values.</span>

<span class="sd">    :param wx.Panel parent: the parent to the :class:`~wxpython.ComboBox` (usually a</span>
<span class="sd">      frame or panel)</span>
<span class="sd">    :param dict dct: a dict (or list) to contain the value set</span>
<span class="sd">      for the :class:`~wxpython.ComboBox`.</span>
<span class="sd">    :param item: the dict key (or list index) where ``dct[item]`` will </span>
<span class="sd">      be set to the value selected in the :class:`~wxpython.ComboBox`. Also, dct[item]</span>
<span class="sd">      contains the starting value shown in the widget. If the value</span>
<span class="sd">      does not match an entry in :data:`values`, the first value</span>
<span class="sd">      in :data:`choices` is used as the default, but ``dct[item]`` is</span>
<span class="sd">      not changed.    </span>
<span class="sd">    :param list choices: a list of choices to be displayed to the</span>
<span class="sd">      user such as</span>
<span class="sd">      ::</span>
<span class="sd">      </span>
<span class="sd">      [&quot;default&quot;,&quot;option 1&quot;,&quot;option 2&quot;,]</span>

<span class="sd">      Note that these options will correspond to the entries in </span>
<span class="sd">      :data:`values` (if specified) item by item. </span>
<span class="sd">    :param list values: a list of values that correspond to</span>
<span class="sd">      the options in :data:`choices`, such as</span>
<span class="sd">      ::</span>
<span class="sd">      </span>
<span class="sd">      [0,1,2]</span>
<span class="sd">      </span>
<span class="sd">      The default for :data:`values` is to use the same list as</span>
<span class="sd">      specified for :data:`choices`.</span>
<span class="sd">    :param (other): additional keyword arguments accepted by</span>
<span class="sd">      :class:`~wxpython.ComboBox` can be specified.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">dct</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">choices</span><span class="p">,</span><span class="n">values</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="k">if</span> <span class="n">dct</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">startval</span> <span class="o">=</span> <span class="n">choices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">startval</span><span class="p">,</span>
                             <span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span><span class="p">,</span>
                             <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="o">=</span> <span class="n">values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dct</span> <span class="o">=</span> <span class="n">dct</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSelection</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">onSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="c"># respond to a selection by setting the enum value in the CIF dictionary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">:</span> <span class="c"># should always be true!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dct</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dct</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c"># unknown</span>

<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="G2CheckBox"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2CheckBox">[docs]</a><span class="k">class</span> <span class="nc">G2CheckBox</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A customized version of a CheckBox that automatically initializes</span>
<span class="sd">    the control to a supplied list or dict entry and updates that</span>
<span class="sd">    entry as the widget is used.</span>

<span class="sd">    :param wx.Panel parent: name of panel or frame that will be</span>
<span class="sd">      the parent to the widget. Can be None.</span>
<span class="sd">    :param str label: text to put on check button</span>
<span class="sd">    :param dict/list loc: the dict or list with the initial value to be</span>
<span class="sd">      placed in the CheckBox. </span>
<span class="sd">    :param int/str key: the dict key or the list index for the value to be</span>
<span class="sd">      edited by the CheckBox. The ``loc[key]`` element must exist.</span>
<span class="sd">      The CheckBox will be initialized from this value.</span>
<span class="sd">      If the value is anything other that True (or 1), it will be taken as</span>
<span class="sd">      False. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">loc</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span><span class="o">==</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OnCheckBox</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_OnCheckBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="G2ChoiceButton"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2ChoiceButton">[docs]</a><span class="k">class</span> <span class="nc">G2ChoiceButton</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A customized version of a wx.Choice that automatically initializes</span>
<span class="sd">    the control to match a supplied value and saves the choice directly</span>
<span class="sd">    into an array or list. Optionally a function can be called each time a</span>
<span class="sd">    choice is selected. </span>

<span class="sd">    :param wx.Panel parent: name of panel or frame that will be</span>
<span class="sd">      the parent to the widget. Can be None.</span>
<span class="sd">    :param list choiceList: a list or tuple of choices to offer the user.</span>
<span class="sd">    :param dict/list indLoc: a dict or list with the initial value to be</span>
<span class="sd">      placed in the Choice button. </span>
<span class="sd">    :param int/str indKey: the dict key or the list index for the value to be</span>
<span class="sd">      edited by the Choice button. The ``indLoc[indKey]`` element must exist.</span>
<span class="sd">      The value for this should be None or an integer in range(len(choiceList)).</span>
<span class="sd">      The Choice button will be initialized to the choice corresponding to the</span>
<span class="sd">      value in this element if not None.</span>
<span class="sd">    :param dict/list strLoc: a dict or list with the string value corresponding to</span>
<span class="sd">      indLoc/indKey. Default (None) means that this is not used. </span>
<span class="sd">    :param int/str strKey: the dict key or the list index for the string value </span>
<span class="sd">      The ``strLoc[strKey]`` element must exist or strLoc must be None (default).</span>
<span class="sd">    :param function onChoice: name of a   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">choiceList</span><span class="p">,</span><span class="n">indLoc</span><span class="p">,</span><span class="n">indKey</span><span class="p">,</span><span class="n">strLoc</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">strKey</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">onChoice</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Choice</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">choiceList</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choiceList</span> <span class="o">=</span> <span class="n">choiceList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indLoc</span> <span class="o">=</span> <span class="n">indLoc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indKey</span> <span class="o">=</span> <span class="n">indKey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strLoc</span> <span class="o">=</span> <span class="n">strLoc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strKey</span> <span class="o">=</span> <span class="n">strKey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onChoice</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indLoc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indKey</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indLoc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indKey</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">NOT_FOUND</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHOICE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OnChoice</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strLoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="c"># make sure strLoc gets initialized</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_OnChoice</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># note that onChoice will not be called</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onChoice</span> <span class="o">=</span> <span class="n">onChoice</span>
    <span class="k">def</span> <span class="nf">_OnChoice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indLoc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indKey</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">strLoc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">strLoc</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">strKey</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetStringSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">onChoice</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">onChoice</span><span class="p">()</span>
<span class="c">################################################################################    </span></div>
<div class="viewcode-block" id="CallScrolledMultiEditor"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.CallScrolledMultiEditor">[docs]</a><span class="k">def</span> <span class="nf">CallScrolledMultiEditor</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">dictlst</span><span class="p">,</span><span class="n">elemlst</span><span class="p">,</span><span class="n">prelbl</span><span class="o">=</span><span class="p">[],</span><span class="n">postlbl</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit items&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">250</span><span class="p">),</span>
                             <span class="n">CopyButton</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Shell routine to call a ScrolledMultiEditor dialog. See</span>
<span class="sd">    :class:`ScrolledMultiEditor` for parameter definitions.</span>

<span class="sd">    :returns: True if the OK button is pressed; False if the window is closed</span>
<span class="sd">      with the system menu or the Cancel button.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">dlg</span> <span class="o">=</span> <span class="n">ScrolledMultiEditor</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">dictlst</span><span class="p">,</span><span class="n">elemlst</span><span class="p">,</span><span class="n">prelbl</span><span class="p">,</span><span class="n">postlbl</span><span class="p">,</span>
                              <span class="n">title</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="n">size</span><span class="p">,</span>
                              <span class="n">CopyButton</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="ScrolledMultiEditor"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ScrolledMultiEditor">[docs]</a><span class="k">class</span> <span class="nc">ScrolledMultiEditor</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Define a window for editing a potentially large number of dict- or</span>
<span class="sd">    list-contained values with validation for each item. Edited values are</span>
<span class="sd">    automatically placed in their source location. If invalid entries</span>
<span class="sd">    are provided, the TextCtrl is turned yellow and the OK button is disabled.</span>

<span class="sd">    The type for each TextCtrl validation is determined by the</span>
<span class="sd">    initial value of the entry (int, float or string). </span>
<span class="sd">    Float values can be entered in the TextCtrl as numbers or also</span>
<span class="sd">    as algebraic expressions using operators + - / \* () and \*\*,</span>
<span class="sd">    in addition pi, sind(), cosd(), tand(), and sqrt() can be used,</span>
<span class="sd">    as well as appreviations s(), sin(), c(), cos(), t(), tan() and sq(). </span>

<span class="sd">    :param wx.Frame parent: name of parent window, or may be None</span>

<span class="sd">    :param tuple dictlst: a list of dicts or lists containing values to edit</span>

<span class="sd">    :param tuple elemlst: a list of keys for each item in a dictlst. Must have the</span>
<span class="sd">      same length as dictlst.</span>

<span class="sd">    :param wx.Frame parent: name of parent window, or may be None</span>
<span class="sd">    </span>
<span class="sd">    :param tuple prelbl: a list of labels placed before the TextCtrl for each</span>
<span class="sd">      item (optional)</span>
<span class="sd">   </span>
<span class="sd">    :param tuple postlbl: a list of labels placed after the TextCtrl for each</span>
<span class="sd">      item (optional)</span>

<span class="sd">    :param str title: a title to place in the frame of the dialog</span>

<span class="sd">    :param str header: text to place at the top of the window. May contain</span>
<span class="sd">      new line characters. </span>

<span class="sd">    :param wx.Size size: a size parameter that dictates the</span>
<span class="sd">      size for the scrolled region of the dialog. The default is</span>
<span class="sd">      (300,250). </span>

<span class="sd">    :param bool CopyButton: if True adds a small button that copies the</span>
<span class="sd">      value for the current row to all fields below (default is False)</span>
<span class="sd">      </span>
<span class="sd">    :param list minvals: optional list of minimum values for validation</span>
<span class="sd">      of float or int values. Ignored if value is None.</span>
<span class="sd">    :param list maxvals: optional list of maximum values for validation</span>
<span class="sd">      of float or int values. Ignored if value is None.</span>
<span class="sd">    :param list sizevals: optional list of wx.Size values for each input</span>
<span class="sd">      widget. Ignored if value is None.</span>
<span class="sd">    :returns: the wx.Dialog created here. Use method .ShowModal() to display it.</span>
<span class="sd">    </span>
<span class="sd">    *Example for use of ScrolledMultiEditor:*</span>

<span class="sd">    ::</span>

<span class="sd">        dlg = &lt;pkg&gt;.ScrolledMultiEditor(frame,dictlst,elemlst,prelbl,postlbl,</span>
<span class="sd">                                        header=header)</span>
<span class="sd">        if dlg.ShowModal() == wx.ID_OK:</span>
<span class="sd">             for d,k in zip(dictlst,elemlst):</span>
<span class="sd">                 print d[k]</span>

<span class="sd">    *Example definitions for dictlst and elemlst:*</span>

<span class="sd">    ::</span>
<span class="sd">      </span>
<span class="sd">          dictlst = (dict1,list1,dict1,list1)</span>
<span class="sd">          elemlst = (&#39;a&#39;, 1, 2, 3)</span>

<span class="sd">      This causes items dict1[&#39;a&#39;], list1[1], dict1[2] and list1[3] to be edited.</span>
<span class="sd">    </span>
<span class="sd">    Note that these items must have int, float or str values assigned to</span>
<span class="sd">    them. The dialog will force these types to be retained. String values</span>
<span class="sd">    that are blank are marked as invalid. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">dictlst</span><span class="p">,</span><span class="n">elemlst</span><span class="p">,</span><span class="n">prelbl</span><span class="o">=</span><span class="p">[],</span><span class="n">postlbl</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit items&#39;</span><span class="p">,</span><span class="n">header</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">250</span><span class="p">),</span>
                 <span class="n">CopyButton</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">minvals</span><span class="o">=</span><span class="p">[],</span><span class="n">maxvals</span><span class="o">=</span><span class="p">[],</span><span class="n">sizevals</span><span class="o">=</span><span class="p">[]):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dictlst</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">elemlst</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span><span class="s">&quot;ScrolledMultiEditor error: len(dictlst) != len(elemlst) &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dictlst</span><span class="p">))</span><span class="o">+</span><span class="s">&quot; != &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elemlst</span><span class="p">))</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="c"># create dialog &amp; sizer</span>
            <span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">title</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictlst</span> <span class="o">=</span> <span class="n">dictlst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elemlst</span> <span class="o">=</span> <span class="n">elemlst</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ButtonIndex</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">dictlst</span><span class="p">,</span><span class="n">elemlst</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">orig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="c"># add a header if supplied</span>
        <span class="k">if</span> <span class="n">header</span><span class="p">:</span>
            <span class="n">subSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">header</span><span class="p">))</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">subSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># make OK button now, because we will need it for validation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
        <span class="c"># create scrolled panel and sizer</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">wxscroll</span><span class="o">.</span><span class="n">ScrolledPanel</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TAB_TRAVERSAL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">if</span> <span class="n">CopyButton</span><span class="p">:</span> <span class="n">cols</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">subSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">dictlst</span><span class="p">),</span><span class="n">cols</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span><span class="n">hgap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">vgap</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ValidatedControlsList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># make list of TextCtrls</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">d</span><span class="p">,</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">dictlst</span><span class="p">,</span><span class="n">elemlst</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prelbl</span><span class="p">):</span> <span class="c"># label before TextCtrl, or put in a blank</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> 
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">prelbl</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
            <span class="n">kargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">minvals</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">minvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">kargs</span><span class="p">[</span><span class="s">&#39;min&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">minvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">maxvals</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">maxvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">kargs</span><span class="p">[</span><span class="s">&#39;max&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">maxvals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sizevals</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">sizevals</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">kargs</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">sizevals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">CopyButton</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">wx.lib.colourselect</span> <span class="kn">as</span> <span class="nn">wscs</span>
                <span class="n">but</span> <span class="o">=</span> <span class="n">wscs</span><span class="o">.</span><span class="n">ColourSelect</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;v&#39;</span><span class="p">,</span> <span class="c"># would like to use u&#39;\u2193&#39; or u&#39;\u25BC&#39; but not in WinXP</span>
                                        <span class="c"># is there a way to test? </span>
                                        <span class="n">parent</span><span class="o">=</span><span class="n">panel</span><span class="p">,</span>
                                        <span class="n">colour</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">200</span><span class="p">),</span>
                                        <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">23</span><span class="p">),</span>
                                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">RAISED_BORDER</span><span class="p">)</span>
                <span class="n">but</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_OnCopyButton</span><span class="p">)</span>
                <span class="n">but</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&#39;Press to copy adjacent value to all rows below&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ButtonIndex</span><span class="p">[</span><span class="n">but</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>
            <span class="c"># create the validated TextCrtl, store it and add it to the sizer</span>
            <span class="n">ctrl</span> <span class="o">=</span> <span class="n">ValidatedTxtCtrl</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">OKcontrol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ControlOKButton</span><span class="p">,</span>
                                    <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ValidatedControlsList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ctrl</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">postlbl</span><span class="p">):</span> <span class="c"># label after TextCtrl, or put in a blank</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">postlbl</span><span class="p">[</span><span class="n">i</span><span class="p">])))</span>
        <span class="c"># finish up ScrolledPanel</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">subSizer</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetAutoLayout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># Sizer for OK/Close buttons. N.B. on Close changes are discarded</span>
        <span class="c"># by restoring the initial values</span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CLOSE</span><span class="p">,</span><span class="s">&quot;Cancel&quot;</span><span class="p">)</span> 
        <span class="n">btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onClose</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c"># size out the window. Set it to be enlarged but not made smaller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_OnCopyButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Implements the copy down functionality&#39;</span>
        <span class="n">but</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ButtonIndex</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">d</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">ctrl</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dictlst</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlst</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ValidatedControlsList</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">continue</span>
            <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">ctrl</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Restore original values &amp; close the window&#39;</span>
        <span class="k">for</span> <span class="n">d</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dictlst</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">elemlst</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">orig</span><span class="p">):</span>
            <span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
        
<div class="viewcode-block" id="ScrolledMultiEditor.ControlOKButton"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ScrolledMultiEditor.ControlOKButton">[docs]</a>    <span class="k">def</span> <span class="nf">ControlOKButton</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">setvalue</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Enable or Disable the OK button for the dialog. Note that this is</span>
<span class="sd">        passed into the ValidatedTxtCtrl for use by validators.</span>

<span class="sd">        :param bool setvalue: if True, all entries in the dialog are</span>
<span class="sd">          checked for validity. if False then the OK button is disabled.</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">setvalue</span><span class="p">:</span> <span class="c"># turn button on, do only if all controls show as valid</span>
            <span class="k">for</span> <span class="n">ctrl</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ValidatedControlsList</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">ctrl</span><span class="o">.</span><span class="n">invalid</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>
                    <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Enable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Disable</span><span class="p">()</span>

<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="SymOpDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SymOpDialog">[docs]</a><span class="k">class</span> <span class="nc">SymOpDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Class to select a symmetry operator</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">New</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">ForceUnit</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Select symmetry operator&#39;</span><span class="p">,</span>
            <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SGData</span> <span class="o">=</span> <span class="n">SGData</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">New</span> <span class="o">=</span> <span class="n">New</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Force</span> <span class="o">=</span> <span class="n">ForceUnit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="bp">False</span><span class="p">,</span><span class="bp">False</span><span class="p">]</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ForceUnit</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;No&#39;</span><span class="p">,</span><span class="s">&#39;Yes&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Force to unit cell?&#39;</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">choice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGInv&#39;</span><span class="p">]:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;No&#39;</span><span class="p">,</span><span class="s">&#39;Yes&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Choose inversion?&#39;</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">choice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLatt&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
            <span class="n">LattOp</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">Latt2text</span><span class="p">(</span><span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLatt&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;;&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Choose cell centering?&#39;</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">LattOp</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">latt</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">latt</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;-1&#39;</span><span class="p">,</span><span class="s">&#39;2/m&#39;</span><span class="p">,</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
            <span class="n">Ncol</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ncol</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">OpList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">M</span><span class="p">,</span><span class="n">T</span> <span class="ow">in</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGOps&#39;</span><span class="p">]:</span>
            <span class="n">OpList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">G2spc</span><span class="o">.</span><span class="n">MT2text</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">T</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oprs</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Choose space group operator?&#39;</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">OpList</span><span class="p">,</span>
            <span class="n">majorDimension</span><span class="o">=</span><span class="n">Ncol</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oprs</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">oprs</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;   Choose unit cell?&quot;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cellSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">cellSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cellName</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;X&#39;</span><span class="p">,</span><span class="s">&#39;Y&#39;</span><span class="p">,</span><span class="s">&#39;Z&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cell</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">cellName</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">20</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetRange</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
            <span class="n">cellSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cellSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">New</span><span class="p">:</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;No&#39;</span><span class="p">,</span><span class="s">&#39;Yes&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">RadioBox</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Generate new positions?&#39;</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">choice</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_RADIOBOX</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOpSelect</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
        <span class="n">cancelBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Cancel&quot;</span><span class="p">)</span>
        <span class="n">cancelBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCancel</span><span class="p">)</span>
        <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">cancelBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">OnOpSelect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGInv&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">inv</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLatt&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;P&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">latt</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">oprs</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">New</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">new</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Force</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">force</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">OpSelected</span>

    <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="DisAglDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DisAglDialog">[docs]</a><span class="k">class</span> <span class="nc">DisAglDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Distance/Angle Controls input dialog. After</span>
<span class="sd">    :meth:`ShowModal` returns, the results are found in</span>
<span class="sd">    dict :attr:`self.data`, which is accessed using :meth:`GetData`.</span>

<span class="sd">    :param wx.Frame parent: reference to parent frame (or None)</span>
<span class="sd">    :param dict data: a dict containing the current</span>
<span class="sd">      search ranges or an empty dict, which causes default values</span>
<span class="sd">      to be used.</span>
<span class="sd">      Will be used to set element `DisAglCtls` in </span>
<span class="sd">      :ref:`Phase Tree Item &lt;Phase_table&gt;`</span>
<span class="sd">    :param dict default:  A dict containing the default</span>
<span class="sd">      search ranges for each element.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">default</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                           <span class="s">&#39;Distance Angle Controls&#39;</span><span class="p">,</span> 
            <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span> <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>         <span class="c">#just a dummy - gets destroyed in Draw!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">_default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">default</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set starting values for the search values, either from</span>
<span class="sd">        the input array or from defaults, if input is null</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="c"># don&#39;t mess with originals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Factors&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.85</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;BondRadii&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="p">[</span><span class="s">&#39;BondRadii&#39;</span><span class="p">][:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;AngleRadii&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span><span class="p">[</span><span class="s">&#39;AngleRadii&#39;</span><span class="p">][:]</span>

<div class="viewcode-block" id="DisAglDialog.Draw"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DisAglDialog.Draw">[docs]</a>    <span class="k">def</span> <span class="nf">Draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creates the contents of the dialog. Normally called</span>
<span class="sd">        by :meth:`__init__`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Controls for phase &#39;</span><span class="o">+</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Name&#39;</span><span class="p">]),</span>
            <span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">radiiSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39; Type&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Bond radii&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Angle radii&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">objList</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;AtomTypes&#39;</span><span class="p">]):</span>
            <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39; &#39;</span><span class="o">+</span><span class="n">item</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">bRadii</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;BondRadii&#39;</span><span class="p">][</span><span class="nb">id</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objList</span><span class="p">[</span><span class="n">bRadii</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;BondRadii&#39;</span><span class="p">,</span><span class="nb">id</span><span class="p">]</span>
            <span class="n">bRadii</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">bRadii</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">bRadii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">aRadii</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;AngleRadii&#39;</span><span class="p">][</span><span class="nb">id</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objList</span><span class="p">[</span><span class="n">aRadii</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;AngleRadii&#39;</span><span class="p">,</span><span class="nb">id</span><span class="p">]</span>
            <span class="n">aRadii</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">aRadii</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">radiiSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">aRadii</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">radiiSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">factorSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">Names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Bond&#39;</span><span class="p">,</span><span class="s">&#39;Angle&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Names</span><span class="p">):</span>
            <span class="n">factorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">name</span><span class="o">+</span><span class="s">&#39; search factor&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">bondFact</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Factors&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">objList</span><span class="p">[</span><span class="n">bondFact</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Factors&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
            <span class="n">bondFact</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">bondFact</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnRadiiVal</span><span class="p">)</span>
            <span class="n">factorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">bondFact</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">factorSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        
        <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
        <span class="n">ResetBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Reset&#39;</span><span class="p">)</span>
        <span class="n">ResetBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnReset</span><span class="p">)</span>
        <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ResetBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
    </div>
    <span class="k">def</span> <span class="nf">OnRadiiVal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">objList</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">Obj</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>          <span class="c">#reset in case of error</span>
        
<div class="viewcode-block" id="DisAglDialog.GetData"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DisAglDialog.GetData">[docs]</a>    <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Returns the values from the dialog&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        </div>
<div class="viewcode-block" id="DisAglDialog.OnOk"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DisAglDialog.OnOk">[docs]</a>    <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when the OK button is pressed&#39;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>              
        </div>
<div class="viewcode-block" id="DisAglDialog.OnReset"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DisAglDialog.OnReset">[docs]</a>    <span class="k">def</span> <span class="nf">OnReset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called when the Reset button is pressed&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        </div></div>
<div class="viewcode-block" id="PickTwoDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.PickTwoDialog">[docs]</a><span class="k">class</span> <span class="nc">PickTwoDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;This does not seem to be in use</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">names</span><span class="p">,</span><span class="n">choices</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> 
            <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>         <span class="c">#just a dummy - gets destroyed in Draw!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">choices</span> <span class="o">=</span> <span class="n">choices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">names</span> <span class="o">=</span> <span class="n">names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Indx</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="k">def</span> <span class="nf">OnSelection</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">Indx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>  <span class="c">#to avoid Unicode versions</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">DestroyChildren</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">isel</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">):</span>
            <span class="n">lineSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">lineSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Reference atom &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">isel</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
            <span class="n">nameList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">names</span><span class="p">[:]</span>
            <span class="k">if</span> <span class="n">isel</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">nameList</span><span class="p">:</span>
                    <span class="n">nameList</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">choices</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">choice</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">name</span><span class="p">,</span><span class="n">choices</span><span class="o">=</span><span class="n">nameList</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="p">)</span>
            <span class="n">Indx</span><span class="p">[</span><span class="n">choice</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">isel</span>
            <span class="n">choice</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="n">OnSelection</span><span class="p">)</span>
            <span class="n">lineSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">choice</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">lineSizer</span><span class="p">)</span>
        <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
        <span class="n">CancelBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Cancel&#39;</span><span class="p">)</span>
        <span class="n">CancelBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCancel</span><span class="p">)</span>
        <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">CancelBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">GetSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">choices</span>

    <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>              
        
    <span class="k">def</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="SingleFloatDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SingleFloatDialog">[docs]</a><span class="k">class</span> <span class="nc">SingleFloatDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="s">&#39;Dialog to obtain a single float value from user&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="mf">0.</span><span class="p">,</span><span class="mf">1.</span><span class="p">],</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.5g</span><span class="s">&#39;</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> 
            <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>         <span class="c">#just a dummy - gets destroyed in Draw!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">limits</span> <span class="o">=</span> <span class="n">limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Draw</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">Draw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">OnValItem</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">valItem</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">valItem</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="n">valItem</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">valItem</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="n">valItem</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnValItem</span><span class="p">)</span>
        <span class="n">valItem</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnValItem</span><span class="p">)</span>
        <span class="n">OkBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&quot;Ok&quot;</span><span class="p">)</span>
        <span class="n">OkBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnOk</span><span class="p">)</span>
        <span class="n">CancelBtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;Cancel&#39;</span><span class="p">)</span>
        <span class="n">CancelBtn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCancel</span><span class="p">)</span>
        <span class="n">btnSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">OkBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">CancelBtn</span><span class="p">)</span>
        <span class="n">btnSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">BOTTOM</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TOP</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>
        
    <span class="k">def</span> <span class="nf">OnOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>              
        
    <span class="k">def</span> <span class="nf">OnCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetParent</span><span class="p">()</span>
        <span class="n">parent</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>

<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="SingleStringDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SingleStringDialog">[docs]</a><span class="k">class</span> <span class="nc">SingleStringDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dialog to obtain a single string value from user</span>
<span class="sd">    </span>
<span class="sd">    :param wx.Frame parent: name of parent frame</span>
<span class="sd">    :param str title: title string for dialog</span>
<span class="sd">    :param str prompt: string to tell use what they are inputting</span>
<span class="sd">    :param str value: default input value, if any</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> 
                           <span class="n">pos</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DefaultPosition</span><span class="p">,</span>
                           <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valItem</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">),</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">valItem</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StdDialogButtonSizer</span><span class="p">()</span>
        <span class="n">OKbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>
        <span class="n">OKbtn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">OKbtn</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panel</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Fit</span><span class="p">()</span>

<div class="viewcode-block" id="SingleStringDialog.Show"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SingleStringDialog.Show">[docs]</a>    <span class="k">def</span> <span class="nf">Show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Use this method after creating the dialog to post it</span>
<span class="sd">        :returns: True if the user pressed OK; False if the User pressed Cancel</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valItem</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>
</div>
<div class="viewcode-block" id="SingleStringDialog.GetValue"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SingleStringDialog.GetValue">[docs]</a>    <span class="k">def</span> <span class="nf">GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Use this method to get the value entered by the user</span>
<span class="sd">        :returns: string entered by user</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="c">################################################################################</span>
</div></div>
<div class="viewcode-block" id="G2MultiChoiceDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2MultiChoiceDialog">[docs]</a><span class="k">class</span> <span class="nc">G2MultiChoiceDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A dialog similar to MultiChoiceDialog except that buttons are</span>
<span class="sd">    added to set all choices and to toggle all choices.</span>

<span class="sd">    :param wx.Frame ParentFrame: reference to parent frame</span>
<span class="sd">    :param str title: heading above list of choices</span>
<span class="sd">    :param str header: Title to place on window frame </span>
<span class="sd">    :param list ChoiceList: a list of choices where one will be selected</span>
<span class="sd">    :param bool toggle: If True (default) the toggle and select all buttons</span>
<span class="sd">      are displayed</span>
<span class="sd">    :param bool monoFont: If False (default), use a variable-spaced font;</span>
<span class="sd">      if True use a equally-spaced font.</span>
<span class="sd">    :param bool filterBox: If True (default) an input widget is placed on</span>
<span class="sd">      the window and only entries matching the entered text are shown.</span>
<span class="sd">    :param kw: optional keyword parameters for the wx.Dialog may</span>
<span class="sd">      be included such as size [which defaults to `(320,310)`] and</span>
<span class="sd">      style (which defaults to `wx.DEFAULT_DIALOG_STYLE|wx.RESIZE_BORDER|wx.CENTRE| wx.OK | wx.CANCEL`);</span>
<span class="sd">      note that `wx.OK` and `wx.CANCEL` controls</span>
<span class="sd">      the presence of the eponymous buttons in the dialog.</span>
<span class="sd">    :returns: the name of the created dialog  </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">,</span> <span class="n">toggle</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">monoFont</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filterBox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># process keyword parameters, notably style</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:(</span><span class="mi">320</span><span class="p">,</span><span class="mi">310</span><span class="p">),</span> <span class="c"># default Frame keywords</span>
                   <span class="s">&#39;style&#39;</span><span class="p">:</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTRE</span><span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span>
                   <span class="p">}</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span> <span class="o">=</span> <span class="n">ChoiceList</span> <span class="c"># list of choices (list of str values)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="bp">False</span><span class="p">,]</span> <span class="c"># selection status for each choice (list of bools)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">))</span> <span class="c"># list of the choice numbers that have been filtered (list of int indices)</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="n">useOK</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">^=</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">useOK</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">:</span>
            <span class="n">useCANCEL</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">^=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">useCANCEL</span> <span class="o">=</span> <span class="bp">False</span>        
        <span class="c"># create the dialog frame</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c"># fill the dialog</span>
        <span class="n">Sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">topSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">35</span><span class="p">)),</span>
            <span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">WACV</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filterBox</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Timer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TIMER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Filter</span><span class="p">)</span>
            <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Name </span><span class="se">\n</span><span class="s">Filter: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">WACV</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onChar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Filter</span><span class="p">)</span>
            <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">WACV</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">topSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckListBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">monoFont</span><span class="p">:</span>
            <span class="n">font1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">GetFont</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointSize</span><span class="p">(),</span>
                            <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font1</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="c"># set/toggle buttons</span>
        <span class="k">if</span> <span class="n">toggle</span><span class="p">:</span>
            <span class="n">bSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
            <span class="n">setBut</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Set All&#39;</span><span class="p">)</span>
            <span class="n">setBut</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_SetAll</span><span class="p">)</span>
            <span class="n">bSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">setBut</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
            <span class="n">bSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
            <span class="n">togBut</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Toggle All&#39;</span><span class="p">)</span>
            <span class="n">togBut</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_ToggleAll</span><span class="p">)</span>
            <span class="n">bSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">togBut</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">)</span>
            <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">bSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
        <span class="c"># OK/Cancel buttons</span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StdDialogButtonSizer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">useOK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
            <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">useCANCEL</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
            <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_RIGHT</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="c"># OK done, let&#39;s get outa here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">Sizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
<div class="viewcode-block" id="G2MultiChoiceDialog.GetSelections"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2MultiChoiceDialog.GetSelections">[docs]</a>    <span class="k">def</span> <span class="nf">GetSelections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Returns a list of the indices for the selected choices&#39;</span>
        <span class="c"># update self.Selections with settings for displayed items</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="c"># return all selections, shown or hidden</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Selections</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span></div>
<div class="viewcode-block" id="G2MultiChoiceDialog.SetSelections"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2MultiChoiceDialog.SetSelections">[docs]</a>    <span class="k">def</span> <span class="nf">SetSelections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">selList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the selection indices in selList as selected. Resets any previous</span>
<span class="sd">        selections for compatibility with wx.MultiChoiceDialog. Note that</span>
<span class="sd">        the state for only the filtered items is shown.</span>

<span class="sd">        :param list selList: indices of items to be selected. These indices</span>
<span class="sd">          are referenced to the order in self.ChoiceList</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="bp">False</span><span class="p">,]</span> <span class="c"># reset selections</span>
        <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">selList</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ShowSelections</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">_ShowSelections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Show the selection state for displayed items&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">SetChecked</span><span class="p">(</span>
            <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">Selections</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">[</span><span class="n">i</span><span class="p">]]]</span>
            <span class="p">)</span> <span class="c"># Note anything previously checked will be cleared.</span>
    <span class="k">def</span> <span class="nf">_SetAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Set all viewed choices on&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">SetChecked</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">)))</span>
    <span class="k">def</span> <span class="nf">_ToggleAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;flip the state of all viewed choices&#39;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">Check</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">IsChecked</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
    <span class="k">def</span> <span class="nf">onChar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">oneShot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">Filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span> <span class="c"># record current selections</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">txt</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">ChoiceList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ChoiceList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">))</span>
            <span class="n">ChoiceList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">AppendItems</span><span class="p">(</span><span class="n">ChoiceList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ShowSelections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

<span class="c">################################################################################</span>
</div>
<div class="viewcode-block" id="G2SingleChoiceDialog"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2SingleChoiceDialog">[docs]</a><span class="k">class</span> <span class="nc">G2SingleChoiceDialog</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A dialog similar to wx.SingleChoiceDialog except that a filter can be</span>
<span class="sd">    added.</span>

<span class="sd">    :param wx.Frame ParentFrame: reference to parent frame</span>
<span class="sd">    :param str title: heading above list of choices</span>
<span class="sd">    :param str header: Title to place on window frame </span>
<span class="sd">    :param list ChoiceList: a list of choices where one will be selected</span>
<span class="sd">    :param bool monoFont: If False (default), use a variable-spaced font;</span>
<span class="sd">      if True use a equally-spaced font.</span>
<span class="sd">    :param bool filterBox: If True (default) an input widget is placed on</span>
<span class="sd">      the window and only entries matching the entered text are shown.</span>
<span class="sd">    :param kw: optional keyword parameters for the wx.Dialog may</span>
<span class="sd">      be included such as size [which defaults to `(320,310)`] and</span>
<span class="sd">      style (which defaults to ``wx.DEFAULT_DIALOG_STYLE | wx.RESIZE_BORDER | wx.CENTRE | wx.OK | wx.CANCEL``);</span>
<span class="sd">      note that ``wx.OK`` and ``wx.CANCEL`` controls</span>
<span class="sd">      the presence of the eponymous buttons in the dialog.</span>
<span class="sd">    :returns: the name of the created dialog</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">,</span> 
                 <span class="n">monoFont</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">filterBox</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="c"># process keyword parameters, notably style</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;size&#39;</span><span class="p">:(</span><span class="mi">320</span><span class="p">,</span><span class="mi">310</span><span class="p">),</span> <span class="c"># default Frame keywords</span>
                   <span class="s">&#39;style&#39;</span><span class="p">:</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTRE</span><span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">,</span>
                   <span class="p">}</span>
        <span class="n">options</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span> <span class="o">=</span> <span class="n">ChoiceList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">:</span>
            <span class="n">useOK</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">^=</span> <span class="n">wx</span><span class="o">.</span><span class="n">OK</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">useOK</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">:</span>
            <span class="n">useCANCEL</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">options</span><span class="p">[</span><span class="s">&#39;style&#39;</span><span class="p">]</span> <span class="o">^=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">useCANCEL</span> <span class="o">=</span> <span class="bp">False</span>        
        <span class="c"># create the dialog frame</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">header</span><span class="p">,</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
        <span class="c"># fill the dialog</span>
        <span class="n">Sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">topSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">35</span><span class="p">)),</span>
            <span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">WACV</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">filterBox</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Timer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TIMER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Filter</span><span class="p">)</span>
            <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Filter: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                         <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onChar</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">Filter</span><span class="p">)</span>
        <span class="n">topSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">topSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ListBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span> <span class="n">wx</span><span class="o">.</span><span class="n">DefaultSize</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_LEFT_DCLICK</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">onDoubleClick</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">monoFont</span><span class="p">:</span>
            <span class="n">font1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Font</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">GetFont</span><span class="p">()</span><span class="o">.</span><span class="n">GetPointSize</span><span class="p">(),</span>
                            <span class="n">wx</span><span class="o">.</span><span class="n">MODERN</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">NORMAL</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">SetFont</span><span class="p">(</span><span class="n">font1</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span>
        <span class="c"># OK/Cancel buttons</span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StdDialogButtonSizer</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">useOK</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
            <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">useCANCEL</span><span class="p">:</span>
            <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
            <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_RIGHT</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">Sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span>
        <span class="c"># OK done, let&#39;s get outa here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">Sizer</span><span class="p">)</span>
<div class="viewcode-block" id="G2SingleChoiceDialog.GetSelection"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2SingleChoiceDialog.GetSelection">[docs]</a>    <span class="k">def</span> <span class="nf">GetSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Returns the index of the selected choice&#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">wx</span><span class="o">.</span><span class="n">NOT_FOUND</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span></div>
    <span class="k">def</span> <span class="nf">onChar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Start</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span><span class="n">oneShot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">Filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">IsRunning</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">Stop</span><span class="p">()</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filterBox</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Update</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">txt</span><span class="p">:</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">ChoiceList</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ChoiceList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filterlist</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span><span class="p">))</span>
            <span class="n">ChoiceList</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ChoiceList</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clb</span><span class="o">.</span><span class="n">AppendItems</span><span class="p">(</span><span class="n">ChoiceList</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OKbtn</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">onDoubleClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">)</span>

<span class="c">################################################################################</span>
</div>
<div class="viewcode-block" id="ItemSelector"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ItemSelector">[docs]</a><span class="k">def</span> <span class="nf">ItemSelector</span><span class="p">(</span><span class="n">ChoiceList</span><span class="p">,</span> <span class="n">ParentFrame</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select an item&#39;</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="s">&#39;Item Selector&#39;</span><span class="p">,</span>
                 <span class="n">useCancel</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Provide a wx dialog to select a single item or multiple items from list of choices</span>

<span class="sd">    :param list ChoiceList: a list of choices where one will be selected</span>
<span class="sd">    :param wx.Frame ParentFrame: Name of parent frame (default None)</span>
<span class="sd">    :param str title: heading above list of choices (default &#39;Select an item&#39;)</span>
<span class="sd">    :param wx.Size size: Size for dialog to be created (default None -- size as needed)</span>
<span class="sd">    :param str header: Title to place on window frame (default &#39;Item Selector&#39;)</span>
<span class="sd">    :param bool useCancel: If True (default) both the OK and Cancel buttons are offered</span>
<span class="sd">    :param bool multiple: If True then multiple items can be selected (default False)</span>
<span class="sd">    </span>
<span class="sd">    :returns: the selection index or None or a selection list if multiple is true</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">useCancel</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2MultiChoiceDialog</span><span class="p">(</span>
                <span class="n">ParentFrame</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2MultiChoiceDialog</span><span class="p">(</span>
                <span class="n">ParentFrame</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTRE</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">useCancel</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SingleChoiceDialog</span><span class="p">(</span>
                <span class="n">ParentFrame</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span> <span class="n">ChoiceList</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SingleChoiceDialog</span><span class="p">(</span>
                <span class="n">ParentFrame</span><span class="p">,</span><span class="n">title</span><span class="p">,</span> <span class="n">header</span><span class="p">,</span><span class="n">ChoiceList</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CENTRE</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span><span class="p">:</span> <span class="n">dlg</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">multiple</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span>
    <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="GridFractionEditor"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GridFractionEditor">[docs]</a><span class="k">class</span> <span class="nc">GridFractionEditor</span><span class="p">(</span><span class="n">wg</span><span class="o">.</span><span class="n">PyGridCellEditor</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A grid cell editor class that allows entry of values as fractions as well</span>
<span class="sd">    as sine and cosine values [as s() and c()]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">grid</span><span class="p">):</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">PyGridCellEditor</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">evtHandler</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetInsertionPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetControl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">evtHandler</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">PushEventHandler</span><span class="p">(</span><span class="n">evtHandler</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHAR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnChar</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SetSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rect</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetDimensions</span><span class="p">(</span><span class="n">rect</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">width</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="o">.</span><span class="n">height</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span>
                               <span class="n">wx</span><span class="o">.</span><span class="n">SIZE_ALLOW_MINUS_ONE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">BeginEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startValue</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">GetTable</span><span class="p">()</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startValue</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetInsertionPointEnd</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">GetLastPosition</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">EndEdit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">grid</span><span class="p">):</span>
        <span class="n">changed</span> <span class="o">=</span> <span class="bp">False</span>

        <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startValue</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">neg</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="k">if</span> <span class="s">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">neg</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="s">&#39;.&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">+=</span> <span class="s">&#39;.&#39;</span>
            <span class="k">elif</span> <span class="s">&#39;s&#39;</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;sind(&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">neg</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;-sind(&#39;</span><span class="o">+</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;-s&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;sind(&#39;</span><span class="o">+</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;s&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
            <span class="k">elif</span> <span class="s">&#39;c&#39;</span> <span class="ow">in</span> <span class="n">val</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s">&#39;cosd(&#39;</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">neg</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;-cosd(&#39;</span><span class="o">+</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;-c&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="s">&#39;cosd(&#39;</span><span class="o">+</span><span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;c&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">eval</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">SyntaxError</span><span class="p">,</span><span class="ne">NameError</span><span class="p">):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">startValue</span>
            <span class="n">grid</span><span class="o">.</span><span class="n">GetTable</span><span class="p">()</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span> <span class="c"># update the table</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">startValue</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">changed</span>

    <span class="k">def</span> <span class="nf">Reset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">startValue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">SetInsertionPointEnd</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">Clone</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">GridFractionEditor</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">StartingKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">OnChar</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetSkipped</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">EmulateKeyPress</span><span class="p">(</span><span class="n">evt</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">OnChar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt</span><span class="p">):</span>
        <span class="n">key</span> <span class="o">=</span> <span class="n">evt</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="mi">15</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">&gt;</span> <span class="mi">255</span><span class="p">:</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">char</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&#39;.+-/0123456789cosind()&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tc</span><span class="o">.</span><span class="n">WriteText</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="ShowLSParms"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ShowLSParms">[docs]</a><span class="k">class</span> <span class="nc">ShowLSParms</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create frame to show least-squares parameters</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">varyList</span><span class="p">,</span><span class="n">fullVaryList</span><span class="p">,</span>
                 <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span><span class="mi">430</span><span class="p">)):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">title</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                           <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="p">)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>

        <span class="n">panel</span> <span class="o">=</span> <span class="n">wxscroll</span><span class="o">.</span><span class="n">ScrolledPanel</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="c">#size=size,</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TAB_TRAVERSAL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">SUNKEN_BORDER</span><span class="p">)</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">varyList</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Number of refined variables: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)))</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">varyList</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullVaryList</span><span class="p">):</span>
            <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fullVaryList</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">varyList</span><span class="p">)</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39; + &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; parameters are varied via constraints&#39;</span><span class="p">))</span>
        <span class="n">subSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">parmDict</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">hgap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">vgap</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">parmNames</span> <span class="o">=</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">parmNames</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Parameter name  &#39;</span><span class="p">))</span>
        <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;refine?&#39;</span><span class="p">))</span>
        <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;value&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_RIGHT</span><span class="p">)</span>
        <span class="n">explainRefine</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">parmNames</span><span class="p">:</span>
            <span class="c"># skip entries without numerical values</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">],</span><span class="nb">basestring</span><span class="p">):</span> <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">G2py3</span><span class="o">.</span><span class="n">FormatSigFigs</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">parmDict</span><span class="p">[</span><span class="n">name</span><span class="p">])</span><span class="o">+</span><span class="s">&#39; -?&#39;</span> <span class="c"># unexpected</span>
                <span class="c">#continue</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">getVarDescr</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>                
                <span class="n">ch</span> <span class="o">=</span> <span class="n">HelpButton</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">G2obj</span><span class="o">.</span><span class="n">fmtVarDescr</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RIGHT</span><span class="o">|</span><span class="n">WACV</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)))</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">varyList</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;R&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">fullVaryList</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;C&#39;</span><span class="p">))</span>
                <span class="n">explainRefine</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">subSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">value</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_RIGHT</span><span class="p">)</span>

        <span class="c"># finish up ScrolledPanel</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">subSizer</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetAutoLayout</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">SetupScrolling</span><span class="p">()</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">explainRefine</span><span class="p">:</span>
            <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                          <span class="s">&#39;&quot;R&quot; indicates a refined variable</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">+</span>
                          <span class="s">&#39;&quot;C&quot; indicates generated from a constraint&#39;</span>
                          <span class="p">),</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># make OK button </span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CLOSE</span><span class="p">,</span><span class="s">&quot;Close&quot;</span><span class="p">)</span> 
        <span class="n">btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onClose</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="c"># Allow window to be enlarged but not made smaller</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMinSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
 
<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="downdate"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.downdate">[docs]</a><span class="k">class</span> <span class="nc">downdate</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Dialog to allow a user to select a version of GSAS-II to install</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Select Version&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
        <span class="n">pnl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">insver</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">curver</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span>
            <span class="n">pnl</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="s">&#39;Select a specific GSAS-II version to install&#39;</span>
            <span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                          <span class="s">&#39;Currently installed version: &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">insver</span><span class="p">)),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer1</span><span class="p">)</span>
        <span class="n">sizer1</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                          <span class="s">&#39;Select GSAS-II version to install: &#39;</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTRE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">SpinCtrl</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="o">.</span><span class="n">SetRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">curver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">curver</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SPINCTRL</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onSpin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_onSpin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
        <span class="n">sizer1</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">sizer1</span><span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LI_HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

        <span class="n">line</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LI_HORIZONTAL</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span>
                <span class="n">pnl</span><span class="p">,</span>  <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
                <span class="s">&#39;If &quot;Install&quot; is pressed, your project will be saved;</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;GSAS-II will exit; The specified version will be loaded</span><span class="se">\n</span><span class="s">&#39;</span>
                <span class="s">&#39;and GSAS-II will restart. Press &quot;Cancel&quot; to abort.&#39;</span><span class="p">),</span>
            <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StdDialogButtonSizer</span><span class="p">()</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">,</span> <span class="s">&quot;Install&quot;</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">SetDefault</span><span class="p">()</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">AddButton</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Realize</span><span class="p">()</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="n">pnl</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topsizer</span><span class="o">=</span><span class="n">sizer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_onSpin</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_onSpin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Called to load info about the selected version in the dialog&#39;</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetLog</span><span class="p">(</span><span class="n">version</span><span class="o">=</span><span class="n">ver</span><span class="p">)</span>
        <span class="n">date</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;date&#39;</span><span class="p">,</span><span class="s">&#39;?&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;T&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="s">&#39;(Version &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; created &#39;</span><span class="o">+</span><span class="n">date</span>
        <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39; by &#39;</span><span class="o">+</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;author&#39;</span><span class="p">,</span><span class="s">&#39;?&#39;</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;msg&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">msg</span><span class="p">:</span> <span class="n">s</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">Comment: &#39;</span><span class="o">+</span><span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">topsizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="downdate.getVersion"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.downdate.getVersion">[docs]</a>    <span class="k">def</span> <span class="nf">getVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;Get the version number in the dialog&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">spin</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="MyHelp"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHelp">[docs]</a><span class="k">class</span> <span class="nc">MyHelp</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A class that creates the contents of a help menu.</span>
<span class="sd">    The menu will start with two entries:</span>

<span class="sd">    * &#39;Help on &lt;helpType&gt;&#39;: where helpType is a reference to an HTML page to</span>
<span class="sd">      be opened</span>
<span class="sd">    * About: opens an About dialog using OnHelpAbout. N.B. on the Mac this</span>
<span class="sd">      gets moved to the App menu to be consistent with Apple style.</span>

<span class="sd">    NOTE: for this to work properly with respect to system menus, the title</span>
<span class="sd">    for the menu must be &amp;Help, or it will not be processed properly:</span>

<span class="sd">    ::</span>

<span class="sd">       menu.Append(menu=MyHelp(self,...),title=&quot;&amp;Help&quot;)</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">helpLbl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">morehelpitems</span><span class="o">=</span><span class="p">[],</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ABOUT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;About GSAS-II&#39;</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnHelpAbout</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ABOUT</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">whichsvn</span><span class="p">():</span>
            <span class="n">helpobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Check for updates&#39;</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnCheckUpdates</span><span class="p">,</span> <span class="n">helpobj</span><span class="p">)</span>
            <span class="n">helpobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="s">&#39;&amp;Regress to an old GSAS-II version&#39;</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnSelectVersion</span><span class="p">,</span> <span class="n">helpobj</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span><span class="n">indx</span> <span class="ow">in</span> <span class="n">morehelpitems</span><span class="p">:</span>
            <span class="n">helpobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">lbl</span><span class="p">,</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnHelpById</span><span class="p">,</span> <span class="n">helpobj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span><span class="p">[</span><span class="n">helpobj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">indx</span>
        <span class="c"># add a help item only when helpType is specified</span>
        <span class="k">if</span> <span class="n">helpType</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AppendSeparator</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">helpLbl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">helpLbl</span> <span class="o">=</span> <span class="n">helpType</span>
            <span class="n">helpobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Help on &#39;</span><span class="o">+</span><span class="n">helpLbl</span><span class="p">,</span>
                                  <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">)</span>
            <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnHelpById</span><span class="p">,</span> <span class="n">helpobj</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span><span class="p">[</span><span class="n">helpobj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">helpType</span>
       
<div class="viewcode-block" id="MyHelp.OnHelpById"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHelp.OnHelpById">[docs]</a>    <span class="k">def</span> <span class="nf">OnHelpById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when Help on... is pressed in a menu. Brings up</span>
<span class="sd">        a web page for documentation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">helpType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">helpType</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;Error: help lookup failed!&#39;</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&#39;id=&#39;</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">GetId</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">helpType</span> <span class="o">==</span> <span class="s">&#39;Tutorials&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">Tutorials</span> <span class="o">=</span> <span class="bp">True</span> 
            <span class="n">ShowHelp</span><span class="p">(</span><span class="n">helpType</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MyHelp.OnHelpAbout"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHelp.OnHelpAbout">[docs]</a>    <span class="k">def</span> <span class="nf">OnHelpAbout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="s">&quot;Display an &#39;About GSAS-II&#39; box&quot;</span>
        <span class="k">global</span> <span class="n">__version__</span>
        <span class="n">info</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">AboutDialogInfo</span><span class="p">()</span>
        <span class="n">info</span><span class="o">.</span><span class="n">Name</span> <span class="o">=</span> <span class="s">&#39;GSAS-II&#39;</span>
        <span class="n">ver</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ver</span><span class="p">:</span> 
            <span class="n">info</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&#39;Revision &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; (svn), version &#39;</span><span class="o">+</span><span class="n">__version__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span><span class="o">.</span><span class="n">Version</span> <span class="o">=</span> <span class="s">&#39;Revision &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">GSASIIpath</span><span class="o">.</span><span class="n">GetVersionNumber</span><span class="p">())</span><span class="o">+</span><span class="s">&#39; (.py files), version &#39;</span><span class="o">+</span><span class="n">__version__</span>
        <span class="c">#info.Developers = [&#39;Robert B. Von Dreele&#39;,&#39;Brian H. Toby&#39;]</span>
        <span class="n">info</span><span class="o">.</span><span class="n">Copyright</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;(c) &#39;</span> <span class="o">+</span> <span class="n">time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y&#39;</span><span class="p">)</span> <span class="o">+</span>
<span class="sd">&#39;&#39;&#39; Argonne National Laboratory</span>
<span class="sd">This product includes software developed</span>
<span class="sd">by the UChicago Argonne, LLC, as </span>
<span class="sd">Operator of Argonne National Laboratory.&#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">info</span><span class="o">.</span><span class="n">Description</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;General Structure Analysis System-II (GSAS-II)</span>
<span class="s">Robert B. Von Dreele and Brian H. Toby</span>

<span class="s">Please cite as:</span>
<span class="s">B.H. Toby &amp; R.B. Von Dreele, J. Appl. Cryst. 46, 544-549 (2013) &#39;&#39;&#39;</span>

        <span class="n">info</span><span class="o">.</span><span class="n">WebSite</span> <span class="o">=</span> <span class="p">(</span><span class="s">&quot;https://subversion.xray.aps.anl.gov/trac/pyGSAS&quot;</span><span class="p">,</span><span class="s">&quot;GSAS-II home page&quot;</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">AboutBox</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="MyHelp.OnCheckUpdates"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHelp.OnCheckUpdates">[docs]</a>    <span class="k">def</span> <span class="nf">OnCheckUpdates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Check if the GSAS-II repository has an update for the current source files</span>
<span class="sd">        and perform that update if requested.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">whichsvn</span><span class="p">():</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;No Subversion&#39;</span><span class="p">,</span><span class="s">&#39;Cannot update GSAS-II because subversion (svn) was not found.&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">BeginBusyCursor</span><span class="p">()</span>
        <span class="n">local</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">local</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">wx</span><span class="o">.</span><span class="n">EndBusyCursor</span><span class="p">()</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;Unable to run subversion on the GSAS-II current directory. Is GSAS-II installed correctly?&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;Subversion error&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">print</span> <span class="s">&#39;Installed GSAS-II version: &#39;</span><span class="o">+</span><span class="n">local</span>
        <span class="n">repos</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">(</span><span class="n">local</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">EndBusyCursor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">repos</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;Unable to access the GSAS-II server. Is this computer on the internet?&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;Server unavailable&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">print</span> <span class="s">&#39;GSAS-II version on server: &#39;</span><span class="o">+</span><span class="n">repos</span>
        <span class="k">if</span> <span class="n">local</span> <span class="o">==</span> <span class="n">repos</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;GSAS-II is up-to-date. Version &#39;</span><span class="o">+</span><span class="n">local</span><span class="o">+</span><span class="s">&#39; is already loaded.&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;GSAS-II Up-to-date&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">mods</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnFindLocalChanges</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mods</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;You have version &#39;</span><span class="o">+</span><span class="n">local</span><span class="o">+</span>
                                   <span class="s">&#39; of GSAS-II installed, but the current version is &#39;</span><span class="o">+</span><span class="n">repos</span><span class="o">+</span>
                                   <span class="s">&#39;. However, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mods</span><span class="p">))</span><span class="o">+</span>
                                   <span class="s">&#39; file(s) on your local computer have been modified.&#39;</span>
                                   <span class="s">&#39; Updating will attempt to merge your local changes with &#39;</span>
                                   <span class="s">&#39;the latest GSAS-II version, but if &#39;</span>
                                   <span class="s">&#39;conflicts arise, local changes will be &#39;</span>
                                   <span class="s">&#39;discarded. It is also possible that the &#39;</span>
                                   <span class="s">&#39;local changes my prevent GSAS-II from running. &#39;</span>
                                   <span class="s">&#39;Press OK to start an update if this is acceptable:&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;Local GSAS-II Mods&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;You have version &#39;</span><span class="o">+</span><span class="n">local</span><span class="o">+</span>
                                   <span class="s">&#39; of GSAS-II installed, but the current version is &#39;</span><span class="o">+</span><span class="n">repos</span><span class="o">+</span>
                                   <span class="s">&#39;. Press OK to start an update:&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;GSAS-II Updates&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&#39;start updates&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                               <span class="s">&#39;Your project will now be saved, GSAS-II will exit and an update &#39;</span>
                               <span class="s">&#39;will be performed and GSAS-II will restart. Press Cancel to &#39;</span>
                               <span class="s">&#39;abort the update&#39;</span><span class="p">,</span>
                               <span class="s">&#39;Start update?&#39;</span><span class="p">,</span>
                               <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">OnFileSave</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnUpdateProcess</span><span class="p">(</span><span class="n">projectfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">)</span>
        <span class="k">return</span>
</div>
<div class="viewcode-block" id="MyHelp.OnSelectVersion"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHelp.OnSelectVersion">[docs]</a>    <span class="k">def</span> <span class="nf">OnSelectVersion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Allow the user to select a specific version of GSAS-II</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">whichsvn</span><span class="p">():</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;No Subversion&#39;</span><span class="p">,</span><span class="s">&#39;Cannot update GSAS-II because subversion (svn) &#39;</span><span class="o">+</span>
                                   <span class="s">&#39;was not found.&#39;</span>
                                   <span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">local</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnGetRev</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">local</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;Unable to run subversion on the GSAS-II current directory. Is GSAS-II installed correctly?&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;Subversion error&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">mods</span> <span class="o">=</span> <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnFindLocalChanges</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mods</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span>
                                   <span class="s">&#39;You have version &#39;</span><span class="o">+</span><span class="n">local</span><span class="o">+</span>
                                   <span class="s">&#39; of GSAS-II installed&#39;</span>
                                   <span class="s">&#39;. However, &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mods</span><span class="p">))</span><span class="o">+</span>
                                   <span class="s">&#39; file(s) on your local computer have been modified.&#39;</span>
                                   <span class="s">&#39; Downdating will attempt to merge your local changes with &#39;</span>
                                   <span class="s">&#39;the selected GSAS-II version. &#39;</span>
                                   <span class="s">&#39;Downdating is not encouraged because &#39;</span>
                                   <span class="s">&#39;if merging is not possible, your local changes will be &#39;</span>
                                   <span class="s">&#39;discarded. It is also possible that the &#39;</span>
                                   <span class="s">&#39;local changes my prevent GSAS-II from running. &#39;</span>
                                   <span class="s">&#39;Press OK to continue anyway.&#39;</span><span class="p">,</span>
                                   <span class="s">&#39;Local GSAS-II Mods&#39;</span><span class="p">,</span>
                                   <span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CANCEL</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                <span class="k">return</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">downdate</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
            <span class="n">ver</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getVersion</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&#39;start regress to &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">))</span>
        <span class="n">GSASIIpath</span><span class="o">.</span><span class="n">svnUpdateProcess</span><span class="p">(</span>
            <span class="n">projectfile</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">GSASprojectfile</span><span class="p">,</span>
            <span class="n">version</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ver</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">OnFileSave</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span>

<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="AddHelp"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.AddHelp">[docs]</a><span class="k">class</span> <span class="nc">AddHelp</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;For the Mac: creates an entry to the help menu of type </span>
<span class="sd">    &#39;Help on &lt;helpType&gt;&#39;: where helpType is a reference to an HTML page to</span>
<span class="sd">    be opened.</span>

<span class="sd">    NOTE: when appending this menu (menu.Append) be sure to set the title to</span>
<span class="sd">    &#39;&amp;Help&#39; so that wx handles it correctly.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">helpType</span><span class="p">,</span><span class="n">helpLbl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="k">if</span> <span class="n">helpLbl</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">helpLbl</span> <span class="o">=</span> <span class="n">helpType</span>
        <span class="c"># add a help item only when helpType is specified</span>
        <span class="n">helpobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Help on &#39;</span><span class="o">+</span><span class="n">helpLbl</span><span class="p">,</span>
                              <span class="nb">id</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">)</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnHelpById</span><span class="p">,</span> <span class="n">helpobj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span> <span class="o">=</span> <span class="n">helpType</span>
       
<div class="viewcode-block" id="AddHelp.OnHelpById"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.AddHelp.OnHelpById">[docs]</a>    <span class="k">def</span> <span class="nf">OnHelpById</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Called when Help on... is pressed in a menu. Brings up</span>
<span class="sd">        a web page for documentation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">ShowHelp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HelpById</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>

<span class="c">################################################################################</span></div></div>
<div class="viewcode-block" id="HelpButton"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.HelpButton">[docs]</a><span class="k">class</span> <span class="nc">HelpButton</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create a help button that displays help information.</span>
<span class="sd">    The text is displayed in a modal message window.</span>

<span class="sd">    TODO: it might be nice if it were non-modal: e.g. it stays around until</span>
<span class="sd">    the parent is deleted or the user closes it, but this did not work for</span>
<span class="sd">    me. </span>

<span class="sd">    :param parent: the panel which will be the parent of the button</span>
<span class="sd">    :param str msg: the help text to be displayed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span> 
            <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_HELP</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;?&#39;</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">BU_EXACTFIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onPress</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="o">=</span><span class="n">msg</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">def</span> <span class="nf">_onClose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">EndModal</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_CANCEL</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_onPress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Respond to a button press by displaying the requested text&#39;</span>
        <span class="c">#dlg = wx.MessageDialog(self.parent,self.msg,&#39;Help info&#39;,wx.OK)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Dialog</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Help information&#39;</span><span class="p">,</span> 
                        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_DIALOG_STYLE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">RESIZE_BORDER</span><span class="p">)</span>
        <span class="c">#self.dlg.SetBackgroundColour(wx.WHITE)</span>
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">txt</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">txt</span><span class="o">.</span><span class="n">SetBackgroundColour</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">WHITE</span><span class="p">)</span>

        <span class="n">btnsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">btn</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_CLOSE</span><span class="p">)</span> 
        <span class="n">btn</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">_onClose</span><span class="p">)</span>
        <span class="n">btnsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btn</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">btnsizer</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="MyHtmlPanel"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MyHtmlPanel">[docs]</a><span class="k">class</span> <span class="nc">MyHtmlPanel</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Defines a panel to display HTML help information, as an alternative to</span>
<span class="sd">    displaying help information in a web browser.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
        <span class="n">sizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">back</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;Back&quot;</span><span class="p">)</span>
        <span class="n">back</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnBack</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span> <span class="o">=</span> <span class="n">G2HtmlWindow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">750</span><span class="p">,</span><span class="mi">450</span><span class="p">))</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">back</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">sizer</span><span class="p">)</span>
        <span class="n">sizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SIZE</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnHelpSize</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">OnHelpSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>         <span class="c">#does the job but weirdly!!</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">GetOpenedAnchor</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">anchor</span><span class="p">:</span>            
            <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">ScrollToAnchor</span><span class="p">(</span><span class="n">anchor</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">ScrollToAnchor</span><span class="p">,</span><span class="n">anchor</span><span class="p">)</span>
            <span class="n">event</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">OnBack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">HistoryBack</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">LoadFile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="nb">file</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="nb">file</span><span class="p">[:</span><span class="n">pos</span><span class="p">]</span>
            <span class="n">helpanchor</span> <span class="o">=</span> <span class="nb">file</span><span class="p">[</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">helpfile</span> <span class="o">=</span> <span class="nb">file</span>
            <span class="n">helpanchor</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">LoadPage</span><span class="p">(</span><span class="n">helpfile</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">helpanchor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">ScrollToAnchor</span><span class="p">(</span><span class="n">helpanchor</span><span class="p">)</span>
            <span class="n">xs</span><span class="p">,</span><span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">GetViewStart</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">htmlwin</span><span class="o">.</span><span class="n">Scroll</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="G2HtmlWindow"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.G2HtmlWindow">[docs]</a><span class="k">class</span> <span class="nc">G2HtmlWindow</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">HtmlWindow</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Displays help information in a primitive HTML browser type window</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="n">parent</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">HtmlWindow</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">LoadPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">HtmlWindow</span><span class="o">.</span><span class="n">LoadPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TitlePage</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">OnLinkClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">HtmlWindow</span><span class="o">.</span><span class="n">OnLinkClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">xs</span><span class="p">,</span><span class="n">ys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetViewStart</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Scroll</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span><span class="n">ys</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TitlePage</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">HistoryBack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">HtmlWindow</span><span class="o">.</span><span class="n">HistoryBack</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TitlePage</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">TitlePage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetOpenedPage</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; -- &#39;</span> <span class="o">+</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">GetOpenedPageTitle</span><span class="p">())</span>

<span class="c">################################################################################</span></div>
<div class="viewcode-block" id="DataFrame"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DataFrame">[docs]</a><span class="k">class</span> <span class="nc">DataFrame</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create the data item window and all the entries in menus used in</span>
<span class="sd">    that window. For Linux and windows, the menu entries are created for the</span>
<span class="sd">    current data item window, but in the Mac the menu is accessed from all</span>
<span class="sd">    windows. This means that a different menu is posted depending on which</span>
<span class="sd">    data item is posted. On the Mac, all the menus contain the data tree menu</span>
<span class="sd">    items, but additional menus are added specific to the data item. </span>

<span class="sd">    Note that while the menus are created here, </span>
<span class="sd">    the binding for the menus is done later in various GSASII*GUI modules,</span>
<span class="sd">    where the functions to be called are defined.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="DataFrame.Bind"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DataFrame.Bind">[docs]</a>    <span class="k">def</span> <span class="nf">Bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Override the Bind() function: on the Mac the binding is to</span>
<span class="sd">        the main window, so that menus operate with any window on top.</span>
<span class="sd">        For other platforms, call the default wx.Frame Bind()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span> <span class="c"># mac</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G2frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>      
        </div>
<div class="viewcode-block" id="DataFrame.PrefillDataMenu"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DataFrame.PrefillDataMenu">[docs]</a>    <span class="k">def</span> <span class="nf">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">menu</span><span class="p">,</span><span class="n">helpType</span><span class="p">,</span><span class="n">helpLbl</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">empty</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create the &quot;standard&quot; part of data frame menus. Note that on Linux and</span>
<span class="sd">        Windows nothing happens here. On Mac, this menu duplicates the</span>
<span class="sd">        tree menu, but adds an extra help command for the data item and a separator. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datamenu</span> <span class="o">=</span> <span class="n">menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpType</span> <span class="o">=</span> <span class="n">helpType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helpLbl</span> <span class="o">=</span> <span class="n">helpLbl</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span> <span class="c"># mac                         </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G2frame</span><span class="o">.</span><span class="n">FillMainMenu</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span> <span class="c"># add the data tree menu items</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">)</span> <span class="c"># add a separator</span>
        </div>
<div class="viewcode-block" id="DataFrame.PostfillDataMenu"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.DataFrame.PostfillDataMenu">[docs]</a>    <span class="k">def</span> <span class="nf">PostfillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">empty</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create the &quot;standard&quot; part of data frame menus. Note that on Linux and</span>
<span class="sd">        Windows, this is the standard help Menu. On Mac, this menu duplicates the</span>
<span class="sd">        tree menu, but adds an extra help command for the data item and a separator. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datamenu</span>
        <span class="n">helpType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpType</span>
        <span class="n">helpLbl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">helpLbl</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span> <span class="c"># mac</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
                <span class="n">menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;|&#39;</span><span class="p">)</span> <span class="c"># add another separator</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">AddHelp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">G2frame</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="n">helpType</span><span class="p">,</span> <span class="n">helpLbl</span><span class="o">=</span><span class="n">helpLbl</span><span class="p">),</span>
                        <span class="n">title</span><span class="o">=</span><span class="s">&#39;&amp;Help&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># other</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">MyHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="n">helpType</span><span class="p">,</span> <span class="n">helpLbl</span><span class="o">=</span><span class="n">helpLbl</span><span class="p">),</span>
                        <span class="n">title</span><span class="o">=</span><span class="s">&#39;&amp;Help&#39;</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_init_menus</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s">&#39;define all GSAS-II data frame menus&#39;</span>

        <span class="c"># for use where no menu or data frame help is provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BlankMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        
        <span class="c"># Controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ControlsMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ControlsMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Controls&#39;</span><span class="p">,</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c"># Notebook</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataNotebookMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataNotebookMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Notebook&#39;</span><span class="p">,</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c"># Comments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataCommentsMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataCommentsMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Comments&#39;</span><span class="p">,</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">(</span><span class="n">empty</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c"># Constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ConstraintMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Constraints&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintTab</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ConstraintTab</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">wxID_CONSPHASE</span><span class="p">,</span><span class="s">&#39;Phase&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">wxID_CONSHAP</span><span class="p">,</span><span class="s">&#39;Histogram/Phase&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">wxID_CONSHIST</span><span class="p">,</span><span class="s">&#39;Histogram&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="n">wxID_CONSGLOBAL</span><span class="p">,</span><span class="s">&#39;Global&#39;</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintTab</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">txt</span><span class="p">,</span>
                <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select &#39;</span><span class="o">+</span><span class="n">txt</span><span class="o">+</span><span class="s">&#39; constraint editing tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_HOLDADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add hold&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add hold on a parameter value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_EQUIVADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add equivalence&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add equivalence between parameter values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_CONSTRAINTADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add constraint&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add constraint on parameter values&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ConstraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_FUNCTADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add New Var&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add variable composed of existing parameter&#39;</span><span class="p">)</span>

        <span class="c"># item = self.ConstraintEdit.Append(id=wx.ID_ANY,kind=wx.ITEM_NORMAL,text=&#39;Update GUI&#39;)</span>
        <span class="c"># def UpdateGSASIIconstrGUI(event):</span>
        <span class="c">#     import GSASIIconstrGUI</span>
        <span class="c">#     reload(GSASIIconstrGUI)</span>
        <span class="c">#     import GSASIIobj</span>
        <span class="c">#     reload(GSASIIobj)</span>
        <span class="c"># self.Bind(wx.EVT_MENU,UpdateGSASIIconstrGUI,id=item.GetId())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># Rigid bodies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VectorRBEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">VectorRBEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RIGIDBODYADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add rigid body&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add vector rigid body&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ResidueRBMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ResidueRBMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RIGIDBODYIMPORT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Import XYZ&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import rigid body XYZ from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ResidueRBMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESIDUETORSSEQ</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Define sequence&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Define torsion sequence&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ResidueRBMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RIGIDBODYADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Import residues&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Import residue rigid bodies from macro file&#39;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodyMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RigidBodyMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodyMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">VectorRBEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Restraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintTab</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESTSELPHASE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Select phase&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESTRAINTADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add restraints&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add restraints&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxID_RESTRAINTADD</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>    <span class="c">#gets disenabled if macromolecule phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_AARESTRAINTADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add residue restraints&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add residue based restraints for macromolecules from macro file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxID_AARESTRAINTADD</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>    <span class="c">#gets enabled if macromolecule phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_AARESTRAINTPLOT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Plot residue restraints&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Plot selected residue based restraints for macromolecules from macro file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxID_AARESTRAINTPLOT</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>    <span class="c">#gets enabled if macromolecule phase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESRCHANGEVAL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Change value&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Change observed value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESTCHANGEESD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Change esd&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Change esd in observed value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESTDELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete restraints&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete selected restraints&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RestraintMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Restraints&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RestraintTab</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RestraintMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RestraintEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Sequential results</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SequentialMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Sequential&#39;</span><span class="p">,</span><span class="n">helpLbl</span><span class="o">=</span><span class="s">&#39;Sequential Refinement&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialFile</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SequentialFile</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Selected Cols&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialFile</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAVESEQSEL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save as text&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Save selected sequential refinement results as a text file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialFile</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAVESEQSELCSV</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save as CSV&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Save selected sequential refinement results as a CSV spreadsheet file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialFile</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PLOTSEQSEL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Plot selected&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Plot selected sequential refinement results&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPvars</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Pseudo Vars&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxADDSEQVAR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add a new pseudo-variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxDELSEQVAR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete an existing pseudo-variable&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxEDITSEQVAR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Edit an existing pseudo-variable&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Parametric Fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxADDPARFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add equation&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add a new equation to minimize&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxDELPARFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete equation&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete an equation for parametric minimization&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxEDITPARFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Edit equation&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Edit an existing parametric minimization equation&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxDOPARFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Fit to equation(s)&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Perform a parametric minimization&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Powder </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HistMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">HistMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;PWD Analysis&#39;</span><span class="p">,</span><span class="n">helpLbl</span><span class="o">=</span><span class="s">&#39;Powder Fit Error Analysis&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorAnal</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">HistMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ErrorAnal</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Commands&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorAnal</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDANALYSIS</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Error Analysis&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Error analysis on powder pattern&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ErrorAnal</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDCOPY</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy params&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Error analysis on powder pattern&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># PDR / Limits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">LimitMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Limits&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">LimitEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_LIMITCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy limits to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LimitEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ADDEXCLREGION</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add exclude&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add excluded region - select a point on plot; drag to adjust&#39;</span><span class="p">)</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># PDR / Background</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BackMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">BackMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Background&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BackEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BackMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">BackEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;File&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BackEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_BACKCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy background parameters to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">BackEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_BACKFLAGCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy flags&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy background refinement flags to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># PDR / Instrument Parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">InstMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Instrument Parameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Reset instrument profile parameters to default&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_INSTLOAD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load profile...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Load instrument profile parameters from file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_INSTSAVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save profile...&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Save instrument profile parameters to file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_INSTPRMRESET</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reset profile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy instrument profile parameters to other histograms&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_INSTCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">InstEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_INSTFLAGCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy flags&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy instrument parameter refinement flags to other histograms&#39;</span><span class="p">)</span>
<span class="c">#        self.InstEdit.Append(help=&#39;Change radiation type (Ka12 - synch)&#39;, </span>
<span class="c">#            id=wxID_CHANGEWAVETYPE, kind=wx.ITEM_NORMAL,text=&#39;Change radiation&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># PDR / Sample Parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Command&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetScale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SETSCALE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Set scale&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Set scale by matching to another histogram&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAMPLELOAD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Load sample parameters from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAMPLESAVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Save sample parameters to file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAMPLECOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy refinable and most other sample parameters to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAMPLECOPYSOME</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy selected...&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy selected sample parameters to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SampleEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAMPLEFLAGCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy flags&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy sample parameter refinement flags to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetScale</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>

        <span class="c"># PDR / Peak List</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PeakMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Peak List&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Peak Fitting&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AutoSearch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Automatic peak search&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_AUTOSEARCH</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Auto search&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UnDo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Undo last least squares refinement&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_UNDO</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;UnDo&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakFit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_LSQPEAKFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;LSQ PeakFit&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Peak fitting via least-squares&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PFOneCycle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_LSQONECYCLE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;LSQ one cycle&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;One cycle of Peak fitting via least-squares&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RESETSIGGAM</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span> 
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Reset sig and gam&#39;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Reset sigma and gamma to global fit&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_CLEARPEAKS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear the peak list&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UnDo</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PeakFit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PFOneCycle</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c"># PDR / Index Peak List</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Index Peak List&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksEdit</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Load/Reload index peaks from peak list&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_INDXRELOAD</span><span class="p">,</span> 
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load/Reload&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># PDR / Unit Cells List</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndexMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">IndexMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Unit Cells List&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndexMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Cell Index/Refine&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndexPeaks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_INDEXPEAKS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Index Cell&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CopyCell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_COPYCELL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy Cell&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy selected unit cell from indexing to cell refinement fields&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RefineCell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_REFINECELL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span> 
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Refine Cell&#39;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Refine unit cell parameters from indexed peaks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MakeNewPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IndexEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_MAKENEWPHASE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Make new phase&#39;</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Make new phase from selected unit cell&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">IndexPeaks</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CopyCell</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RefineCell</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MakeNewPhase</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c"># PDR / Reflection Lists</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReflMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Reflection List&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReflEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReflMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ReflEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Reflection List&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SelectPhase</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ReflEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Select phase for reflection list&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SELECTPHASE</span><span class="p">,</span> 
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Select phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReflEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDHKLPLOT</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Plot HKLs&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Plot HKLs from powder pattern&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c">#SASD &amp; REFL/ Substance editor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SubstanceMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Substances&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_LOADSUBSTANCE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load substance&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Load substance from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ADDSUBSTANCE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add substance&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add new substance to list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_COPYSUBSTANCE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy substances&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy substances&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DELETESUBSTANCE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete substance&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete substance from list&#39;</span><span class="p">)</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ELEMENTADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add elements&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add elements to substance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SubstanceEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ELEMENTDELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete elements&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete elements from substance&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># SASD/ Models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ModelMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Models&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELADD</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add new term to model&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Fit&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Fit model parameters to data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SasdUndo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELUNDO</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Undo&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Undo model fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SasdUndo</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELFITALL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Sequential fit&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Sequential fit of model parameters to all SASD data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy model parameters to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ModelEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MODELCOPYFLAGS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy flags&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy model refinement flags to other histograms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># IMG / Image Controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Image Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Calibrate detector by fitting to calibrant lines&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMCALIBRATE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Calibrate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Recalibrate detector by fitting to calibrant lines&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMRECALIBRATE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Recalibrate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear calibration data points and rings&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMCLEARCALIB</span><span class="p">,</span> 
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear calibration&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Integrate selected image&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMINTEGRATE</span><span class="p">,</span> 
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Integrate&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Integrate all images selected from list&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_INTEGRATEALL</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Integrate all&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy image controls to other images&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMCOPYCONTROLS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Save image controls to file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMSAVECONTROLS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ImageEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Load image controls from file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_IMLOADCONTROLS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># IMG / Masks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MaskMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Image Masks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&#39;Create new&#39;</span><span class="p">,</span> <span class="n">submenu</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy mask to other images&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_MASKCOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy mask&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Save mask to file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_MASKSAVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save mask&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MaskEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Load mask from file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_MASKLOAD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load mask&#39;</span><span class="p">)</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Create an arc mask with mouse input&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_NEWMASKARC</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Arc mask&#39;</span><span class="p">)</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Create a frame mask with mouse input&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_NEWMASKFRAME</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Frame mask&#39;</span><span class="p">)</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Create a polygon mask with mouse input&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_NEWMASKPOLY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Polygon mask&#39;</span><span class="p">)</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Create a ring mask with mouse input&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_NEWMASKRING</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Ring mask&#39;</span><span class="p">)</span>
        <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Create a spot mask with mouse input&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_NEWMASKSPOT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Spot mask&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># IMG / Stress/Strain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">StrStaMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Stress/Strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Append d-zero for one ring&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_APPENDDZERO</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Append d-zero&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Fit stress/strain data&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_STRSTAFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Fit stress/strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Update d-zero from ave d-zero&#39;</span><span class="p">,</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_UPDATEDZERO</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Update d-zero&#39;</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Fit stress/strain data for all images&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_STRSTAALLFIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;All image fit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy stress/strain data to other images&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_STRSTACOPY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy stress/strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Save stress/strain data to file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_STRSTASAVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save stress/strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">StrStaEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Load stress/strain data from file&#39;</span><span class="p">,</span> 
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_STRSTALOAD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Load stress/strain&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># PDF / PDF Controls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PDFMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;PDF Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;PDF Controls&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Add element to sample composition&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PDFADDELEMENT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Add element&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete element from sample composition&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PDFDELELEMENT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete element&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy PDF controls&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PDFCOPYCONTROLS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy controls&#39;</span><span class="p">)</span>
        <span class="c">#        self.PDFEdit.Append(help=&#39;Load PDF controls from file&#39;,id=wxID_PDFLOADCONTROLS, kind=wx.ITEM_NORMAL,</span>
        <span class="c">#            text=&#39;Load Controls&#39;)</span>
        <span class="c">#        self.PDFEdit.Append(help=&#39;Save PDF controls to file&#39;, id=wxID_PDFSAVECONTROLS, kind=wx.ITEM_NORMAL,</span>
        <span class="c">#            text=&#39;Save controls&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute PDF&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PDFCOMPUTE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Compute PDF&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PDFEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute all PDFs&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PDFCOMPUTEALL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Compute all PDFs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># Phase / General tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataGeneral</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataGeneral</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;General&#39;</span><span class="p">,</span> <span class="n">helpLbl</span><span class="o">=</span><span class="s">&#39;Phase/General&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataGeneral</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataGeneral</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Compute&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute Fourier map&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_FOURCALC</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Fourier map&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Search Fourier map&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_FOURSEARCH</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Search map&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Run charge flipping&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_CHARGEFLIP</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Charge flipping&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear map&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_FOURCLEAR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear map&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Run Monte Carlo - Simulated Annealing&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SINGLEMCSA</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;MC/SA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">GeneralCalc</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Run Monte Carlo - Simulated Annealing on multiprocessors&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MULTIMCSA</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Multi MC/SA&#39;</span><span class="p">)</span>            <span class="c">#currently not useful</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># Phase / Data tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Data&#39;</span><span class="p">,</span> <span class="n">helpLbl</span><span class="o">=</span><span class="s">&#39;Phase/Data&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DataEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDRADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add powder histograms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select new powder histograms to be used for this phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_HKLFADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add single crystal histograms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select new single crystal histograms to be used for this phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DATADELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Remove histograms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Remove histograms from use for this phase&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Phase / Atoms tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomsMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">AtomsMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Compute&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSEDITADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Append atom&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Appended as an H atom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSVIEWADD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Append view point&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Appended as an H atom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSEDITINSERT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Insert atom&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atom row to insert before; inserted as an H atom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMVIEWINSERT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Insert view point&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atom row to insert before; inserted as an H atom&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMMOVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Move atom to view point&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select single atom to move&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSEDITDELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete atom&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms to delete first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSREFINE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Set atom refinement flags&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms to refine first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSMODIFY</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Modify atom parameters&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms to modify first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSTRANSFORM</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Transform atoms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms to transform first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RELOADDRAWATOMS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reload draw atoms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Reload atom drawing list&#39;</span><span class="p">)</span>
        <span class="n">submenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomEdit</span><span class="o">.</span><span class="n">AppendMenu</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span> <span class="s">&#39;Reimport atoms&#39;</span><span class="p">,</span> <span class="n">submenu</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Reimport atoms from file; sequence must match&#39;</span><span class="p">)</span>
        <span class="c"># setup a cascade menu for the formats that have been defined</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReImportMenuId</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c"># points to readers for each menu entry</span>
        <span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">G2frame</span><span class="o">.</span><span class="n">ImportPhaseReaderlist</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">help</span><span class="o">=</span><span class="n">reader</span><span class="o">.</span><span class="n">longFormatName</span><span class="p">,</span>
                <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;reimport coordinates from &#39;</span><span class="o">+</span><span class="n">reader</span><span class="o">.</span><span class="n">formatName</span><span class="o">+</span><span class="s">&#39; file&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ReImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="n">reader</span>
        <span class="n">item</span> <span class="o">=</span> <span class="n">submenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Reimport coordinates, try to determine format from file&#39;</span><span class="p">,</span>
            <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;guess format from file&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ReImportMenuId</span><span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># try all readers</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSDISAGL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Show Distances &amp;&amp; Angles&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute distances &amp; angles for selected atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ATOMSPDISAGL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Save Distances &amp;&amp; Angles&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute distances &amp; angles for selected atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span><span class="o">.</span><span class="n">ISOcalc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">AtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">wxID_ISODISP</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Compute ISODISTORT mode values&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute values of ISODISTORT modes from atom parameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
                 
        <span class="c"># Phase / Draw Options tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataDrawOptions</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DataDrawOptions</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Draw Options&#39;</span><span class="p">,</span> <span class="n">helpLbl</span><span class="o">=</span><span class="s">&#39;Phase/Draw Options&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DataDrawOptions</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
        
        <span class="c"># Phase / Draw Atoms tab </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Draw Atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomCompute</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRigidBody</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomCompute</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Compute&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Restraints&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomsMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRigidBody</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Rigid body&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWATOMSTYLE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Atom style&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWATOMLABEL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Atom label&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWATOMCOLOR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Atom color&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select atoms first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWATOMRESETCOLOR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Reset atom colors&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Resets all atom colors to defaults&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWVIEWPOINT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;View point&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;View point is 1st atom selected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWADDEQUIV</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add atoms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add symmetry &amp; cell equivalents to drawing set from selected atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWTRANSFORM</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Transform atoms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Transform selected atoms by symmetry &amp; cell translations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWFILLCOORD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Fill CN-sphere&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Fill coordination sphere for selected atoms&#39;</span><span class="p">)</span>            
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWFILLCELL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Fill unit cell&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Fill unit cell with selected atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWDELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete atoms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete atoms from drawing set&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWDISTVP</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;View pt. dist.&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute distance of selected atoms from view point&#39;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWDISAGLTOR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Dist. Ang. Tors.&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute distance, angle or torsion for 2-4 selected atoms&#39;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomCompute</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWPLANE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Best plane&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute best plane for 4+ selected atoms&#39;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWRESTRBOND</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add bond restraint&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add bond restraint for selected atoms (2)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWRESTRANGLE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add angle restraint&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add angle restraint for selected atoms (3: one end 1st)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWRESTRPLANE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add plane restraint&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add plane restraint for selected atoms (4+)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRestraint</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWRESTRCHIRAL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add chiral restraint&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add chiral restraint for selected atoms (4: center atom 1st)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DrawAtomRigidBody</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_DRAWDEFINERB</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Define rigid body&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Define rigid body with selected atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>

        <span class="c"># Phase / MCSA tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MCSAMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;MC/SA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;MC/SA&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ADDMCSAATOM</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add atom&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add single atom to MC/SA model&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ADDMCSARB</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Add rigid body&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Add rigid body to MC/SA model&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_CLEARMCSARB</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear rigid bodies&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear all atoms &amp; rigid bodies from MC/SA model&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MOVEMCSA</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Move MC/SA solution&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Move MC/SA solution to atom list&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MCSAEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_MCSACLEARRESULTS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear results&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear table of MC/SA results&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Phase / Texture tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">TextureMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Texture&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">TextureEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Texture&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_REFINETEXTURE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Refine texture&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Refine the texture coefficients from sequential Pawley results&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">TextureEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_CLEARTEXTURE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear texture&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear the texture coefficients&#39;</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Phase / Pawley tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">PawleyMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Pawley&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">PawleyEdit</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Operations&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PAWLEYLOAD</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Pawley create&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Initialize Pawley reflection list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PAWLEYESTIMATE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Pawley estimate&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Estimate initial Pawley intensities&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PawleyEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PAWLEYUPDATE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Pawley update&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Update negative Pawley intensities with -0.5*Fobs and turn off refinemnt&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
            
        <span class="c"># Phase / Map peaks tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Map peaks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Map peaks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSMOVE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Move peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Move selected peaks to atom list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSVIEWPT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;View point&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;View point is 1st peak selected&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSDISTVP</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;View pt. dist.&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Compute distance of selected peaks from view point&#39;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_SHOWBONDS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Hide bonds&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Hide or show bonds between peak positions&#39;</span><span class="p">)</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSDA</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Calc dist/ang&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Calculate distance or angle for selection&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_FINDEQVPEAKS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Equivalent peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Find equivalent peaks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSUNIQUE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Unique peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select unique set&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSDELETE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Delete peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Delete selected peaks&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">MapPeaksEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_PEAKSCLEAR</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Clear peaks&#39;</span><span class="p">,</span> 
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Clear the map peak list&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>

        <span class="c"># Phase / Rigid bodies tab</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PrefillDataMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesMenu</span><span class="p">,</span><span class="n">helpType</span><span class="o">=</span><span class="s">&#39;Rigid bodies&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;Select tab&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;Edit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_ASSIGNATMS2RB</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Assign atoms to rigid body&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Select &amp; position rigid body in structure of existing atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_AUTOFINDRESRB</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Auto find residues&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Auto find of residue RBs in macromolecule&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_COPYRBPARMS</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Copy rigid body parms&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Copy rigid body location &amp; TLS parameters&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_GLOBALTHERM</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Global thermal motion&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Global setting of residue thermal motion models&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_GLOBALRESREFINE</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Global residue refine&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Global setting of residue RB refinement flags&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">RigidBodiesEdit</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_RBREMOVEALL</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Remove all rigid bodies&#39;</span><span class="p">,</span>
            <span class="n">help</span><span class="o">=</span><span class="s">&#39;Remove all rigid body assignment for atoms&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">PostfillDataMenu</span><span class="p">()</span>
    <span class="c"># end of GSAS-II menu definitions</span>
        
    <span class="k">def</span> <span class="nf">_init_ctrls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="c">#style=wx.DEFAULT_FRAME_STYLE ^ wx.CLOSE_BOX | wx.FRAME_FLOAT_ON_PARENT ,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_FRAME_STYLE</span> <span class="o">^</span> <span class="n">wx</span><span class="o">.</span><span class="n">CLOSE_BOX</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">size</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;GSAS-II data display&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_menus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">frame</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G2frame</span> <span class="o">=</span> <span class="n">frame</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ctrls</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">clientSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
        <span class="n">Size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSize</span><span class="p">()</span>
        <span class="n">xPos</span> <span class="o">=</span> <span class="n">clientSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">Size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Point</span><span class="p">(</span><span class="n">xPos</span><span class="p">,</span><span class="n">clientSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">250</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">AtomGrid</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">selectedRow</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">def</span> <span class="nf">setSizePosLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Width</span><span class="p">):</span>
        <span class="n">clientSize</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ClientDisplayRect</span><span class="p">()</span>
        <span class="n">Width</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Width</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">clientSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="mi">300</span><span class="p">)</span>
        <span class="n">Width</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">Width</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">300</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">Width</span><span class="p">)</span>
<span class="c">#        self.SetPosition(wx.Point(clientSize[2]-Width[0],clientSize[1]+250))</span>
        
    <span class="k">def</span> <span class="nf">Clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ClearBackground</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DestroyChildren</span><span class="p">()</span>
                   
<span class="c">################################################################################</span>
<span class="c">#####  GSNotebook</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="GSNoteBook"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GSNoteBook">[docs]</a><span class="k">class</span> <span class="nc">GSNoteBook</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">aui</span><span class="o">.</span><span class="n">AuiNotebook</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Notebook used in various locations; implemented with wx.aui extension</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="n">size</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">aui</span><span class="o">.</span><span class="n">AuiNotebook</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                    <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">aui</span><span class="o">.</span><span class="n">AUI_NB_TOP</span> <span class="o">|</span>
                                    <span class="n">wx</span><span class="o">.</span><span class="n">aui</span><span class="o">.</span><span class="n">AUI_NB_SCROLL_BUTTONS</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">size</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>
                                                      
    <span class="k">def</span> <span class="nf">Clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="n">GSNoteBook</span><span class="o">.</span><span class="n">DeleteAllPages</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">FindPage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="n">numPage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPageCount</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">page</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numPage</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetPageText</span><span class="p">(</span><span class="n">page</span><span class="p">)</span> <span class="o">==</span> <span class="n">name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">page</span>

    <span class="k">def</span> <span class="nf">ChangeSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">page</span><span class="p">):</span>
        <span class="c"># in wx.Notebook ChangeSelection is like SetSelection, but it</span>
        <span class="c"># does not invoke the event related to pressing the tab button</span>
        <span class="c"># I don&#39;t see a way to do that in aui.</span>
        <span class="n">oldPage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetSelection</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">oldPage</span>

    <span class="c"># def __getattribute__(self,name):</span>
    <span class="c">#     &#39;&#39;&#39;This method provides a way to print out a message every time</span>
    <span class="c">#     that a method in a class is called -- to see what all the calls</span>
    <span class="c">#     might be, or where they might be coming from.</span>
    <span class="c">#     Cute trick for debugging!</span>
    <span class="c">#     &#39;&#39;&#39;</span>
    <span class="c">#     attr = object.__getattribute__(self, name)</span>
    <span class="c">#     if hasattr(attr, &#39;__call__&#39;):</span>
    <span class="c">#         def newfunc(*args, **kwargs):</span>
    <span class="c">#             print(&#39;GSauiNoteBook calling %s&#39; %attr.__name__)</span>
    <span class="c">#             result = attr(*args, **kwargs)</span>
    <span class="c">#             return result</span>
    <span class="c">#         return newfunc</span>
    <span class="c">#     else:</span>
    <span class="c">#         return attr</span>
            
<span class="c">################################################################################</span>
<span class="c">#####  GSGrid</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="GSGrid"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GSGrid">[docs]</a><span class="k">class</span> <span class="nc">GSGrid</span><span class="p">(</span><span class="n">wg</span><span class="o">.</span><span class="n">Grid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Basic wx.Grid implementation</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>                    
        <span class="c">#self.SetSize(parent.GetClientSize())</span>
        <span class="c"># above removed to speed drawing of initial grid</span>
        <span class="c"># does not appear to be needed</span>
            
    <span class="k">def</span> <span class="nf">Clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">Grid</span><span class="o">.</span><span class="n">ClearGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">SetCellStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="n">readonly</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetCellBackgroundColour</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">color</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetReadOnly</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">isReadOnly</span><span class="o">=</span><span class="n">readonly</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">GetSelection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c">#this is to satisfy structure drawing stuff in G2plt when focus changes</span>
        <span class="k">return</span> <span class="bp">None</span>

<div class="viewcode-block" id="GSGrid.InstallGridToolTip"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GSGrid.InstallGridToolTip">[docs]</a>    <span class="k">def</span> <span class="nf">InstallGridToolTip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rowcolhintcallback</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;code to display a tooltip for each item on a grid</span>
<span class="sd">        from http://wiki.wxpython.org/wxGrid%20ToolTips</span>

<span class="sd">        :param function rowcolhintcallback: a routine that returns a text</span>
<span class="sd">          string depending on the selected row and column</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">prev_rowcol</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">,</span><span class="bp">None</span><span class="p">]</span>
        <span class="k">def</span> <span class="nf">OnMouseMotion</span><span class="p">(</span><span class="n">evt</span><span class="p">):</span>
            <span class="c"># evt.GetRow() and evt.GetCol() would be nice to have here,</span>
            <span class="c"># but as this is a mouse event, not a grid event, they are not</span>
            <span class="c"># available and we need to compute them by hand.</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CalcUnscrolledPosition</span><span class="p">(</span><span class="n">evt</span><span class="o">.</span><span class="n">GetPosition</span><span class="p">())</span>
            <span class="n">row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">YToRow</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">col</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">XToCol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">)</span> <span class="o">!=</span> <span class="n">prev_rowcol</span> <span class="ow">and</span> <span class="n">row</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">prev_rowcol</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                <span class="n">hinttext</span> <span class="o">=</span> <span class="n">rowcolhintcallback</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">hinttext</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">hinttext</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">GetGridWindow</span><span class="p">()</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="n">hinttext</span><span class="p">)</span>
            <span class="n">evt</span><span class="o">.</span><span class="n">Skip</span><span class="p">()</span>

        <span class="n">wx</span><span class="o">.</span><span class="n">EVT_MOTION</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetGridWindow</span><span class="p">(),</span> <span class="n">OnMouseMotion</span><span class="p">)</span>
                                                
<span class="c">################################################################################</span>
<span class="c">#####  Table</span>
<span class="c">################################################################################           </span>
       </div></div>
<div class="viewcode-block" id="Table"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.Table">[docs]</a><span class="k">class</span> <span class="nc">Table</span><span class="p">(</span><span class="n">wg</span><span class="o">.</span><span class="n">PyGridTableBase</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Basic data table for use with GSgrid</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">[],</span> <span class="n">rowLabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colLabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">types</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="n">wg</span><span class="o">.</span><span class="n">PyGridTableBase</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span> <span class="o">=</span> <span class="n">colLabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowLabels</span> <span class="o">=</span> <span class="n">rowLabels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataTypes</span> <span class="o">=</span> <span class="n">types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">AppendRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">numRows</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">def</span> <span class="nf">CanGetValueAs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">typeName</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">:</span>
            <span class="n">colType</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">typeName</span> <span class="o">==</span> <span class="n">colType</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">CanSetValueAs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">typeName</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">CanGetValueAs</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">typeName</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">DeleteRow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetData</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetData</span><span class="p">([])</span>
        <span class="n">new</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">irow</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">irow</span> <span class="o">&lt;&gt;</span> <span class="n">pos</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetData</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">GetColLabelValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="nf">GetData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">()):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetRowValues</span><span class="p">(</span><span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">GetNumberCols</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        
    <span class="k">def</span> <span class="nf">GetNumberRows</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">GetRowLabelValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowLabels</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowLabels</span><span class="p">[</span><span class="n">row</span><span class="p">]</span>
        
    <span class="k">def</span> <span class="nf">GetColValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">()):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">GetRowValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()):</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">data</span>
        
    <span class="k">def</span> <span class="nf">GetTypeName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataTypes</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">GetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
            
    <span class="k">def</span> <span class="nf">InsertRows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,[])</span>
            <span class="n">pos</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="k">def</span> <span class="nf">IsEmptyCell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        
    <span class="k">def</span> <span class="nf">OnKeyPress</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">dellist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetSelectedRows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">GetKeyCode</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">WXK_DELETE</span> <span class="ow">and</span> <span class="n">dellist</span><span class="p">:</span>
            <span class="n">grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetView</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dellist</span><span class="p">:</span> <span class="n">grid</span><span class="o">.</span><span class="n">DeleteRow</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                
    <span class="k">def</span> <span class="nf">SetColLabelValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="n">numcols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="n">numcols</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">colLabels</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="n">label</span>
        
    <span class="k">def</span> <span class="nf">SetData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">SetRowValues</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
                
    <span class="k">def</span> <span class="nf">SetRowLabelValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowLabels</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">=</span><span class="n">label</span>
            
    <span class="k">def</span> <span class="nf">SetRowValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
            
    <span class="k">def</span> <span class="nf">SetValue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">innerSetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">,</span><span class="n">value</span>
                <span class="c"># add a new row</span>
                <span class="k">if</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">():</span>
                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
                <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">innerSetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        
<span class="c">################################################################################</span>
<span class="c">#### Help</span>
<span class="c">################################################################################</span>
</div>
<div class="viewcode-block" id="ShowHelp"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.ShowHelp">[docs]</a><span class="k">def</span> <span class="nf">ShowHelp</span><span class="p">(</span><span class="n">helpType</span><span class="p">,</span><span class="n">frame</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Called to bring up a web page for documentation.&#39;&#39;&#39;</span>
    <span class="k">global</span> <span class="n">htmlFirstUse</span>
    <span class="c"># look up a definition for help info from dict</span>
    <span class="n">helplink</span> <span class="o">=</span> <span class="n">helpLocDict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">helpType</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">helplink</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c"># no defined link to use, create a default based on key</span>
        <span class="n">helplink</span> <span class="o">=</span> <span class="s">&#39;gsasII.html#&#39;</span><span class="o">+</span><span class="n">helpType</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
    <span class="n">helplink</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path2GSAS2</span><span class="p">,</span><span class="s">&#39;help&#39;</span><span class="p">,</span><span class="n">helplink</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">helpMode</span> <span class="o">==</span> <span class="s">&#39;internal&#39;</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">htmlPanel</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">helplink</span><span class="p">)</span>
            <span class="n">htmlFrame</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">htmlFrame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mi">610</span><span class="p">,</span> <span class="mi">510</span><span class="p">))</span>
            <span class="n">htmlFrame</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">htmlFrame</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s">&quot;HTML Window&quot;</span><span class="p">)</span> <span class="c"># N.B. reset later in LoadFile</span>
            <span class="n">htmlPanel</span> <span class="o">=</span> <span class="n">MyHtmlPanel</span><span class="p">(</span><span class="n">htmlFrame</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">htmlPanel</span><span class="o">.</span><span class="n">LoadFile</span><span class="p">(</span><span class="n">helplink</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="s">&quot;file://&quot;</span>
        <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;win&#39;</span><span class="p">):</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">htmlFirstUse</span><span class="p">:</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open_new</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">helplink</span><span class="p">)</span>
            <span class="n">htmlFirstUse</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">webbrowser</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">pfx</span><span class="o">+</span><span class="n">helplink</span><span class="p">,</span> <span class="n">new</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">autoraise</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c">################################################################################</span>
<span class="c">#####  Notebook</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="UpdateNotebook"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.UpdateNotebook">[docs]</a><span class="k">def</span> <span class="nf">UpdateNotebook</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Called when the data tree notebook entry is selected. Allows for</span>
<span class="sd">    editing of the text in that tree entry</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">OnNoteBook</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Notebook&#39;</span><span class="p">),</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;nt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">name</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">AppendText</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;Notebook&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetClientSize</span><span class="p">(),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_MULTILINE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">TE_DONTWRAP</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnNoteBook</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnNoteBook</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">AppendText</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">AppendText</span><span class="p">(</span><span class="s">&#39;Notebook entry @ &#39;</span><span class="o">+</span><span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">250</span><span class="p">])</span>
            
<span class="c">################################################################################</span>
<span class="c">#####  Controls</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="UpdateControls"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.UpdateControls">[docs]</a><span class="k">def</span> <span class="nf">UpdateControls</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Edit overall GSAS-II controls in main Controls data tree entry</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c">#patch</span>
    <span class="k">if</span> <span class="s">&#39;deriv type&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;analytic Hessian&#39;</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;min dM/M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0001</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;shift factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>        
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;F**2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;minF/sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s">&#39;shift factor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;shift factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">if</span> <span class="s">&#39;max cyc&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="k">if</span> <span class="s">&#39;F**2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;F**2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;minF/sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="s">&#39;Author&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;no name&#39;</span>
    <span class="k">if</span> <span class="s">&#39;FreePrm1&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;FreePrm1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Sample humidity (%)&#39;</span>
    <span class="k">if</span> <span class="s">&#39;FreePrm2&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;FreePrm2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Sample voltage (V)&#39;</span>
    <span class="k">if</span> <span class="s">&#39;FreePrm3&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;FreePrm3&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Applied load (MN)&#39;</span>
    <span class="k">if</span> <span class="s">&#39;Copy2Next&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Copy2Next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">if</span> <span class="s">&#39;Reverse Seq&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s">&#39;Reverse Seq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>   
     
    
    <span class="c">#end patch</span>

    <span class="k">def</span> <span class="nf">SeqSizer</span><span class="p">():</span>
        
        <span class="k">def</span> <span class="nf">OnSelectData</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">choices</span> <span class="o">=</span> <span class="n">GetPatternTreeDataNames</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,[</span><span class="s">&#39;PWDR&#39;</span><span class="p">,])</span>
            <span class="n">sel</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="s">&#39;Seq Data&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Seq Data&#39;</span><span class="p">]:</span>
                    <span class="n">sel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">choices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
                <span class="n">sel</span> <span class="o">=</span> <span class="p">[</span><span class="n">choices</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Seq Data&#39;</span><span class="p">]]</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2MultiChoiceDialog</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span> <span class="s">&#39;Sequential refinement&#39;</span><span class="p">,</span>
                                      <span class="s">&#39;Select dataset to include&#39;</span><span class="p">,</span>
                                      <span class="n">choices</span><span class="p">)</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">SetSelections</span><span class="p">(</span><span class="n">sel</span><span class="p">)</span>
            <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">sel</span> <span class="ow">in</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelections</span><span class="p">():</span>
                    <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">choices</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;Seq Data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">names</span>                
                <span class="n">G2frame</span><span class="o">.</span><span class="n">EnableSeqRefineMenu</span><span class="p">()</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="n">UpdateControls</span><span class="p">,</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            
        <span class="k">def</span> <span class="nf">OnReverse</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;Reverse Seq&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">reverseSel</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            
        <span class="k">def</span> <span class="nf">OnCopySel</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;Copy2Next&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copySel</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span> 
                    
        <span class="n">seqSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">dataSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">dataSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Sequential Refinement: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">selSeqData</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Select data&#39;</span><span class="p">)</span>
        <span class="n">selSeqData</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="n">OnSelectData</span><span class="p">)</span>
        <span class="n">dataSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">selSeqData</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">SeqData</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Seq Data&#39;</span><span class="p">,[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">SeqData</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="s">&#39; (no powder data selected)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="s">&#39; (&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SeqData</span><span class="p">))</span><span class="o">+</span><span class="s">&#39; dataset(s) selected)&#39;</span>

        <span class="n">dataSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">lbl</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">seqSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">dataSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">SeqData</span><span class="p">:</span>
            <span class="n">selSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">reverseSel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Reverse order?&#39;</span><span class="p">)</span>
            <span class="n">reverseSel</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span><span class="n">OnReverse</span><span class="p">)</span>
            <span class="n">reverseSel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Reverse Seq&#39;</span><span class="p">])</span>
            <span class="n">selSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">reverseSel</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">copySel</span> <span class="o">=</span>  <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Copy results to next histogram?&#39;</span><span class="p">)</span>
            <span class="n">copySel</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span><span class="n">OnCopySel</span><span class="p">)</span>
            <span class="n">copySel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Copy2Next&#39;</span><span class="p">])</span>
            <span class="n">selSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">copySel</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">seqSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">selSizer</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">seqSizer</span>
        
    <span class="k">def</span> <span class="nf">LSSizer</span><span class="p">():</span>        
        
        <span class="k">def</span> <span class="nf">OnDerivType</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">derivSel</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
            <span class="n">derivSel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">])</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">CallAfter</span><span class="p">(</span><span class="n">UpdateControls</span><span class="p">,</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            
        <span class="k">def</span> <span class="nf">OnConvergence</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">1.e-9</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">Cnvrg</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())))</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0001</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;min dM/M&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">Cnvrg</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            
        <span class="k">def</span> <span class="nf">OnMaxCycles</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">maxCyc</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
            <span class="n">maxCyc</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]))</span>
                        
        <span class="k">def</span> <span class="nf">OnFactor</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Factr</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span><span class="mf">0.00001</span><span class="p">),</span><span class="mf">100.</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;shift factor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">Factr</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            
        <span class="k">def</span> <span class="nf">OnFsqRef</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;F**2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fsqRef</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">OnMinSig</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">minSig</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()),</span><span class="mf">0.</span><span class="p">),</span><span class="mf">5.</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;minF/sig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">minSig</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>

        <span class="n">LSSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="n">cols</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">vgap</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">hgap</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
        <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Refinement derivatives: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">Choice</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;analytic Jacobian&#39;</span><span class="p">,</span><span class="s">&#39;numeric&#39;</span><span class="p">,</span><span class="s">&#39;analytic Hessian&#39;</span><span class="p">]</span>
        <span class="n">derivSel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">],</span><span class="n">choices</span><span class="o">=</span><span class="n">Choice</span><span class="p">,</span>
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="p">)</span>
        <span class="n">derivSel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">])</span>
        <span class="n">derivSel</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="n">OnDerivType</span><span class="p">)</span>
            
        <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">derivSel</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Min delta-M/M: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">Cnvrg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2g</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;min dM/M&#39;</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="n">Cnvrg</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnConvergence</span><span class="p">)</span>
        <span class="n">Cnvrg</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnConvergence</span><span class="p">)</span>
        <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Cnvrg</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;Hessian&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;deriv type&#39;</span><span class="p">]:</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Max cycles: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">Choice</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;0&#39;</span><span class="p">,</span><span class="s">&#39;1&#39;</span><span class="p">,</span><span class="s">&#39;2&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">,</span><span class="s">&#39;5&#39;</span><span class="p">,</span><span class="s">&#39;10&#39;</span><span class="p">,</span><span class="s">&#39;15&#39;</span><span class="p">,</span><span class="s">&#39;20&#39;</span><span class="p">]</span>
            <span class="n">maxCyc</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]),</span><span class="n">choices</span><span class="o">=</span><span class="n">Choice</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="p">)</span>
            <span class="n">maxCyc</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;max cyc&#39;</span><span class="p">]))</span>
            <span class="n">maxCyc</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="n">OnMaxCycles</span><span class="p">)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">maxCyc</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Initial shift factor: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">Factr</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.5f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;shift factor&#39;</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="n">Factr</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnFactor</span><span class="p">)</span>
            <span class="n">Factr</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnFactor</span><span class="p">)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">Factr</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">Sngl</span><span class="p">:</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">),)</span>
            <span class="n">fsqRef</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Refine HKLF as F^2? &#39;</span><span class="p">)</span>
            <span class="n">fsqRef</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;F**2&#39;</span><span class="p">])</span>
            <span class="n">fsqRef</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span><span class="n">OnFsqRef</span><span class="p">)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">fsqRef</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Min obs/sig (0-5): &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
            <span class="n">minSig</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;minF/sig&#39;</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
            <span class="n">minSig</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnMinSig</span><span class="p">)</span>
            <span class="n">minSig</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnMinSig</span><span class="p">)</span>
            <span class="n">LSSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">minSig</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">LSSizer</span>
        
    <span class="k">def</span> <span class="nf">AuthSizer</span><span class="p">():</span>

        <span class="k">def</span> <span class="nf">OnAuthor</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">data</span><span class="p">[</span><span class="s">&#39;Author&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>

        <span class="n">Author</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Author&#39;</span><span class="p">]</span>
        <span class="n">authSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">authSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; CIF Author (last, first):&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">auth</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">Author</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnAuthor</span><span class="p">)</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnAuthor</span><span class="p">)</span>
        <span class="n">authSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">auth</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">authSizer</span>
        
        
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetStatusBar</span><span class="p">():</span>
        <span class="n">Status</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">CreateStatusBar</span><span class="p">()</span>
        <span class="n">Status</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;Controls&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">)</span>
    <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">ControlsMenu</span><span class="p">)</span>
    <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Refinement Controls:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>    
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">LSSizer</span><span class="p">())</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">SeqSizer</span><span class="p">())</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">AuthSizer</span><span class="p">())</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="mi">0</span><span class="p">)</span>
        
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>    
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">))</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">(</span><span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">))</span>
     
<span class="c">################################################################################</span>
<span class="c">#####  Comments</span>
<span class="c">################################################################################           </span>
       </div>
<span class="k">def</span> <span class="nf">UpdateComments</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>                   

    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;Comments&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetClientSize</span><span class="p">(),</span>
        <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_MULTILINE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_DONTWRAP</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">AppendText</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">([</span><span class="mi">400</span><span class="p">,</span><span class="mi">250</span><span class="p">])</span>
            
<span class="c">################################################################################</span>
<span class="c">#####  Display of Sequential Results</span>
<span class="c">################################################################################           </span>
       
<div class="viewcode-block" id="UpdateSeqResults"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.UpdateSeqResults">[docs]</a><span class="k">def</span> <span class="nf">UpdateSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">prevSize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called when the Sequential Results data tree entry is selected</span>
<span class="sd">    to show results from a sequential refinement.</span>
<span class="sd">    </span>
<span class="sd">    :param wx.Frame G2frame: main GSAS-II data tree windows</span>

<span class="sd">    :param dict data: a dictionary containing the following items:  </span>

<span class="sd">            * &#39;histNames&#39; - list of histogram names in order as processed by Sequential Refinement</span>
<span class="sd">            * &#39;varyList&#39; - list of variables - identical over all refinements in sequence</span>
<span class="sd">              note that this is the original list of variables, prior to processing</span>
<span class="sd">              constraints. </span>
<span class="sd">            * keyed by histName - dictionaries for all data sets processed, which contains:</span>

<span class="sd">              * &#39;variables&#39;- result[0] from leastsq call</span>
<span class="sd">              * &#39;varyList&#39; - list of variables passed to leastsq call (not same as above)</span>
<span class="sd">              * &#39;sig&#39; - esds for variables</span>
<span class="sd">              * &#39;covMatrix&#39; - covariance matrix from individual refinement</span>
<span class="sd">              * &#39;title&#39; - histogram name; same as dict item name</span>
<span class="sd">              * &#39;newAtomDict&#39; - new atom parameters after shifts applied</span>
<span class="sd">              * &#39;newCellDict&#39; - refined cell parameters after shifts to A0-A5 from Dij terms applied&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">GetSampleParms</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;Make a dictionary of the sample parameters are not the same over the</span>
<span class="sd">        refinement series.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">sampleParmDict</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Temperature&#39;</span><span class="p">:[],</span><span class="s">&#39;Pressure&#39;</span><span class="p">:[],</span>
                          <span class="s">&#39;FreePrm1&#39;</span><span class="p">:[],</span><span class="s">&#39;FreePrm2&#39;</span><span class="p">:[],</span><span class="s">&#39;FreePrm3&#39;</span><span class="p">:[],}</span>
        <span class="n">Controls</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>
            <span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;Controls&#39;</span><span class="p">))</span>
        <span class="n">sampleParm</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">:</span>
            <span class="n">Id</span> <span class="o">=</span> <span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
            <span class="n">sampleData</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">Id</span><span class="p">,</span><span class="s">&#39;Sample Parameters&#39;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sampleParmDict</span><span class="p">:</span>
                <span class="n">sampleParmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sampleData</span><span class="p">[</span><span class="n">item</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sampleParmDict</span><span class="p">:</span>
            <span class="n">frstValue</span> <span class="o">=</span> <span class="n">sampleParmDict</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sampleParmDict</span><span class="p">[</span><span class="n">item</span><span class="p">])</span><span class="o">-</span><span class="n">frstValue</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;FreePrm&#39;</span><span class="p">):</span>
                    <span class="n">sampleParm</span><span class="p">[</span><span class="n">Controls</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span> <span class="o">=</span> <span class="n">sampleParmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">sampleParm</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampleParmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">sampleParm</span>

    <span class="k">def</span> <span class="nf">GetColumnInfo</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns column label, lists of values and errors (or None) for each column in the table</span>
<span class="sd">        for plotting. The column label is reformatted from Unicode to MatPlotLib encoding</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plotName</span> <span class="o">=</span> <span class="n">plotSpCharFix</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">plotName</span><span class="p">,</span><span class="n">colList</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">colSigs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span>
            
    <span class="k">def</span> <span class="nf">PlotSelect</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Plots a row (covariance) or column on double-click&#39;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelectedCols</span><span class="p">()</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelectedRows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotSelectedSequence</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span><span class="n">GetColumnInfo</span><span class="p">,</span><span class="n">SelectXaxis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">histNames</span><span class="p">[</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>       <span class="c">#only does 1st one selected</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotCovariance</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span>
                <span class="s">&#39;Select row or columns&#39;</span><span class="p">,</span>
                <span class="s">&#39;Nothing selected in table. Click on column or row label(s) to plot. N.B. Grid selection can be a bit funky.&#39;</span>
                <span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">OnPlotSelSeq</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;plot the selected columns or row from menu command&#39;</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelectedCols</span><span class="p">())</span> <span class="c"># ignore selection order</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelectedRows</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotSelectedSequence</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">cols</span><span class="p">,</span><span class="n">GetColumnInfo</span><span class="p">,</span><span class="n">SelectXaxis</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">histNames</span><span class="p">[</span><span class="n">rows</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>       <span class="c">#only does 1st one selected</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotCovariance</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span>
                <span class="s">&#39;Select columns&#39;</span><span class="p">,</span>
                <span class="s">&#39;No columns or rows selected in table. Click on row or column labels to select fields for plotting.&#39;</span>
                <span class="p">)</span>
            
    <span class="k">def</span> <span class="nf">OnSaveSelSeqCSV</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;export the selected columns to a .csv file from menu command&#39;</span>
        <span class="n">OnSaveSelSeq</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">csv</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">OnSaveSelSeq</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">csv</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="s">&#39;export the selected columns to a .txt file from menu command&#39;</span>
        <span class="k">def</span> <span class="nf">WriteCSV</span><span class="p">():</span>
            <span class="k">def</span> <span class="nf">WriteList</span><span class="p">(</span><span class="n">headerItems</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
                <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">headerItems</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">lbl</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
                <span class="k">return</span> <span class="n">line</span>
            <span class="n">head</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">havesig</span><span class="p">:</span>
                    <span class="n">head</span> <span class="o">+=</span> <span class="p">[</span><span class="n">item</span><span class="p">,</span><span class="s">&#39;esd-&#39;</span><span class="o">+</span><span class="n">item</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">head</span> <span class="o">+=</span> <span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="n">SeqFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">WriteList</span><span class="p">(</span><span class="n">head</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">saveNames</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&quot;&#39;</span><span class="o">+</span><span class="n">saveNames</span><span class="p">[</span><span class="n">row</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;&quot;&#39;</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">havesig</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">saveData</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">])</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">saveSigs</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">saveData</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">])</span>
                <span class="n">SeqFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">WriteSeq</span><span class="p">():</span>
            <span class="n">lenName</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">saveNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">line</span> <span class="o">=</span> <span class="s">&#39;  </span><span class="si">%s</span><span class="s">  &#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">lenName</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">havesig</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%12s</span><span class="s"> </span><span class="si">%12s</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span><span class="s">&#39;esd&#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%12s</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">12</span><span class="p">))</span>
            <span class="n">SeqFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">saveNames</span><span class="p">):</span>
                <span class="n">line</span> <span class="o">=</span> <span class="s">&quot; &#39;</span><span class="si">%s</span><span class="s">&#39; &quot;</span><span class="o">%</span><span class="p">(</span><span class="n">saveNames</span><span class="p">[</span><span class="n">row</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">havesig</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%12.6f</span><span class="s"> </span><span class="si">%12.6f</span><span class="s"> &#39;</span><span class="o">%</span><span class="p">(</span><span class="n">saveData</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">],</span><span class="n">saveSigs</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">line</span> <span class="o">+=</span> <span class="s">&#39; </span><span class="si">%12.6f</span><span class="s"> &#39;</span><span class="o">%</span><span class="n">saveData</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">]</span>
                <span class="n">SeqFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

        <span class="n">cols</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelectedCols</span><span class="p">())</span> <span class="c"># ignore selection order</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetNumberRows</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">ErrorDialog</span><span class="p">(</span><span class="s">&#39;Select columns&#39;</span><span class="p">,</span>
                             <span class="s">&#39;No columns selected in table. Click on column labels to select fields for output.&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">saveNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetRowLabelValue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nrows</span><span class="p">)]</span>
        <span class="n">saveData</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">saveSigs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">havesig</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span><span class="n">vals</span><span class="p">,</span><span class="n">sigs</span> <span class="o">=</span> <span class="n">GetColumnInfo</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
            <span class="n">saveData</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="k">if</span> <span class="n">sigs</span><span class="p">:</span>
                <span class="n">havesig</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
                <span class="n">saveSigs</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigs</span>
        <span class="k">if</span> <span class="n">csv</span><span class="p">:</span>
            <span class="n">wild</span> <span class="o">=</span> <span class="s">&#39;CSV output file (*.csv)|*.csv&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wild</span> <span class="o">=</span> <span class="s">&#39;Text output file (*.txt)|*.txt&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span>
            <span class="n">G2frame</span><span class="p">,</span>
            <span class="s">&#39;Choose text output file for your selection&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="n">wild</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CHANGE_DIR</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">SeqTextFile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="n">SeqTextFile</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="n">SeqTextFile</span><span class="p">)</span> 
                <span class="n">SeqFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">SeqTextFile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">csv</span><span class="p">:</span>
                    <span class="n">WriteCSV</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">WriteSeq</span><span class="p">()</span>
                <span class="n">SeqFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                
    <span class="k">def</span> <span class="nf">striphist</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">insChar</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="s">&#39;strip a histogram number from a var name&#39;</span>
        <span class="n">sv</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">var</span>
        <span class="n">sv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">insChar</span>
        <span class="k">return</span> <span class="s">&#39;:&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sv</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">plotSpCharFix</span><span class="p">(</span><span class="n">lbl</span><span class="p">):</span>
        <span class="s">&#39;Change selected unicode characters to their matplotlib equivalent&#39;</span>
        <span class="k">for</span> <span class="n">u</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="p">(</span><span class="s">u&#39;</span><span class="se">\u03B1</span><span class="s">&#39;</span><span class="p">,</span><span class="s">r&#39;$\alpha$&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">u&#39;</span><span class="se">\u03B2</span><span class="s">&#39;</span><span class="p">,</span><span class="s">r&#39;$\beta$&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">u&#39;</span><span class="se">\u03B3</span><span class="s">&#39;</span><span class="p">,</span><span class="s">r&#39;$\gamma$&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s">u&#39;</span><span class="se">\u0394\u03C7</span><span class="s">&#39;</span><span class="p">,</span><span class="s">r&#39;$\Delta\chi$&#39;</span><span class="p">),</span>
            <span class="p">]:</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lbl</span>
    
    <span class="k">def</span> <span class="nf">SelectXaxis</span><span class="p">():</span>
        <span class="s">&#39;returns a selected column number (or None) as the X-axis selection&#39;</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetNumberCols</span><span class="p">()</span>
        <span class="n">colNames</span> <span class="o">=</span> <span class="p">[</span><span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetColLabelValue</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ncols</span><span class="p">)]</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2SingleChoiceDialog</span><span class="p">(</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span>
            <span class="s">&#39;Select x-axis parameter for plot or Cancel for sequence number&#39;</span><span class="p">,</span>
            <span class="s">&#39;Select X-axis&#39;</span><span class="p">,</span>
            <span class="n">colNames</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">col</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">col</span>
    
    <span class="k">def</span> <span class="nf">EnablePseudoVarMenus</span><span class="p">():</span>
        <span class="s">&#39;Enables or disables the PseudoVar menu items that require existing defs&#39;</span>
        <span class="k">if</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">]:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxDELSEQVAR</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialPvars</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxEDITSEQVAR</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">DelPseudoVar</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Ask the user to select a pseudo var expression to delete&#39;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">ItemSelector</span><span class="p">(</span>
            <span class="n">choices</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span>
            <span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select expressions to remove&#39;</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&#39;Delete expression&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selected</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">selected</span><span class="p">:</span>
            <span class="n">UpdateSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span> <span class="c"># redisplay variables</span>

    <span class="k">def</span> <span class="nf">EditPseudoVar</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Edit an existing pseudo var expression&#39;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="n">ItemSelector</span><span class="p">(</span>
                <span class="n">choices</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select an expression to edit&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&#39;Edit expression&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2exG</span><span class="o">.</span><span class="n">ExpressionDialog</span><span class="p">(</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">PSvarDict</span><span class="p">,</span>
                <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">selected</span><span class="p">]],</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&quot;Edit the PseudoVar expression&quot;</span><span class="p">,</span>
                <span class="n">VarLabel</span><span class="o">=</span><span class="s">&quot;PseudoVar #&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">selected</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
                <span class="n">fit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newobj</span><span class="p">:</span>
                <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">newobj</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">selected</span><span class="p">]]</span>
                <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">calcobj</span><span class="o">.</span><span class="n">eObj</span><span class="o">.</span><span class="n">expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">newobj</span>
                <span class="n">UpdateSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span> <span class="c"># redisplay variables</span>
        
    <span class="k">def</span> <span class="nf">AddNewPseudoVar</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Create a new pseudo var expression&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2exG</span><span class="o">.</span><span class="n">ExpressionDialog</span><span class="p">(</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">PSvarDict</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&#39;Enter an expression for a PseudoVar here&#39;</span><span class="p">,</span>
            <span class="n">VarLabel</span> <span class="o">=</span> <span class="s">&quot;New PseudoVar&quot;</span><span class="p">,</span>
            <span class="n">fit</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">calcobj</span><span class="o">.</span><span class="n">eObj</span><span class="o">.</span><span class="n">expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">UpdateSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSize</span><span class="p">())</span> <span class="c"># redisplay variables</span>

    <span class="c"># PATCH: this routine can go away eventually</span>
    <span class="k">def</span> <span class="nf">CreatePSvarDict</span><span class="p">(</span><span class="n">seqnum</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create a parameter dict (parmDict) for everything that might be used</span>
<span class="sd">        in a PseudoVar.</span>
<span class="sd">        Also creates a list of revised labels (modVaryList) for the covariance matrix to</span>
<span class="sd">        match the items in the parameter dict and a matching list of ESDs (ESDvaryList).</span>
<span class="sd">        </span>
<span class="sd">        :param int seqnum: the sequence number of the histogram in the sequential</span>
<span class="sd">          refinement</span>
<span class="sd">        :param str name: the name of the histogram in the data tree</span>

<span class="sd">        :returns: parmDict,modVaryList,ESDvaryList</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">parmDict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">modVaryList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">key</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;varyList&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;variables&#39;</span><span class="p">])):</span>
            <span class="n">skey</span> <span class="o">=</span> <span class="n">striphist</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">skey</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newAtomDict&#39;</span><span class="p">,{}):</span>
                <span class="c"># replace coordinate shifts with equivalents from lookup table</span>
                <span class="n">repkey</span><span class="p">,</span><span class="n">repval</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;newAtomDict&#39;</span><span class="p">][</span><span class="n">skey</span><span class="p">]</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">repkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">repval</span>
                <span class="n">modVaryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repkey</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">skey</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newCellDict&#39;</span><span class="p">,{}):</span>
                <span class="c"># replace recip. cell term shifts with equivalents from lookup table        </span>
                <span class="n">repkey</span><span class="p">,</span><span class="n">repval</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;newCellDict&#39;</span><span class="p">][</span><span class="n">skey</span><span class="p">]</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">repkey</span><span class="p">]</span> <span class="o">=</span> <span class="n">repval</span>
                <span class="n">modVaryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">repkey</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">modVaryList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="c"># create a cell parm dict, override initial settings with values in parmDict</span>
        <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
            <span class="n">phasedict</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
            <span class="n">pId</span> <span class="o">=</span> <span class="n">phasedict</span><span class="p">[</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
            <span class="n">cell</span> <span class="o">=</span> <span class="n">Rcelldict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">cell</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="n">lbl</span><span class="p">:</span><span class="n">parmDict</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="k">for</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">RcellLbls</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="k">if</span> <span class="n">lbl</span> <span class="ow">in</span> <span class="n">parmDict</span><span class="p">}</span>
                <span class="p">)</span>
            <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span> <span class="c"># prefix for A values from phase</span>
            <span class="n">A</span><span class="p">,</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">cellFill</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">cell</span><span class="p">,</span><span class="n">zeroDict</span><span class="p">[</span><span class="n">pId</span><span class="p">])</span>
            <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pfx</span><span class="o">+</span><span class="n">cellUlbl</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">val</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span>
                             <span class="nb">enumerate</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
                             <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span>
                             <span class="p">})</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&quot;vol&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="c"># now add misc terms to dict</span>
        <span class="n">parmDict</span><span class="p">[</span><span class="s">&#39;Rwp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;Rvals&#39;</span><span class="p">][</span><span class="s">&#39;Rwp&#39;</span><span class="p">]</span>
        <span class="n">parmDict</span><span class="p">[</span><span class="s">u&#39;</span><span class="se">\u0394\u03C7\u00B2</span><span class="s"> (%)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">100.</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;Rvals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;DelChi2&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sampleParms</span><span class="p">:</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">sampleParms</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">seqnum</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">parmDict</span><span class="p">,</span><span class="n">modVaryList</span><span class="p">,</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;sig&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">UpdateParmDict</span><span class="p">(</span><span class="n">parmDict</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;generate the atom positions and the direct &amp; reciprocal cell values,</span>
<span class="sd">        because they might be needed to evaluate the pseudovar</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">Ddict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s">&#39;D11&#39;</span><span class="p">,</span><span class="s">&#39;D22&#39;</span><span class="p">,</span><span class="s">&#39;D33&#39;</span><span class="p">,</span><span class="s">&#39;D12&#39;</span><span class="p">,</span><span class="s">&#39;D13&#39;</span><span class="p">,</span><span class="s">&#39;D23&#39;</span><span class="p">],</span>
                         <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                     <span class="p">)</span>
        <span class="n">delList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phaselist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parmDict</span><span class="p">:</span> 
            <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span> <span class="k">continue</span>
            <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="k">continue</span>
            <span class="c"># remove the dA[xyz] terms, they would only bring confusion</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;dA&#39;</span><span class="p">):</span>
                <span class="n">delList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="c"># compute and update the corrected reciprocal cell terms using the Dij values</span>
            <span class="k">elif</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Ddict</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">phaselist</span><span class="p">:</span> <span class="n">phaselist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">akey</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="n">Ddict</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">parmDict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">+=</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                <span class="n">delList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">delList</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">parmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>                
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phaselist</span><span class="p">:</span>
            <span class="n">pId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
            <span class="c"># apply cell symmetry</span>
            <span class="n">A</span><span class="p">,</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">cellFill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="p">,</span><span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">parmDict</span><span class="p">,</span><span class="n">zeroDict</span><span class="p">[</span><span class="n">pId</span><span class="p">])</span>
            <span class="c"># convert to direct cell &amp; add the unique terms to the dictionary</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]:</span>
                    <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="n">cellUlbl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">parmDict</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
            <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="s">&#39;vol&#39;</span>
            <span class="n">parmDict</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">parmDict</span>

    <span class="k">def</span> <span class="nf">EvalPSvarDeriv</span><span class="p">(</span><span class="n">calcobj</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="n">ESD</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Evaluate an expression derivative with respect to a</span>
<span class="sd">        GSAS-II variable name.</span>

<span class="sd">        Note this likely could be faster if the loop over calcobjs were done</span>
<span class="sd">        inside after the Dict was created. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">step</span> <span class="o">=</span> <span class="n">ESD</span><span class="o">/</span><span class="mi">10</span>
        <span class="n">Ddict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s">&#39;D11&#39;</span><span class="p">,</span><span class="s">&#39;D22&#39;</span><span class="p">,</span><span class="s">&#39;D33&#39;</span><span class="p">,</span><span class="s">&#39;D12&#39;</span><span class="p">,</span><span class="s">&#39;D13&#39;</span><span class="p">,</span><span class="s">&#39;D23&#39;</span><span class="p">],</span>
                         <span class="p">[</span><span class="s">&#39;A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)])</span>
                     <span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phaselist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">incr</span> <span class="ow">in</span> <span class="n">step</span><span class="p">,</span><span class="o">-</span><span class="n">step</span><span class="p">:</span>
            <span class="n">VparmDict</span> <span class="o">=</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>            
            <span class="c"># as saved, the parmDict has updated &#39;A[xyz]&#39; values, but &#39;dA[xyz]&#39;</span>
            <span class="c"># values are not zeroed: fix that!</span>
            <span class="n">VparmDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">item</span><span class="p">:</span><span class="mf">0.0</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parmDict</span> <span class="k">if</span> <span class="s">&#39;dA&#39;</span> <span class="ow">in</span> <span class="n">item</span><span class="p">})</span>
            <span class="n">VparmDict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">+=</span> <span class="n">incr</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">Dict2Map</span><span class="p">(</span><span class="n">VparmDict</span><span class="p">,[])</span> <span class="c"># apply constraints</span>
            <span class="c"># generate the atom positions and the direct &amp; reciprocal cell values now, because they might</span>
            <span class="c"># needed to evaluate the pseudovar</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">VparmDict</span><span class="p">:</span> 
                <span class="k">if</span> <span class="s">&#39;:&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="k">continue</span>
                <span class="c"># apply any new shifts to atom positions</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;dA&#39;</span><span class="p">):</span>
                    <span class="n">VparmDict</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">))]</span> <span class="o">+=</span> <span class="n">VparmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
                    <span class="n">VparmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="c"># compute and update the corrected reciprocal cell terms using the Dij values</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="n">Ddict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">phaselist</span><span class="p">:</span> <span class="n">phaselist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="n">akey</span> <span class="o">=</span> <span class="n">key</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="n">Ddict</span><span class="p">[</span><span class="n">key</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                    <span class="n">VparmDict</span><span class="p">[</span><span class="n">akey</span><span class="p">]</span> <span class="o">+=</span> <span class="n">VparmDict</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phaselist</span><span class="p">:</span>
                <span class="n">pId</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="c"># apply cell symmetry</span>
                <span class="n">A</span><span class="p">,</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">cellFill</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="p">,</span><span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">VparmDict</span><span class="p">,</span><span class="n">zeroDict</span><span class="p">[</span><span class="n">pId</span><span class="p">])</span>
                <span class="c"># convert to direct cell &amp; add the unique terms to the dictionary</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]:</span>
                        <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="n">cellUlbl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">VparmDict</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
                <span class="n">lbl</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span><span class="o">+</span><span class="s">&#39;vol&#39;</span>
                <span class="n">VparmDict</span><span class="p">[</span><span class="n">lbl</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="c"># dict should be fully updated, use it &amp; calculate</span>
            <span class="n">calcobj</span><span class="o">.</span><span class="n">SetupCalc</span><span class="p">(</span><span class="n">VparmDict</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calcobj</span><span class="o">.</span><span class="n">EvalExpression</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">step</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">EnableParFitEqMenus</span><span class="p">():</span>
        <span class="s">&#39;Enables or disables the Parametric Fit menu items that require existing defs&#39;</span>
        <span class="k">if</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxDELPARFIT</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxEDITPARFIT</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialPfit</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="n">wxDOPARFIT</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ParEqEval</span><span class="p">(</span><span class="n">Values</span><span class="p">,</span><span class="n">calcObjList</span><span class="p">,</span><span class="n">varyList</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Evaluate the parametric expression(s)</span>
<span class="sd">        :param list Values: a list of values for each variable parameter</span>
<span class="sd">        :param list calcObjList: a list of :class:`GSASIIobj.ExpressionCalcObj`</span>
<span class="sd">          expression objects to evaluate</span>
<span class="sd">        :param list varyList: a list of variable names for each value in Values</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">calcobj</span> <span class="ow">in</span> <span class="n">calcObjList</span><span class="p">:</span>
            <span class="n">calcobj</span><span class="o">.</span><span class="n">UpdateVars</span><span class="p">(</span><span class="n">varyList</span><span class="p">,</span><span class="n">Values</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">calcobj</span><span class="o">.</span><span class="n">depVal</span><span class="o">-</span><span class="n">calcobj</span><span class="o">.</span><span class="n">EvalExpression</span><span class="p">())</span><span class="o">/</span><span class="n">calcobj</span><span class="o">.</span><span class="n">depSig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">DoParEqFit</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">eqObj</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="s">&#39;Parametric fit minimizer&#39;</span>
        <span class="n">varyValueDict</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># dict of variables and their initial values</span>
        <span class="n">calcObjList</span> <span class="o">=</span> <span class="p">[]</span> <span class="c"># expression objects, ready to go for each data point</span>
        <span class="k">if</span> <span class="n">eqObj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">eqObjDict</span> <span class="o">=</span> <span class="p">{</span><span class="n">eqObj</span><span class="o">.</span><span class="n">expression</span><span class="p">:</span><span class="n">eqObj</span><span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">eqObjDict</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">eqObjDict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">eqObjDict</span><span class="p">[</span><span class="n">expr</span><span class="p">]</span>
            <span class="c"># assemble refined vars for this equation</span>
            <span class="n">varyValueDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">var</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetVariedVarVal</span><span class="p">()})</span>
            <span class="c"># lookup dependent var position</span>
            <span class="n">depVar</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetDepVar</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">depVar</span> <span class="ow">in</span> <span class="n">colLabels</span><span class="p">:</span>
                <span class="n">indx</span> <span class="o">=</span> <span class="n">colLabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">depVar</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;Dependent variable &#39;</span><span class="o">+</span><span class="n">depVar</span><span class="o">+</span><span class="s">&#39; not found&#39;</span><span class="p">)</span>
            <span class="c"># assemble a list of the independent variables</span>
            <span class="n">indepVars</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetIndependentVars</span><span class="p">()</span>
            <span class="c"># loop over each datapoint</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colList</span><span class="p">)):</span>
                <span class="c"># assemble equations to fit</span>
                <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="c"># prepare a dict of needed independent vars for this expression</span>
                <span class="n">indepVarDict</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colLabels</span><span class="p">)</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">indepVars</span><span class="p">}</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">SetupCalc</span><span class="p">(</span><span class="n">indepVarDict</span><span class="p">)</span>                
                <span class="c"># values and sigs for current value of dependent var</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">depVal</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">depSig</span> <span class="o">=</span> <span class="n">colSigs</span><span class="p">[</span><span class="n">indx</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="n">calcObjList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calcobj</span><span class="p">)</span>
        <span class="c"># varied parameters</span>
        <span class="n">varyList</span> <span class="o">=</span> <span class="n">varyValueDict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">varyValues</span> <span class="o">=</span> <span class="p">[</span><span class="n">varyValueDict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">varyList</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">varyList</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;no variables to refine!&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Fit Results&#39;</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">so</span><span class="o">.</span><span class="n">leastsq</span><span class="p">(</span><span class="n">ParEqEval</span><span class="p">,</span><span class="n">varyValues</span><span class="p">,</span><span class="n">full_output</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>   <span class="c">#ftol=Ftol,</span>
                                    <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">calcObjList</span><span class="p">,</span><span class="n">varyList</span><span class="p">)</span>
                                    <span class="p">)</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">covar</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">covar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,(</span><span class="n">var</span><span class="p">,</span><span class="n">val</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">varyList</span><span class="p">,</span><span class="n">values</span><span class="p">)):</span>
                    <span class="k">print</span> <span class="s">&#39;  &#39;</span><span class="p">,</span><span class="n">var</span><span class="p">,</span><span class="s">&#39; =&#39;</span><span class="p">,</span><span class="n">G2mth</span><span class="o">.</span><span class="n">ValEsd</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">covar</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">]))</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">print</span> <span class="s">&#39;Fit failed&#39;</span>
                <span class="k">return</span>
        <span class="c"># create a plot for each parametric variable</span>
        <span class="k">for</span> <span class="n">fitnum</span><span class="p">,</span><span class="n">expr</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">eqObjDict</span><span class="p">)):</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="n">eqObjDict</span><span class="p">[</span><span class="n">expr</span><span class="p">]</span>
            <span class="n">obj</span><span class="o">.</span><span class="n">UpdateVariedVars</span><span class="p">(</span><span class="n">varyList</span><span class="p">,</span><span class="n">values</span><span class="p">)</span>
            <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="c"># lookup dependent var position</span>
            <span class="n">indx</span> <span class="o">=</span> <span class="n">colLabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">GetDepVar</span><span class="p">())</span>
            <span class="c"># assemble a list of the independent variables</span>
            <span class="n">indepVars</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">GetIndependentVars</span><span class="p">()</span>            
            <span class="c"># loop over each datapoint</span>
            <span class="n">fitvals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colList</span><span class="p">)):</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">SetupCalc</span><span class="p">(</span>
                    <span class="p">{</span><span class="n">var</span><span class="p">:</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colLabels</span><span class="p">)</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">indepVars</span><span class="p">}</span>
                    <span class="p">)</span>
                <span class="n">fitvals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calcobj</span><span class="o">.</span><span class="n">EvalExpression</span><span class="p">())</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotSelectedSequence</span><span class="p">(</span>
                <span class="n">G2frame</span><span class="p">,[</span><span class="n">indx</span><span class="p">],</span><span class="n">GetColumnInfo</span><span class="p">,</span><span class="n">SelectXaxis</span><span class="p">,</span>
                <span class="n">fitnum</span><span class="p">,</span><span class="n">fitvals</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">SingleParEqFit</span><span class="p">(</span><span class="n">eqObj</span><span class="p">):</span>
        <span class="n">DoParEqFit</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">eqObj</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">DelParFitEq</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Ask the user to select function to delete&#39;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">txtlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">GetDepVar</span><span class="p">()</span><span class="o">+</span><span class="s">&#39; = &#39;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
        <span class="n">selected</span> <span class="o">=</span> <span class="n">ItemSelector</span><span class="p">(</span>
            <span class="n">txtlst</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span>
            <span class="n">multiple</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select a parametric equation to remove&#39;</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&#39;Delete equation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selected</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">selected</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">item</span><span class="p">]]</span>
        <span class="n">EnableParFitEqMenus</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]:</span> <span class="n">DoParEqFit</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">EditParFitEq</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Edit an existing parametric equation&#39;</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">txtlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">GetDepVar</span><span class="p">()</span><span class="o">+</span><span class="s">&#39; = &#39;</span><span class="o">+</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">selected</span> <span class="o">=</span> <span class="n">ItemSelector</span><span class="p">(</span>
                <span class="n">txtlst</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span>
                <span class="n">multiple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s">&#39;Select a parametric equation to edit&#39;</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&#39;Edit equation&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selected</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2exG</span><span class="o">.</span><span class="n">ExpressionDialog</span><span class="p">(</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">indepVarDict</span><span class="p">,</span>
                <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">selected</span><span class="p">]],</span>
                <span class="n">depVarDict</span><span class="o">=</span><span class="n">depVarDict</span><span class="p">,</span>
                <span class="n">header</span><span class="o">=</span><span class="s">&quot;Edit the formula for this minimization function&quot;</span><span class="p">,</span>
                <span class="n">ExtraButton</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Fit&#39;</span><span class="p">,</span><span class="n">SingleParEqFit</span><span class="p">])</span>
            <span class="n">newobj</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">newobj</span><span class="p">:</span>
                <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">newobj</span><span class="p">)</span>
                <span class="k">del</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">choices</span><span class="p">[</span><span class="n">selected</span><span class="p">]]</span>
                <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">calcobj</span><span class="o">.</span><span class="n">eObj</span><span class="o">.</span><span class="n">expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">newobj</span>
                <span class="n">EnableParFitEqMenus</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]:</span> <span class="n">DoParEqFit</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">AddNewParFitEq</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Create a new parametric equation to be fit to sequential results&#39;</span>

        <span class="c"># compile the variable names in previous freevars to avoid accidental name collisions</span>
        <span class="n">usedvarlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">eq</span><span class="p">,</span><span class="n">obj</span> <span class="ow">in</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">freeVars</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">freeVars</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">usedvarlist</span><span class="p">:</span> <span class="n">usedvarlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">freeVars</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">dlg</span> <span class="o">=</span> <span class="n">G2exG</span><span class="o">.</span><span class="n">ExpressionDialog</span><span class="p">(</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">indepVarDict</span><span class="p">,</span>
            <span class="n">depVarDict</span><span class="o">=</span><span class="n">depVarDict</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&#39;Define an equation to minimize in the parametric fit&#39;</span><span class="p">,</span>
            <span class="n">ExtraButton</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;Fit&#39;</span><span class="p">,</span><span class="n">SingleParEqFit</span><span class="p">],</span>
            <span class="n">usedVars</span><span class="o">=</span><span class="n">usedvarlist</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">obj</span><span class="p">:</span>
            <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
            <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">][</span><span class="n">calcobj</span><span class="o">.</span><span class="n">eObj</span><span class="o">.</span><span class="n">expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
            <span class="n">EnableParFitEqMenus</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]:</span> <span class="n">DoParEqFit</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                                            
    <span class="k">def</span> <span class="nf">GridSetToolTip</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Routine to show standard uncertainties for each element in table</span>
<span class="sd">        as a tooltip</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">colSigs</span><span class="p">[</span><span class="n">col</span><span class="p">]:</span>
            <span class="k">return</span> <span class="s">u&#39;</span><span class="se">\u03c3</span><span class="s"> = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">colSigs</span><span class="p">[</span><span class="n">col</span><span class="p">][</span><span class="n">row</span><span class="p">])</span>
        <span class="k">return</span> <span class="s">&#39;&#39;</span>
    
    <span class="c"># lookup table for unique cell parameters by symmetry</span>
    <span class="n">cellGUIlist</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,)],</span>
        <span class="p">[[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;3&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">,</span><span class="s">&#39;6/m&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;mmm&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;2/m&#39;</span><span class="o">+</span><span class="s">&#39;a&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;2/m&#39;</span><span class="o">+</span><span class="s">&#39;b&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;2/m&#39;</span><span class="o">+</span><span class="s">&#39;c&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">)],</span>
        <span class="p">[[</span><span class="s">&#39;-1&#39;</span><span class="p">],(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">)],</span>
        <span class="p">]</span>
    <span class="c"># cell labels</span>
    <span class="n">cellUlbl</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">u&#39;</span><span class="se">\u03B1</span><span class="s">&#39;</span><span class="p">,</span><span class="s">u&#39;</span><span class="se">\u03B2</span><span class="s">&#39;</span><span class="p">,</span><span class="s">u&#39;</span><span class="se">\u03B3</span><span class="s">&#39;</span><span class="p">)</span> <span class="c"># unicode a,b,c,alpha,beta,gamma</span>

    <span class="c">#======================================================================</span>
    <span class="c"># start processing sequential results here (UpdateSeqResults)</span>
    <span class="c">#======================================================================</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;No sequential refinement results&#39;</span>
        <span class="k">return</span>
    <span class="n">Histograms</span><span class="p">,</span><span class="n">Phases</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">GetUsedHistogramsAndPhasesfromTree</span><span class="p">()</span>
    <span class="n">Controls</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span><span class="s">&#39;Controls&#39;</span><span class="p">))</span>
    <span class="c"># create a place to store Pseudo Vars &amp; Parametric Fit functions, if needed</span>
    <span class="k">if</span> <span class="s">&#39;SeqPseudoVars&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Controls</span><span class="p">:</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="s">&#39;SeqParFitEqs&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Controls</span><span class="p">:</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqParFitEqs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">histNames</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;histNames&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetStatusBar</span><span class="p">():</span>
        <span class="n">Status</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">CreateStatusBar</span><span class="p">()</span>
        <span class="n">Status</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&quot;Select column to export; Double click on column to plot data; on row for Covariance&quot;</span><span class="p">)</span>
    <span class="n">sampleParms</span> <span class="o">=</span> <span class="n">GetSampleParms</span><span class="p">()</span>

    <span class="c"># make dict of varied atom coords keyed by absolute position</span>
    <span class="n">newAtomDict</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newAtomDict&#39;</span><span class="p">,{})</span> <span class="c"># dict with atom positions; relative &amp; absolute</span>
    <span class="c"># Possible error: the next might need to be data[histNames[0]][&#39;varyList&#39;]</span>
    <span class="c"># error will arise if there constraints on coordinates?</span>
    <span class="n">atomLookup</span> <span class="o">=</span> <span class="p">{</span><span class="n">newAtomDict</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newAtomDict</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;varyList&#39;</span><span class="p">]}</span>
    
    <span class="c"># make dict of varied cell parameters equivalents</span>
    <span class="n">ESDlookup</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># provides the Dij term for each Ak term (where terms are refined)</span>
    <span class="n">Dlookup</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># provides the Ak term for each Dij term (where terms are refined)</span>
    <span class="c"># N.B. These Dij vars are missing a histogram #</span>
    <span class="n">newCellDict</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newCellDict&#39;</span><span class="p">,{})</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">newCellDict</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;varyList&#39;</span><span class="p">]:</span>
            <span class="n">ESDlookup</span><span class="p">[</span><span class="n">newCellDict</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">Dlookup</span><span class="p">[</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">newCellDict</span><span class="p">[</span><span class="n">item</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="c"># add coordinate equivalents to lookup table</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="n">atomLookup</span><span class="p">:</span>
        <span class="n">Dlookup</span><span class="p">[</span><span class="n">atomLookup</span><span class="p">[</span><span class="n">parm</span><span class="p">]]</span> <span class="o">=</span> <span class="n">parm</span>
        <span class="n">ESDlookup</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="o">=</span> <span class="n">atomLookup</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span>

    <span class="c"># get unit cell &amp; symmetry for all phases &amp; initial stuff for later use</span>
    <span class="n">RecpCellTerms</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">SGdata</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">uniqCellIndx</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">initialCell</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">RcellLbls</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">zeroDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">Rcelldict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">phase</span> <span class="ow">in</span> <span class="n">Phases</span><span class="p">:</span>
        <span class="n">phasedict</span> <span class="o">=</span> <span class="n">Phases</span><span class="p">[</span><span class="n">phase</span><span class="p">]</span>
        <span class="n">pId</span> <span class="o">=</span> <span class="n">phasedict</span><span class="p">[</span><span class="s">&#39;pId&#39;</span><span class="p">]</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span> <span class="c"># prefix for A values from phase</span>
        <span class="n">RcellLbls</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
        <span class="n">RecpCellTerms</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">cell2A</span><span class="p">(</span><span class="n">phasedict</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;Cell&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="n">zeroDict</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">RcellLbls</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="mi">6</span><span class="o">*</span><span class="p">[</span><span class="mf">0.</span><span class="p">,]))</span>
        <span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="n">phasedict</span><span class="p">[</span><span class="s">&#39;General&#39;</span><span class="p">][</span><span class="s">&#39;SGData&#39;</span><span class="p">]</span>
        <span class="n">Rcelldict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">lbl</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">RcellLbls</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">RecpCellTerms</span><span class="p">[</span><span class="n">pId</span><span class="p">])})</span>
        <span class="n">laue</span> <span class="o">=</span> <span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">][</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">laue</span> <span class="o">==</span> <span class="s">&#39;2/m&#39;</span><span class="p">:</span>
            <span class="n">laue</span> <span class="o">+=</span> <span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">][</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">symlist</span><span class="p">,</span><span class="n">celllist</span> <span class="ow">in</span> <span class="n">cellGUIlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">laue</span> <span class="ow">in</span> <span class="n">symlist</span><span class="p">:</span>
                <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="n">celllist</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span> <span class="c"># should not happen</span>
            <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]:</span>
            <span class="n">initialCell</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)]</span> <span class="o">=</span>  <span class="n">RecpCellTerms</span><span class="p">[</span><span class="n">pId</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SequentialMenu</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;Sequential refinement results&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetStatusBar</span><span class="p">():</span>
        <span class="n">Status</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">CreateStatusBar</span><span class="p">()</span>
        <span class="n">Status</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">OnSaveSelSeq</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAVESEQSEL</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">OnSaveSelSeqCSV</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_SAVESEQSELCSV</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">OnPlotSelSeq</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PLOTSEQSEL</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">AddNewPseudoVar</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxADDSEQVAR</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">DelPseudoVar</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxDELSEQVAR</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">EditPseudoVar</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxEDITSEQVAR</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">AddNewParFitEq</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxADDPARFIT</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">DelParFitEq</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxDELPARFIT</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">EditParFitEq</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxEDITPARFIT</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">DoParEqFit</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxDOPARFIT</span><span class="p">)</span>
    <span class="n">EnablePseudoVarMenus</span><span class="p">()</span>
    <span class="n">EnableParFitEqMenus</span><span class="p">()</span>

    <span class="c">#-----------------------------------------------------------------------------------</span>
    <span class="c"># build up the data table by columns -----------------------------------------------</span>
    <span class="n">colList</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colSigs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">colLabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">nRows</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">histNames</span><span class="p">)</span>
    <span class="c"># start with Rwp values</span>
    <span class="n">colList</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;Rvals&#39;</span><span class="p">][</span><span class="s">&#39;Rwp&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">]]</span>
    <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
    <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="s">&#39;Rwp&#39;</span><span class="p">]</span>
    <span class="n">Types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="o">+</span><span class="s">&#39;:10,3&#39;</span><span class="p">,]</span>
    <span class="c"># add % change in Chi^2 in last cycle</span>
    <span class="k">if</span> <span class="s">&#39;SASD&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="p">[[</span><span class="mf">100.</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;Rvals&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;DelChi2&#39;</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">]]</span>
        <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="s">u&#39;</span><span class="se">\u0394\u03C7\u00B2</span><span class="s"> (%)&#39;</span><span class="p">]</span>
        <span class="n">Types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">,]</span>
    <span class="n">deltaChiCol</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">colLabels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="c"># add changing sample parameters to table</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sampleParms</span><span class="p">:</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">sampleParms</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>
        <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span>
        <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">Types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">,]</span>
    <span class="c"># add unique cell parameters</span>
    <span class="k">for</span> <span class="n">pId</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">RecpCellTerms</span><span class="p">):</span>
        <span class="n">pfx</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::&#39;</span> <span class="c"># prefix for A values from phase</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">cellESDs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="n">cellUlbl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]]</span>
        <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Vol&#39;</span><span class="p">]</span>
        <span class="n">Types</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]))</span><span class="o">*</span><span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">,]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">:</span>
            <span class="n">covData</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s">&#39;varyList&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">Dlookup</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">striphist</span><span class="p">(</span><span class="n">v</span><span class="p">),</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;varyList&#39;</span><span class="p">]],</span>
                <span class="s">&#39;covMatrix&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;covMatrix&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">RecpCellTerms</span><span class="p">[</span><span class="n">pId</span><span class="p">][:]</span> <span class="c"># make copy of starting A values</span>
            <span class="c"># update with refined values</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
                <span class="n">var</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pId</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;::A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ESDlookup</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;newCellDict&#39;</span><span class="p">][</span><span class="n">ESDlookup</span><span class="p">[</span><span class="n">var</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="c"># get refined value </span>
                    <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span> <span class="c"># override with updated value</span>
            <span class="c"># apply symmetry</span>
            <span class="n">Albls</span> <span class="o">=</span> <span class="p">[</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;A&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)]</span>
            <span class="n">cellDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">Albls</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
            <span class="n">A</span><span class="p">,</span><span class="n">zeros</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">cellFill</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">cellDict</span><span class="p">,</span><span class="n">zeroDict</span><span class="p">[</span><span class="n">pId</span><span class="p">])</span>
            <span class="c"># convert to direct cell &amp; add only unique values to table</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">vol</span> <span class="o">=</span> <span class="n">G2lat</span><span class="o">.</span><span class="n">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
            <span class="n">cE</span> <span class="o">=</span> <span class="n">G2stIO</span><span class="o">.</span><span class="n">getCellEsd</span><span class="p">(</span><span class="n">pfx</span><span class="p">,</span><span class="n">SGdata</span><span class="p">[</span><span class="n">pId</span><span class="p">],</span><span class="n">A</span><span class="p">,</span><span class="n">covData</span><span class="p">)</span>
            <span class="n">cells</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="n">vol</span><span class="p">]]</span>
            <span class="n">cellESDs</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">cE</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">uniqCellIndx</span><span class="p">[</span><span class="n">pId</span><span class="p">]]</span><span class="o">+</span><span class="p">[</span><span class="n">cE</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]]</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cells</span><span class="p">)</span>
        <span class="n">colSigs</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">cellESDs</span><span class="p">)</span>
    <span class="c"># add the variables that were refined; change from rows to columns</span>
    <span class="n">colList</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;variables&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">])</span>
    <span class="n">colLabels</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;varyList&#39;</span><span class="p">]</span>
    <span class="n">Types</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;varyList&#39;</span><span class="p">])</span><span class="o">*</span><span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">]</span>
    <span class="n">colSigs</span> <span class="o">+=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;sig&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">])</span>

    <span class="c"># tabulate constrained variables, removing histogram numbers if needed</span>
    <span class="c"># from parameter label</span>
    <span class="n">depValDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">depSigDict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;depParmDict&#39;</span><span class="p">,{}):</span>
            <span class="n">val</span><span class="p">,</span><span class="n">sig</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;depParmDict&#39;</span><span class="p">][</span><span class="n">var</span><span class="p">]</span>
            <span class="n">svar</span> <span class="o">=</span> <span class="n">striphist</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">svar</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">depValDict</span><span class="p">:</span>
               <span class="n">depValDict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">val</span><span class="p">]</span>
               <span class="n">depSigDict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sig</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="n">depValDict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
               <span class="n">depSigDict</span><span class="p">[</span><span class="n">svar</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sig</span><span class="p">)</span>
    <span class="c"># add the dependent constrained variables to the table</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">depValDict</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">depValDict</span><span class="p">[</span><span class="n">var</span><span class="p">])</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">histNames</span><span class="p">):</span> <span class="k">continue</span>
        <span class="n">colLabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">Types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">,]</span>
        <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">depSigDict</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">depValDict</span><span class="p">[</span><span class="n">var</span><span class="p">]]</span>

    <span class="c"># add atom parameters to table</span>
    <span class="n">colLabels</span> <span class="o">+=</span> <span class="n">atomLookup</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">Types</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">atomLookup</span><span class="p">)</span><span class="o">*</span><span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">parm</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">atomLookup</span><span class="p">):</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;newAtomDict&#39;</span><span class="p">][</span><span class="n">atomLookup</span><span class="p">[</span><span class="n">parm</span><span class="p">]][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">atomLookup</span><span class="p">[</span><span class="n">parm</span><span class="p">]</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;varyList&#39;</span><span class="p">]:</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s">&#39;varyList&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">atomLookup</span><span class="p">[</span><span class="n">parm</span><span class="p">])</span>
            <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;sig&#39;</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="c"># should not happen</span>
    <span class="c"># evaluate Pseudovars, their ESDs and add them to grid</span>
    <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">]:</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">Controls</span><span class="p">[</span><span class="s">&#39;SeqPseudoVars&#39;</span><span class="p">][</span><span class="n">expr</span><span class="p">]</span>
        <span class="n">calcobj</span> <span class="o">=</span> <span class="n">G2obj</span><span class="o">.</span><span class="n">ExpressionCalcObj</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
        <span class="n">valList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">esdList</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">seqnum</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">histNames</span><span class="p">):</span>
            <span class="n">sigs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;sig&#39;</span><span class="p">]</span>
            <span class="n">G2mv</span><span class="o">.</span><span class="n">InitVars</span><span class="p">()</span>
            <span class="n">parmDict</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;parmDict&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">parmDict</span><span class="p">:</span>
                <span class="n">constraintInfo</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;constraintInfo&#39;</span><span class="p">)</span>
                <span class="n">groups</span><span class="p">,</span><span class="n">parmlist</span><span class="p">,</span><span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">ihst</span> <span class="o">=</span> <span class="n">constraintInfo</span>
                <span class="n">varyList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;varyList&#39;</span><span class="p">]</span>
                <span class="n">parmDict</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;parmDict&#39;</span><span class="p">]</span>
                <span class="n">G2mv</span><span class="o">.</span><span class="n">GenerateConstraints</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span><span class="n">parmlist</span><span class="p">,</span><span class="n">varyList</span><span class="p">,</span><span class="n">constrDict</span><span class="p">,</span><span class="n">fixedList</span><span class="p">,</span><span class="n">parmDict</span><span class="p">,</span><span class="n">SeqHist</span><span class="o">=</span><span class="n">ihst</span><span class="p">)</span>
                <span class="n">derivs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">EvalPSvarDeriv</span><span class="p">(</span><span class="n">calcobj</span><span class="p">,</span><span class="n">parmDict</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span><span class="n">var</span><span class="p">,</span><span class="n">ESD</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">ESD</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">varyList</span><span class="p">,</span><span class="n">sigs</span><span class="p">)]</span>
                    <span class="p">)</span>
                <span class="n">esdList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">derivs</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">][</span><span class="s">&#39;covMatrix&#39;</span><span class="p">],</span><span class="n">derivs</span><span class="o">.</span><span class="n">T</span><span class="p">))</span>
                    <span class="p">))</span>
                <span class="n">PSvarDict</span> <span class="o">=</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">UpdateParmDict</span><span class="p">(</span><span class="n">PSvarDict</span><span class="p">)</span>
                <span class="c">#calcobj.SetupCalc(PSvarDict)</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">UpdateDict</span><span class="p">(</span><span class="n">PSvarDict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c"># PATCH: this routine can go away eventually once parmDict is always in</span>
                <span class="c"># sequential refinement</span>
                <span class="n">PSvarDict</span><span class="p">,</span><span class="n">unused</span><span class="p">,</span><span class="n">unused</span> <span class="o">=</span> <span class="n">CreatePSvarDict</span><span class="p">(</span><span class="n">seqnum</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
                <span class="n">calcobj</span><span class="o">.</span><span class="n">SetupCalc</span><span class="p">(</span><span class="n">PSvarDict</span><span class="p">)</span>
            <span class="n">valList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">calcobj</span><span class="o">.</span><span class="n">EvalExpression</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">esdList</span><span class="p">:</span>
            <span class="n">esdList</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="n">colList</span> <span class="o">+=</span> <span class="p">[</span><span class="n">valList</span><span class="p">]</span>
        <span class="n">colSigs</span> <span class="o">+=</span> <span class="p">[</span><span class="n">esdList</span><span class="p">]</span>
        <span class="n">colLabels</span> <span class="o">+=</span> <span class="p">[</span><span class="n">expr</span><span class="p">]</span>
        <span class="n">Types</span> <span class="o">+=</span> <span class="p">[</span><span class="n">wg</span><span class="o">.</span><span class="n">GRID_VALUE_FLOAT</span><span class="p">,]</span>
    <span class="c">#---- table build done -------------------------------------------------------------</span>

    <span class="c"># Make dict needed for creating &amp; editing pseudovars (PSvarDict).</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">parmDict</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;parmDict&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parmDict</span><span class="p">:</span>
        <span class="n">PSvarDict</span> <span class="o">=</span> <span class="n">parmDict</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">UpdateParmDict</span><span class="p">(</span><span class="n">PSvarDict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Sequential refinement needs to be rerun to obtain ESDs for PseudoVariables&#39;</span>
        <span class="c"># PATCH: this routine can go away eventually</span>
        <span class="n">PSvarDict</span><span class="p">,</span><span class="n">unused</span><span class="p">,</span><span class="n">unused</span> <span class="o">=</span> <span class="n">CreatePSvarDict</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="c"># Also dicts of dependent (depVarDict) &amp; independent vars (indepVarDict)</span>
    <span class="c"># for Parametric fitting from the data table</span>
    <span class="n">parmDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">colLabels</span><span class="p">,</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colList</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="c"># scratch dict w/all values in table</span>
    <span class="n">parmDict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span><span class="n">var</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newCellDict&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span> <span class="c">#  add varied reciprocal cell terms</span>
    <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">indepVarDict</span> <span class="o">=</span> <span class="p">{</span>     <span class="c">#  values in table w/o ESDs</span>
        <span class="n">var</span><span class="p">:</span><span class="n">colList</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colLabels</span><span class="p">)</span> <span class="k">if</span> <span class="n">colSigs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span>
        <span class="p">}</span>
    <span class="c"># make dict of dependent vars (w/ESDs) that are not converted (Dij to Ak or dAx to Ax) </span>
    <span class="n">depVarDict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">var</span><span class="p">:</span><span class="n">colList</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">var</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">colLabels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colSigs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">striphist</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">Dlookup</span>
        <span class="p">}</span>
    <span class="c"># add recip cell coeff. values</span>
    <span class="n">depVarDict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">var</span><span class="p">:</span><span class="n">val</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;newCellDict&#39;</span><span class="p">,{})</span><span class="o">.</span><span class="n">values</span><span class="p">()})</span>
    
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="n">GSGrid</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span> <span class="o">=</span> <span class="n">Table</span><span class="p">(</span>
        <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">colList</span><span class="p">)],</span>     <span class="c"># convert from columns to rows</span>
        <span class="n">colLabels</span><span class="o">=</span><span class="n">colLabels</span><span class="p">,</span><span class="n">rowLabels</span><span class="o">=</span><span class="n">histNames</span><span class="p">,</span><span class="n">types</span><span class="o">=</span><span class="n">Types</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetTable</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">EnableEditing</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wg</span><span class="o">.</span><span class="n">EVT_GRID_LABEL_LEFT_DCLICK</span><span class="p">,</span> <span class="n">PlotSelect</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetRowLabelSize</span><span class="p">(</span><span class="mi">8</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>       <span class="c">#pretty arbitrary 8</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetMargins</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">AutoSizeColumns</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prevSize</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetSize</span><span class="p">(</span><span class="n">prevSize</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">([</span><span class="mi">700</span><span class="p">,</span><span class="mi">350</span><span class="p">])</span>
    <span class="c"># highlight unconverged shifts </span>
    <span class="k">if</span> <span class="s">&#39;SASD&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">histNames</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">histNames</span><span class="p">):</span>
            <span class="n">deltaChi</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">SeqTable</span><span class="o">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">deltaChiCol</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">deltaChi</span> <span class="o">&gt;</span> <span class="mf">10.</span><span class="p">:</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetCellStyle</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">deltaChiCol</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">deltaChi</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">:</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetCellStyle</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">deltaChiCol</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="mi">255</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">InstallGridToolTip</span><span class="p">(</span><span class="n">GridSetToolTip</span><span class="p">)</span>
    <span class="c">#======================================================================</span>
    <span class="c"># end UpdateSeqResults; done processing sequential results</span>
    <span class="c">#======================================================================</span>

    <span class="c"># make dict with vars for use in PseudoVars</span>
    <span class="c"># name = histNames[0]</span>
    <span class="c"># parmDict = dict(zip(colLabels,zip(*colList)[0]))</span>
    <span class="c"># # create a dict with the refined Ax values for all phases (only)</span>
    <span class="c"># refCellDict = {var:val for var,val in data[name][&#39;newCellDict&#39;].values()}</span>
    <span class="c"># # compute the Ai values for each phase, updated with refined values and</span>
    <span class="c"># # with symmetry constraints applied</span>
    <span class="c"># for pId in Alist:     # loop over phases</span>
    <span class="c">#     Albls = [str(pId)+&#39;::A&#39;+str(i) for i in range(6)]</span>
    <span class="c">#     cellDict = {var:refCellDict.get(var,val) for var,val in zip(Albls,Alist[pId])}</span>
    <span class="c">#     zeroDict = {var:0.0 for var in Albls}</span>
    <span class="c">#     A,zeros = G2stIO.cellFill(str(pId)+&#39;::&#39;,SGdata[pId],cellDict,zeroDict)</span>
    <span class="c">#     parmDict.update(dict(zip(Albls,A)))</span>

<span class="c">#    print data[name][&#39;varyList&#39;]</span>
<span class="c">#            </span>
    <span class="c"># print &#39;vars for PVar dict&#39;</span>
    <span class="c"># for i,(var,val) in enumerate(zip(colLabels,zip(*colList)[0])):</span>
    <span class="c">#     if var in data[name][&#39;varyList&#39;]:</span>
    <span class="c">#         print var,Dlookup.get(striphist(var),var),val,parmDict.get(Dlookup.get(striphist(var),var))</span>
    <span class="c">#         pass</span>
    <span class="c">#     #else:</span>
    <span class="c">#     #    print i,var,colSigs[i]</span>
    <span class="c"># print &#39;vars for PVar dict again&#39;</span>
    
<span class="c">################################################################################</span>
<span class="c">#####  Main PWDR panel</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="UpdatePWHKPlot"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.UpdatePWHKPlot">[docs]</a><span class="k">def</span> <span class="nf">UpdatePWHKPlot</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Called when the histogram main tree entry is called. Displays the</span>
<span class="sd">    histogram weight factor, refinement statistics for the histogram</span>
<span class="sd">    and the range of data for a simulation.</span>

<span class="sd">    Also invokes a plot of the histogram.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">onEditSimRange</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="s">&#39;Edit simulation range&#39;</span>
        <span class="n">inp</span> <span class="o">=</span> <span class="p">[</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]),</span>
            <span class="bp">None</span>
            <span class="p">]</span>
        <span class="n">inp</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;start angle&#39;</span><span class="p">,</span> <span class="s">&#39;end angle&#39;</span><span class="p">,</span> <span class="s">&#39;step size&#39;</span><span class="p">)</span>
        <span class="n">dictlst</span> <span class="o">=</span> <span class="p">[</span><span class="n">inp</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
        <span class="n">elemlst</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">ScrolledMultiEditor</span><span class="p">(</span>
            <span class="n">G2frame</span><span class="p">,[</span><span class="n">inp</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">),</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inp</span><span class="p">)),</span> <span class="n">names</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="s">&#39;Edit simulation range&#39;</span><span class="p">,</span>
            <span class="n">minvals</span><span class="o">=</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.001</span><span class="p">,</span><span class="mf">0.0001</span><span class="p">),</span>
            <span class="n">maxvals</span><span class="o">=</span><span class="p">(</span><span class="mf">180.</span><span class="p">,</span><span class="mf">180.</span><span class="p">,</span><span class="o">.</span><span class="mi">1</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">CenterOnParent</span><span class="p">()</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">!=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">inp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">inp</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">end</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="n">inp</span>
        <span class="k">else</span><span class="p">:</span>                
            <span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">step</span> <span class="o">=</span> <span class="n">inp</span>
        <span class="n">step</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
        <span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">end</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">newdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">newdata</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="c"># too small a range - reject</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">newdata</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newdata</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">newdata</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newdata</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newdata</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">newdata</span><span class="p">)]</span>
        <span class="n">Tmin</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Tmax</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="s">&#39;Limits&#39;</span><span class="p">),</span>
            <span class="p">[(</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">),[</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">]])</span>
        <span class="n">UpdatePWHKPlot</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">kind</span><span class="p">,</span><span class="n">item</span><span class="p">)</span> <span class="c"># redisplay data screen</span>

    <span class="k">def</span> <span class="nf">OnErrorAnalysis</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotDeltSig</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">kind</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">OnWtFactor</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wtval</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">wtval</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">onCopySelectedItems</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Respond to menu item to copy multiple sections from a histogram.</span>
<span class="sd">        Need this here to pass on the G2frame object. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">CopySelectedHistItems</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
           
    <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
<span class="c">#patches</span>
    <span class="k">if</span> <span class="s">&#39;wtFactor&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;wtFactor&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="nb">list</span><span class="p">)</span> <span class="ow">and</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;HKLF&#39;</span><span class="p">:</span>
        <span class="n">RefData</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;RefList&#39;</span><span class="p">:[],</span><span class="s">&#39;FF&#39;</span><span class="p">:[]}</span>
        <span class="k">for</span> <span class="n">ref</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">RefData</span><span class="p">[</span><span class="s">&#39;RefList&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">[:</span><span class="mi">11</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">ref</span><span class="p">[</span><span class="mi">13</span><span class="p">],])</span>
            <span class="n">RefData</span><span class="p">[</span><span class="s">&#39;FF&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">14</span><span class="p">])</span>
        <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefData</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
<span class="c">#end patches</span>
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
    <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">HistMenu</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">OnErrorAnalysis</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDANALYSIS</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="n">onCopySelectedItems</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_PWDCOPY</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">)</span>
    
    <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),)</span>
    <span class="n">wtSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
    <span class="n">wtSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39; Weight factor: &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
    <span class="n">wtval</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;wtFactor&#39;</span><span class="p">]),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_PROCESS_ENTER</span><span class="p">)</span>
    <span class="n">wtval</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnWtFactor</span><span class="p">)</span>
    <span class="n">wtval</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnWtFactor</span><span class="p">)</span>
    <span class="n">wtSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wtval</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wtSizer</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;Dummy&#39;</span><span class="p">):</span>
        <span class="n">simSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
        <span class="n">Tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">num</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">step</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tmax</span> <span class="o">-</span> <span class="n">Tmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">num</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="s">u&#39;2</span><span class="se">\u03b8</span><span class="s">&#39;</span> <span class="c"># 2theta</span>
        <span class="n">lbl</span> <span class="o">=</span>  <span class="s">u&#39;Simulation range: {:.2f} to {:.2f} {:s}</span><span class="se">\n</span><span class="s">with {:.4f} steps ({:d} points)&#39;</span>
        <span class="n">lbl</span> <span class="o">+=</span> <span class="s">u&#39;</span><span class="se">\n</span><span class="s">(Edit range resets observed intensities).&#39;</span>
        <span class="n">lbl</span> <span class="o">=</span> <span class="n">lbl</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Tmin</span><span class="p">,</span><span class="n">Tmax</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">num</span><span class="p">)</span>
        <span class="n">simSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="n">lbl</span><span class="p">),</span>
                    <span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">but</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Button</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ID_ANY</span><span class="p">,</span><span class="s">&quot;Edit range&quot;</span><span class="p">)</span>
        <span class="n">but</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_BUTTON</span><span class="p">,</span><span class="n">onEditSimRange</span><span class="p">)</span>
        <span class="n">simSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">but</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">WACV</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">simSizer</span><span class="p">)</span>
    <span class="k">if</span> <span class="s">&#39;Nobs&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
            <span class="s">&#39; Data residual wR: </span><span class="si">%.3f%%</span><span class="s"> on </span><span class="si">%d</span><span class="s"> observations&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;wR&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s">&#39;Nobs&#39;</span><span class="p">])))</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">if</span> <span class="s">&#39;Nref&#39;</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),)</span>
                <span class="n">pfx</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;Nref&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pfx</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="s">&#39;::Name&#39;</span><span class="p">,</span><span class="s">&#39;?&#39;</span><span class="p">)</span>
                <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39; For phase &#39;</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="p">))</span>
                <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                    <span class="s">u&#39; Unweighted phase residuals RF</span><span class="se">\u00b2</span><span class="s">: </span><span class="si">%.3f%%</span><span class="s">, RF: </span><span class="si">%.3f%%</span><span class="s"> on </span><span class="si">%d</span><span class="s"> reflections  &#39;</span><span class="o">%</span> \
                    <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf^2&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">pfx</span><span class="o">+</span><span class="s">&#39;Rf&#39;</span><span class="p">],</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">value</span><span class="p">])))</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),)</span>
    <span class="n">mainSizer</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>    
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
    <span class="n">Size</span> <span class="o">=</span> <span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">)</span>
    <span class="n">Size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">10</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">(</span><span class="n">Size</span><span class="p">)</span>
    <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;PWDR&#39;</span><span class="p">:</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">plotType</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;SASD&#39;</span><span class="p">:</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">plotType</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">kind</span> <span class="o">==</span> <span class="s">&#39;HKLF&#39;</span><span class="p">:</span>
        <span class="n">refList</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;RefList&#39;</span><span class="p">]</span>
        <span class="n">FoMax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>
        <span class="n">controls</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Type&#39;</span> <span class="p">:</span> <span class="s">&#39;Fo&#39;</span><span class="p">,</span><span class="s">&#39;ifFc&#39;</span> <span class="p">:</span> <span class="bp">True</span><span class="p">,</span>     
            <span class="s">&#39;HKLmax&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]))],</span>
            <span class="s">&#39;HKLmin&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">])),</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">refList</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">2</span><span class="p">]))],</span>
            <span class="s">&#39;FoMax&#39;</span> <span class="p">:</span> <span class="n">FoMax</span><span class="p">,</span><span class="s">&#39;Zone&#39;</span> <span class="p">:</span> <span class="s">&#39;001&#39;</span><span class="p">,</span><span class="s">&#39;Layer&#39;</span> <span class="p">:</span> <span class="mi">0</span><span class="p">,</span><span class="s">&#39;Scale&#39;</span> <span class="p">:</span> <span class="mf">1.0</span><span class="p">,}</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotSngl</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">Data</span><span class="o">=</span><span class="n">controls</span><span class="p">,</span><span class="n">hklRef</span><span class="o">=</span><span class="n">refList</span><span class="p">)</span>
                 
<span class="c">################################################################################</span>
<span class="c">#####  Pattern tree routines</span>
<span class="c">################################################################################           </span>
       </div>
<div class="viewcode-block" id="GetPatternTreeDataNames"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GetPatternTreeDataNames">[docs]</a><span class="k">def</span> <span class="nf">GetPatternTreeDataNames</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">dataTypes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Needs a doc string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>        
    <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dataTypes</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">names</span>
                          </div>
<div class="viewcode-block" id="GetPatternTreeItemId"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.GetPatternTreeItemId">[docs]</a><span class="k">def</span> <span class="nf">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span> <span class="n">parentId</span><span class="p">,</span> <span class="n">itemText</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Needs a doc string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetFirstChild</span><span class="p">(</span><span class="n">parentId</span><span class="p">)</span>
    <span class="k">while</span> <span class="n">item</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="n">itemText</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">item</span>
        <span class="n">item</span><span class="p">,</span> <span class="n">cookie</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetNextChild</span><span class="p">(</span><span class="n">parentId</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">0</span>                
</div>
<div class="viewcode-block" id="MovePatternTreeToGrid"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.MovePatternTreeToGrid">[docs]</a><span class="k">def</span> <span class="nf">MovePatternTreeToGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">item</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Called from GSASII.OnPatternTreeSelChanged when a item is selected on the tree </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
<span class="c">#    print G2frame.PatternTree.GetItemText(item)</span>
    
    <span class="n">oldPage</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># will be set later if already on a Phase item</span>
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
        <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Comments&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()]</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
                <span class="n">Id</span> <span class="o">=</span> <span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;Comments&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Id</span><span class="p">:</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>     <span class="c">#clumsy but avoids dead window problem when opening another project</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;Notebook&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()]</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
                <span class="n">Id</span> <span class="o">=</span> <span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="s">&#39;Notebook&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">Id</span><span class="p">:</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">Id</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>     <span class="c">#clumsy but avoids dead window problem when opening another project</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="s">&#39;Phase Data for&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetLabel</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="p">:</span> 
                <span class="n">oldPage</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">dataDisplay</span><span class="o">.</span><span class="n">GetSelection</span><span class="p">()</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetLabel</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c">#create the frame for the data item window</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">mainPanel</span><span class="p">,</span><span class="n">frame</span><span class="o">=</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">PhaseUserSize</span> <span class="o">=</span> <span class="bp">None</span>
        
    <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Raise</span><span class="p">()</span>            
    <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">parentID</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">root</span>
    <span class="c">#for i in G2frame.ExportPattern: i.Enable(False)</span>
    <span class="n">defWid</span> <span class="o">=</span> <span class="p">[</span><span class="mi">250</span><span class="p">,</span><span class="mi">150</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">item</span> <span class="o">!=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
        <span class="n">parentID</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">root</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Notebook&#39;</span><span class="p">:</span>
            <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">DataNotebookMenu</span><span class="p">)</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c">#for i in G2frame.ExportPattern: i.Enable(False)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">UpdateNotebook</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Controls&#39;</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c">#for i in G2frame.ExportPattern: i.Enable(False)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>           <span class="c">#fill in defaults</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">G2obj</span><span class="o">.</span><span class="n">DefaultControls</span><span class="p">)</span>    <span class="c">#least squares controls</span>
                <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>                             
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">Refine</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">EnableSeqRefineMenu</span><span class="p">()</span>
            <span class="n">UpdateControls</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Sequential results&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">UpdateSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Small Angle Sequential results&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">UpdateSASDSeqResults</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Covariance&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">(</span><span class="n">defWid</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="s">&#39;Rvals&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">Nvars</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;varyList&#39;</span><span class="p">])</span>
                <span class="n">Rvals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Rvals&#39;</span><span class="p">]</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Final residuals: </span><span class="se">\n</span><span class="s">wR = </span><span class="si">%.3f%%</span><span class="s"> </span><span class="se">\n</span><span class="s">chi**2 = </span><span class="si">%.1f</span><span class="s"> </span><span class="se">\n</span><span class="s">GOF = </span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Rvals</span><span class="p">[</span><span class="s">&#39;Rwp&#39;</span><span class="p">],</span><span class="n">Rvals</span><span class="p">[</span><span class="s">&#39;chisq&#39;</span><span class="p">],</span><span class="n">Rvals</span><span class="p">[</span><span class="s">&#39;GOF&#39;</span><span class="p">])</span>
                <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">Nobs = </span><span class="si">%d</span><span class="s"> </span><span class="se">\n</span><span class="s">Nvals = </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">Rvals</span><span class="p">[</span><span class="s">&#39;Nobs&#39;</span><span class="p">],</span><span class="n">Nvars</span><span class="p">)</span>
                <span class="k">if</span> <span class="s">&#39;lamMax&#39;</span> <span class="ow">in</span> <span class="n">Rvals</span><span class="p">:</span>
                    <span class="n">text</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">log10 MaxLambda = </span><span class="si">%.1f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Rvals</span><span class="p">[</span><span class="s">&#39;lamMax&#39;</span><span class="p">]))</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetClientSize</span><span class="p">(),</span>
                <span class="n">value</span><span class="o">=</span><span class="s">&#39;See plot window for covariance display&#39;</span><span class="o">+</span><span class="n">text</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">TE_MULTILINE</span><span class="p">)</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotCovariance</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Constraints&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">G2cnstG</span><span class="o">.</span><span class="n">UpdateConstraints</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Rigid bodies&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">G2cnstG</span><span class="o">.</span><span class="n">UpdateRigidBodies</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Restraints&#39;</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="n">Phases</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">GetPhaseData</span><span class="p">()</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="n">phaseName</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">if</span> <span class="n">Phases</span><span class="p">:</span>
                <span class="n">phaseName</span> <span class="o">=</span> <span class="n">Phases</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">(</span><span class="n">defWid</span><span class="p">)</span>
            <span class="n">G2restG</span><span class="o">.</span><span class="n">UpdateRestraints</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">Phases</span><span class="p">,</span><span class="n">phaseName</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;IMG&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">item</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;PKS&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPowderLines</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;PWDR&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="c">#for i in G2frame.ExportPattern: i.Enable(True)</span>
            <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">EnablePlot</span><span class="p">:</span>
                <span class="n">UpdatePWHKPlot</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="s">&#39;PWDR&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;SASD&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="c">#for i in G2frame.ExportPattern: i.Enable(True)</span>
            <span class="k">if</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">EnablePlot</span><span class="p">:</span>
                <span class="n">UpdatePWHKPlot</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="s">&#39;SASD&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;HKLF&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">Sngl</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">UpdatePWHKPlot</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="s">&#39;HKLF&#39;</span><span class="p">,</span><span class="n">item</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">&#39;PDF&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">ExportPDF</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;S(Q)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Phases&#39;</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">setSizePosLeft</span><span class="p">(</span><span class="n">defWid</span><span class="p">)</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">GetClientSize</span><span class="p">(),</span>
                <span class="n">value</span><span class="o">=</span><span class="s">&#39;Select one phase to see its parameters&#39;</span><span class="p">)</span>            
    <span class="k">elif</span> <span class="s">&#39;I(Q)&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;I(Q)&#39;</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s">&#39;S(Q)&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;S(Q)&#39;</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s">&#39;F(Q)&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;F(Q)&#39;</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s">&#39;G(R)&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;G(R)&#39;</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>            
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">parentID</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Phases&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2phG</span><span class="o">.</span><span class="n">UpdatePhaseData</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">oldPage</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Comments&#39;</span><span class="p">:</span>
        <span class="n">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">DataCommentsMenu</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">UpdateComments</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Image Controls&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s">&#39;Image Controls&#39;</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">masks</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span>
            <span class="n">GetPatternTreeItemId</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">G2frame</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="s">&#39;Masks&#39;</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2imG</span><span class="o">.</span><span class="n">UpdateImageControls</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">masks</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Masks&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s">&#39;Masks&#39;</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2imG</span><span class="o">.</span><span class="n">UpdateMasks</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Stress/Strain&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetTitle</span><span class="p">(</span><span class="s">&#39;Stress/Strain&#39;</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2imG</span><span class="o">.</span><span class="n">UpdateStressStrain</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotStrain</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;PDF Controls&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">ExportPDF</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdatePDFGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;I(Q)&#39;</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;S(Q)&#39;</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;F(Q)&#39;</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotISFG</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;G(R)&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Peak List&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">ExportPeakList</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdatePeakGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Background&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateBackground</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Limits&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateLimitsGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">datatype</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">plotType</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Instrument Parameters&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateInstrumentGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;P&#39;</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Type&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>          <span class="c">#powder data only</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPeakWidths</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Models&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateModelsGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">plotType</span><span class="o">=</span><span class="s">&#39;SASD&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Size&#39;</span><span class="p">][</span><span class="s">&#39;Distribution&#39;</span><span class="p">]):</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotSASDSizeDist</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Substances&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateSubstanceGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Sample Parameters&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">datatype</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">)[</span><span class="mi">2</span><span class="p">][:</span><span class="mi">4</span><span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;Temperature&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>           <span class="c">#temp fix for old gpx files</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Scale&#39;</span><span class="p">:[</span><span class="mf">1.0</span><span class="p">,</span><span class="bp">True</span><span class="p">],</span><span class="s">&#39;Type&#39;</span><span class="p">:</span><span class="s">&#39;Debye-Scherrer&#39;</span><span class="p">,</span><span class="s">&#39;Absorption&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;DisplaceX&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span>
                <span class="s">&#39;DisplaceY&#39;</span><span class="p">:[</span><span class="mf">0.0</span><span class="p">,</span><span class="bp">False</span><span class="p">],</span><span class="s">&#39;Diffuse&#39;</span><span class="p">:[],</span><span class="s">&#39;Temperature&#39;</span><span class="p">:</span><span class="mf">300.</span><span class="p">,</span><span class="s">&#39;Pressure&#39;</span><span class="p">:</span><span class="mf">1.0</span><span class="p">,</span>
                    <span class="s">&#39;FreePrm1&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span><span class="s">&#39;FreePrm2&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span><span class="s">&#39;FreePrm3&#39;</span><span class="p">:</span><span class="mf">0.</span><span class="p">,</span>
                    <span class="s">&#39;Gonio. radius&#39;</span><span class="p">:</span><span class="mf">200.0</span><span class="p">}</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
    
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateSampleGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">plotType</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Index Peak List&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">ExportPeakList</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">Enable</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateIndexPeaksGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;PKS&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">):</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPowderLines</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Unit Cells List&#39;</span><span class="p">:</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mf">25.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s">&#39;P1&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span> <span class="c">#zero error flag, zero value, max Nc/No, start volume</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>      <span class="c">#Bravais lattice flags</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>                                 <span class="c">#empty cell list</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>                                 <span class="c">#empty dmin</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">SetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>                             
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateUnitCellsGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="s">&#39;PKS&#39;</span> <span class="ow">in</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">):</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPowderLines</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Reflection Lists&#39;</span><span class="p">:</span>   <span class="c">#powder reflections</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PickId</span> <span class="o">=</span> <span class="n">item</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">RefList</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">RefList</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateReflectionGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">G2plt</span><span class="o">.</span><span class="n">PlotPatterns</span><span class="p">(</span><span class="n">G2frame</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;Reflection List&#39;</span><span class="p">:</span>    <span class="c">#HKLF reflections</span>
        <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemParent</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemText</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">G2frame</span><span class="o">.</span><span class="n">PatternTree</span><span class="o">.</span><span class="n">GetItemPyData</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">PatternId</span><span class="p">)</span>
        <span class="n">G2pdG</span><span class="o">.</span><span class="n">UpdateReflectionGrid</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">HKLF</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">Name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="SetDataMenuBar"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.SetDataMenuBar">[docs]</a><span class="k">def</span> <span class="nf">SetDataMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="p">,</span><span class="n">menu</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Set the menu for the data frame. On the Mac put this</span>
<span class="sd">    menu for the data tree window instead.</span>

<span class="sd">    Note that data frame items do not have menus, for these (menu=None)</span>
<span class="sd">    display a blank menu or on the Mac display the standard menu for</span>
<span class="sd">    the data tree window.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s">&quot;darwin&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">menu</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">GSASIIMenu</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">menu</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">BlankMenu</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">G2frame</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="n">menu</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="HorizontalLine"><a class="viewcode-back" href="../GSASIIGUIr.html#GSASIIgrid.HorizontalLine">[docs]</a><span class="k">def</span> <span class="nf">HorizontalLine</span><span class="p">(</span><span class="n">sizer</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Draws a horizontal line as wide as the window.</span>
<span class="sd">    This shows up on the Mac as a very thin line, no matter what I do</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">StaticLine</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">LI_HORIZONTAL</span><span class="p">)</span>
    <span class="n">sizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">ALL</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PySimpleApp</span><span class="p">()</span>
    <span class="n">frm</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="c"># create a frame</span>
    <span class="n">frm</span><span class="o">.</span><span class="n">Show</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>

    <span class="c">#======================================================================</span>
    <span class="c"># test ScrolledMultiEditor</span>
    <span class="c">#======================================================================</span>
    <span class="c"># Data1 = {</span>
    <span class="c">#     &#39;Order&#39;:1,</span>
    <span class="c">#     &#39;omega&#39;:&#39;string&#39;,</span>
    <span class="c">#     &#39;chi&#39;:2.0,</span>
    <span class="c">#     &#39;phi&#39;:&#39;&#39;,</span>
    <span class="c">#     }</span>
    <span class="c"># elemlst = sorted(Data1.keys())</span>
    <span class="c"># postlbl = sorted(Data1.keys())</span>
    <span class="c"># dictlst = len(elemlst)*[Data1,]</span>

    <span class="c"># Data2 = list(range(100))</span>
    <span class="c"># elemlst += range(2,6)</span>
    <span class="c"># postlbl += range(2,6)</span>
    <span class="c"># dictlst += len(range(2,6))*[Data2,]</span>

    <span class="c"># prelbl = range(len(elemlst))</span>
    <span class="c"># postlbl[1] = &quot;a very long label for the 2nd item to force a horiz. scrollbar&quot;</span>
    <span class="c"># header=&quot;&quot;&quot;This is a longer\nmultiline and perhaps silly header&quot;&quot;&quot;</span>
    <span class="c"># dlg = ScrolledMultiEditor(frm,dictlst,elemlst,prelbl,postlbl,</span>
    <span class="c">#                           header=header,CopyButton=True)</span>
    <span class="c"># print Data1</span>
    <span class="c"># if dlg.ShowModal() == wx.ID_OK:</span>
    <span class="c">#     for d,k in zip(dictlst,elemlst):</span>
    <span class="c">#         print k,d[k]</span>
    <span class="c"># dlg.Destroy()</span>
    <span class="c"># if CallScrolledMultiEditor(frm,dictlst,elemlst,prelbl,postlbl,</span>
    <span class="c">#                            header=header):</span>
    <span class="c">#     for d,k in zip(dictlst,elemlst):</span>
    <span class="c">#         print k,d[k]</span>

    <span class="c">#======================================================================</span>
    <span class="c"># test G2MultiChoiceDialog</span>
    <span class="c">#======================================================================</span>
    <span class="c"># choices = []</span>
    <span class="c"># for i in range(21):</span>
    <span class="c">#     choices.append(&quot;option_&quot;+str(i))</span>
    <span class="c"># dlg = G2MultiChoiceDialog(frm, &#39;Sequential refinement&#39;,</span>
    <span class="c">#                           &#39;Select dataset to include&#39;,</span>
    <span class="c">#                           choices)</span>
    <span class="c"># sel = range(2,11,2)</span>
    <span class="c"># dlg.SetSelections(sel)</span>
    <span class="c"># dlg.SetSelections((1,5))</span>
    <span class="c"># if dlg.ShowModal() == wx.ID_OK:</span>
    <span class="c">#     for sel in dlg.GetSelections():</span>
    <span class="c">#         print sel,choices[sel]</span>
    
    <span class="c">#======================================================================</span>
    <span class="c"># test wx.MultiChoiceDialog</span>
    <span class="c">#======================================================================</span>
    <span class="c"># dlg = wx.MultiChoiceDialog(frm, &#39;Sequential refinement&#39;,</span>
    <span class="c">#                           &#39;Select dataset to include&#39;,</span>
    <span class="c">#                           choices)</span>
    <span class="c"># sel = range(2,11,2)</span>
    <span class="c"># dlg.SetSelections(sel)</span>
    <span class="c"># dlg.SetSelections((1,5))</span>
    <span class="c"># if dlg.ShowModal() == wx.ID_OK:</span>
    <span class="c">#     for sel in dlg.GetSelections():</span>
    <span class="c">#         print sel,choices[sel]</span>

    <span class="n">pnl</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="n">frm</span><span class="p">)</span>
    <span class="n">siz</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>

    <span class="n">td</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;Goni&#39;</span><span class="p">:</span><span class="mf">200.</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">}</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">ValidatedTxtCtrl</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span><span class="n">td</span><span class="p">,</span><span class="s">&#39;Goni&#39;</span><span class="p">)</span>
    <span class="n">siz</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">ValidatedTxtCtrl</span><span class="p">(</span><span class="n">pnl</span><span class="p">,</span><span class="n">td</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">siz</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span>

    <span class="n">pnl</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">siz</span><span class="p">)</span>
    <span class="n">siz</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="n">frm</span><span class="p">)</span>
    <span class="n">app</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">td</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>