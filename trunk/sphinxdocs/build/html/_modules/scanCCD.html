<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>scanCCD &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for scanCCD</h1><div class="highlight"><pre>
<span class="c">#scanCCD data processing</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*scanCCD: reduce data from scanning CCD*</span>
<span class="sd">========================================</span>

<span class="sd">Quickly prototyped routine for reduction of data from detector described in</span>
<span class="sd">B.H. Toby, T.J. Madden, M.R. Suchomel, J.D. Baldwin, and R.B. Von Dreele,</span>
<span class="sd">&quot;A Scanning CCD Detector for Powder Diffraction Measurements&quot;.</span>
<span class="sd">Journal of Applied Crystallography. 46(4): p. 1058-63 (2013).</span>

<span class="sd">&#39;&#39;&#39;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">os.path</span> <span class="kn">as</span> <span class="nn">ospath</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">nl</span>
<span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
<span class="kn">import</span> <span class="nn">wx</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">GSASIIpath</span>
<span class="kn">import</span> <span class="nn">GSASIIIO</span> <span class="kn">as</span> <span class="nn">G2IO</span>
<span class="kn">import</span> <span class="nn">GSASIIimage</span> <span class="kn">as</span> <span class="nn">G2img</span>
<span class="kn">import</span> <span class="nn">GSASIIplot</span> <span class="kn">as</span> <span class="nn">G2plt</span>

<span class="n">npsind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">npcosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">npacosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">npasind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">scanCCD</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
    
<span class="p">[</span><span class="n">wxID_FILEEXIT</span><span class="p">,</span> <span class="n">wxID_FILEOPEN</span><span class="p">,</span> <span class="n">wxID_INTEGRATE</span><span class="p">,</span> <span class="n">wxID_OUTPUT</span><span class="p">,</span>
<span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">wx</span><span class="o">.</span><span class="n">NewId</span><span class="p">()</span> <span class="k">for</span> <span class="n">_init_coll_File_Items</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">FileDlgFixExt</span><span class="p">(</span><span class="n">dlg</span><span class="p">,</span><span class="nb">file</span><span class="p">):</span>            <span class="c">#this is needed to fix a problem in linux wx.FileDialog</span>
    <span class="n">ext</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetWildcard</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;|&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="o">*</span><span class="n">dlg</span><span class="o">.</span><span class="n">GetFilterIndex</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;*&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ext</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">file</span><span class="p">:</span>
        <span class="nb">file</span> <span class="o">+=</span> <span class="n">ext</span>
    <span class="k">return</span> <span class="nb">file</span>
    
<span class="k">class</span> <span class="nc">scanCCD</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">_init_ctrls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">&#39;scanCCD&#39;</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">460</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_FRAME_STYLE</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;scanCCD&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanCCDMenu</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MenuBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Menu</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Open scanCCD image files (*.tif)&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_FILEOPEN</span><span class="p">,</span>
             <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Open scanCCD files&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Integrate scanCCD images&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_INTEGRATE</span><span class="p">,</span>
             <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Integrate scanCCD images&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Output fxye file from integration&#39;</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_OUTPUT</span><span class="p">,</span>
             <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Output pattern&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">help</span><span class="o">=</span><span class="s">&#39;Exit from scanCCD&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_FILEEXIT</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">ITEM_NORMAL</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s">&#39;Exit&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnImageRead</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_FILEOPEN</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnImageIntegrate</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_INTEGRATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">OnOutput</span><span class="p">,</span><span class="nb">id</span><span class="o">=</span><span class="n">wxID_OUTPUT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_MENU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">OnFileExit</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">wxID_FILEEXIT</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scanCCDMenu</span><span class="o">.</span><span class="n">Append</span><span class="p">(</span><span class="n">menu</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">File</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;File&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetMenuBar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanCCDMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Panel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>        
        <span class="n">plotFrame</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Frame</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;scanCCD Plots&#39;</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">Size</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span><span class="mi">600</span><span class="p">),</span> \
            <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">DEFAULT_FRAME_STYLE</span> <span class="o">^</span> <span class="n">wx</span><span class="o">.</span><span class="n">CLOSE_BOX</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span> <span class="o">=</span> <span class="n">G2plt</span><span class="o">.</span><span class="n">G2PlotNoteBook</span><span class="p">(</span><span class="n">plotFrame</span><span class="p">)</span>
        <span class="n">plotFrame</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init_ctrls</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CLOSE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ExitMain</span><span class="p">)</span>    
        <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hxyw</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;color&#39;</span><span class="p">:</span><span class="s">&#39;Paired&#39;</span><span class="p">,</span><span class="s">&#39;range&#39;</span><span class="p">:[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1000</span><span class="p">]]}</span>

    <span class="k">def</span> <span class="nf">ExitMain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">OnFileExit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Clear</span><span class="p">()</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">dataFrame</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Close</span><span class="p">()</span>
        
    <span class="k">def</span> <span class="nf">OnImageRead</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose scanCCD image files&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span>\
        <span class="s">&#39;Any detector tif (*.tif;*.tiff)|*.tif;*.tiff|</span><span class="se">\</span>
<span class="s">        All files (*.*)|*.*&#39;</span><span class="p">,</span>
        <span class="n">wx</span><span class="o">.</span><span class="n">OPEN</span> <span class="o">|</span> <span class="n">wx</span><span class="o">.</span><span class="n">MULTIPLE</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">SetDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPaths</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">imagefile</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">:</span>
                    <span class="n">Comments</span><span class="p">,</span><span class="n">Data</span><span class="p">,</span><span class="n">Npix</span><span class="p">,</span><span class="n">image</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imagefile</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">Comments</span><span class="p">:</span>
                        <span class="n">A</span> <span class="o">=</span> <span class="n">G2img</span><span class="o">.</span><span class="n">ImageCompress</span><span class="p">(</span><span class="n">image</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">Image</span> <span class="o">=</span> <span class="n">A</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pixel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Data</span><span class="p">[</span><span class="s">&#39;pixelSize&#39;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">shape</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">15.3096</span><span class="p">,</span><span class="mf">16.4</span><span class="p">]</span>        <span class="c">#for bob1-3 files</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">15.56012</span>              <span class="c">#from bob1 fit to 2333 peak positions</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;LRlimits&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">)]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;PtScan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">image</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;2thScan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">90.0</span><span class="p">,</span><span class="mf">0.001</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;showBlk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>               <span class="c">#default - skip ramp block</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">UpdateControls</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">OnImageIntegrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        
        <span class="k">def</span> <span class="nf">Make2ThetaMap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">iLim</span><span class="p">,</span><span class="n">jLim</span><span class="p">):</span>
            <span class="c">#transforms scanCCD image from x,y space to 2-theta,y space</span>
            <span class="n">pixelSize</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;pixel&#39;</span><span class="p">]</span>
            <span class="n">scalex</span> <span class="o">=</span> <span class="n">pixelSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span>
            <span class="n">scaley</span> <span class="o">=</span> <span class="n">pixelSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span>
            <span class="n">vecA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="mf">0.</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            
            <span class="n">tay</span><span class="p">,</span><span class="n">tax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">jLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+.</span><span class="mi">5</span><span class="p">:</span><span class="n">jLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+.</span><span class="mi">5</span><span class="p">,</span><span class="n">iLim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+.</span><span class="mi">5</span><span class="p">:</span><span class="n">iLim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+.</span><span class="mi">5</span><span class="p">]</span>        <span class="c">#bin centers not corners</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">((</span><span class="n">tax</span><span class="o">*</span><span class="n">scalex</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c">#scanCCD 2-thetas</span>
            <span class="n">tay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">(</span><span class="n">tay</span><span class="o">*</span><span class="n">scaley</span><span class="o">-</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">vecB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">npcosd</span><span class="p">(</span><span class="n">tax</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">],</span><span class="n">npsind</span><span class="p">(</span><span class="n">tax</span><span class="p">)</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">],</span><span class="n">tay</span><span class="p">])</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">vecB</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">vecB</span><span class="o">.</span><span class="n">T</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">vecB</span> <span class="o">/=</span> <span class="n">norm</span><span class="o">.</span><span class="n">T</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">npacosd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vecB</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">vecA</span><span class="p">))</span><span class="o">*</span><span class="n">tax</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">tax</span><span class="p">)</span>      <span class="c">#to get sign of 2-theta</span>
            <span class="n">tay</span> <span class="o">+=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">tax</span><span class="p">,</span><span class="n">tay</span><span class="o">.</span><span class="n">T</span>           <span class="c">#2-theta arrays &amp; turn y array around!!</span>

    
        <span class="k">def</span> <span class="nf">Fill2ThetaMap</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">TA</span><span class="p">,</span><span class="n">image</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">numpy.ma</span> <span class="kn">as</span> <span class="nn">ma</span>
            <span class="n">Zmin</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmin&#39;</span><span class="p">]</span>
            <span class="n">Zmax</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmax&#39;</span><span class="p">]</span>
            <span class="n">tax</span><span class="p">,</span><span class="n">tay</span> <span class="o">=</span> <span class="n">TA</span>    <span class="c"># 2-theta &amp; yaxis</span>
            <span class="n">taz</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">masked_outside</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">-</span><span class="n">Zmin</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Zmax</span><span class="o">-</span><span class="n">Zmin</span><span class="p">)</span>
            <span class="n">tam</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">getmask</span><span class="p">(</span><span class="n">taz</span><span class="p">)</span>
            <span class="n">tax</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">compressed</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tax</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">mask</span><span class="o">=</span><span class="n">tam</span><span class="p">))</span>
            <span class="n">tay</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">compressed</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tay</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">mask</span><span class="o">=</span><span class="n">tam</span><span class="p">))</span>
            <span class="n">taz</span> <span class="o">=</span> <span class="n">ma</span><span class="o">.</span><span class="n">compressed</span><span class="p">(</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">taz</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span><span class="n">mask</span><span class="o">=</span><span class="n">tam</span><span class="p">))</span>
            <span class="k">del</span><span class="p">(</span><span class="n">tam</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">tax</span><span class="p">,</span><span class="n">tay</span><span class="p">,</span><span class="n">taz</span>
        
        <span class="kn">import</span> <span class="nn">histosigma2d</span> <span class="kn">as</span> <span class="nn">h2d</span>
        <span class="k">print</span> <span class="s">&#39;Begin image integration&#39;</span>
        <span class="n">scaley</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pixel&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="n">tthStart</span><span class="p">,</span><span class="n">tthEnd</span><span class="p">,</span><span class="n">tthStep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;2thScan&#39;</span><span class="p">]</span>
        <span class="n">LUtth</span> <span class="o">=</span> <span class="p">[</span><span class="n">tthStart</span><span class="p">,</span><span class="n">tthEnd</span><span class="p">]</span>
        <span class="n">TBlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">nYpix</span> <span class="o">=</span> <span class="n">TBlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">TBlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">TBlim</span> <span class="o">*=</span> <span class="n">scaley</span>
        <span class="n">TBdelt</span> <span class="o">=</span> <span class="n">TBlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">TBlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">nTB</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">numChans</span> <span class="o">=</span> <span class="p">(</span><span class="n">tthEnd</span><span class="o">-</span><span class="n">tthStart</span><span class="p">)</span><span class="o">/</span><span class="n">tthStep</span>
        <span class="n">NST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">numChans</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">numChans</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">Amat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">numChans</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">Qmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">numChans</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">order</span><span class="o">=</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">imSize</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">])</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span>
        <span class="n">H1</span> <span class="o">=</span> <span class="p">[</span><span class="n">tth</span> <span class="k">for</span> <span class="n">tth</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">LUtth</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">LUtth</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">numChans</span><span class="p">)]</span>
        <span class="n">blkSize</span> <span class="o">=</span> <span class="mi">2048</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">4096</span><span class="o">/</span><span class="n">blkSize</span>
        <span class="n">nBlk</span> <span class="o">=</span> <span class="n">N</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">)</span>       <span class="c">#assume 4Kx4K CCD images - done in 1Kx1K blocks</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ProgressDialog</span><span class="p">(</span><span class="s">&quot;Elapsed time&quot;</span><span class="p">,</span><span class="s">&quot;2D image integration&quot;</span><span class="p">,</span><span class="n">nBlk</span><span class="p">,</span>
            <span class="n">style</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">PD_ELAPSED_TIME</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_AUTO_HIDE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">PD_CAN_ABORT</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">nBlk</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">iBegi</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">iFin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">GoOn</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">for</span> <span class="n">ifile</span><span class="p">,</span><span class="n">imagefile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">ifile</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;skip&#39;</span><span class="p">]:</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">G2IO</span><span class="o">.</span><span class="n">GetImageData</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">imagefile</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
                    <span class="n">image</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">iBlk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                        <span class="n">iBeg</span> <span class="o">=</span> <span class="n">iBegi</span><span class="o">+</span><span class="n">iBlk</span><span class="o">*</span><span class="n">blkSize</span>
                        <span class="n">iFin</span> <span class="o">=</span> <span class="n">iBeg</span><span class="o">+</span><span class="n">blkSize</span>
                        <span class="k">for</span> <span class="n">jBlk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
                            <span class="n">jBeg</span> <span class="o">=</span> <span class="n">jBlk</span><span class="o">*</span><span class="n">blkSize</span>
                            <span class="n">jFin</span> <span class="o">=</span> <span class="n">jBeg</span><span class="o">+</span><span class="n">blkSize</span>                
                            <span class="k">print</span> <span class="s">&#39;Process map block:&#39;</span><span class="p">,</span><span class="n">nBlk</span><span class="p">,</span><span class="n">iBlk</span><span class="p">,</span><span class="n">jBlk</span><span class="p">,</span><span class="s">&#39; offset:&#39;</span><span class="p">,</span><span class="n">iBegi</span><span class="p">,</span><span class="s">&#39; limits:&#39;</span><span class="p">,</span><span class="n">iBeg</span><span class="p">,</span><span class="n">iFin</span><span class="p">,</span><span class="n">jBeg</span><span class="p">,</span><span class="n">jFin</span>
                            <span class="n">TA</span> <span class="o">=</span> <span class="n">Make2ThetaMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,(</span><span class="n">iBeg</span><span class="p">,</span><span class="n">iFin</span><span class="p">),(</span><span class="n">jBeg</span><span class="p">,</span><span class="n">jFin</span><span class="p">))</span>           <span class="c">#2-theta &amp; Y arrays &amp; create position mask                       </span>
                            <span class="n">Block</span> <span class="o">=</span> <span class="n">image</span><span class="p">[</span><span class="n">iBeg</span><span class="o">-</span><span class="n">iBegi</span><span class="p">:</span><span class="n">iFin</span><span class="o">-</span><span class="n">iBegi</span><span class="p">,</span><span class="n">jBeg</span><span class="p">:</span><span class="n">jFin</span><span class="p">]</span>
                            <span class="n">tax</span><span class="p">,</span><span class="n">tay</span><span class="p">,</span><span class="n">taz</span> <span class="o">=</span> <span class="n">Fill2ThetaMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">TA</span><span class="p">,</span><span class="n">Block</span><span class="p">)</span>                 <span class="c">#and apply masks</span>
                            <span class="n">NST</span><span class="p">,</span><span class="n">H0</span><span class="p">,</span><span class="n">Amat</span><span class="p">,</span><span class="n">Qmat</span> <span class="o">=</span> <span class="n">h2d</span><span class="o">.</span><span class="n">histosigma2d</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tax</span><span class="p">),</span><span class="n">tax</span><span class="p">,</span><span class="n">tay</span><span class="p">,</span><span class="n">taz</span><span class="p">,</span><span class="n">numChans</span><span class="p">,</span><span class="n">nTB</span><span class="p">,</span><span class="n">LUtth</span><span class="p">,</span><span class="n">TBlim</span><span class="p">,</span><span class="n">tthStep</span><span class="p">,</span><span class="n">TBdelt</span><span class="p">,</span><span class="n">NST</span><span class="p">,</span><span class="n">H0</span><span class="p">,</span><span class="n">Amat</span><span class="p">,</span><span class="n">Qmat</span><span class="p">)</span>
                            <span class="n">H0temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span><span class="n">NST</span><span class="p">))</span>
                            <span class="n">Qtemp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Qmat</span><span class="p">,</span><span class="n">NST</span><span class="p">))</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;showBlk&#39;</span><span class="p">]:</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">PlotBlock</span><span class="p">(</span><span class="n">Block</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;Block&#39;</span><span class="p">,</span><span class="n">iBlk</span><span class="p">,</span><span class="n">jBlk</span><span class="p">))</span>
                                <span class="n">OKdlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">MessageDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Continue&#39;</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">OK</span><span class="p">)</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">result</span> <span class="o">=</span> <span class="n">OKdlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span>
                                <span class="k">finally</span><span class="p">:</span>
                                    <span class="n">OKdlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
                            <span class="k">del</span> <span class="n">tax</span><span class="p">,</span><span class="n">tay</span><span class="p">,</span><span class="n">taz</span>
                            <span class="n">nBlk</span> <span class="o">+=</span> <span class="mi">1</span>
                            <span class="n">GoOn</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">nBlk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                                <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">print</span> <span class="s">&#39;file &#39;</span><span class="o">+</span><span class="n">imagefile</span><span class="o">+</span><span class="s">&#39; skipped&#39;</span>
                    <span class="n">nBlk</span> <span class="o">+=</span> <span class="n">N</span><span class="o">*</span><span class="n">N</span>
                    <span class="n">GoOn</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Update</span><span class="p">(</span><span class="n">nBlk</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">iFin</span> <span class="o">+=</span> <span class="n">N</span><span class="o">*</span><span class="n">blkSize</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">GoOn</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">iBegi</span> <span class="o">=</span> <span class="n">iFin</span>
            <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">H0</span><span class="p">,</span><span class="n">NST</span><span class="p">)</span>
            <span class="n">H0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span>
            <span class="n">Qmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">Qmat</span><span class="p">,</span><span class="n">NST</span><span class="p">)</span>
            <span class="n">Qmat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan_to_num</span><span class="p">(</span><span class="n">Qmat</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">NST</span>
            <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>
        <span class="n">Scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Qmat</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">H0</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;SumI: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">H0</span><span class="p">),</span><span class="s">&#39; SumV: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Qmat</span><span class="p">),</span><span class="s">&#39; Scale:&#39;</span><span class="p">,</span><span class="n">Scale</span>
        <span class="k">print</span> <span class="s">&#39;Integration complete&#39;</span>
        <span class="k">print</span> <span class="s">&quot;Elapsed time:&quot;</span><span class="p">,</span><span class="s">&quot;</span><span class="si">%8.3f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">),</span> <span class="s">&quot;s&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Hxyw</span> <span class="o">=</span> <span class="p">[</span><span class="n">H1</span><span class="p">,</span><span class="n">Scale</span><span class="o">*</span><span class="n">H0</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">Qmat</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="k">print</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">PlotXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Hxyw</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;Integration result&#39;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">OnOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">powderSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">powderfile</span><span class="p">,</span><span class="n">Fxye</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">powderfile</span><span class="p">,</span><span class="s">&#39;w&#39;</span><span class="p">)</span>
            <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;#</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="s">&#39;from scanCCD image &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="k">print</span> <span class="s">&#39;save powder pattern to file: &#39;</span><span class="p">,</span><span class="n">powderfile</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">BeginBusyCursor</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hxyw</span>
                <span class="k">if</span> <span class="n">Fxye</span><span class="p">:</span>
                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">powderfile</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;BANK 1 </span><span class="si">%d</span><span class="s"> </span><span class="si">%d</span><span class="s"> CONS </span><span class="si">%.2f</span><span class="s"> </span><span class="si">%.2f</span><span class="s"> 0 0 FXYE</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span>\
                        <span class="mf">100.</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>                    
                <span class="n">XYE</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">E</span> <span class="ow">in</span> <span class="n">XYE</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Fxye</span><span class="p">:</span>
                        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%15.6g</span><span class="s"> </span><span class="si">%15.6g</span><span class="s"> </span><span class="si">%15.6g</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)))</span>                        
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%15.6g</span><span class="s"> </span><span class="si">%15.6g</span><span class="s"> </span><span class="si">%15.6g</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">E</span><span class="p">,</span><span class="mf">1.0</span><span class="p">)))</span>
                <span class="nb">file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">EndBusyCursor</span><span class="p">()</span>
            <span class="k">print</span> <span class="s">&#39;powder pattern file written&#39;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Hxyw</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FileDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;Choose output powder file name&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> 
            <span class="s">&#39;GSAS fxye file (*.fxye)|*.fxye|xye file (*.xye)|*.xye&#39;</span><span class="p">,</span>
            <span class="n">wx</span><span class="o">.</span><span class="n">FD_SAVE</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">FD_OVERWRITE_PROMPT</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">SetDirectory</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dirname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ShowModal</span><span class="p">()</span> <span class="o">==</span> <span class="n">wx</span><span class="o">.</span><span class="n">ID_OK</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetFilename</span><span class="p">()</span>
                <span class="n">powderfile</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetPath</span><span class="p">()</span>
                <span class="k">if</span> <span class="s">&#39;fxye&#39;</span> <span class="ow">in</span> <span class="n">powderfile</span><span class="p">:</span>
                    <span class="n">powderSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">powderfile</span><span class="p">,</span><span class="n">Fxye</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>       <span class="c">#just xye</span>
                    <span class="n">powderSave</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">powderfile</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dirname</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">GetDirectory</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">dlg</span><span class="o">.</span><span class="n">Destroy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">UpdateControls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="n">ObjIndx</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="o">.</span><span class="n">DestroyChildren</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">ColorSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnNewColorBar</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">colSel</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colSel</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
                
            <span class="k">def</span> <span class="nf">OnShowBlk</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;showBlk&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">shoBlk</span><span class="o">.</span><span class="n">GetValue</span><span class="p">()</span>
                
            <span class="k">def</span> <span class="nf">OnSkipFiles</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;skip&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">skipFile</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                            
            <span class="n">colorList</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">mpl</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">datad</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">m</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;_r&quot;</span><span class="p">)]</span>
            <span class="n">colorSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">colorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Color bar &#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">colSel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">],</span><span class="n">choices</span><span class="o">=</span><span class="n">colorList</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_SORT</span><span class="p">)</span>
            <span class="n">colSel</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span> <span class="n">OnNewColorBar</span><span class="p">)</span>
            <span class="n">colorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">colSel</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">colorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;image files to skip:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">skipFile</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">ComboBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;skip&#39;</span><span class="p">]),</span>
                <span class="n">choices</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">))],</span>
                <span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_READONLY</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">CB_DROPDOWN</span><span class="p">)</span>
            <span class="n">skipFile</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_COMBOBOX</span><span class="p">,</span><span class="n">OnSkipFiles</span><span class="p">)</span>
            <span class="n">colorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">skipFile</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">shoBlk</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">CheckBox</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Show image blocks?&#39;</span><span class="p">)</span>
            <span class="n">shoBlk</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;showBlk&#39;</span><span class="p">])</span>
            <span class="n">shoBlk</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_CHECKBOX</span><span class="p">,</span> <span class="n">OnShowBlk</span><span class="p">)</span>
            <span class="n">colorSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">shoBlk</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">colorSizer</span>                   
            
        <span class="k">def</span> <span class="nf">MaxSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnMaxSlider</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>            
                <span class="n">imax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxSel</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">100.</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">imax</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
                
            <span class="k">def</span> <span class="nf">OnMaxValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="ne">ValueError</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">maxSel</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">value</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            
            <span class="n">maxSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">maxSizer</span><span class="o">.</span><span class="n">AddGrowableCol</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">maxSizer</span><span class="o">.</span><span class="n">SetFlexibleDirection</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">HORIZONTAL</span><span class="p">)</span>
            <span class="n">maxSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39; Max intensity&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxSel</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">Slider</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">style</span><span class="o">=</span><span class="n">wx</span><span class="o">.</span><span class="n">SL_HORIZONTAL</span><span class="p">,</span>
                <span class="n">value</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">maxSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxSel</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxSel</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_SLIDER</span><span class="p">,</span> <span class="n">OnMaxSlider</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnMaxValue</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnMaxValue</span><span class="p">)</span>
            <span class="n">maxSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxVal</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>    
            <span class="k">return</span> <span class="n">maxSizer</span>    
                    
        <span class="k">def</span> <span class="nf">ZSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnZValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            
            <span class="n">zSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">zSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Upper intensity mask:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">zMax</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmax&#39;</span><span class="p">]))</span>
            <span class="n">zMax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnZValue</span><span class="p">)</span>
            <span class="n">zMax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnZValue</span><span class="p">)</span>
            <span class="n">ObjIndx</span><span class="p">[</span><span class="n">zMax</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="s">&#39;Zmax&#39;</span>
            <span class="n">zSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">zMax</span><span class="p">)</span>
            <span class="n">zSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Intensity subtraction:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">zMin</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmin&#39;</span><span class="p">]))</span>
            <span class="n">ObjIndx</span><span class="p">[</span><span class="n">zMin</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="s">&#39;Zmin&#39;</span>
            <span class="n">zMin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnZValue</span><span class="p">)</span>
            <span class="n">zMin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnZValue</span><span class="p">)</span>
            <span class="n">zSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">zMin</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">zSizer</span>
                        
        <span class="k">def</span> <span class="nf">ZeroSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnZeroValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">Obj</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
                
            <span class="k">def</span> <span class="nf">OnZpdgValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.0</span><span class="o">*</span><span class="n">value</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">pi</span>
                <span class="n">Obj</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            
            <span class="n">zeroSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;X-zero:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">zMax</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">zMax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnZeroValue</span><span class="p">)</span>
            <span class="n">zMax</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnZeroValue</span><span class="p">)</span>
            <span class="n">ObjIndx</span><span class="p">[</span><span class="n">zMax</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">zMax</span><span class="p">)</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;Y-zero:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">zMin</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">ObjIndx</span><span class="p">[</span><span class="n">zMin</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">zMin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnZeroValue</span><span class="p">)</span>
            <span class="n">zMin</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnZeroValue</span><span class="p">)</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">zMin</span><span class="p">)</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;mm per deg:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
            <span class="n">zpdeg</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]))</span>
            <span class="n">ObjIndx</span><span class="p">[</span><span class="n">zpdeg</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]</span>
            <span class="n">zpdeg</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnZpdgValue</span><span class="p">)</span>
            <span class="n">zpdeg</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnZpdgValue</span><span class="p">)</span>
            <span class="n">zeroSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">zpdeg</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">zeroSizer</span>
                        
        <span class="k">def</span> <span class="nf">TBLRSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnTBLRValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">data</span><span class="p">[</span><span class="n">item</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">Obj</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            
            <span class="n">TBLRsizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Bottom&#39;</span><span class="p">,</span><span class="s">&#39;Top&#39;</span><span class="p">]):</span> 
                <span class="n">TBLRsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">item</span><span class="o">+</span><span class="s">&#39; limit, pixels:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
                <span class="n">TBlim</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">TBlim</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnTBLRValue</span><span class="p">)</span>
                <span class="n">TBlim</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnTBLRValue</span><span class="p">)</span>
                <span class="n">ObjIndx</span><span class="p">[</span><span class="n">TBlim</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
                <span class="n">TBLRsizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">TBlim</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">TBLRsizer</span>
            
        <span class="k">def</span> <span class="nf">ScanSizer</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            
            <span class="k">def</span> <span class="nf">OnScanValue</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
                <span class="n">Obj</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">GetEventObject</span><span class="p">()</span>
                <span class="n">item</span> <span class="o">=</span> <span class="n">ObjIndx</span><span class="p">[</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetId</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Obj</span><span class="o">.</span><span class="n">GetValue</span><span class="p">())</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;2thScan&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span>
                <span class="n">data</span><span class="p">[</span><span class="s">&#39;2thScan&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                <span class="n">Obj</span><span class="o">.</span><span class="n">SetValue</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">pixel</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;pixel&#39;</span><span class="p">]</span>
                    <span class="n">zero</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">tthscale</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]</span>
                    <span class="n">npixel</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span><span class="o">*</span><span class="n">tthscale</span><span class="o">+</span><span class="n">zero</span><span class="p">)</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">data</span><span class="p">[</span><span class="s">&#39;LRlimits&#39;</span><span class="p">][</span><span class="n">item</span><span class="p">]</span> <span class="o">=</span> <span class="n">npixel</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            
            <span class="n">scanSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">FlexGridSizer</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s">&#39;Lower 2-th&#39;</span><span class="p">,</span><span class="s">&#39;Upper 2-th&#39;</span><span class="p">,</span><span class="s">&#39;2-th step&#39;</span><span class="p">]):</span>
                <span class="n">scanSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">StaticText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">item</span><span class="o">+</span><span class="s">&#39;:&#39;</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
                <span class="n">scanParm</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">TextCtrl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;2thScan&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">scanParm</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_TEXT_ENTER</span><span class="p">,</span><span class="n">OnScanValue</span><span class="p">)</span>
                <span class="n">scanParm</span><span class="o">.</span><span class="n">Bind</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">EVT_KILL_FOCUS</span><span class="p">,</span><span class="n">OnScanValue</span><span class="p">)</span>
                <span class="n">ObjIndx</span><span class="p">[</span><span class="n">scanParm</span><span class="o">.</span><span class="n">GetId</span><span class="p">()]</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">scanSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">scanParm</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">scanSizer</span>                
                        
        <span class="n">mainSizer</span> <span class="o">=</span> <span class="n">wx</span><span class="o">.</span><span class="n">BoxSizer</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ColorSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>        
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">MaxSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_LEFT</span><span class="o">|</span><span class="n">wx</span><span class="o">.</span><span class="n">EXPAND</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ZSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ZeroSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ScanSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Add</span><span class="p">(</span><span class="n">TBLRSizer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">wx</span><span class="o">.</span><span class="n">ALIGN_CENTER_VERTICAL</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="o">.</span><span class="n">SetSizer</span><span class="p">(</span><span class="n">mainSizer</span><span class="p">)</span>
        <span class="n">mainSizer</span><span class="o">.</span><span class="n">Layout</span><span class="p">()</span>    
        <span class="n">fitSize</span> <span class="o">=</span> <span class="n">mainSizer</span><span class="o">.</span><span class="n">Fit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">SCCDPanel</span><span class="p">)</span>
<span class="c">#        self.SCCDPanel.GetParent().SetSize(fitSize)</span>
            
    <span class="k">def</span> <span class="nf">PlotImage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pixel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;pixel&#39;</span><span class="p">]</span>
        <span class="n">scalex</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span>
        <span class="n">scaley</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span>

        
        <span class="k">def</span> <span class="nf">OnMotion</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
            <span class="n">sizexy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span> <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">:</span>                 <span class="c">#avoid out of frame errors</span>
                <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetCursor</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">CROSS_CURSOR</span><span class="p">)</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span>
                <span class="k">if</span> <span class="n">item</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s">&#39;Line&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
                        <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetToolTipString</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%8.3f</span><span class="s"> </span><span class="si">%8.3f</span><span class="s">mm&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xpos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
                    <span class="n">ypos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
                    <span class="n">xpix</span> <span class="o">=</span> <span class="n">xpos</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">scalex</span><span class="p">)</span>
                    <span class="n">ypix</span> <span class="o">=</span> <span class="n">sizexy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">ypos</span><span class="o">/</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">scaley</span><span class="p">)</span>
                    <span class="n">Int</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="k">if</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">xpix</span> <span class="o">&lt;=</span> <span class="n">sizexy</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">ypix</span> <span class="o">&lt;=</span> <span class="n">sizexy</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                        <span class="n">Int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="p">[</span><span class="n">xpix</span><span class="p">][</span><span class="n">ypix</span><span class="p">]</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmin&#39;</span><span class="p">]</span>
                        <span class="n">tth</span> <span class="o">=</span> <span class="p">(</span><span class="n">xpos</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;mm/deg&#39;</span><span class="p">]</span>
                        <span class="n">vecA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
                        <span class="n">vecB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">npcosd</span><span class="p">(</span><span class="n">tth</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">],</span><span class="n">npsind</span><span class="p">(</span><span class="n">tth</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;radius&#39;</span><span class="p">],(</span><span class="n">ypos</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">])])</span>
                        <span class="n">vecB</span> <span class="o">/=</span> <span class="n">nl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vecB</span><span class="p">)</span>
                        <span class="n">tth2</span> <span class="o">=</span> <span class="n">npacosd</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vecA</span><span class="p">,</span><span class="n">vecB</span><span class="p">))</span><span class="o">*</span><span class="n">tth</span><span class="o">/</span><span class="nb">abs</span><span class="p">(</span><span class="n">tth</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">SetFields</span><span class="p">(</span>\
                            <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;Detector x,y =</span><span class="si">%9.3f</span><span class="s">mm </span><span class="si">%9.3f</span><span class="s">mm, 2-th =</span><span class="si">%9.3f</span><span class="s"> I = </span><span class="si">%6d</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span><span class="p">,</span><span class="n">tth2</span><span class="p">,</span><span class="n">Int</span><span class="p">)])</span>
                            
        <span class="k">def</span> <span class="nf">OnPick</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">artist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mousePicked</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">mouseevent</span>
            
        <span class="k">def</span> <span class="nf">OnRelease</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span>
            <span class="n">xpos</span><span class="p">,</span><span class="n">ypos</span> <span class="o">=</span> <span class="p">[</span><span class="n">event</span><span class="o">.</span><span class="n">xdata</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">ydata</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;_line0&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span>    <span class="c">#X-zero</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpos</span>               
            <span class="k">elif</span> <span class="s">&#39;_line1&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span>  <span class="c">#Y-zero</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypos</span>
            <span class="k">elif</span> <span class="s">&#39;_line2&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span> <span class="c">#Y-lower limit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ypos</span><span class="o">/</span><span class="n">scaley</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_line3&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span> <span class="c">#Y-upper limit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ypos</span><span class="o">/</span><span class="n">scaley</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_line4&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span> <span class="c">#X-lower limit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;LRlimits&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xpos</span><span class="o">/</span><span class="n">scalex</span><span class="p">)</span>
            <span class="k">elif</span> <span class="s">&#39;_line5&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span><span class="p">):</span> <span class="c">#X-upper limit</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;LRlimits&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xpos</span><span class="o">/</span><span class="n">scalex</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">itemPicked</span> <span class="o">=</span> <span class="bp">None</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">PlotImage</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">UpdateControls</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;scanCCD image&#39;</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>          <span class="c">#get previous powder plot &amp; get limits</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span><span class="n">Plot</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Page</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
                <span class="n">Page</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">addMpl</span><span class="p">(</span><span class="s">&#39;scanCCD image&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;scanCCD image&#39;</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="n">OnMotion</span><span class="p">)</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;pick_event&#39;</span><span class="p">,</span> <span class="n">OnPick</span><span class="p">)</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;button_release_event&#39;</span><span class="p">,</span> <span class="n">OnRelease</span><span class="p">)</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;size&#39;</span><span class="p">]</span>
        <span class="n">Imin</span><span class="p">,</span><span class="n">Imax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;range&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]]</span>
        <span class="n">Xmax</span> <span class="o">=</span> <span class="n">scalex</span><span class="o">*</span><span class="n">xlim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span>
        <span class="n">Ymax</span> <span class="o">=</span> <span class="n">scaley</span><span class="o">*</span><span class="n">ylim</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;imScale&#39;</span><span class="p">]</span>
        <span class="n">TBlimit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;TBlimits&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">scalex</span>
        <span class="n">LRlimit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;LRlimits&#39;</span><span class="p">])</span><span class="o">*</span><span class="n">scaley</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">SetFields</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">])</span>
        <span class="n">Zmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmin&#39;</span><span class="p">]</span>
        <span class="n">Zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zmax&#39;</span><span class="p">]</span>
        <span class="n">Zeros</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;Zeros&#39;</span><span class="p">]</span>
        <span class="n">Lines</span> <span class="o">=</span> <span class="p">[]</span>
            
<span class="c">#        MA = ma.masked_greater(ma.masked_less(self.Image.T,Zmin),Zmax)</span>
<span class="c">#        MaskA = ma.getmaskarray(MA)</span>
<span class="c">#        ImgM = Plot.imshow(MaskA,aspect=&#39;auto&#39;,cmap=&#39;Reds&#39;,</span>
<span class="c">#            interpolation=&#39;nearest&#39;,vmin=0,vmax=2,extent=[0,Xmax,0,Ymax])</span>
        <span class="n">Img</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">T</span><span class="o">-</span><span class="n">Zmin</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">vmin</span><span class="o">=</span><span class="n">Imin</span><span class="p">,</span><span class="n">vmax</span><span class="o">=</span><span class="n">Imax</span><span class="p">,</span>
            <span class="n">aspect</span><span class="o">=</span><span class="s">&#39;auto&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">],</span><span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">Xmax</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Ymax</span><span class="p">])</span>
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">Zeros</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>    
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">Zeros</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>    
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">TBlimit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>    
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">TBlimit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>    
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">LRlimit</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>    
        <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">LRlimit</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">dashes</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span><span class="n">picker</span><span class="o">=</span><span class="mf">3.</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">blk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">imagefiles</span><span class="p">)):</span>
            <span class="n">Lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Plot</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">blk</span><span class="o">*</span><span class="mi">4096</span><span class="o">*</span><span class="n">scalex</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">))</span>    
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Scan, mm&#39;</span><span class="p">)</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Detector Y, mm&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xylim</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
            
    <span class="k">def</span> <span class="nf">PlotBlock</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">block</span><span class="p">,</span><span class="n">title</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Block&#39;</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>          <span class="c">#get previous powder plot &amp; get limits</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span><span class="n">Plot</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">Page</span><span class="o">.</span><span class="n">IsShown</span><span class="p">():</span>
                <span class="n">Page</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">addMpl</span><span class="p">(</span><span class="s">&#39;Block&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&#39;Block&#39;</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">Img</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">block</span><span class="p">,</span><span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span><span class="n">aspect</span><span class="o">=</span><span class="s">&#39;equal&#39;</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s">&#39;color&#39;</span><span class="p">])</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xylim</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
                    
    <span class="k">def</span> <span class="nf">PlotXY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">XY</span><span class="p">,</span><span class="n">newPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;simple plot of xy data, used for diagnostic purposes</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">def</span> <span class="nf">OnMotion</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
            <span class="n">xpos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">xdata</span>
            <span class="k">if</span> <span class="n">xpos</span><span class="p">:</span>                                        <span class="c">#avoid out of frame mouse position</span>
                <span class="n">ypos</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">ydata</span>
                <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">SetCursor</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">CROSS_CURSOR</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&#39;X =</span><span class="si">%9.3f</span><span class="s"> </span><span class="si">%s</span><span class="s"> =</span><span class="si">%9.3f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span><span class="nb">type</span><span class="p">,</span><span class="n">ypos</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span>                   
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">SetStatusText</span><span class="p">(</span><span class="s">&#39;Select &#39;</span><span class="o">+</span><span class="nb">type</span><span class="o">+</span><span class="s">&#39; pattern first&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
        <span class="k">try</span><span class="p">:</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">newPlot</span><span class="p">:</span>
                <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
                <span class="n">xylim</span> <span class="o">=</span> <span class="n">Plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span><span class="n">Plot</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="n">Page</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="n">newPlot</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="n">Plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">addMpl</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
            <span class="n">plotNum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">plotList</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
            <span class="n">Page</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">nb</span><span class="o">.</span><span class="n">GetPage</span><span class="p">(</span><span class="n">plotNum</span><span class="p">)</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">mpl_connect</span><span class="p">(</span><span class="s">&#39;motion_notify_event&#39;</span><span class="p">,</span> <span class="n">OnMotion</span><span class="p">)</span>
        
        <span class="n">Page</span><span class="o">.</span><span class="n">SetFocus</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plotNB</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">DestroyChildren</span><span class="p">()</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="s">&#39;line scan&#39;</span><span class="p">:</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;image x, mm&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;2-theta, deg&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>            
        <span class="n">Plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;&#39;</span><span class="o">+</span><span class="nb">type</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
        <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;g&#39;</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">,</span><span class="s">&#39;m&#39;</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">]</span>
        <span class="n">lenX</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">S</span> <span class="o">=</span> <span class="n">XY</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">Plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">S</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">,</span><span class="n">picker</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">newPlot</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">Plot</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">xylim</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">xylim</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">push_current</span><span class="p">()</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Page</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">scanCCDmain</span><span class="p">(</span><span class="n">wx</span><span class="o">.</span><span class="n">App</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">OnInit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">scanCCD</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">Show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">SetTopWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="main"><a class="viewcode-back" href="../GSASIIscripts.html#scanCCD.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="s">&#39;starts main application to merge data from scanning CCD&#39;</span>
    <span class="n">application</span> <span class="o">=</span> <span class="n">scanCCDmain</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">application</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
    </div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>