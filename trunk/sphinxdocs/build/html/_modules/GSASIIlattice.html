

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASIIlattice &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for GSASIIlattice</h1><div class="highlight"><pre>
<span class="c"># -*- coding: utf-8 -*-</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">*GSASIIlattice: Unit cells*</span>
<span class="sd">---------------------------</span>

<span class="sd">Perform lattice-related computations&#39;&#39;&#39;</span>
<span class="c">########### SVN repository information ###################</span>
<span class="c"># $Date: 2013-06-02 23:07:35 -0500 (Sun, 02 Jun 2013) $</span>
<span class="c"># $Author: toby $</span>
<span class="c"># $Revision: 939 $</span>
<span class="c"># $URL: https://subversion.xor.aps.anl.gov/pyGSAS/trunk/GSASIIlattice.py $</span>
<span class="c"># $Id: GSASIIlattice.py 939 2013-06-03 04:07:35Z toby $</span>
<span class="c">########### SVN repository information ###################</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="kn">as</span> <span class="nn">nl</span>

<span class="c"># trig functions in degrees</span>
<span class="n">sind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">asind</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">tand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">atand</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">atan2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">cosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
<span class="n">acosd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">180.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
<span class="n">rdsq2d</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">p</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">p</span><span class="p">)</span>

<div class="viewcode-block" id="sec2HMS"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.sec2HMS">[docs]</a><span class="k">def</span> <span class="nf">sec2HMS</span><span class="p">(</span><span class="n">sec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Convert time in sec to H:M:S string</span>
<span class="sd">    </span>
<span class="sd">    :param sec: time in seconds</span>
<span class="sd">    :return: H:M:S string (to nearest 100th second)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">H</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span>
    <span class="n">M</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sec</span><span class="o">/</span><span class="mi">60</span><span class="o">-</span><span class="n">H</span><span class="o">*</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">sec</span><span class="o">-</span><span class="mi">3600</span><span class="o">*</span><span class="n">H</span><span class="o">-</span><span class="mi">60</span><span class="o">*</span><span class="n">M</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">:</span><span class="si">%2d</span><span class="s">:</span><span class="si">%.2f</span><span class="s">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">S</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="rotdMat"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.rotdMat">[docs]</a><span class="k">def</span> <span class="nf">rotdMat</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prepare rotation matrix for angle in degrees about axis(=0,1,2)</span>

<span class="sd">    :param angle: angle in degrees</span>
<span class="sd">    :param axis:  axis (0,1,2 = x,y,z) about which for the rotation</span>
<span class="sd">    :return: rotation matrix - 3x3 numpy array</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">elif</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">,</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">)]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">)],[</span><span class="mi">0</span><span class="p">,</span><span class="n">sind</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">cosd</span><span class="p">(</span><span class="n">angle</span><span class="p">)]])</span>
        </div>
<div class="viewcode-block" id="rotdMat4"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.rotdMat4">[docs]</a><span class="k">def</span> <span class="nf">rotdMat4</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Prepare rotation matrix for angle in degrees about axis(=0,1,2) with scaling for OpenGL </span>

<span class="sd">    :param angle: angle in degrees</span>
<span class="sd">    :param axis:  axis (0,1,2 = x,y,z) about which for the rotation</span>
<span class="sd">    :return: rotation matrix - 4x4 numpy array (last row/column for openGL scaling)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Mat</span> <span class="o">=</span> <span class="n">rotdMat</span><span class="p">(</span><span class="n">angle</span><span class="p">,</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">Mat</span><span class="p">,[[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">0</span><span class="p">]]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],]),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="fillgmat"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.fillgmat">[docs]</a><span class="k">def</span> <span class="nf">fillgmat</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute lattice metric tensor from unit cell constants</span>

<span class="sd">    :param cell: tuple with a,b,c,alpha, beta, gamma (degrees)</span>
<span class="sd">    :return: 3x3 numpy array</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span> <span class="o">=</span> <span class="n">cell</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">,</span>  <span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">gam</span><span class="p">),</span>  <span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">bet</span><span class="p">)],</span>
        <span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">gam</span><span class="p">),</span>  <span class="n">b</span><span class="o">*</span><span class="n">b</span><span class="p">,</span>  <span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">alp</span><span class="p">)],</span>
        <span class="p">[</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">bet</span><span class="p">)</span> <span class="p">,</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">alp</span><span class="p">),</span>   <span class="n">c</span><span class="o">*</span><span class="n">c</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">g</span>
           </div>
<div class="viewcode-block" id="cell2Gmat"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.cell2Gmat">[docs]</a><span class="k">def</span> <span class="nf">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute real and reciprocal lattice metric tensor from unit cell constants</span>

<span class="sd">    :param cell: tuple with a,b,c,alpha, beta, gamma (degrees)</span>
<span class="sd">    :return: reciprocal (G) &amp; real (g) metric tensors (list of two numpy 3x3 arrays)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">fillgmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>        
    <span class="k">return</span> <span class="n">G</span><span class="p">,</span><span class="n">g</span>
</div>
<div class="viewcode-block" id="A2Gmat"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.A2Gmat">[docs]</a><span class="k">def</span> <span class="nf">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fill real &amp; reciprocal metric tensor (G) from A</span>

<span class="sd">    :param A: reciprocal metric tensor elements as [G11,G22,G33,2*G12,2*G13,2*G23]</span>
<span class="sd">    :param bool inverse: if True return bot G and g; else just G</span>
<span class="sd">    :return: reciprocal (G) &amp; real (g) metric tensors (list of two numpy 3x3 arrays)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>  <span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">],</span> 
        <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>    <span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">],</span> 
        <span class="p">[</span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span><span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span>    <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]]]</span>
    <span class="k">if</span> <span class="n">inverse</span><span class="p">:</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">G</span><span class="p">,</span><span class="n">g</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">G</span>
</div>
<div class="viewcode-block" id="Gmat2A"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Gmat2A">[docs]</a><span class="k">def</span> <span class="nf">Gmat2A</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Extract A from reciprocal metric tensor (G)</span>

<span class="sd">    :param G: reciprocal maetric tensor (3x3 numpy array</span>
<span class="sd">    :return: A = [G11,G22,G33,2*G12,2*G13,2*G23]</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">G</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="mf">2.</span><span class="o">*</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="mf">2.</span><span class="o">*</span><span class="n">G</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="mf">2.</span><span class="o">*</span><span class="n">G</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]</span>
    </div>
<div class="viewcode-block" id="cell2A"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.cell2A">[docs]</a><span class="k">def</span> <span class="nf">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Obtain A = [G11,G22,G33,2*G12,2*G13,2*G23] from lattice parameters</span>

<span class="sd">    :param cell: [a,b,c,alpha,beta,gamma] (degrees)</span>
<span class="sd">    :return: G reciprocal metric tensor as 3x3 numpy array</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Gmat2A</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="A2cell"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.A2cell">[docs]</a><span class="k">def</span> <span class="nf">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute unit cell constants from A</span>

<span class="sd">    :param A: [G11,G22,G33,2*G12,2*G13,2*G23] G - reciprocal metric tensor</span>
<span class="sd">    :return: a,b,c,alpha, beta, gamma (degrees) - lattice parameters</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Gmat2cell"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Gmat2cell">[docs]</a><span class="k">def</span> <span class="nf">Gmat2cell</span><span class="p">(</span><span class="n">g</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute real/reciprocal lattice parameters from real/reciprocal metric tensor (g/G)</span>
<span class="sd">    The math works the same either way.</span>

<span class="sd">    :param g (or G): real (or reciprocal) metric tensor 3x3 array</span>
<span class="sd">    :return: a,b,c,alpha, beta, gamma (degrees) (or a*,b*,c*,alpha*,beta*,gamma* degrees)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">oldset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="s">&#39;raise&#39;</span><span class="p">)</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]))</span>
    <span class="n">alp</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">bet</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">c</span><span class="p">))</span>
    <span class="n">gam</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">b</span><span class="p">))</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">oldset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">alp</span><span class="p">,</span><span class="n">bet</span><span class="p">,</span><span class="n">gam</span>
</div>
<div class="viewcode-block" id="invcell2Gmat"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.invcell2Gmat">[docs]</a><span class="k">def</span> <span class="nf">invcell2Gmat</span><span class="p">(</span><span class="n">invcell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute real and reciprocal lattice metric tensor from reciprocal </span>
<span class="sd">       unit cell constants</span>
<span class="sd">       </span>
<span class="sd">    :param invcell: [a*,b*,c*,alpha*, beta*, gamma*] (degrees)</span>
<span class="sd">    :return: reciprocal (G) &amp; real (g) metric tensors (list of two 3x3 arrays)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">fillgmat</span><span class="p">(</span><span class="n">invcell</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span><span class="p">,</span><span class="n">g</span>
        </div>
<div class="viewcode-block" id="calc_rVsq"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_rVsq">[docs]</a><span class="k">def</span> <span class="nf">calc_rVsq</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the square of the reciprocal lattice volume (1/V**2) from A&#39;</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="n">rVsq</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rVsq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">rVsq</span>
    </div>
<div class="viewcode-block" id="calc_rV"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_rV">[docs]</a><span class="k">def</span> <span class="nf">calc_rV</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the reciprocal lattice volume (V*) from A</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">calc_rVsq</span><span class="p">(</span><span class="n">A</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="calc_V"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_V">[docs]</a><span class="k">def</span> <span class="nf">calc_V</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute the real lattice volume (V) from A</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="n">calc_rV</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="A2invcell"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.A2invcell">[docs]</a><span class="k">def</span> <span class="nf">A2invcell</span><span class="p">(</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute reciprocal unit cell constants from A</span>
<span class="sd">    returns tuple with a*,b*,c*,alpha*, beta*, gamma* (degrees)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">A2Gmat</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Gmat2AB"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Gmat2AB">[docs]</a><span class="k">def</span> <span class="nf">Gmat2AB</span><span class="p">(</span><span class="n">G</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes orthogonalization matrix from reciprocal metric tensor G</span>

<span class="sd">    :returns: tuple of two 3x3 numpy arrays (A,B)</span>

<span class="sd">       * A for crystal to Cartesian transformations A*x = np.inner(A,x) = X </span>
<span class="sd">       * B (= inverse of A) for Cartesian to crystal transformation B*X = np.inner(B,X) = x</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cellstar</span> <span class="o">=</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">cell</span> <span class="o">=</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="c"># from Giacovazzo (Fundamentals 2nd Ed.) p.75</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c"># a</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="c"># b cos(gamma)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c"># c cos(beta)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="c"># b sin(gamma)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cellstar</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="c"># - c cos(alpha*) sin(beta)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cellstar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>         <span class="c"># 1/c*</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span>
    
</div>
<div class="viewcode-block" id="cell2AB"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.cell2AB">[docs]</a><span class="k">def</span> <span class="nf">cell2AB</span><span class="p">(</span><span class="n">cell</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Computes orthogonalization matrix from unit cell constants</span>

<span class="sd">    :param tuple cell: a,b,c, alpha, beta, gamma (degrees)</span>
<span class="sd">    :returns: tuple of two 3x3 numpy arrays (A,B)</span>
<span class="sd">       A for crystal to Cartesian transformations A*x = np.inner(A,x) = X </span>
<span class="sd">       B (= inverse of A) for Cartesian to crystal transformation B*X = np.inner(B,X) = x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span> 
    <span class="n">cellstar</span> <span class="o">=</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
    <span class="c"># from Giacovazzo (Fundamentals 2nd Ed.) p.75</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>                <span class="c"># a</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="c"># b cos(gamma)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span>  <span class="c"># c cos(beta)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  <span class="c"># b sin(gamma)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">cell</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cellstar</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="c"># - c cos(alpha*) sin(beta)</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">cellstar</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>         <span class="c"># 1/c*</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">nl</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span><span class="n">B</span>
    </div>
<div class="viewcode-block" id="U6toUij"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.U6toUij">[docs]</a><span class="k">def</span> <span class="nf">U6toUij</span><span class="p">(</span><span class="n">U6</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fill matrix (Uij) from U6 = [U11,U22,U33,U12,U13,U23]</span>
<span class="sd">    NB: there is a non numpy version in GSASIIspc: U2Uij</span>

<span class="sd">    :param list U6: 6 terms of u11,u22,...</span>
<span class="sd">    :returns:</span>
<span class="sd">        Uij - numpy [3][3] array of uij</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="p">[</span><span class="n">U6</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span> 
        <span class="p">[</span><span class="n">U6</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> 
        <span class="p">[</span><span class="n">U6</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>  <span class="n">U6</span><span class="p">[</span><span class="mi">2</span><span class="p">]]])</span>
    <span class="k">return</span> <span class="n">U</span>
</div>
<div class="viewcode-block" id="UijtoU6"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.UijtoU6">[docs]</a><span class="k">def</span> <span class="nf">UijtoU6</span><span class="p">(</span><span class="n">U</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Fill vector [U11,U22,U33,U12,U13,U23] from Uij </span>
<span class="sd">    NB: there is a non numpy version in GSASIIspc: Uij2U</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">U6</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">U</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">],</span><span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]])</span>
    <span class="k">return</span> <span class="n">U6</span>
</div>
<div class="viewcode-block" id="Uij2betaij"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Uij2betaij">[docs]</a><span class="k">def</span> <span class="nf">Uij2betaij</span><span class="p">(</span><span class="n">Uij</span><span class="p">,</span><span class="n">G</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert Uij to beta-ij tensors -- stub for eventual completion</span>
<span class="sd">    </span>
<span class="sd">    :param Uij: numpy array [Uij]</span>
<span class="sd">    :param G: reciprocal metric tensor</span>
<span class="sd">    :returns: beta-ij - numpy array [beta-ij]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
    </div>
<div class="viewcode-block" id="CosSinAngle"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.CosSinAngle">[docs]</a><span class="k">def</span> <span class="nf">CosSinAngle</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">G</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; calculate sin &amp; cos of angle betwee U &amp; V in generalized coordinates </span>
<span class="sd">    defined by metric tensor G</span>

<span class="sd">    :param U: 3-vectors assume numpy arrays</span>
<span class="sd">    :param V: 3-vectors assume numpy arrays</span>
<span class="sd">    :param G: metric tensor for U &amp; V defined space assume numpy array</span>
<span class="sd">    :returns:</span>
<span class="sd">        cos(phi) &amp; sin(phi)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">U</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">U</span><span class="p">)))</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">V</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">V</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">V</span><span class="p">)))</span>
    <span class="n">cosP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">u</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">v</span><span class="p">))</span>
    <span class="n">sinP</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="o">-</span><span class="n">cosP</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">cosP</span><span class="p">,</span><span class="n">sinP</span>
    </div>
<div class="viewcode-block" id="criticalEllipse"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.criticalEllipse">[docs]</a><span class="k">def</span> <span class="nf">criticalEllipse</span><span class="p">(</span><span class="n">prob</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate critical values for probability ellipsoids from probability</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span> <span class="mf">0.01</span> <span class="o">&lt;=</span> <span class="n">prob</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.54</span> 
    <span class="n">coeff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">6.44988E-09</span><span class="p">,</span><span class="mf">4.16479E-07</span><span class="p">,</span><span class="mf">1.11172E-05</span><span class="p">,</span><span class="mf">1.58767E-04</span><span class="p">,</span><span class="mf">0.00130554</span><span class="p">,</span>
        <span class="mf">0.00604091</span><span class="p">,</span><span class="mf">0.0114921</span><span class="p">,</span><span class="o">-</span><span class="mf">0.040301</span><span class="p">,</span><span class="o">-</span><span class="mf">0.6337203</span><span class="p">,</span><span class="mf">1.311582</span><span class="p">])</span>
    <span class="n">llpr</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">polyval</span><span class="p">(</span><span class="n">coeff</span><span class="p">,</span><span class="n">llpr</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="CellBlock"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.CellBlock">[docs]</a><span class="k">def</span> <span class="nf">CellBlock</span><span class="p">(</span><span class="n">nCells</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate block of unit cells n*n*n on a side; [0,0,0] centered, n = 2*nCells+1</span>
<span class="sd">    currently only works for nCells = 0 or 1 (not &gt;1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">nCells</span><span class="p">:</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">nCells</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">N2</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">N</span>
        <span class="n">N3</span> <span class="o">=</span> <span class="n">N</span><span class="o">*</span><span class="n">N</span><span class="o">*</span><span class="n">N</span>
        <span class="n">cellArray</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N3</span><span class="p">))</span>
        <span class="n">cellGen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">A</span><span class="o">/</span><span class="n">N2</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="o">/</span><span class="n">N</span><span class="o">%</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">A</span><span class="o">%</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">cellGen</span><span class="p">:</span>
            <span class="n">cellArray</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cellArray</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        </div>
<div class="viewcode-block" id="CellAbsorption"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.CellAbsorption">[docs]</a><span class="k">def</span> <span class="nf">CellAbsorption</span><span class="p">(</span><span class="n">ElList</span><span class="p">,</span><span class="n">Volume</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Compute unit cell absorption</span>

<span class="sd">    :param dict ElList: dictionary of element contents including mu and</span>
<span class="sd">      number of atoms be cell</span>
<span class="sd">    :param float Volume: unit cell volume</span>
<span class="sd">    :returns: mu-total/Volume</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">muT</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">El</span> <span class="ow">in</span> <span class="n">ElList</span><span class="p">:</span>
        <span class="n">muT</span> <span class="o">+=</span> <span class="n">ElList</span><span class="p">[</span><span class="n">El</span><span class="p">][</span><span class="s">&#39;mu&#39;</span><span class="p">]</span><span class="o">*</span><span class="n">ElList</span><span class="p">[</span><span class="n">El</span><span class="p">][</span><span class="s">&#39;FormulaNo&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">muT</span><span class="o">/</span><span class="n">Volume</span>
    
<span class="c">#Permutations and Combinations</span>
<span class="c"># Four routines: combinations,uniqueCombinations, selections &amp; permutations</span>
<span class="c">#These taken from Python Cookbook, 2nd Edition. 19.15 p724-726</span>
<span class="c">#    </span></div>
<span class="k">def</span> <span class="nf">_combinators</span><span class="p">(</span><span class="n">_handle</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; factored-out common structure of all following combinators &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[</span> <span class="p">]</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
        <span class="n">this_one</span> <span class="o">=</span> <span class="p">[</span> <span class="n">item</span> <span class="p">]</span>
        <span class="k">for</span> <span class="n">cc</span> <span class="ow">in</span> <span class="n">_combinators</span><span class="p">(</span><span class="n">_handle</span><span class="p">,</span> <span class="n">_handle</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">i</span><span class="p">),</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">this_one</span> <span class="o">+</span> <span class="n">cc</span>
<div class="viewcode-block" id="combinations"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.combinations">[docs]</a><span class="k">def</span> <span class="nf">combinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; take n distinct items, order matters &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">skipIthItem</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">_combinators</span><span class="p">(</span><span class="n">skipIthItem</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></div>
<div class="viewcode-block" id="uniqueCombinations"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.uniqueCombinations">[docs]</a><span class="k">def</span> <span class="nf">uniqueCombinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; take n distinct items, order is irrelevant &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">afterIthItem</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">return</span> <span class="n">_combinators</span><span class="p">(</span><span class="n">afterIthItem</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></div>
<div class="viewcode-block" id="selections"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.selections">[docs]</a><span class="k">def</span> <span class="nf">selections</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; take n (not necessarily distinct) items, order matters &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">keepAllItems</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">items</span>
    <span class="k">return</span> <span class="n">_combinators</span><span class="p">(</span><span class="n">keepAllItems</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span></div>
<div class="viewcode-block" id="permutations"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.permutations">[docs]</a><span class="k">def</span> <span class="nf">permutations</span><span class="p">(</span><span class="n">items</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; take all items, order matters &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">combinations</span><span class="p">(</span><span class="n">items</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">items</span><span class="p">))</span>

<span class="c">#reflection generation routines</span>
<span class="c">#for these: H = [h,k,l]; A is as used in calc_rDsq; G - inv metric tensor, g - metric tensor; </span>
<span class="c">#           cell - a,b,c,alp,bet,gam in A &amp; deg</span>
   </div>
<div class="viewcode-block" id="calc_rDsq"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_rDsq">[docs]</a><span class="k">def</span> <span class="nf">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">rdsq</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">A</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">rdsq</span>
    </div>
<div class="viewcode-block" id="calc_rDsq2"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_rDsq2">[docs]</a><span class="k">def</span> <span class="nf">calc_rDsq2</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">G</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="calc_rDsqZ"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.calc_rDsqZ">[docs]</a><span class="k">def</span> <span class="nf">calc_rDsqZ</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">tth</span><span class="p">,</span><span class="n">lam</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">rpd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
    <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span><span class="o">+</span><span class="n">Z</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">tth</span><span class="p">)</span><span class="o">*</span><span class="mf">2.0</span><span class="o">*</span><span class="n">rpd</span><span class="o">/</span><span class="n">lam</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">rdsq</span>
       </div>
<div class="viewcode-block" id="MaxIndex"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.MaxIndex">[docs]</a><span class="k">def</span> <span class="nf">MaxIndex</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">Hmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">Hmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">dmin</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Hmax</span>
    </div>
<div class="viewcode-block" id="sortHKLd"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.sortHKLd">[docs]</a><span class="k">def</span> <span class="nf">sortHKLd</span><span class="p">(</span><span class="n">HKLd</span><span class="p">,</span><span class="n">ifreverse</span><span class="p">,</span><span class="n">ifdup</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;needs doc string</span>

<span class="sd">    :param HKLd: a list of [h,k,l,d,...];</span>
<span class="sd">    :param ifreverse: True for largest d first</span>
<span class="sd">    :param ifdup: True if duplicate d-spacings allowed</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">H</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">HKLd</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ifdup</span><span class="p">:</span>
            <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">i</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">T</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>            
    <span class="n">D</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">HKLd</span><span class="p">))</span>
    <span class="n">T</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ifreverse</span><span class="p">:</span>
        <span class="n">T</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">X</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">okey</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">T</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="n">okey</span><span class="p">:</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>    <span class="c">#remove duplicate d-spacings</span>
        <span class="n">okey</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">return</span> <span class="n">X</span>
    </div>
<div class="viewcode-block" id="SwapIndx"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.SwapIndx">[docs]</a><span class="k">def</span> <span class="nf">SwapIndx</span><span class="p">(</span><span class="n">Axis</span><span class="p">,</span><span class="n">H</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="k">if</span> <span class="n">Axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">H</span>
    <span class="k">elif</span> <span class="n">Axis</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        </div>
<div class="viewcode-block" id="Rh2Hx"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Rh2Hx">[docs]</a><span class="k">def</span> <span class="nf">Rh2Hx</span><span class="p">(</span><span class="n">Rh</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">Hx</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Hx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">Rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Hx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Rh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Hx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Rh</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Hx</span>
    </div>
<div class="viewcode-block" id="Hx2Rh"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Hx2Rh">[docs]</a><span class="k">def</span> <span class="nf">Hx2Rh</span><span class="p">(</span><span class="n">Hx</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">Rh</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">itk</span> <span class="o">=</span> <span class="o">-</span><span class="n">Hx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Hx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Hx</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">itk</span><span class="o">%</span><span class="mi">3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>        <span class="c">#error - not rhombohedral reflection</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">itk</span><span class="o">/</span><span class="mi">3</span>
        <span class="n">Rh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Hx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Rh</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rh</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">Hx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Rh</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
                <span class="n">Rh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Rh</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">Rh</span>
        </div>
<div class="viewcode-block" id="CentCheck"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.CentCheck">[docs]</a><span class="k">def</span> <span class="nf">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,</span><span class="n">H</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span> <span class="o">=</span> <span class="n">H</span>
    <span class="k">if</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;A&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;B&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span> <span class="ow">and</span> <span class="p">((</span><span class="n">h</span><span class="o">+</span><span class="n">k</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">elif</span> <span class="n">Cent</span> <span class="o">==</span> <span class="s">&#39;R&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="o">-</span><span class="n">h</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="n">l</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
                                    </div>
<div class="viewcode-block" id="GetBraviasNum"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GetBraviasNum">[docs]</a><span class="k">def</span> <span class="nf">GetBraviasNum</span><span class="p">(</span><span class="n">center</span><span class="p">,</span><span class="n">system</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Determine the Bravais lattice number, as used in GenHBravais</span>
<span class="sd">    </span>
<span class="sd">    :param center: one of: &#39;P&#39;, &#39;C&#39;, &#39;I&#39;, &#39;F&#39;, &#39;R&#39; (see SGLatt from GSASIIspc.SpcGroup)</span>
<span class="sd">    :param system: one of &#39;cubic&#39;, &#39;hexagonal&#39;, &#39;tetragonal&#39;, &#39;orthorhombic&#39;, &#39;trigonal&#39; (for R)</span>
<span class="sd">      &#39;monoclinic&#39;, &#39;triclinic&#39; (see SGSys from GSASIIspc.SpcGroup)</span>
<span class="sd">    :return: a number between 0 and 13 </span>
<span class="sd">      or throws a ValueError exception if the combination of center, system is not found (i.e. non-standard)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;R&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;trigonal&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;hexagonal&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tetragonal&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">5</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;tetragonal&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">6</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;F&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;orthorhombic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">7</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;orthorhombic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">8</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;orthorhombic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">9</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;orthorhombic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">10</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;C&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">11</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">12</span>
    <span class="k">elif</span> <span class="n">center</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;P&#39;</span> <span class="ow">and</span> <span class="n">system</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;triclinic&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">13</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span><span class="s">&#39;non-standard Bravais lattice center=</span><span class="si">%s</span><span class="s">, cell=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">center</span><span class="p">,</span><span class="n">system</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="GenHBravais"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GenHBravais">[docs]</a><span class="k">def</span> <span class="nf">GenHBravais</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">Bravais</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the positionally unique powder diffraction reflections</span>
<span class="sd">     </span>
<span class="sd">    :param dmin: minimum d-spacing in A</span>
<span class="sd">    :param Bravais: lattice type (see GetBraviasNum). Bravais is one of::</span>
<span class="sd">             0 F cubic</span>
<span class="sd">             1 I cubic</span>
<span class="sd">             2 P cubic</span>
<span class="sd">             3 R hexagonal (trigonal not rhombohedral)</span>
<span class="sd">             4 P hexagonal</span>
<span class="sd">             5 I tetragonal</span>
<span class="sd">             6 P tetragonal</span>
<span class="sd">             7 F orthorhombic</span>
<span class="sd">             8 I orthorhombic</span>
<span class="sd">             9 C orthorhombic</span>
<span class="sd">             10 P orthorhombic</span>
<span class="sd">             11 C monoclinic</span>
<span class="sd">             12 P monoclinic</span>
<span class="sd">             13 P triclinic</span>
<span class="sd">            </span>
<span class="sd">    :param A: reciprocal metric tensor elements as [G11,G22,G33,2*G12,2*G13,2*G23]</span>
<span class="sd">    :return: HKL unique d list of [h,k,l,d,-1] sorted with largest d first</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">if</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">11</span><span class="p">]:</span>
        <span class="n">Cent</span> <span class="o">=</span> <span class="s">&#39;C&#39;</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">]:</span>
        <span class="n">Cent</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">]:</span>
        <span class="n">Cent</span> <span class="o">=</span> <span class="s">&#39;F&#39;</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span>
        <span class="n">Cent</span> <span class="o">=</span> <span class="s">&#39;R&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Cent</span> <span class="o">=</span> <span class="s">&#39;P&#39;</span>
    <span class="n">Hmax</span> <span class="o">=</span> <span class="n">MaxIndex</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="n">dminsq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">dmin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">Bravais</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>                       <span class="c">#triclinic</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">hmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">hmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">hmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                    <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                        <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">]:</span>                <span class="c">#monoclinic - b unique</span>
        <span class="n">Hmax</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">Hmax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span><span class="n">lmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                    <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="mi">2</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">]:</span>            <span class="c">#orthorhombic</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]:</span>                  <span class="c">#tetragonal</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">Bravais</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span>
        <span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">Bravais</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">lmin</span> <span class="o">=</span> <span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>                  <span class="c">#hexagonal/trigonal</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">hmin</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">hmin</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>                                   <span class="c">#cubic</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">Cent</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">rdsq2d</span><span class="p">(</span><span class="n">rdsq</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sortHKLd</span><span class="p">(</span><span class="n">HKL</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="getHKLmax"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.getHKLmax">[docs]</a><span class="k">def</span> <span class="nf">getHKLmax</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="s">&#39;finds maximum allowed hkl for given A within dmin&#39;</span>
    <span class="n">SGLaue</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]:</span>        <span class="c">#Rhombohedral axes</span>
        <span class="n">Hmax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">A2cell</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
        <span class="n">aHx</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">-</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="n">cHx</span> <span class="o">=</span> <span class="n">cell</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3.0</span><span class="o">*</span><span class="p">(</span><span class="mf">1.0</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">cell</span><span class="p">[</span><span class="mi">3</span><span class="p">])))</span>
        <span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">aHx</span><span class="o">/</span><span class="n">dmin</span><span class="p">))</span>
        <span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">cHx</span><span class="o">/</span><span class="n">dmin</span><span class="p">))</span>
        <span class="c">#print Hmax,aHx,cHx</span>
    <span class="k">else</span><span class="p">:</span>                           <span class="c"># all others</span>
        <span class="n">Hmax</span> <span class="o">=</span> <span class="n">MaxIndex</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Hmax</span>
    </div>
<div class="viewcode-block" id="GenHLaue"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GenHLaue">[docs]</a><span class="k">def</span> <span class="nf">GenHLaue</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Generate the crystallographically unique powder diffraction reflections</span>
<span class="sd">    for a lattice and Bravais type</span>
<span class="sd">    </span>
<span class="sd">    :param dmin: minimum d-spacing</span>
<span class="sd">    :param SGData: space group dictionary with at least</span>
<span class="sd">    </span>
<span class="sd">        * &#39;SGLaue&#39;: Laue group symbol: one of &#39;-1&#39;,&#39;2/m&#39;,&#39;mmm&#39;,&#39;4/m&#39;,&#39;6/m&#39;,&#39;4/mmm&#39;,&#39;6/mmm&#39;, &#39;3m1&#39;, &#39;31m&#39;, &#39;3&#39;, &#39;3R&#39;, &#39;3mR&#39;, &#39;m3&#39;, &#39;m3m&#39;</span>
<span class="sd">        * &#39;SGLatt&#39;: lattice centering: one of &#39;P&#39;,&#39;A&#39;,&#39;B&#39;,&#39;C&#39;,&#39;I&#39;,&#39;F&#39;</span>
<span class="sd">        * &#39;SGUniq&#39;: code for unique monoclinic axis one of &#39;a&#39;,&#39;b&#39;,&#39;c&#39; (only if &#39;SGLaue&#39; is &#39;2/m&#39;) otherwise an empty string</span>
<span class="sd">        </span>
<span class="sd">    :param A: reciprocal metric tensor elements as [G11,G22,G33,2*G12,2*G13,2*G23]</span>
<span class="sd">    :return: HKL = list of [h,k,l,d] sorted with largest d first and is unique </span>
<span class="sd">            part of reciprocal space ignoring anomalous dispersion</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">math</span>
    <span class="n">SGLaue</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span>
    <span class="n">SGLatt</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLatt&#39;</span><span class="p">]</span>
    <span class="n">SGUniq</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span>
    <span class="c">#finds maximum allowed hkl for given A within dmin</span>
    <span class="n">Hmax</span> <span class="o">=</span> <span class="n">getHKLmax</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
        
    <span class="n">dminsq</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">dmin</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">HKL</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span>                       <span class="c">#triclinic</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">hmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">k</span> <span class="o">==</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span> <span class="n">hmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;2/m&#39;</span><span class="p">:</span>                <span class="c">#monoclinic</span>
        <span class="n">axisnum</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">[</span><span class="s">&#39;a&#39;</span><span class="p">,</span><span class="s">&#39;b&#39;</span><span class="p">,</span><span class="s">&#39;c&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">SGUniq</span><span class="p">)</span>
        <span class="n">Hmax</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="n">axisnum</span><span class="p">,</span><span class="n">Hmax</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span><span class="n">lmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="o">-</span><span class="n">axisnum</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
                    <span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span> <span class="o">=</span> <span class="n">SwapIndx</span><span class="p">(</span><span class="n">axisnum</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;6/m&#39;</span><span class="p">]:</span>            <span class="c">#orthorhombic</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;mmm&#39;</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">kmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;4/mmm&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">]:</span>                  <span class="c">#tetragonal &amp; hexagonal</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">,</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]:</span>                  <span class="c">#trigonals</span>
        <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">hmin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">hmin</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">hmin</span><span class="p">,</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">]:</span>
                    <span class="n">kmax</span> <span class="o">=</span> <span class="n">h</span>
                    <span class="n">kmin</span> <span class="o">=</span> <span class="o">-</span><span class="nb">int</span><span class="p">((</span><span class="n">h</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kmin</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">kmax</span> <span class="o">=</span> <span class="n">h</span>
                    <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kmax</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;31m&#39;</span> <span class="ow">and</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">kmin</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">kmin</span><span class="p">,</span><span class="n">kmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
                        <span class="n">H</span> <span class="o">=</span> <span class="n">Hx2Rh</span><span class="p">(</span><span class="n">H</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>                                   <span class="c">#cubic</span>
        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Hmax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">lmin</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">lmax</span> <span class="o">=</span> <span class="n">k</span>
                <span class="k">if</span> <span class="n">SGLaue</span> <span class="o">==</span><span class="s">&#39;m3&#39;</span><span class="p">:</span>
                    <span class="n">lmax</span> <span class="o">=</span> <span class="n">h</span><span class="o">-</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span> <span class="n">lmax</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lmin</span><span class="p">,</span><span class="n">lmax</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">H</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="n">CentCheck</span><span class="p">(</span><span class="n">SGLatt</span><span class="p">,[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]):</span> <span class="n">H</span><span class="o">=</span><span class="p">[</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">H</span><span class="p">:</span>
                        <span class="n">rdsq</span> <span class="o">=</span> <span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">)</span>
                        <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">rdsq</span> <span class="o">&lt;=</span> <span class="n">dminsq</span><span class="p">:</span>
                            <span class="n">HKL</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="mi">1</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rdsq</span><span class="p">)])</span>
    <span class="k">return</span> <span class="n">sortHKLd</span><span class="p">(</span><span class="n">HKL</span><span class="p">,</span><span class="bp">True</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>

<span class="c">#Spherical harmonics routines</span></div>
<div class="viewcode-block" id="OdfChk"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.OdfChk">[docs]</a><span class="k">def</span> <span class="nf">OdfChk</span><span class="p">(</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">L</span><span class="o">%</span><span class="mi">2</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;0&#39;</span><span class="p">:</span>                      <span class="c">#cylindrical symmetry</span>
            <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;2/m&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;mmm&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;4/m&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;4/mmm&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">4</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;6/m&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;6/mmm&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">M</span><span class="p">)</span><span class="o">%</span><span class="mi">6</span> <span class="ow">and</span> <span class="n">M</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;m3&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">L</span><span class="o">%</span><span class="mi">12</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">elif</span> <span class="n">SGLaue</span> <span class="o">==</span> <span class="s">&#39;m3m&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">M</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">L</span><span class="o">%</span><span class="mi">12</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">M</span> <span class="o">&lt;=</span> <span class="n">L</span><span class="o">/</span><span class="mi">12</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
    <span class="k">return</span> <span class="bp">False</span>
        </div>
<div class="viewcode-block" id="GenSHCoeff"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GenSHCoeff">[docs]</a><span class="k">def</span> <span class="nf">GenSHCoeff</span><span class="p">(</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">SamSym</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">IfLMN</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">coeffNames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iord</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="p">)]:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">iord</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">iord</span><span class="o">+</span><span class="mi">1</span><span class="p">)]:</span>
            <span class="k">if</span> <span class="n">OdfChk</span><span class="p">(</span><span class="n">SamSym</span><span class="p">,</span><span class="n">iord</span><span class="p">,</span><span class="n">m</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">iord</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">iord</span><span class="o">+</span><span class="mi">1</span><span class="p">)]:</span>
                    <span class="k">if</span> <span class="n">OdfChk</span><span class="p">(</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">iord</span><span class="p">,</span><span class="n">n</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">IfLMN</span><span class="p">:</span>
                            <span class="n">coeffNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;C(</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iord</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">coeffNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;C(</span><span class="si">%d</span><span class="s">,</span><span class="si">%d</span><span class="s">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">iord</span><span class="p">,</span><span class="n">n</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">coeffNames</span>
    </div>
<div class="viewcode-block" id="CrsAng"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.CrsAng">[docs]</a><span class="k">def</span> <span class="nf">CrsAng</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">cell</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">al</span><span class="p">,</span><span class="n">be</span><span class="p">,</span><span class="n">ga</span> <span class="o">=</span> <span class="n">cell</span>
    <span class="n">SQ3</span> <span class="o">=</span> <span class="mf">1.732050807569</span>
    <span class="n">H1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">H2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">H3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">H4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">G</span><span class="p">,</span><span class="n">g</span> <span class="o">=</span> <span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
    <span class="n">Laue</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span>
    <span class="n">Naxis</span> <span class="o">=</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span>
    <span class="n">DH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">Laue</span> <span class="o">==</span> <span class="s">&#39;2/m&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Naxis</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">DR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H1</span><span class="p">))</span>
            <span class="n">DHR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H1</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">Naxis</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">DR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H2</span><span class="p">))</span>
            <span class="n">DHR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H2</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">DR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H3</span><span class="p">))</span>
            <span class="n">DHR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H3</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">Laue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;R3&#39;</span><span class="p">,</span><span class="s">&#39;R3m&#39;</span><span class="p">]:</span>
        <span class="n">DR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H4</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H4</span><span class="p">))</span>
        <span class="n">DHR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H4</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">DR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H3</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H3</span><span class="p">))</span>
        <span class="n">DHR</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">H3</span><span class="p">))</span>
    <span class="n">DHR</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">DR</span><span class="o">*</span><span class="n">DH</span><span class="p">)</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">DHR</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">,</span><span class="n">acosd</span><span class="p">(</span><span class="n">DHR</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">Laue</span> <span class="o">==</span> <span class="s">&#39;-1&#39;</span><span class="p">:</span>
        <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">ga</span><span class="p">))</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">Laue</span> <span class="o">==</span> <span class="s">&#39;2/m&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Naxis</span> <span class="o">==</span> <span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="p">(</span><span class="n">c</span><span class="o">-</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">al</span><span class="p">))</span>
            <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">al</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">elif</span> <span class="n">Naxis</span> <span class="o">==</span> <span class="s">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">c</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">be</span><span class="p">))</span>
            <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">be</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">ga</span><span class="p">))</span>
            <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">ga</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">elif</span> <span class="n">Laue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/m&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">]:</span>
        <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">a</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">b</span>
    
    <span class="k">elif</span> <span class="n">Laue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3R&#39;</span><span class="p">,</span><span class="s">&#39;3mR&#39;</span><span class="p">]:</span>
        <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">2.0</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">SQ3</span><span class="o">*</span><span class="p">(</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="n">Laue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
        <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">BA</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">BB</span> <span class="o">=</span> <span class="n">SQ3</span><span class="o">*</span><span class="n">H</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">atan2d</span><span class="p">(</span><span class="n">BA</span><span class="p">,</span><span class="n">BB</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">phi</span><span class="p">,</span><span class="n">beta</span>
    </div>
<div class="viewcode-block" id="SamAng"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.SamAng">[docs]</a><span class="k">def</span> <span class="nf">SamAng</span><span class="p">(</span><span class="n">Tth</span><span class="p">,</span><span class="n">Gangls</span><span class="p">,</span><span class="n">Sangl</span><span class="p">,</span><span class="n">IFCoup</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Compute sample orientation angles vs laboratory coord. system</span>

<span class="sd">    :param Tth:        Signed theta                                   </span>
<span class="sd">    :param Gangls:     Sample goniometer angles phi,chi,omega,azmuth  </span>
<span class="sd">    :param Sangl:      Sample angle zeros om-0, chi-0, phi-0          </span>
<span class="sd">    :param IFCoup:     True if omega &amp; 2-theta coupled in CW scan</span>
<span class="sd">    :returns:  </span>
<span class="sd">        psi,gam:    Sample odf angles                              </span>
<span class="sd">        dPSdA,dGMdA:    Angle zero derivatives</span>
<span class="sd">    &quot;&quot;&quot;</span>                         
    
    <span class="n">rpd</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.</span>
    <span class="k">if</span> <span class="n">IFCoup</span><span class="p">:</span>
        <span class="n">GSomeg</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">Tth</span><span class="p">)</span>
        <span class="n">GComeg</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">+</span><span class="n">Tth</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">GSomeg</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">GComeg</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">GSTth</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Tth</span><span class="p">)</span>
    <span class="n">GCTth</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Tth</span><span class="p">)</span>      
    <span class="n">GSazm</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">GCazm</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="n">GSchi</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">GCchi</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">GSphi</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">GCphi</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Gangls</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">SSomeg</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">SComeg</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">SSchi</span> <span class="o">=</span> <span class="n">sind</span><span class="p">(</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">SCchi</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">Sangl</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">AT</span> <span class="o">=</span> <span class="o">-</span><span class="n">GSTth</span><span class="o">*</span><span class="n">GComeg</span><span class="o">+</span><span class="n">GCTth</span><span class="o">*</span><span class="n">GCazm</span><span class="o">*</span><span class="n">GSomeg</span>
    <span class="n">BT</span> <span class="o">=</span> <span class="n">GSTth</span><span class="o">*</span><span class="n">GSomeg</span><span class="o">+</span><span class="n">GCTth</span><span class="o">*</span><span class="n">GCazm</span><span class="o">*</span><span class="n">GComeg</span>
    <span class="n">CT</span> <span class="o">=</span> <span class="o">-</span><span class="n">GCTth</span><span class="o">*</span><span class="n">GSazm</span><span class="o">*</span><span class="n">GSchi</span>
    <span class="n">DT</span> <span class="o">=</span> <span class="o">-</span><span class="n">GCTth</span><span class="o">*</span><span class="n">GSazm</span><span class="o">*</span><span class="n">GCchi</span>
    
    <span class="n">BC1</span> <span class="o">=</span> <span class="o">-</span><span class="n">AT</span><span class="o">*</span><span class="n">GSphi</span><span class="o">+</span><span class="p">(</span><span class="n">CT</span><span class="o">+</span><span class="n">BT</span><span class="o">*</span><span class="n">GCchi</span><span class="p">)</span><span class="o">*</span><span class="n">GCphi</span>
    <span class="n">BC2</span> <span class="o">=</span> <span class="n">DT</span><span class="o">-</span><span class="n">BT</span><span class="o">*</span><span class="n">GSchi</span>
    <span class="n">BC3</span> <span class="o">=</span> <span class="n">AT</span><span class="o">*</span><span class="n">GCphi</span><span class="o">+</span><span class="p">(</span><span class="n">CT</span><span class="o">+</span><span class="n">BT</span><span class="o">*</span><span class="n">GCchi</span><span class="p">)</span><span class="o">*</span><span class="n">GSphi</span>
      
    <span class="n">BC</span> <span class="o">=</span> <span class="n">BC1</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SCchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">-</span><span class="n">BC3</span><span class="o">*</span><span class="n">SSomeg</span>      
    <span class="n">psi</span> <span class="o">=</span> <span class="n">acosd</span><span class="p">(</span><span class="n">BC</span><span class="p">)</span>
    
    <span class="n">BD</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="n">BC</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">BD</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">rpd</span><span class="o">/</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">BD</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">C</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">dPSdA</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SCchi</span><span class="o">-</span><span class="n">BC2</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">-</span><span class="n">BC3</span><span class="o">*</span><span class="n">SComeg</span><span class="p">),</span>
        <span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SCchi</span><span class="p">),</span>
        <span class="o">-</span><span class="n">C</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">-</span><span class="n">BC3</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SCchi</span><span class="p">)]</span>
      
    <span class="n">BA</span> <span class="o">=</span> <span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SSchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SCchi</span>
    <span class="n">BB</span> <span class="o">=</span> <span class="n">BC1</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SCchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">+</span><span class="n">BC3</span><span class="o">*</span><span class="n">SComeg</span>
    <span class="n">gam</span> <span class="o">=</span> <span class="n">atan2d</span><span class="p">(</span><span class="n">BB</span><span class="p">,</span><span class="n">BA</span><span class="p">)</span>

    <span class="n">BD</span> <span class="o">=</span> <span class="p">(</span><span class="n">BA</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">BB</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">rpd</span>

    <span class="n">dBAdO</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">dBAdC</span> <span class="o">=</span> <span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SCchi</span><span class="o">-</span><span class="n">BC2</span><span class="o">*</span><span class="n">SSchi</span>
    <span class="n">dBAdF</span> <span class="o">=</span> <span class="n">BC3</span><span class="o">*</span><span class="n">SSchi</span>
    
    <span class="n">dBBdO</span> <span class="o">=</span> <span class="n">BC1</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SCchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SComeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">-</span><span class="n">BC3</span><span class="o">*</span><span class="n">SSomeg</span>
    <span class="n">dBBdC</span> <span class="o">=</span> <span class="o">-</span><span class="n">BC1</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SSchi</span><span class="o">+</span><span class="n">BC2</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SCchi</span>
    <span class="n">dBBdF</span> <span class="o">=</span> <span class="n">BC1</span><span class="o">*</span><span class="n">SComeg</span><span class="o">-</span><span class="n">BC3</span><span class="o">*</span><span class="n">SSomeg</span><span class="o">*</span><span class="n">SCchi</span>
    
    <span class="k">if</span> <span class="n">BD</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">:</span>
        <span class="n">dGMdA</span> <span class="o">=</span> <span class="p">[(</span><span class="n">BA</span><span class="o">*</span><span class="n">dBBdO</span><span class="o">-</span><span class="n">BB</span><span class="o">*</span><span class="n">dBAdO</span><span class="p">)</span><span class="o">/</span><span class="n">BD</span><span class="p">,(</span><span class="n">BA</span><span class="o">*</span><span class="n">dBBdC</span><span class="o">-</span><span class="n">BB</span><span class="o">*</span><span class="n">dBAdC</span><span class="p">)</span><span class="o">/</span><span class="n">BD</span><span class="p">,(</span><span class="n">BA</span><span class="o">*</span><span class="n">dBBdF</span><span class="o">-</span><span class="n">BB</span><span class="o">*</span><span class="n">dBAdF</span><span class="p">)</span><span class="o">/</span><span class="n">BD</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dGMdA</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>

        
    <span class="k">return</span> <span class="n">psi</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">dPSdA</span><span class="p">,</span><span class="n">dGMdA</span>
</div>
<span class="n">BOH</span> <span class="o">=</span> <span class="p">{</span>
<span class="s">&#39;L=2&#39;</span><span class="p">:[[],[],[]],</span>
<span class="s">&#39;L=4&#39;</span><span class="p">:[[</span><span class="mf">0.30469720</span><span class="p">,</span><span class="mf">0.36418281</span><span class="p">],[],[]],</span>
<span class="s">&#39;L=6&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.14104740</span><span class="p">,</span><span class="mf">0.52775103</span><span class="p">],[],[]],</span>
<span class="s">&#39;L=8&#39;</span><span class="p">:[[</span><span class="mf">0.28646862</span><span class="p">,</span><span class="mf">0.21545346</span><span class="p">,</span><span class="mf">0.32826995</span><span class="p">],[],[]],</span>
<span class="s">&#39;L=10&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.16413497</span><span class="p">,</span><span class="mf">0.33078546</span><span class="p">,</span><span class="mf">0.39371345</span><span class="p">],[],[]],</span>
<span class="s">&#39;L=12&#39;</span><span class="p">:[[</span><span class="mf">0.26141975</span><span class="p">,</span><span class="mf">0.27266871</span><span class="p">,</span><span class="mf">0.03277460</span><span class="p">,</span><span class="mf">0.32589402</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.09298802</span><span class="p">,</span><span class="o">-</span><span class="mf">0.23773812</span><span class="p">,</span><span class="mf">0.49446631</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=14&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.17557309</span><span class="p">,</span><span class="mf">0.25821932</span><span class="p">,</span><span class="mf">0.27709173</span><span class="p">,</span><span class="mf">0.33645360</span><span class="p">],[],[]],</span>
<span class="s">&#39;L=16&#39;</span><span class="p">:[[</span><span class="mf">0.24370673</span><span class="p">,</span><span class="mf">0.29873515</span><span class="p">,</span><span class="mf">0.06447688</span><span class="p">,</span><span class="mf">0.00377</span><span class="p">,</span><span class="mf">0.32574495</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.12039646</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25330128</span><span class="p">,</span><span class="mf">0.23950998</span><span class="p">,</span><span class="mf">0.40962508</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=18&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.16914245</span><span class="p">,</span><span class="mf">0.17017340</span><span class="p">,</span><span class="mf">0.34598142</span><span class="p">,</span><span class="mf">0.07433932</span><span class="p">,</span><span class="mf">0.32696037</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.06901768</span><span class="p">,</span><span class="mf">0.16006562</span><span class="p">,</span><span class="o">-</span><span class="mf">0.24743528</span><span class="p">,</span><span class="mf">0.47110273</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=20&#39;</span><span class="p">:[[</span><span class="mf">0.23067026</span><span class="p">,</span><span class="mf">0.31151832</span><span class="p">,</span><span class="mf">0.09287682</span><span class="p">,</span><span class="mf">0.01089683</span><span class="p">,</span><span class="mf">0.00037564</span><span class="p">,</span><span class="mf">0.32573563</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.13615420</span><span class="p">,</span><span class="o">-</span><span class="mf">0.25048007</span><span class="p">,</span><span class="mf">0.12882081</span><span class="p">,</span><span class="mf">0.28642879</span><span class="p">,</span><span class="mf">0.34620433</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=22&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.16109560</span><span class="p">,</span><span class="mf">0.10244188</span><span class="p">,</span><span class="mf">0.36285175</span><span class="p">,</span><span class="mf">0.13377513</span><span class="p">,</span><span class="mf">0.01314399</span><span class="p">,</span><span class="mf">0.32585583</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.09620055</span><span class="p">,</span><span class="mf">0.20244115</span><span class="p">,</span><span class="o">-</span><span class="mf">0.22389483</span><span class="p">,</span><span class="mf">0.17928946</span><span class="p">,</span><span class="mf">0.42017231</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=24&#39;</span><span class="p">:[[</span><span class="mf">0.22050742</span><span class="p">,</span><span class="mf">0.31770654</span><span class="p">,</span><span class="mf">0.11661736</span><span class="p">,</span><span class="mf">0.02049853</span><span class="p">,</span><span class="mf">0.00150861</span><span class="p">,</span><span class="mf">0.00003426</span><span class="p">,</span><span class="mf">0.32573505</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.13651722</span><span class="p">,</span><span class="o">-</span><span class="mf">0.21386648</span><span class="p">,</span><span class="mf">0.00522051</span><span class="p">,</span><span class="mf">0.33939435</span><span class="p">,</span><span class="mf">0.10837396</span><span class="p">,</span><span class="mf">0.32914497</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.05378596</span><span class="p">,</span><span class="o">-</span><span class="mf">0.11945819</span><span class="p">,</span><span class="mf">0.16272298</span><span class="p">,</span><span class="o">-</span><span class="mf">0.26449730</span><span class="p">,</span><span class="mf">0.44923956</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
<span class="s">&#39;L=26&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.15435003</span><span class="p">,</span><span class="mf">0.05261630</span><span class="p">,</span><span class="mf">0.35524646</span><span class="p">,</span><span class="mf">0.18578869</span><span class="p">,</span><span class="mf">0.03259103</span><span class="p">,</span><span class="mf">0.00186197</span><span class="p">,</span><span class="mf">0.32574594</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.11306511</span><span class="p">,</span><span class="mf">0.22072681</span><span class="p">,</span><span class="o">-</span><span class="mf">0.18706142</span><span class="p">,</span><span class="mf">0.05439948</span><span class="p">,</span><span class="mf">0.28122966</span><span class="p">,</span><span class="mf">0.35634355</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],[]],</span>
<span class="s">&#39;L=28&#39;</span><span class="p">:[[</span><span class="mf">0.21225019</span><span class="p">,</span><span class="mf">0.32031716</span><span class="p">,</span><span class="mf">0.13604702</span><span class="p">,</span><span class="mf">0.03132468</span><span class="p">,</span><span class="mf">0.00362703</span><span class="p">,</span><span class="mf">0.00018294</span><span class="p">,</span><span class="mf">0.00000294</span><span class="p">,</span><span class="mf">0.32573501</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.13219496</span><span class="p">,</span><span class="o">-</span><span class="mf">0.17206256</span><span class="p">,</span><span class="o">-</span><span class="mf">0.08742608</span><span class="p">,</span><span class="mf">0.32671661</span><span class="p">,</span><span class="mf">0.17973107</span><span class="p">,</span><span class="mf">0.02567515</span><span class="p">,</span><span class="mf">0.32619598</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.07989184</span><span class="p">,</span><span class="o">-</span><span class="mf">0.16735346</span><span class="p">,</span><span class="mf">0.18839770</span><span class="p">,</span><span class="o">-</span><span class="mf">0.20705337</span><span class="p">,</span><span class="mf">0.12926808</span><span class="p">,</span><span class="mf">0.42715602</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
<span class="s">&#39;L=30&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.14878368</span><span class="p">,</span><span class="mf">0.01524973</span><span class="p">,</span><span class="mf">0.33628434</span><span class="p">,</span><span class="mf">0.22632587</span><span class="p">,</span><span class="mf">0.05790047</span><span class="p">,</span><span class="mf">0.00609812</span><span class="p">,</span><span class="mf">0.00022898</span><span class="p">,</span><span class="mf">0.32573594</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.11721726</span><span class="p">,</span><span class="mf">0.20915005</span><span class="p">,</span><span class="o">-</span><span class="mf">0.11723436</span><span class="p">,</span><span class="o">-</span><span class="mf">0.07815329</span><span class="p">,</span><span class="mf">0.31318947</span><span class="p">,</span><span class="mf">0.13655742</span><span class="p">,</span><span class="mf">0.33241385</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.04297703</span><span class="p">,</span><span class="mf">0.09317876</span><span class="p">,</span><span class="o">-</span><span class="mf">0.11831248</span><span class="p">,</span><span class="mf">0.17355132</span><span class="p">,</span><span class="o">-</span><span class="mf">0.28164031</span><span class="p">,</span><span class="mf">0.42719361</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
<span class="s">&#39;L=32&#39;</span><span class="p">:[[</span><span class="mf">0.20533892</span><span class="p">,</span><span class="mf">0.32087437</span><span class="p">,</span><span class="mf">0.15187897</span><span class="p">,</span><span class="mf">0.04249238</span><span class="p">,</span><span class="mf">0.00670516</span><span class="p">,</span><span class="mf">0.00054977</span><span class="p">,</span><span class="mf">0.00002018</span><span class="p">,</span><span class="mf">0.00000024</span><span class="p">,</span><span class="mf">0.32573501</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.12775091</span><span class="p">,</span><span class="o">-</span><span class="mf">0.13523423</span><span class="p">,</span><span class="o">-</span><span class="mf">0.14935701</span><span class="p">,</span><span class="mf">0.28227378</span><span class="p">,</span><span class="mf">0.23670434</span><span class="p">,</span><span class="mf">0.05661270</span><span class="p">,</span><span class="mf">0.00469819</span><span class="p">,</span><span class="mf">0.32578978</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.09703829</span><span class="p">,</span><span class="o">-</span><span class="mf">0.19373733</span><span class="p">,</span><span class="mf">0.18610682</span><span class="p">,</span><span class="o">-</span><span class="mf">0.14407046</span><span class="p">,</span><span class="mf">0.00220535</span><span class="p">,</span><span class="mf">0.26897090</span><span class="p">,</span><span class="mf">0.36633402</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]],</span>
<span class="s">&#39;L=34&#39;</span><span class="p">:[[</span><span class="o">-</span><span class="mf">0.14409234</span><span class="p">,</span><span class="o">-</span><span class="mf">0.01343681</span><span class="p">,</span><span class="mf">0.31248977</span><span class="p">,</span><span class="mf">0.25557722</span><span class="p">,</span><span class="mf">0.08571889</span><span class="p">,</span><span class="mf">0.01351208</span><span class="p">,</span><span class="mf">0.00095792</span><span class="p">,</span><span class="mf">0.00002550</span><span class="p">,</span><span class="mf">0.32573508</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.11527834</span><span class="p">,</span><span class="mf">0.18472133</span><span class="p">,</span><span class="o">-</span><span class="mf">0.04403280</span><span class="p">,</span><span class="o">-</span><span class="mf">0.16908618</span><span class="p">,</span><span class="mf">0.27227021</span><span class="p">,</span><span class="mf">0.21086614</span><span class="p">,</span><span class="mf">0.04041752</span><span class="p">,</span><span class="mf">0.32688152</span><span class="p">,</span><span class="mf">0.0</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.06773139</span><span class="p">,</span><span class="mf">0.14120811</span><span class="p">,</span><span class="o">-</span><span class="mf">0.15835721</span><span class="p">,</span><span class="mf">0.18357456</span><span class="p">,</span><span class="o">-</span><span class="mf">0.19364673</span><span class="p">,</span><span class="mf">0.08377174</span><span class="p">,</span><span class="mf">0.43116318</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]]</span>
<span class="p">}</span>

<span class="n">Lnorm</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">L</span><span class="p">:</span> <span class="mf">4.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">L</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>

<div class="viewcode-block" id="GetKcl"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GetKcl">[docs]</a><span class="k">def</span> <span class="nf">GetKcl</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    <span class="n">RSQ2PI</span> <span class="o">=</span> <span class="mf">0.3989422804014</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>
    <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
        <span class="n">Kcl</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Kcl</span> <span class="o">+=</span> <span class="n">BOH</span><span class="p">[</span><span class="s">&#39;L=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">)][</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">im</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">RSQ2PI</span>
        <span class="k">if</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">SQ2</span>
        <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;R3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="n">N</span><span class="o">%</span><span class="mi">6</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Kcl</span>
    </div>
<div class="viewcode-block" id="GetKsl"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GetKsl">[docs]</a><span class="k">def</span> <span class="nf">GetKsl</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="n">SamSym</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">gam</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    <span class="n">RSQPI</span> <span class="o">=</span> <span class="mf">0.5641895835478</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>
    <span class="n">psrs</span><span class="p">,</span><span class="n">dpdps</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">M</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">psi</span><span class="p">)</span>
    <span class="n">psrs</span> <span class="o">*=</span> <span class="n">RSQPI</span>
    <span class="n">dpdps</span> <span class="o">*=</span> <span class="n">RSQPI</span>
    <span class="k">if</span> <span class="n">M</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">psrs</span> <span class="o">/=</span> <span class="n">SQ2</span>
        <span class="n">dpdps</span> <span class="o">/=</span> <span class="n">SQ2</span>
    <span class="k">if</span> <span class="n">SamSym</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,]:</span>
        <span class="n">dum</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span>
        <span class="n">Ksl</span> <span class="o">=</span> <span class="n">psrs</span><span class="o">*</span><span class="n">dum</span>
        <span class="n">dKsdp</span> <span class="o">=</span> <span class="n">dpdps</span><span class="o">*</span><span class="n">dum</span>
        <span class="n">dKsdg</span> <span class="o">=</span> <span class="o">-</span><span class="n">psrs</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dum</span> <span class="o">=</span> <span class="n">cosd</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span>
        <span class="n">Ksl</span> <span class="o">=</span> <span class="n">psrs</span><span class="o">*</span><span class="n">dum</span>
        <span class="n">dKsdp</span> <span class="o">=</span> <span class="n">dpdps</span><span class="o">*</span><span class="n">dum</span>
        <span class="n">dKsdg</span> <span class="o">=</span> <span class="n">psrs</span><span class="o">*</span><span class="n">M</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">sind</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">+</span><span class="n">cosd</span><span class="p">(</span><span class="n">M</span><span class="o">*</span><span class="n">gam</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Ksl</span><span class="p">,</span><span class="n">dKsdp</span><span class="p">,</span><span class="n">dKsdg</span> 
   </div>
<div class="viewcode-block" id="GetKclKsl"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.GetKclKsl">[docs]</a><span class="k">def</span> <span class="nf">GetKclKsl</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">SGLaue</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is used for spherical harmonics description of preferred orientation;</span>
<span class="sd">        cylindrical symmetry only (M=0) and no sample angle derivatives returned</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    <span class="n">RSQ2PI</span> <span class="o">=</span> <span class="mf">0.3989422804014</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>
    <span class="n">Ksl</span><span class="p">,</span><span class="n">x</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">psi</span><span class="p">)</span>
    <span class="n">Ksl</span> <span class="o">*=</span> <span class="n">RSQ2PI</span>
    <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
        <span class="n">Kcl</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
            <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">Kcl</span> <span class="o">+=</span> <span class="n">BOH</span><span class="p">[</span><span class="s">&#39;L=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">L</span><span class="p">)][</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">im</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
        <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">RSQ2PI</span>
        <span class="k">if</span> <span class="n">N</span><span class="p">:</span>
            <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">SQ2</span>
        <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;R3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">SGLaue</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="n">N</span><span class="o">%</span><span class="mi">6</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">N</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Kcl</span><span class="o">*</span><span class="n">Ksl</span><span class="p">,</span><span class="n">Lnorm</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Glnh"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Glnh">[docs]</a><span class="k">def</span> <span class="nf">Glnh</span><span class="p">(</span><span class="n">Start</span><span class="p">,</span><span class="n">SHCoef</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">gam</span><span class="p">,</span><span class="n">SamSym</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    <span class="n">RSQPI</span> <span class="o">=</span> <span class="mf">0.5641895835478</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>

    <span class="k">if</span> <span class="n">Start</span><span class="p">:</span>
        <span class="n">ptx</span><span class="o">.</span><span class="n">pyqlmninit</span><span class="p">()</span>
        <span class="n">Start</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">Fln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHCoef</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SHCoef</span><span class="p">):</span>
        <span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">))</span>
        <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">psi</span><span class="p">)</span>
        <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">RSQPI</span>
        <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pcrs</span> <span class="o">/=</span> <span class="n">SQ2</span>
        <span class="k">if</span> <span class="n">SamSym</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,]:</span>
            <span class="n">Ksl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Ksl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">))</span>
        <span class="n">Fln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHCoef</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">*</span><span class="n">Ksl</span><span class="o">*</span><span class="n">Lnorm</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">ODFln</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">SHCoef</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">SHCoef</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">Fln</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">ODFln</span>
</div>
<div class="viewcode-block" id="Flnh"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.Flnh">[docs]</a><span class="k">def</span> <span class="nf">Flnh</span><span class="p">(</span><span class="n">Start</span><span class="p">,</span><span class="n">SHCoef</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">SGData</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    
    <span class="n">FORPI</span> <span class="o">=</span> <span class="mf">12.5663706143592</span>
    <span class="n">RSQPI</span> <span class="o">=</span> <span class="mf">0.5641895835478</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>

    <span class="k">if</span> <span class="n">Start</span><span class="p">:</span>
        <span class="n">ptx</span><span class="o">.</span><span class="n">pyqlmninit</span><span class="p">()</span>
        <span class="n">Start</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="n">Fln</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">SHCoef</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">term</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">SHCoef</span><span class="p">):</span>
        <span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
            <span class="n">Kcl</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                <span class="n">im</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
                <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
                <span class="n">Kcl</span> <span class="o">+=</span> <span class="n">BOH</span><span class="p">[</span><span class="s">&#39;L=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">im</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>        
        <span class="k">else</span><span class="p">:</span>                <span class="c">#all but cubic</span>
            <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">phi</span><span class="p">)</span>
            <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">RSQPI</span>
            <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pcrs</span> <span class="o">/=</span> <span class="n">SQ2</span>
            <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;R3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span>
               <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span> 
                   <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">6</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                       <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
               <span class="k">else</span><span class="p">:</span>
                   <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span>
        <span class="n">Fln</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">SHCoef</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">*</span><span class="n">Kcl</span><span class="o">*</span><span class="n">Lnorm</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">ODFln</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">SHCoef</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">SHCoef</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span><span class="n">Fln</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">ODFln</span>
    </div>
<div class="viewcode-block" id="polfcal"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.polfcal">[docs]</a><span class="k">def</span> <span class="nf">polfcal</span><span class="p">(</span><span class="n">ODFln</span><span class="p">,</span><span class="n">SamSym</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">gam</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    <span class="n">RSQPI</span> <span class="o">=</span> <span class="mf">0.5641895835478</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>
    <span class="n">PolVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">gam</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">ODFln</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ODFln</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.e-3</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">))</span>
            <span class="n">psrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">psi</span><span class="p">),</span><span class="n">psi</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">SamSym</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;-1&#39;</span><span class="p">,</span><span class="s">&#39;2/m&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Ksl</span> <span class="o">=</span> <span class="n">RSQPI</span><span class="o">*</span><span class="n">psrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Ksl</span> <span class="o">=</span> <span class="n">RSQPI</span><span class="o">*</span><span class="n">psrs</span><span class="o">/</span><span class="n">SQ2</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Ksl</span> <span class="o">=</span> <span class="n">RSQPI</span><span class="o">*</span><span class="n">psrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">m</span><span class="o">*</span><span class="n">gam</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Ksl</span> <span class="o">=</span> <span class="n">RSQPI</span><span class="o">*</span><span class="n">psrs</span><span class="o">/</span><span class="n">SQ2</span>
            <span class="n">PolVal</span> <span class="o">+=</span> <span class="n">ODFln</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Ksl</span> 
    <span class="k">return</span> <span class="n">PolVal</span>
    </div>
<div class="viewcode-block" id="invpolfcal"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.invpolfcal">[docs]</a><span class="k">def</span> <span class="nf">invpolfcal</span><span class="p">(</span><span class="n">ODFln</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">beta</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="kn">import</span> <span class="nn">pytexture</span> <span class="kn">as</span> <span class="nn">ptx</span>
    
    <span class="n">FORPI</span> <span class="o">=</span> <span class="mf">12.5663706143592</span>
    <span class="n">RSQPI</span> <span class="o">=</span> <span class="mf">0.5641895835478</span>
    <span class="n">SQ2</span> <span class="o">=</span> <span class="mf">1.414213562373</span>

    <span class="n">invPolVal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">ODFln</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ODFln</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mf">1.e-3</span><span class="p">:</span>
            <span class="n">l</span><span class="p">,</span><span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;m3&#39;</span><span class="p">,</span><span class="s">&#39;m3m&#39;</span><span class="p">]:</span>
                <span class="n">Kcl</span> <span class="o">=</span> <span class="mf">0.0</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">l</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">):</span>
                    <span class="n">im</span> <span class="o">=</span> <span class="n">j</span><span class="o">/</span><span class="mi">4</span><span class="o">+</span><span class="mi">1</span>
                    <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>
                    <span class="n">Kcl</span> <span class="o">+=</span> <span class="n">BOH</span><span class="p">[</span><span class="s">&#39;L=&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">l</span><span class="p">)][</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">im</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>        
            <span class="k">else</span><span class="p">:</span>                <span class="c">#all but cubic</span>
                <span class="n">pcrs</span><span class="p">,</span><span class="n">dum</span> <span class="o">=</span> <span class="n">ptx</span><span class="o">.</span><span class="n">pyplmpsi</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">beta</span><span class="p">),</span><span class="n">phi</span><span class="p">)</span>
                <span class="n">pcrs</span> <span class="o">*=</span> <span class="n">RSQPI</span>
                <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">pcrs</span> <span class="o">/=</span> <span class="n">SQ2</span>
                <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;mmm&#39;</span><span class="p">,</span><span class="s">&#39;4/mmm&#39;</span><span class="p">,</span><span class="s">&#39;6/mmm&#39;</span><span class="p">,</span><span class="s">&#39;R3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span>
                   <span class="k">if</span> <span class="n">SGData</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;3mR&#39;</span><span class="p">,</span><span class="s">&#39;3m1&#39;</span><span class="p">,</span><span class="s">&#39;31m&#39;</span><span class="p">]:</span> 
                       <span class="k">if</span> <span class="n">n</span><span class="o">%</span><span class="mi">6</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                           <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">sind</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                       <span class="k">else</span><span class="p">:</span>
                           <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                   <span class="k">else</span><span class="p">:</span>
                       <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">Kcl</span> <span class="o">=</span> <span class="n">pcrs</span><span class="o">*</span><span class="p">(</span><span class="n">cosd</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">)</span><span class="o">+</span><span class="n">sind</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">beta</span><span class="p">))</span>
            <span class="n">invPolVal</span> <span class="o">+=</span> <span class="n">ODFln</span><span class="p">[</span><span class="n">term</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">Kcl</span> 
    <span class="k">return</span> <span class="n">invPolVal</span>
    
    </div>
<div class="viewcode-block" id="textureIndex"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.textureIndex">[docs]</a><span class="k">def</span> <span class="nf">textureIndex</span><span class="p">(</span><span class="n">SHCoef</span><span class="p">):</span>
    <span class="s">&#39;needs doc string&#39;</span>
    <span class="n">Tindx</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">SHCoef</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;C&#39;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">Tindx</span> <span class="o">+=</span> <span class="n">SHCoef</span><span class="p">[</span><span class="n">term</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">l</span><span class="o">+</span><span class="mf">1.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Tindx</span>
    
<span class="c"># self-test materials follow. </span></div>
<span class="n">selftestlist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="sd">&#39;&#39;&#39;Defines a list of self-tests&#39;&#39;&#39;</span>
<span class="n">selftestquiet</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">def</span> <span class="nf">_ReportTest</span><span class="p">():</span>
    <span class="s">&#39;Report name and doc string of current routine when ``selftestquiet`` is False&#39;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">selftestquiet</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">inspect</span>
        <span class="n">caller</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">caller</span><span class="p">)</span><span class="o">.</span><span class="n">__doc__</span>
        <span class="k">if</span> <span class="n">doc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;testing &#39;</span><span class="o">+</span><span class="n">__file__</span><span class="o">+</span><span class="s">&#39; with &#39;</span><span class="o">+</span><span class="n">caller</span><span class="o">+</span><span class="s">&#39; (&#39;</span><span class="o">+</span><span class="n">doc</span><span class="o">+</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;testing &#39;</span><span class="o">+</span><span class="n">__file__</span><span class="p">()</span><span class="o">+</span><span class="s">&quot; with &quot;</span><span class="o">+</span><span class="n">caller</span><span class="p">)</span>
<span class="n">NeedTestData</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">def</span> <span class="nf">TestData</span><span class="p">():</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span>
    <span class="k">global</span> <span class="n">NeedTestData</span>
    <span class="n">NeedTestData</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">global</span> <span class="n">CellTestData</span>
    <span class="c"># output from uctbx computed on platform darwin on 2010-05-28</span>
    <span class="n">CellTestData</span> <span class="o">=</span> <span class="p">[</span>
<span class="c"># cell, g, G, cell*, V, V*</span>
  <span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> 
   <span class="n">array</span><span class="p">([[</span>  <span class="mf">1.60000000e+01</span><span class="p">,</span>   <span class="mf">9.79717439e-16</span><span class="p">,</span>   <span class="mf">9.79717439e-16</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">9.79717439e-16</span><span class="p">,</span>   <span class="mf">1.60000000e+01</span><span class="p">,</span>   <span class="mf">9.79717439e-16</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">9.79717439e-16</span><span class="p">,</span>   <span class="mf">9.79717439e-16</span><span class="p">,</span>   <span class="mf">1.60000000e+01</span><span class="p">]]),</span> <span class="n">array</span><span class="p">([[</span>  <span class="mf">6.25000000e-02</span><span class="p">,</span>   <span class="mf">3.82702125e-18</span><span class="p">,</span>   <span class="mf">3.82702125e-18</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">3.82702125e-18</span><span class="p">,</span>   <span class="mf">6.25000000e-02</span><span class="p">,</span>   <span class="mf">3.82702125e-18</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">3.82702125e-18</span><span class="p">,</span>   <span class="mf">3.82702125e-18</span><span class="p">,</span>   <span class="mf">6.25000000e-02</span><span class="p">]]),</span> <span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">),</span> <span class="mf">64.0</span><span class="p">,</span> <span class="mf">0.015625</span><span class="p">],</span>
<span class="c"># cell, g, G, cell*, V, V*</span>
  <span class="p">[(</span><span class="mf">4.0999999999999996</span><span class="p">,</span> <span class="mf">5.2000000000000002</span><span class="p">,</span> <span class="mf">6.2999999999999998</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">130</span><span class="p">),</span> 
   <span class="n">array</span><span class="p">([[</span> <span class="mf">16.81</span>      <span class="p">,</span> <span class="o">-</span><span class="mf">13.70423184</span><span class="p">,</span>   <span class="mf">4.48533243</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">13.70423184</span><span class="p">,</span>  <span class="mf">27.04</span>      <span class="p">,</span>  <span class="o">-</span><span class="mf">5.6887143</span> <span class="p">],</span>
       <span class="p">[</span>  <span class="mf">4.48533243</span><span class="p">,</span>  <span class="o">-</span><span class="mf">5.6887143</span> <span class="p">,</span>  <span class="mf">39.69</span>      <span class="p">]]),</span> <span class="n">array</span><span class="p">([[</span> <span class="mf">0.10206349</span><span class="p">,</span>  <span class="mf">0.05083339</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00424823</span><span class="p">],</span>
       <span class="p">[</span> <span class="mf">0.05083339</span><span class="p">,</span>  <span class="mf">0.06344997</span><span class="p">,</span>  <span class="mf">0.00334956</span><span class="p">],</span>
       <span class="p">[</span><span class="o">-</span><span class="mf">0.00424823</span><span class="p">,</span>  <span class="mf">0.00334956</span><span class="p">,</span>  <span class="mf">0.02615544</span><span class="p">]]),</span> <span class="p">(</span><span class="mf">0.31947376387537696</span><span class="p">,</span> <span class="mf">0.25189277536327803</span><span class="p">,</span> <span class="mf">0.16172643497798223</span><span class="p">,</span> <span class="mf">85.283666420376008</span><span class="p">,</span> <span class="mf">94.716333579624006</span><span class="p">,</span> <span class="mf">50.825714168082683</span><span class="p">),</span> <span class="mf">100.98576357983838</span><span class="p">,</span> <span class="mf">0.0099023858863968445</span><span class="p">],</span>
<span class="c"># cell, g, G, cell*, V, V*</span>
  <span class="p">[(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">120</span><span class="p">),</span> 
   <span class="n">array</span><span class="p">([[</span>  <span class="mf">1.22500000e+01</span><span class="p">,</span>  <span class="o">-</span><span class="mf">6.12500000e+00</span><span class="p">,</span>   <span class="mf">1.28587914e-15</span><span class="p">],</span>
       <span class="p">[</span> <span class="o">-</span><span class="mf">6.12500000e+00</span><span class="p">,</span>   <span class="mf">1.22500000e+01</span><span class="p">,</span>   <span class="mf">1.28587914e-15</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">1.28587914e-15</span><span class="p">,</span>   <span class="mf">1.28587914e-15</span><span class="p">,</span>   <span class="mf">3.60000000e+01</span><span class="p">]]),</span> <span class="n">array</span><span class="p">([[</span>  <span class="mf">1.08843537e-01</span><span class="p">,</span>   <span class="mf">5.44217687e-02</span><span class="p">,</span>   <span class="mf">3.36690552e-18</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">5.44217687e-02</span><span class="p">,</span>   <span class="mf">1.08843537e-01</span><span class="p">,</span>   <span class="mf">3.36690552e-18</span><span class="p">],</span>
       <span class="p">[</span>  <span class="mf">3.36690552e-18</span><span class="p">,</span>   <span class="mf">3.36690552e-18</span><span class="p">,</span>   <span class="mf">2.77777778e-02</span><span class="p">]]),</span> <span class="p">(</span><span class="mf">0.32991443953692895</span><span class="p">,</span> <span class="mf">0.32991443953692895</span><span class="p">,</span> <span class="mf">0.16666666666666669</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">,</span> <span class="mf">60.000000000000021</span><span class="p">),</span> <span class="mf">63.652867178156257</span><span class="p">,</span> <span class="mf">0.015710211406520427</span><span class="p">],</span>
  <span class="p">]</span>
    <span class="k">global</span> <span class="n">CoordTestData</span>
    <span class="n">CoordTestData</span> <span class="o">=</span> <span class="p">[</span>
<span class="c"># cell, ((frac, ortho),...)</span>
  <span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,),</span> <span class="p">[</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.40000000000000002</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="mf">2.4492935982947065e-17</span><span class="p">,</span> <span class="mf">0.40000000000000002</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">2.4492935982947065e-17</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4492935982947065e-17</span><span class="p">,</span> <span class="mf">0.40000000000000002</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">),(</span><span class="mf">0.40000000000000013</span><span class="p">,</span> <span class="mf">0.79999999999999993</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">0.80000000000000016</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.40000000000000002</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.80000000000000004</span><span class="p">,</span> <span class="mf">0.40000000000000002</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">1.9999999999999998</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)),</span>
<span class="p">]),</span>
<span class="c"># cell, ((frac, ortho),...)</span>
  <span class="p">((</span><span class="mf">4.1</span><span class="p">,</span><span class="mf">5.2</span><span class="p">,</span><span class="mf">6.3</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">80</span><span class="p">,</span><span class="mi">130</span><span class="p">,),</span> <span class="p">[</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.40999999999999998</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.33424955703700043</span><span class="p">,</span> <span class="mf">0.39834311042186865</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">0.10939835193016617</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.051013289294572106</span><span class="p">,</span> <span class="mf">0.6183281045774256</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">),(</span><span class="mf">0.069695941716497567</span><span class="p">,</span> <span class="mf">0.64364635296002093</span><span class="p">,</span> <span class="mf">1.8549843137322766</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.073350319180835066</span><span class="p">,</span> <span class="mf">1.1440160419710339</span><span class="p">,</span> <span class="mf">0.6183281045774256</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">0.67089923785616512</span><span class="p">,</span> <span class="mf">0.74567293154916525</span><span class="p">,</span> <span class="mf">0.6183281045774256</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">0.92574397446582857</span><span class="p">,</span> <span class="mf">1.7366491056364828</span><span class="p">,</span> <span class="mf">3.0916405228871278</span><span class="p">)),</span>
<span class="p">]),</span>
<span class="c"># cell, ((frac, ortho),...)</span>
  <span class="p">((</span><span class="mf">3.5</span><span class="p">,</span><span class="mf">3.5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">,),</span> <span class="p">[</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="mf">0.35000000000000003</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),(</span><span class="o">-</span><span class="mf">0.17499999999999993</span><span class="p">,</span> <span class="mf">0.3031088913245536</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">3.6739403974420595e-17</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6739403974420595e-17</span><span class="p">,</span> <span class="mf">0.60000000000000009</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.10000000000000001</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">),(</span><span class="mf">2.7675166561703527e-16</span><span class="p">,</span> <span class="mf">0.60621778264910708</span><span class="p">,</span> <span class="mf">1.7999999999999998</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">0.17500000000000041</span><span class="p">,</span> <span class="mf">0.90932667397366063</span><span class="p">,</span> <span class="mf">0.60000000000000009</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.29999999999999999</span><span class="p">,</span> <span class="mf">0.20000000000000001</span><span class="p">,</span> <span class="mf">0.10000000000000001</span><span class="p">),(</span><span class="mf">0.70000000000000018</span><span class="p">,</span> <span class="mf">0.6062177826491072</span><span class="p">,</span> <span class="mf">0.60000000000000009</span><span class="p">)),</span>
 <span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),(</span><span class="mf">0.87500000000000067</span><span class="p">,</span> <span class="mf">1.5155444566227676</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">)),</span>
<span class="p">]),</span>
<span class="p">]</span>
    <span class="k">global</span> <span class="n">LaueTestData</span>             <span class="c">#generated by GSAS</span>
    <span class="n">LaueTestData</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;R 3 m&#39;</span><span class="p">:[(</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">120.</span><span class="p">),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span>
    <span class="s">&#39;R 3&#39;</span><span class="p">:[(</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">120.</span><span class="p">),((</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))],</span>
    <span class="s">&#39;P 3&#39;</span><span class="p">:[(</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">120.</span><span class="p">),((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">))],</span>
    <span class="s">&#39;P 3 m 1&#39;</span><span class="p">:[(</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">120.</span><span class="p">),((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">))],</span>
    <span class="s">&#39;P 3 1 m&#39;</span><span class="p">:[(</span><span class="mf">4.</span><span class="p">,</span><span class="mf">4.</span><span class="p">,</span><span class="mf">6.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">90.</span><span class="p">,</span><span class="mf">120.</span><span class="p">),((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
        <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">12</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))],</span>
    <span class="p">}</span>
    
    <span class="k">global</span> <span class="n">FLnhTestData</span>
    <span class="n">FLnhTestData</span> <span class="o">=</span> <span class="p">[{</span>
    <span class="s">&#39;C(4,0,0)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.965</span><span class="p">,</span> <span class="mf">0.42760447</span><span class="p">),</span>
    <span class="s">&#39;C(2,0,0)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">1.0122</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.80233610</span><span class="p">),</span>
    <span class="s">&#39;C(2,0,2)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.0061</span><span class="p">,</span> <span class="mf">8.37491546E-03</span><span class="p">),</span>
    <span class="s">&#39;C(6,0,4)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.0898</span><span class="p">,</span> <span class="mf">4.37985696E-02</span><span class="p">),</span>
    <span class="s">&#39;C(6,0,6)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1369</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.04081762E-02</span><span class="p">),</span>
    <span class="s">&#39;C(6,0,0)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.5935</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.18234928</span><span class="p">),</span>
    <span class="s">&#39;C(4,0,4)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.1872</span><span class="p">,</span> <span class="mf">0.16358127</span><span class="p">),</span>
    <span class="s">&#39;C(6,0,2)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mf">0.6193</span><span class="p">,</span> <span class="mf">0.27573633</span><span class="p">),</span>
    <span class="s">&#39;C(4,0,2)&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.1897</span><span class="p">,</span> <span class="mf">0.12530720</span><span class="p">)},[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span>
<span class="k">def</span> <span class="nf">test0</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test cell2Gmat, fillgmat, Gmat2cell&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">tG</span><span class="p">),</span><span class="n">msg</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">tg</span><span class="p">),</span><span class="n">msg</span>
        <span class="n">tcell</span> <span class="o">=</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">tcell</span><span class="p">),</span><span class="n">msg</span>
        <span class="n">tcell</span> <span class="o">=</span> <span class="n">Gmat2cell</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">tcell</span><span class="p">,</span><span class="n">trcell</span><span class="p">),</span><span class="n">msg</span>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test0</span><span class="p">)</span>

<div class="viewcode-block" id="test1"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test1">[docs]</a><span class="k">def</span> <span class="nf">test1</span><span class="p">():</span>
    <span class="s">&#39;test cell2A and A2Gmat&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test cell2A and A2Gmat&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">A2Gmat</span><span class="p">(</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">tG</span><span class="p">),</span><span class="n">msg</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">tg</span><span class="p">),</span><span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test1</span><span class="p">)</span>

<div class="viewcode-block" id="test2"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test2">[docs]</a><span class="k">def</span> <span class="nf">test2</span><span class="p">():</span>
    <span class="s">&#39;test Gmat2A, A2cell, A2Gmat, Gmat2cell&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test Gmat2A, A2cell, A2Gmat, Gmat2cell&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">cell2Gmat</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">tcell</span> <span class="o">=</span> <span class="n">A2cell</span><span class="p">(</span><span class="n">Gmat2A</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">tcell</span><span class="p">),</span><span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test2</span><span class="p">)</span>

<div class="viewcode-block" id="test3"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test3">[docs]</a><span class="k">def</span> <span class="nf">test3</span><span class="p">():</span>
    <span class="s">&#39;test invcell2Gmat&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test invcell2Gmat&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="n">G</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">invcell2Gmat</span><span class="p">(</span><span class="n">trcell</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">tG</span><span class="p">),</span><span class="n">msg</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">tg</span><span class="p">),</span><span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test3</span><span class="p">)</span>

<div class="viewcode-block" id="test4"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test4">[docs]</a><span class="k">def</span> <span class="nf">test4</span><span class="p">():</span>
    <span class="s">&#39;test calc_rVsq, calc_rV, calc_V&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test calc_rVsq, calc_rV, calc_V&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">calc_rV</span><span class="p">(</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">)),</span><span class="n">trV</span><span class="p">),</span> <span class="n">msg</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">calc_V</span><span class="p">(</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">)),</span><span class="n">tV</span><span class="p">),</span> <span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test4</span><span class="p">)</span>

<div class="viewcode-block" id="test5"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test5">[docs]</a><span class="k">def</span> <span class="nf">test5</span><span class="p">():</span>
    <span class="s">&#39;test A2invcell&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test A2invcell&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="n">tg</span><span class="p">,</span> <span class="n">tG</span><span class="p">,</span> <span class="n">trcell</span><span class="p">,</span> <span class="n">tV</span><span class="p">,</span> <span class="n">trV</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CellTestData</span><span class="p">:</span>
        <span class="n">rcell</span> <span class="o">=</span> <span class="n">A2invcell</span><span class="p">(</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">rcell</span><span class="p">,</span><span class="n">trcell</span><span class="p">),</span><span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test5</span><span class="p">)</span>

<div class="viewcode-block" id="test6"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test6">[docs]</a><span class="k">def</span> <span class="nf">test6</span><span class="p">():</span>
    <span class="s">&#39;test cell2AB&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;test cell2AB&#39;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="n">coordlist</span><span class="p">)</span> <span class="ow">in</span> <span class="n">CoordTestData</span><span class="p">:</span>
        <span class="n">A</span><span class="p">,</span><span class="n">B</span> <span class="o">=</span> <span class="n">cell2AB</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="n">ortho</span><span class="p">)</span> <span class="ow">in</span> <span class="n">coordlist</span><span class="p">:</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="n">frac</span><span class="p">)</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inner</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="n">to</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">ortho</span><span class="p">,</span><span class="n">to</span><span class="p">),</span> <span class="n">msg</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="n">tf</span><span class="p">),</span> <span class="n">msg</span>
            <span class="n">to</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">A</span><span class="o">*</span><span class="n">frac</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">B</span><span class="o">*</span><span class="n">to</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">ortho</span><span class="p">,</span><span class="n">to</span><span class="p">),</span> <span class="n">msg</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">frac</span><span class="p">,</span><span class="n">tf</span><span class="p">),</span> <span class="n">msg</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test6</span><span class="p">)</span>

<div class="viewcode-block" id="test7"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test7">[docs]</a><span class="k">def</span> <span class="nf">test7</span><span class="p">():</span>
    <span class="s">&#39;test GetBraviasNum(...) and GenHBravais(...)&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">os.path</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">spc</span>
    <span class="n">testdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span> <span class="n">__file__</span> <span class="p">))[</span><span class="mi">0</span><span class="p">],</span><span class="s">&#39;testinp&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">testdir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">testdir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">testdir</span><span class="p">)</span>
    <span class="kn">import</span> <span class="nn">sgtbxlattinp</span>
    <span class="n">derror</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="k">def</span> <span class="nf">indexmatch</span><span class="p">(</span><span class="n">hklin</span><span class="p">,</span> <span class="n">hkllist</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">hklref</span> <span class="ow">in</span> <span class="n">hkllist</span><span class="p">:</span>
            <span class="n">hklref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hklref</span><span class="p">)</span>
            <span class="c"># these permutations are far from complete, but are sufficient to </span>
            <span class="c"># allow the test to complete</span>
            <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
                <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),]</span>
            <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span><span class="p">:</span>
                <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>

            <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permlist</span><span class="p">:</span>
                <span class="n">hkl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">hklin</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">hkl</span> <span class="o">==</span> <span class="n">hklref</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
                <span class="k">if</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hkl</span><span class="p">]</span> <span class="o">==</span> <span class="n">hklref</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx7</span><span class="p">:</span>
        <span class="n">spdict</span> <span class="o">=</span> <span class="n">spc</span><span class="o">.</span><span class="n">SpcGroup</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx7</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;SGSys&#39;</span><span class="p">]</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="s">&#39;SGLatt&#39;</span><span class="p">]</span>

        <span class="n">bravcode</span> <span class="o">=</span> <span class="n">GetBraviasNum</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">system</span><span class="p">)</span>

        <span class="n">g2list</span> <span class="o">=</span> <span class="n">GenHBravais</span><span class="p">(</span><span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">dmin</span><span class="p">,</span> <span class="n">bravcode</span><span class="p">,</span> <span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx7</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">g2list</span><span class="p">),</span> <span class="s">&#39;Reflection lists differ for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span>
        <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">num</span> <span class="ow">in</span> <span class="n">g2list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hkllist</span><span class="p">,</span><span class="n">dref</span> <span class="ow">in</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx7</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">dref</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">derror</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indexmatch</span><span class="p">((</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,),</span> <span class="n">hkllist</span><span class="p">,</span> <span class="n">system</span><span class="p">):</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span><span class="s">&#39;No match for </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="n">key</span><span class="p">)</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test7</span><span class="p">)</span>

<div class="viewcode-block" id="test8"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test8">[docs]</a><span class="k">def</span> <span class="nf">test8</span><span class="p">():</span>
    <span class="s">&#39;test GenHLaue&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">spc</span>
    <span class="kn">import</span> <span class="nn">sgtbxlattinp</span>
    <span class="n">derror</span> <span class="o">=</span> <span class="mf">1e-4</span>
    <span class="n">dmin</span> <span class="o">=</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">dmin</span>

    <span class="k">def</span> <span class="nf">indexmatch</span><span class="p">(</span><span class="n">hklin</span><span class="p">,</span> <span class="n">hklref</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">axis</span><span class="p">):</span>
        <span class="c"># these permutations are far from complete, but are sufficient to </span>
        <span class="c"># allow the test to complete</span>
        <span class="k">if</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;cubic&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),]</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span> <span class="ow">and</span> <span class="n">axis</span><span class="o">==</span><span class="s">&#39;b&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span> <span class="ow">and</span> <span class="n">axis</span><span class="o">==</span><span class="s">&#39;a&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;monoclinic&#39;</span> <span class="ow">and</span> <span class="n">axis</span><span class="o">==</span><span class="s">&#39;c&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;trigonal&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>
        <span class="k">elif</span> <span class="n">system</span> <span class="o">==</span> <span class="s">&#39;rhombohedral&#39;</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">permlist</span> <span class="o">=</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)]</span>

        <span class="n">hklref</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">hklref</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">permlist</span><span class="p">:</span>
            <span class="n">hkl</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">hklin</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">perm</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">hkl</span> <span class="o">==</span> <span class="n">hklref</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
            <span class="k">if</span> <span class="p">[</span><span class="o">-</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">hkl</span><span class="p">]</span> <span class="o">==</span> <span class="n">hklref</span><span class="p">:</span> <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx8</span><span class="p">:</span>
        <span class="n">spdict</span> <span class="o">=</span> <span class="n">spc</span><span class="o">.</span><span class="n">SpcGroup</span><span class="p">(</span><span class="n">key</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx8</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="s">&#39;SGLatt&#39;</span><span class="p">]</span>
        <span class="n">Laue</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="s">&#39;SGLaue&#39;</span><span class="p">]</span>
        <span class="n">Axis</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="s">&#39;SGUniq&#39;</span><span class="p">]</span>
        <span class="n">system</span> <span class="o">=</span> <span class="n">spdict</span><span class="p">[</span><span class="s">&#39;SGSys&#39;</span><span class="p">]</span>

        <span class="n">g2list</span> <span class="o">=</span> <span class="n">GenHLaue</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">spdict</span><span class="p">,</span><span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">))</span>
        <span class="c">#if len(g2list) != len(sgtbxlattinp.sgtbx8[key][1]):</span>
        <span class="c">#    print &#39;failed&#39;,key,&#39;:&#39; ,len(g2list),&#39;vs&#39;,len(sgtbxlattinp.sgtbx8[key][1])</span>
        <span class="c">#    print &#39;GSAS-II:&#39;</span>
        <span class="c">#    for h,k,l,d in g2list: print &#39;  &#39;,(h,k,l),d</span>
        <span class="c">#    print &#39;SGTBX:&#39;</span>
        <span class="c">#    for hkllist,dref in sgtbxlattinp.sgtbx8[key][1]: print &#39;  &#39;,hkllist,dref</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">g2list</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx8</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span>
            <span class="s">&#39;Reflection lists differ for </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span>
            <span class="p">)</span>
        <span class="c">#match = True</span>
        <span class="k">for</span> <span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">d</span> <span class="ow">in</span> <span class="n">g2list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">hkllist</span><span class="p">,</span><span class="n">dref</span> <span class="ow">in</span> <span class="n">sgtbxlattinp</span><span class="o">.</span><span class="n">sgtbx8</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span> 
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d</span><span class="o">-</span><span class="n">dref</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">derror</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">indexmatch</span><span class="p">((</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">,),</span> <span class="n">hkllist</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">Axis</span><span class="p">):</span> <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="mi">0</span><span class="p">,</span><span class="s">&#39;No match for </span><span class="si">%s</span><span class="s"> at </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">((</span><span class="n">h</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="n">key</span><span class="p">)</span>
                <span class="c">#match = False</span>
        <span class="c">#if not match: </span>
            <span class="c">#for hkllist,dref in sgtbxlattinp.sgtbx8[key][1]: print &#39;  &#39;,hkllist,dref</span>
            <span class="c">#print center, Laue, Axis, system</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test8</span><span class="p">)</span>
            
<div class="viewcode-block" id="test9"><a class="viewcode-back" href="../GSASIIutil.html#GSASIIlattice.test9">[docs]</a><span class="k">def</span> <span class="nf">test9</span><span class="p">():</span>
    <span class="s">&#39;test GenHLaue&#39;</span>
    <span class="n">_ReportTest</span><span class="p">()</span>
    <span class="kn">import</span> <span class="nn">GSASIIspc</span> <span class="kn">as</span> <span class="nn">G2spc</span>
    <span class="k">if</span> <span class="n">NeedTestData</span><span class="p">:</span> <span class="n">TestData</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">spc</span> <span class="ow">in</span> <span class="n">LaueTestData</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">LaueTestData</span><span class="p">[</span><span class="n">spc</span><span class="p">]</span>
        <span class="n">cell</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">hklm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">H</span> <span class="o">=</span> <span class="n">hklm</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">hklO</span> <span class="o">=</span> <span class="n">hklm</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="n">A</span> <span class="o">=</span> <span class="n">cell2A</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>
        <span class="n">dmin</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">calc_rDsq</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
        <span class="n">SGData</span> <span class="o">=</span> <span class="n">G2spc</span><span class="o">.</span><span class="n">SpcGroup</span><span class="p">(</span><span class="n">spc</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">hkls</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">GenHLaue</span><span class="p">(</span><span class="n">dmin</span><span class="p">,</span><span class="n">SGData</span><span class="p">,</span><span class="n">A</span><span class="p">))</span>
        <span class="n">hklN</span> <span class="o">=</span> <span class="n">hkls</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
        <span class="c">#print spc,hklO.shape,hklN.shape</span>
        <span class="n">err</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">for</span> <span class="n">H</span> <span class="ow">in</span> <span class="n">hklO</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">H</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hklN</span><span class="p">:</span>
                <span class="k">print</span> <span class="n">H</span><span class="p">,</span><span class="s">&#39; missing from hkl from GSASII&#39;</span>
                <span class="n">err</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">err</span><span class="p">)</span></div>
<span class="n">selftestlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test9</span><span class="p">)</span>
        
        
    

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c"># run self-tests</span>
    <span class="n">selftestquiet</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">test</span> <span class="ow">in</span> <span class="n">selftestlist</span><span class="p">:</span>
        <span class="n">test</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&quot;OK&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/G2_html_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>