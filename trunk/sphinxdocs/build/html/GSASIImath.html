

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>GSASIImath: computation module &mdash; GSAS-II 0.2.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '0.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="GSAS-II 0.2.0 documentation" href="index.html" />
    <link rel="next" title="GSASIIindex: Cell Indexing Module" href="GSASIIindex.html" />
    <link rel="prev" title="GSASIIimage: Image calc module" href="GSASIIimage.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GSASIIindex.html" title="GSASIIindex: Cell Indexing Module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="GSASIIimage.html" title="GSASIIimage: Image calc module"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <span class="target" id="module-GSASIImath"></span><div class="section" id="gsasiimath-computation-module">
<h1><em>GSASIImath: computation module</em><a class="headerlink" href="#gsasiimath-computation-module" title="Permalink to this headline">¶</a></h1>
<p>Routines for least-squares minimization and other stuff</p>
<dl class="function">
<dt id="GSASIImath.anneal">
<tt class="descclassname">GSASIImath.</tt><tt class="descname">anneal</tt><big>(</big><em>func</em>, <em>x0</em>, <em>args=()</em>, <em>schedule='fast'</em>, <em>full_output=0</em>, <em>T0=None</em>, <em>Tf=1e-12</em>, <em>maxeval=None</em>, <em>maxaccept=None</em>, <em>maxiter=400</em>, <em>boltzmann=1.0</em>, <em>learn_rate=0.5</em>, <em>feps=1e-06</em>, <em>quench=1.0</em>, <em>m=1.0</em>, <em>n=1.0</em>, <em>lower=-100</em>, <em>upper=100</em>, <em>dwell=50</em>, <em>slope=0.9</em><big>)</big><a class="headerlink" href="#GSASIImath.anneal" title="Permalink to this definition">¶</a></dt>
<dd><p>Minimize a function using simulated annealing.</p>
<p>Schedule is a schedule class implementing the annealing schedule.
Available ones are &#8216;fast&#8217;, &#8216;cauchy&#8217;, &#8216;boltzmann&#8217;</p>
<dl class="docutils">
<dt>func <span class="classifier-delimiter">:</span> <span class="classifier">callable f(x, <a href="#id1"><span class="problematic" id="id2">*</span></a>args)</span></dt>
<dd>Function to be optimized.</dd>
<dt>x0 <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Initial guess.</dd>
<dt>args <span class="classifier-delimiter">:</span> <span class="classifier">tuple</span></dt>
<dd>Extra parameters to <cite>func</cite>.</dd>
<dt>schedule <span class="classifier-delimiter">:</span> <span class="classifier">base_schedule</span></dt>
<dd>Annealing schedule to use (a class).</dd>
<dt>full_output <span class="classifier-delimiter">:</span> <span class="classifier">bool</span></dt>
<dd>Whether to return optional outputs.</dd>
<dt>T0 <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Initial Temperature (estimated as 1.2 times the largest
cost-function deviation over random points in the range).</dd>
<dt>Tf <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Final goal temperature.</dd>
<dt>maxeval <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Maximum function evaluations.</dd>
<dt>maxaccept <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Maximum changes to accept.</dd>
<dt>maxiter <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Maximum cooling iterations.</dd>
<dt>learn_rate <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Scale constant for adjusting guesses.</dd>
<dt>boltzmann <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Boltzmann constant in acceptance test
(increase for less stringent test at each temperature).</dd>
<dt>feps <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Stopping relative error tolerance for the function value in
last four coolings.</dd>
<dt>quench, m, n <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Parameters to alter fast_sa schedule.</dd>
<dt>lower, upper <span class="classifier-delimiter">:</span> <span class="classifier">float or ndarray</span></dt>
<dd>Lower and upper bounds on <cite>x</cite>.</dd>
<dt>dwell <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>The number of times to search the space at each temperature.</dd>
<dt>slope <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Parameter for log schedule</dd>
</dl>
<dl class="docutils">
<dt>xmin <span class="classifier-delimiter">:</span> <span class="classifier">ndarray</span></dt>
<dd>Point giving smallest value found.</dd>
<dt>Jmin <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Minimum value of function found.</dd>
<dt>T <span class="classifier-delimiter">:</span> <span class="classifier">float</span></dt>
<dd>Final temperature.</dd>
<dt>feval <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of function evaluations.</dd>
<dt>iters <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of cooling iterations.</dd>
<dt>accept <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd>Number of tests accepted.</dd>
<dt>retval <span class="classifier-delimiter">:</span> <span class="classifier">int</span></dt>
<dd><p class="first">Flag indicating stopping condition:</p>
<div class="last highlight-python"><pre>0 : Points no longer changing
1 : Cooled to final temperature
2 : Maximum function evaluations
3 : Maximum cooling iterations reached
4 : Maximum accepted query locations reached
5 : Final point not the minimum amongst encountered points</pre>
</div>
</dd>
</dl>
<p>Simulated annealing is a random algorithm which uses no derivative
information from the function being optimized. In practice it has
been more useful in discrete optimization than continuous
optimization, as there are usually better algorithms for continuous
optimization problems.</p>
<p>Some experimentation by trying the difference temperature
schedules and altering their parameters is likely required to
obtain good performance.</p>
<p>The randomness in the algorithm comes from random sampling in numpy.
To obtain the same results you can call numpy.random.seed with the
same seed immediately before calling scipy.optimize.anneal.</p>
<p>We give a brief description of how the three temperature schedules
generate new points and vary their temperature. Temperatures are
only updated with iterations in the outer loop. The inner loop is
over loop over xrange(dwell), and new points are generated for
every iteration in the inner loop. (Though whether the proposed
new points are accepted is probabilistic.)</p>
<p>For readability, let d denote the dimension of the inputs to func.
Also, let x_old denote the previous state, and k denote the
iteration number of the outer loop. All other variables not
defined below are input variables to scipy.optimize.anneal itself.</p>
<p>In the &#8216;fast&#8217; schedule the updates are</p>
<div class="highlight-python"><pre>u ~ Uniform(0, 1, size=d)
y = sgn(u - 0.5) * T * ((1+ 1/T)**abs(2u-1) -1.0)
xc = y * (upper - lower)
x_new = x_old + xc

c = n * exp(-n * quench)
T_new = T0 * exp(-c * k**quench)</pre>
</div>
<p>In the &#8216;cauchy&#8217; schedule the updates are</p>
<div class="highlight-python"><pre>u ~ Uniform(-pi/2, pi/2, size=d)
xc = learn_rate * T * tan(u)
x_new = x_old + xc

T_new = T0 / (1+k)</pre>
</div>
<p>In the &#8216;boltzmann&#8217; schedule the updates are</p>
<div class="highlight-python"><pre>std = minimum( sqrt(T) * ones(d), (upper-lower) / (3*learn_rate) )
y ~ Normal(0, std, size=d)
x_new = x_old + learn_rate * y

T_new = T0 / log(1+k)</pre>
</div>
</dd></dl>

</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="GSASIIimage.html"
                        title="previous chapter"><em>GSASIIimage: Image calc module</em></a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="GSASIIindex.html"
                        title="next chapter"><em>GSASIIindex: Cell Indexing Module</em></a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/GSASIImath.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="GSASIIindex.html" title="GSASIIindex: Cell Indexing Module"
             >next</a> |</li>
        <li class="right" >
          <a href="GSASIIimage.html" title="GSASIIimage: Image calc module"
             >previous</a> |</li>
        <li><a href="index.html">GSAS-II 0.2.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Von Dreele and Toby for Argonne National Laboratory.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>